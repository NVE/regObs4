<ion-accordion-group *ngIf="!isNativePlatform; else observationsDaysBackOnly" (ionChange)="toggleAccordion($event)">
  <ion-accordion value="first">
    <ion-item slot="header" color="light">
      <ion-label color="dark" position="stacked">
        {{ "MENU.TIMESPAN" | translate }}
      </ion-label>
      <ng-container *ngIf="useDaysBack$ | async; else showDateRange">
        <ng-container *ngIf="{ daysBack: daysBackSubject | async } as daysBack">
          <ion-text *ngIf="!isOpen" class="ion-align-self-start">
            <app-check-days-or-weeks-back [daysBack]="daysBack.daysBack"></app-check-days-or-weeks-back>
          </ion-text>
        </ng-container>
      </ng-container>
    </ion-item>
    <div slot="content">
      <ion-list *ngIf="mode$ | async as mode">
        <ion-radio-group [value]="mode" (ionChange)="changeMode($event)">
          <ion-item>
            <ion-radio slot="start" value="predefined"></ion-radio>
            <app-observations-days-back (changeDaysBack)="setUseDaysBack($event)"></app-observations-days-back>
          </ion-item>

          <ion-item>
            <ion-radio slot="start" value="custom"></ion-radio>
            <ion-label>{{ "MENU.CUSTOM_TIMESPAN" | translate }}</ion-label>
          </ion-item>

          <ion-item class="white-background" *ngIf="mode === 'custom'">
            <ion-label slot="start">{{ "MENU.START_DATE" | translate }}</ion-label>
            <app-datetime-picker
              presentation="date"
              [dateTime]="fromDate$ | async"
              [minDate]="minDate"
              [maxDate]="(toDate$ | async) || maxDate"
              (dateTimeChange)="setFromDate($event)"
              dateTimeFormat="dd. MMM yyyy"
              textAlign="right"
              buttonSize="large"
            ></app-datetime-picker>
          </ion-item>

          <ion-item class="white-background" *ngIf="mode === 'custom'">
            <ion-label slot="start">{{ "MENU.END_DATE" | translate }}</ion-label>
            <app-datetime-picker
              presentation="date"
              [dateTime]="toDate$ | async"
              [minDate]="(fromDate$ | async) || minDate"
              [maxDate]="maxDate"
              (dateTimeChange)="setToDate($event)"
              dateTimeFormat="dd. MMM yyyy"
              textAlign="right"
              buttonSize="large"
            ></app-datetime-picker>
          </ion-item>
        </ion-radio-group>
      </ion-list>
    </div>
  </ion-accordion>
</ion-accordion-group>

<ng-template #showDateRange>
  <ng-container *ngIf="dateRangeText$ | async as dateRangeText">
    <ion-text *ngIf="!isOpen" class="ion-align-self-start">
      <span>{{ dateRangeText }}</span>
    </ion-text>
  </ng-container>
</ng-template>

<ng-template #observationsDaysBackOnly>
  <app-observations-days-back (changeDaysBack)="setUseDaysBack($event)"></app-observations-days-back>
</ng-template>
