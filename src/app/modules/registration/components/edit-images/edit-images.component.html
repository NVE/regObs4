<div class="images">
  <!-- Existing attachments -->
  <div class="image-wrapper" *ngFor="let attachment of filteredExistingImages; trackBy: trackExisting">
    <app-remote-image
      [attachment]="attachment"
      preferSize="Large"
      withFallbackText="true"
      largeFallback="true"
    ></app-remote-image>
    <ion-fab class="ion-no-margin" slot="fixed" vertical="top" horizontal="end">
      <ion-fab-button size="small" color="dark" class="map-control-fab" (click)="removeExistingImage(attachment)">
        <ion-icon name="close"></ion-icon>
      </ion-fab-button>
    </ion-fab>
    <app-text-comment
      [(value)]="attachment.Comment"
      title="{{ pictureCommentText | translate }}"
      rows="2"
      placeholder="{{ pictureCommentPlaceholder | translate }}"
    ></app-text-comment>
  </div>

  <!-- New attachments -->
  <div class="image-wrapper" *ngFor="let attachment of newAttachments$ | async; trackBy: trackNew">
    <!-- <img [src]="convertFileSrc(image.PictureImageBase64)" /> -->
    <ro-blob-image [imgBlob]="attachment.blob"></ro-blob-image>
    <div class="upload-progress" *ngIf="attachment.state === 'in-progress'">
      <ion-progress-bar
        [type]="attachment.progress === 0 ? 'indeterminate' : 'determinate'"
        [value]="attachment.progress"
      ></ion-progress-bar>
    </div>
    <ion-fab class="ion-no-margin" slot="fixed" vertical="top" horizontal="end">
      <ion-fab-button
        size="small"
        color="dark"
        class="map-control-fab"
        (click)="removeNewImage(attachment)"
        [disabled]="attachment.state === 'in-progress'"
      >
        <ion-icon name="close"></ion-icon>
      </ion-fab-button>
    </ion-fab>

    <app-text-comment
      [value]="attachment.Comment"
      (valueChange)="setNewAttachmentComment(attachment, $event)"
      title="{{ pictureCommentText | translate }}"
      rows="2"
      placeholder="{{ pictureCommentPlaceholder | translate }}"
    ></app-text-comment>
  </div>
</div>

<ion-item *ngIf="isHybrid" (click)="addClick()">
  <ion-icon [color]="iconColor" [name]="icon" slot="start"></ion-icon>
  <ion-label>{{ title | translate }}</ion-label>
</ion-item>

<ion-item class="file-drop" *ngIf="!isHybrid">
  <ngx-file-drop
    style="width: 100%"
    dropZoneLabel="Drop files here"
    [accept]="accept"
    dropZoneClassName="drop-zone"
    (onFileDrop)="dropped($event)"
  >
    <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector">
      <button type="button" (click)="openFileSelector()">
        <ion-item [ngClass]="{ grey: aboutToDrop }" (dragenter)="aboutToDrop = true" (dragleave)="aboutToDrop = false">
          <ion-icon [color]="iconColor" [name]="icon" slot="start"></ion-icon>
          <ion-label>{{ title | translate }}</ion-label>
        </ion-item>
      </button>
    </ng-template>
  </ngx-file-drop>
</ion-item>
