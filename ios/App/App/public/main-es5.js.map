{"version":3,"mappings":"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,EAAEgmE,KADqB;AAEzB/uE,uBAAS,EAATA,SAFyB;AAGzByzC,qBAAO,EAAEtuB,gDAAShH,IAAT,EAHgB;AAIzBu1B,wBAAU,EAAEm7B,qGAJa;AAKzBv8D,qBAAO,EAAE;AACP/R,yBAAS,EAAE,IADJ;AAEPL,4BAAY,EAAEF;AAFP;AALgB,aAA3B;AAUA,mBAAOoD,GAAP;AACD,YAED;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;iBAEM,0BAAiBnP,OAAjB,EAAmCmP,GAAnC,EAAqD;;;;;;;;AACpC,6BAAM,KAAKxD,iBAAL,CAAuBwE,wBAAvB,EAAN;;;AAAfgE;;0BACDA,YAAY,CAACC;;;;;AAChB,2BAAKzI,iBAAL,CAAuB0I,MAAvB;;;;AAGFlF,yBAAG,CAACswC,UAAJ,GAAiBm7B,oGAAjB;AACA,2BAAKH,yBAAL,CAA+B3kB,WAA/B,CAA2C3mD,GAA3C,EAAgD,IAAhD,EAAsD,IAAtD,EAA4DhQ,SAA5D,IACA;;AACA,2BAAKiU,aAAL,CAAmBkqC,YAAnB,CAAgC,iBAAhC;;;;;;;;;AACD,YAED;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;iBAEM,2BAAkB/gC,MAAlB,EAAuC;;;;;;0DACpC,sFAAoB,KAAKk+D,yBAAL,CAA+Bl2D,iBAA/B,EAApB,EAAwEhI,MAAxE;;;;;;;;;AACR,YAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;iBAEA,kCAAsB;AACpB,mBAAO,KAAKm+D,cAAL,CAAoB17E,IAApB,EACL;AACA,kEAAI,UAAC40B,KAAD;AAAA,qBAAWA,KAAK,CAACxlB,MAAN,CAAa,UAACK,CAAD;AAAA,uBAAOA,CAAC,CAACgxC,UAAF,KAAiBm7B,qGAAxB;AAAA,eAAb,CAAX;AAAA,aAAJ,CAFK,CAAP;AAID;;;iBAED,kCAAyB9lE,EAAzB,EAAmC;AACjC,mBAAO,KAAK2lE,yBAAL,CAA+B9hB,mBAA/B,CAAmD7jD,EAAnD,CAAP;AACD;;;;;;;yBArZUg/C,uBAAmB3J;AAAA;;;eAAnB2J;AAAmB9/C,iBAAnB8/C,qBAAmB;AAAAx/C,oBAFlB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACbRyzC;;AAAUA;AAAA;;AAAA;;AAAA;;AAAA;AAAA;;AACRA;;AACAA;;AAAWA;;;;;;AAAmFA;;AAChGA;;;;;;;;AAF6BA;;AAAAA,0FAAsB,YAAtB,EAAsBA,mFAAtB;;AAChBA;;AAAAA;;;;;;;;AAIbA;;AAAgDA;AAAA;;AAAA;;AAAA;;AAAA;AAAA;;AAC9CA;;AACAA;;AACEA;;;;;;AACAA;;AAAGA;;AAAgBA;;AACrBA;;AACFA;;;;;;;;AAHIA;;AAAAA;;AACGA;;AAAAA;;;;;;;;AAMLA;;AAAsDA;AAAAA;;AAAA;;AAAA,2CAAyB,IAAzB;AAA6B,WAA7B;;AACpDA;;AACAA;;AAAWA;;;;AAAiCA;;AAC9CA;;;;AADaA;;AAAAA;;;;;;AAHfA;;AACEA;;;;AAIFA;;;;;;;;AAJaA;;AAAAA,iKAA2B,UAA3B,EAA2BvgD,GAA3B;;;;;;AAxBnBugD;;AACEA;;AACEA;;AACFA;;AACAA;;AACEA;;AAGEA;;AAMAA;;;;AASAA;;AAOFA;;AACAA;;AACFA;;AACFA;;;;;;;;AAzB8EA;;AAAAA;;AAM5CA;;AAAAA;;AASbA;;AAAAA;;;;;;;;AAanBA;;AAAUA;AAAAA;;AAAA;;AAAA,2CAAyB,KAAzB;AAA8B,WAA9B;;AACRA;;AACAA;;AAAWA;;;;AAAkCA;;AAC/CA;;;;AADaA;;AAAAA;;;;ACvBf,UAAMjqD,SAAS,GAAG,kBAAlB;;UAOai9E;AAWX,mCACU55D,mBADV,EAEU/N,aAFV,EAGU4nE,iBAHV,EAIU55D,iBAJV,EAKU9d,kBALV,EAMU6gC,gBANV,EAOU7lC,cAPV,EAOwC;AAAA;;AAN9B;AACA;AACA;AACA;AACA;AACA;AACA;AACN;;;;iBAEJ,oBAAQ;AAAA;;AACN,iBAAK28E,cAAL,GAAsB,KAAK33E,kBAAL,CAAwB9C,YAAxB,CAAqCxB,IAArC,CACpB,sDAAI,UAAC2kC,EAAD;AAAA,qBAAS;AACX1hB,0BAAU,EAAE0hB,EAAE,CAAChgB,gBADJ;AAEXu3D,wBAAQ,EAAEv3C,EAAE,CAAChgB,gBAAH,CAAoBpZ,OAApB,CAA4B4wE,uEAA5B,KAA+C;AAF9C,eAAT;AAAA,aAAJ,CADoB,EAKpB,wFALoB,CAAtB;AAOA,iBAAKR,OAAL,GAAe,KAAKx5D,mBAAL,CAAyBw5D,OAAzB,CAAiC37E,IAAjC,CACb,sDAAI,UAACo8E,MAAD;AAAA,qBACF,QAAI,CAAC98E,cAAL,CAAoBe,KAApB,CAA0B,uBAA1B,EAAmDvB,SAAnD,EAA8Ds9E,MAA9D,CADE;AAAA,aAAJ,CADa,EAIb,4DAAU,UAACA,MAAD;AAAA,qBACRA,MAAM,CAACzyE,MAAP,GAAgB,CAAhB,GACI,sDAAcyyE,MAAM,CAACnxE,GAAP,CAAW,UAAC8rD,KAAD;AAAA,uBAAW,QAAI,CAACslB,kBAAL,CAAwBtlB,KAAxB,CAAX;AAAA,eAAX,CAAd,CADJ,GAEI,2CAAG,EAAH,CAHI;AAAA,aAAV,CAJa,EASb,sDAAI,UAACqlB,MAAD;AAAA,qBACF,QAAI,CAAC98E,cAAL,CAAoBe,KAApB,CACE,iCADF,EAEEvB,SAFF,EAGEs9E,MAHF,CADE;AAAA,aAAJ,CATa,EAgBb,wFAhBa,CAAf;AAkBA,iBAAKE,YAAL,GAAoB,KAAKl6D,iBAAL,CAAuBm6D,cAA3C;AACD;;;iBAEO,4BACNxlB,KADM,EACc;AAEpB,mBAAO,6CAAK,KAAK9iB,OAAL,CAAa8iB,KAAK,CAACvW,OAAnB,CAAL,EAAkCxgD,IAAlC,CACL,sDAAI,UAACqgB,IAAD;AAAA,qBAAW;AAAEvK,kBAAE,EAAEihD,KAAK,CAACjhD,EAAZ;AAAgB/I,yBAAS,EAAEgqD,KAAK,CAAChqD,SAAjC;AAA4CsT,oBAAI,EAAJA;AAA5C,eAAX;AAAA,aAAJ,CADK,CAAP;AAGD;;;iBAED,iBAAQtT,SAAR,EAA4B;AAC1B,mBAAOovE,mEAAUpvE,SAAV,CAAP;AACD;;;iBAED,iBAAQie,SAAR,EAAyB;AACvB,mBAAO,KAAKgxD,iBAAL,CAAuBQ,UAAvB,CAAkCh1C,mDAAYxc,SAAZ,CAAlC,CAAP;AACD;;;iBAED,0BAAiB3Z,GAAjB,EAA4B;AAAA;;AAC1B1G,sBAAU,CAAC,YAAK;AACd,kBAAI,QAAI,CAAC8xE,OAAT,EAAkB;AAChB,wBAAI,CAACA,OAAL,CAAaC,KAAb;AACD;AACF,aAJS,EAIP,CAJO,CAAV;AAKA,iBAAKtoE,aAAL,CAAmBS,eAAnB,CAAmCxD,GAAnC;AACD;;;iBAED,4BAAmBtE,SAAnB,EAAuC;AACrC,iBAAK4vE,gBAAL,4BAA0C5vE,SAA1C;AACD;;;iBAED,0BAAiB+I,EAAjB,EAA2B;AACzB,iBAAK6mE,gBAAL,6BAA2C7mE,EAA3C;AACD;;;iBAED,qBAAS;AACP,iBAAK2mE,OAAL,CAAaC,KAAb;AACD;;;iBAED,yBAAgBE,WAAhB,EAAoC;AAClC,mBAAOA,WAAW,GACd,KAAKx6D,iBAAL,CAAuBy6D,cAAvB,EADc,GAEd,KAAKF,gBAAL,CAAsB,aAAtB,CAFJ;AAGD;;;;;;;yBA3FUZ,mBAAgBhzB;AAAA;;;cAAhBgzB;AAAgBh6E;AAAAkK;AAAA;;;;;;;;;;;;;;;ADtB7B88C;;;;AAmCAA;;;;AAnCmEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UEQtD+zB;AAGX,wCAAoBtwE,mBAApB,EAA4D;AAAA;;AAAxC;AAA4C;;;;iBAEhE,oBAAQ,CAAK;;;iBAEb,kBAAS7K,KAAT,EAAqB;AACnBA,iBAAK,CAACo7E,cAAN;AACA,iBAAKvwE,mBAAL,CAAyBmF,gBAAzB,CAA0C,KAAK9Q,GAA/C;AACD;;;;;;;yBAVUi8E,wBAAqB/nE;AAAA;;;cAArB+nE;AAAqB/6E;AAAA2G;AAAA7H;AAAA;AAAAm8E;AAAAh7E;AAAAC;AAAAC;AAAAC;AAAA;;;ACRlC4S;;AAAYA;AAAA,qBAAS6tD,oBAAT;AAAyB,aAAzB;;AACV7tD;;AACFA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACIImU;;AACEA;;AACFA;;;;;;AAFwCA;;AACxBA;;AAAAA;;;;;;AAUZA;;AACEA;;AACFA;;;;;;AADgBA;;AAAAA;;;;;;;;AANlBA;;AACEA;AAAA;;AAAA;;AAAA;;AAAA;AAAA;;AACAA;;AACEA;;AACFA;;AACAA;;AAGFA;;;;;;;;AANsDA;;AAAAA;;AACpCA;;AAAAA;;AAEJA;;AAAAA;;;;;;AANhBA;;AACEA;;AASFA;;;;;;AAVUA;;AAC2CA;;AAAAA;;;;;;AAFvDA;;AACEA;;AAWFA;;;;;;AAX0DA;;AAAAA;;;;;;;;;;;;;;AAX5DA;;;;AAEEA;;AAAUA;AAAAA;;AAAA;;AAAA;AAAA;;AACRA;;AACEA;;AACFA;;AACAA;;AAGFA;;AACAA;;;;AAaFA;;;;;;;;AAtBeA,2OAAiD,oBAAjD,EAAiD7c,0BAAjD;;AAEyC6c;;AAAAA;;AACpCA;;AAAAA;;AAEJA;;AAAAA;;AAICA;;AAAAA;;;;;;;;AAcjBA;;AAAoCA;AAAAA;;AAAA;;AAAA;AAAA;;AAAmBA;;;;ACKvD,UAAM+zD,eAAe,GAAG,CACtB,CAACC,sEAAD,CADsB,EAEtB,CAACA,qEAAD,CAFsB,EAGtB,CAACA,uEAAD,EAAkBA,sEAAlB,CAHsB,CAAxB;;UAgDaC;AAgBX;AACA;AACA;AAEA,kCACUnX,iBADV,EAEU1hE,kBAFV,EAGU4P,MAHV,EAGwB;AAAA;;AAFd;AACA;AACA;AAlBD,uBAAQ,OAAR;AACA,wBAAS,KAAT;AACA,4BAAa,IAAb;AACC,8BAAe,IAAIgV,uDAAJ,EAAf;AACD,gCAAiB,KAAjB;AAED,4BAAa,IAAIqgC,yCAAJ,EAAb;AAGR,qCAAsB,GAAtB;AAUI;;;;iBAEJ,oBAAQ;AAAA;;AACN,iBAAK7kC,iBAAL,GAAyB,KAAKpgB,kBAAL,CAAwBogB,iBAAjD;AACA,iBAAK04D,qBAAL,GAA6B,KAAK14D,iBAAL,CAAuB1kB,IAAvB,CAC3B,qDAAI,UAAC2kB,gBAAD;AAAA,qBACFs4D,eAAe,CAAC7tE,MAAhB,CACE,UAACqqD,CAAD;AAAA,uBAAO,CAAC90C,gBAAgB,CAAC1V,IAAjB,CAAsB,UAAC2vC,CAAD;AAAA,yBAAO6a,CAAC,CAACxqD,IAAF,CAAO,UAAC4zB,CAAD;AAAA,2BAAOA,CAAC,KAAK+b,CAAb;AAAA,mBAAP,CAAP;AAAA,iBAAtB,CAAR;AAAA,eADF,CADE;AAAA,aAAJ,CAD2B,CAA7B;AAOA,iBAAK0nB,WAAL,GAAmB,KAAKN,iBAAL,CAAuB38C,aAA1C;;AACA,gBAAI,KAAKg0D,cAAT,EAAyB;AACvB,mBAAKC,eAAL,GAAuB3yE,UAAU,CAAC,YAAK;AACrC,wBAAI,CAAC4yE,mBAAL,GAA2B,eAA3B;AACD,eAFgC,EAE9B,GAF8B,CAAjC;AAGD,aAJD,MAIO;AACL,mBAAKA,mBAAL,GAA2B,SAA3B;AACD;AACF;;;iBAED,uBAAW;AACT,gBAAI,KAAKD,eAAT,EAA0B;AACxBvnE,0BAAY,CAAC,KAAKunE,eAAN,CAAZ;AACD;;AACD,iBAAKlzE,UAAL,CAAgBhK,IAAhB;AACA,iBAAKgK,UAAL,CAAgB2T,QAAhB;AACD;;;iBAED,kBAAM;AACJ,iBAAKy/D,gBAAL,CAAsB,CAAC,KAAKje,MAA5B;AACD;;;iBAED,gBAAI;AACF,iBAAKie,gBAAL,CAAsB,IAAtB;AACD;;;iBAED,iBAAK;AACH,iBAAKA,gBAAL,CAAsB,KAAtB;AACD;;;iBAED,0BAAiBnmE,IAAjB,EAA8B;AAC5B,gBAAMmpC,OAAO,GAAG,KAAK+e,MAAL,KAAgBloD,IAAhC;;AACA,gBAAImpC,OAAJ,EAAa;AACX,mBAAK+e,MAAL,GAAcloD,IAAd;AACA,mBAAKomE,YAAL,CAAkB/xE,IAAlB,CAAuB,KAAK6zD,MAA5B;AACD;AACF;;;iBAEK,6BAAoBt8C,UAApB,EAA2C;;;;;;;AAC/C,2BAAKy5D,KAAL;;AACwB,6BAAM,KAAKp4E,kBAAL,CAAwB9C,YAAxB,CAC3BxB,IAD2B,CACtB,uDAAK,CAAL,CADsB,EAE3B+Q,SAF2B,EAAN;;;AAAlB2sE;AAGN,2BAAKp5E,kBAAL,CAAwBggC,gBAAxB,CAAwCte,gCACnC03D,eADmC,GACpB;AAClB/4D,wCAAgB,EAAE1B;AADA,uBADoB,CAAxC;;;;;;;;;AAID;;;;;;;yBAlFUk6D,kBAAej0D;AAAA;;;cAAfi0D;AAAep7E;AAAA2G;AAAAvH;AAAAo+D;AAAAoe;AAAAN;AAAA;AAAAnP;AAAAuP;AAAA;AAAAz7E;AAAAC;AAAAC;AAAAC;AAAA;AD7E5B+mB;;;;AAwBAA;;;;AAxBqBA;;AAwBfA;;AAAAA;;;;;;;qBCcQ,CACV,+DAAQ,mBAAR,EAA6B,CAC3B,6DAAM,GAAN,EAAW,6DAAM;AAAE5d,qBAAS,EAAE,gBAAb;AAA+BoH,mBAAO,EAAE;AAAxC,WAAN,CAAX,CAD2B,EAE3B,6DAAM,SAAN,EAAiB,6DAAM;AAAEpH,qBAAS,EAAE,gBAAb;AAA+BoH,mBAAO,EAAE;AAAxC,WAAN,CAAjB,CAF2B,EAG3B,kEACE,oBADF,EAEEkrE,uGAAwC,GAAxC,EAA6C,GAA7C,EAAkDA,+EAAlD,CAFF,CAH2B,CAA7B,CADU,EASV,+DACE,gBADF,EAEEA,2GAA4C,CAA5C,EAA+C,GAA/C,EAAoDA,0EAApD,CAFF,CATU,EAaV,+DAAQ,aAAR,EAAuB,CACrB,kEAAW,QAAX,EAAqB,CACnB,6DACE,QADF,EAEE,CACE,6DAAM;AACJtyE,qBAAS,EAAE,2CADP;AAEJoH,mBAAO,EAAE;AAFL,WAAN,CADF,EAKE,+DACE,GADF,EAEE,mFACekrE,0EADf,GAEE,6DAAM;AACJtyE,qBAAS,EAAE,qCADP;AAEJoH,mBAAO,EAAE;AAFL,WAAN,CAFF,CAFF,CALF,CAFF,EAkBE;AAAEmrE,oBAAQ,EAAE;AAAZ,WAlBF,CADmB,CAArB,CADqB,CAAvB,CAbU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UC9BDC;AACX;AAAA;;AAGS,8BAAe,IAAf;AAHO;;;;eAKhB,eAAY;AACV,gBAAI,KAAK76D,UAAL,IAAmB,KAAKA,UAAL,CAAgBtZ,MAAhB,GAAyB,CAAhD,EAAmD;AACjD,qBAAO,KAAKsZ,UAAL,CACJhY,GADI,CACA,UAAC8B,SAAD;AAAA,uBAAeA,SAAS,KAAKgxE,sEAAd,GAAwCA,kEAAUhxE,SAAV,EAAsBkc,WAAtB,EAAxC,GAA8E,MAA7F;AAAA,eADA,EAEJ7Y,IAFI,CAEC,GAFD,CAAP;AAGD;;AACD,mBAAO,EAAP;AACD;;;eAED,eAAW;AACT,0CAAuB,KAAK4tE,QAAL,CAAcppE,OAAd,CAAsB,GAAtB,EAA2B,GAA3B,CAAvB;AACD;;;iBAED,oBAAQ,CAAK;;;;;;;yBAnBFkpE;AAAgB;;;cAAhBA;AAAgB/7E;AAAA2G;AAAAua;AAAAg7D;AAAA;AAAAj8E;AAAAC;AAAAC;AAAAC;AAAA;ACR7B4S;;;;AAAUA,yFAAe,SAAf,EAAeA,wHAAf;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCUGmpE;AAKX,mCAAoB/4C,gBAApB,EAAsD;AAAA;;AAAlC;AAAsC;;;;iBAE1D,oBAAQ;AACN,iBAAKg5C,KAAL,GAAa,KAAKh5C,gBAAL,CAAsBxF,OAAtB,CAA8B,KAAK1c,UAAnC,CAAb;AACD;;;;;;;yBATUi7D,mBAAgBnpE;AAAA;;;cAAhBmpE;AAAgBn8E;AAAA2G;AAAAua;AAAA;AAAAjhB;AAAAC;AAAAE;AAAA;ACV7B4S;;;;;;AAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACCEY;;AAAoEA;AAAAA;;AAAA;;AAAA;AAAA;;AAClEA;;AACFA;;;;;;AADgBA;;AAAAA;;;;;;;;AAcVA;;AACEA;AAAAA;;AAAA;;AAAA;;AAAA;AAAA;;AACAA;;AACEA;;AACFA;;AACAA;;AACEA;;AACFA;;AACFA;;;;;;AALkBA;;AAAAA;;AAGAA;;AAAAA;;;;;;AAPpBA;;AACEA;;AASFA;;;;;;;;AATaA;;AAAAA;;;;;;;;AAZjBA;;AACEA;;AAAkCA;AAAAA;;AAAA;;AAAA;AAAA;;AAAmBA;;AACrDA;;AACEA;;AAAUA;AAAAA;;AAAA;;AAAA;AAAA;;AACRA;;AACEA;;AACFA;;AACAA;;AACEA;;AACFA;;AACFA;;AACAA;;AAWFA;;AACFA;;;;;;;;AAlBsBA;;AAAAA;;AAGAA;;AAAAA;;AAGmBA;;AAAAA;;;;;;AAf3CA;;AACEA;;AAGAA;;AAwBFA;;;;;;AA3ByCA;;AAAAA;;AAGNA;;AAAAA;;;;UCQtByoE;AAKX,qCAAoB95E,kBAApB,EAA0D;AAAA;;AAAtC;AAHpB,wBAAS,KAAT;AAG8D;;;;iBAE9D,oBAAQ;AACN,iBAAK+5E,cAAL,GAAsB,CACpB,CAACC,sEAAD,CADoB,EAEpB,CAACA,qEAAD,CAFoB,EAGpB,CAACA,uEAAD,EAAkBA,sEAAlB,CAHoB,CAAtB;AAKA,iBAAKC,aAAL,GAAqB,KAAKj6E,kBAAL,CAAwB9C,YAA7C;AACD;;;iBAED,kBAAM;AACJ,iBAAK+9D,MAAL,GAAc,CAAC,KAAKA,MAApB;AACD;;;iBAEK,yBAAgBt8C,UAAhB,EAAuC;;;;;;;AAC3C,2BAAKs8C,MAAL,GAAc,KAAd;;AACwB,6BAAM,KAAKj7D,kBAAL,CAAwB9C,YAAxB,CAC3BxB,IAD2B,CACtB,sDAAK,CAAL,CADsB,EAE3B+Q,SAF2B,EAAN;;;AAAlB2sE;AAGN,2BAAKp5E,kBAAL,CAAwBggC,gBAAxB,CAAwCte,gCACnC03D,eADmC,GACpB;AAClB/4D,wCAAgB,EAAE1B;AADA,uBADoB,CAAxC;;;;;;;;;AAID;;;;;;;yBA7BUm7D,qBAAkBzoE;AAAA;;;cAAlByoE;AAAkBr8E;AAAAC;AAAAC;AAAAC;AAAAC;AAAA;ADZ/BwT;;;;;;AAAUA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEENA;;AACEA;;AACFA;;;;;;AAD2BA;;AAAAA;;;;;;AAE3BA;;AACEA;;AACFA;;;;;;AACAA;;AACEA;;;;AACFA;;;;;;AADEA;;AAAAA;;;;;;;;AAEFA;;AACEA;;AAA2DA;AAAAA;;AAAA;;AAAA;AAAA;;AACzDA;;;;AACFA;;AACFA;;;;AAFIA;;AAAAA;;;;;;AAbRA;;AACEA;;AACEA;;AAGAA;;AAGAA;;AAGAA;;AAKFA;;AACFA;;;;;;AAhBwCA;;AAAAA;;AACTA;;AAAAA;;AAGFA;;AAAAA;;AAGbA;;AAAAA;;AAGAA;;AAAAA;;;;UCCH6oE;AAwBX,kCACUxY,iBADV,EAEU5jD,iBAFV,EAGU9d,kBAHV,EAIU4P,MAJV,EAIwB;AAAA;;AAHd;AACA;AACA;AACA;AA3BD,gCAAiB,IAAjB;AACA,mCAAoB,KAApB;AAEA,6BAAc,GAAd;AAET,6BAAc,KAAd;AACQ,yBAAUoqE,oEAAV;AAGA,+BAAgC,EAAhC;AAmBJ;;;;eAjBJ,eAAgB;AACd,mBAAO,KAAKl8D,iBAAL,CAAuBgmB,yBAAvB,EAAP;AACD;;;eAED,eAAe;AACb,gBAAI,KAAKq2C,WAAT,EAAsB;AACpB,qBAAO,cAAP;AACD,aAFD,MAEO;AACL,qBAAO,KAAKz9E,OAAL,CAAaioB,WAAb,EAAP;AACD;AACF;;;iBASD,oBAAQ;AAAA;;AACN,iBAAKI,aAAL,GAAqB,KAAK28C,iBAAL,CAAuB38C,aAA5C;AACA,iBAAK5G,aAAL,CAAmB7X,IAAnB,CACE,KAAKwX,iBAAL,CAAuBm6D,cAAvB,CAAsCp8E,SAAtC,CAAgD,UAAC2b,GAAD,EAAQ;AACtD,sBAAI,CAAC5H,MAAL,CAAYM,GAAZ,CAAgB,YAAK;AACnB,wBAAI,CAACiqE,WAAL,GAAmB3iE,GAAnB;AACD,eAFD;AAGD,aAJD,CADF;AAOA,iBAAK2G,aAAL,CAAmB7X,IAAnB,CACE,KAAKtG,kBAAL,CAAwBC,QAAxB,CAAiCpE,SAAjC,CAA2C,UAACa,OAAD,EAAY;AACrD,sBAAI,CAACkT,MAAL,CAAYM,GAAZ,CAAgB,YAAK;AACnB,wBAAI,CAACxT,OAAL,GAAeA,OAAf;AACD,eAFD;AAGD,aAJD,CADF;AAOD;;;iBAED,uBAAW;AAAA,yDACkB,KAAKyhB,aADvB;AAAA;;AAAA;AACT,wEAA+C;AAAA,oBAApChF,YAAoC;AAC7CA,4BAAY,CAAC1B,WAAb;AACD;AAHQ;AAAA;AAAA;AAAA;AAAA;AAIV;;;iBAED,mBAAO;AACL,iBAAKqG,iBAAL,CAAuBy6D,cAAvB;AACD;;;;;;;yBAzDU2B,kBAAe7oE;AAAA;;;cAAf6oE;AAAez8E;AAAA2G;AAAAg2E;AAAAC;AAAAx/B;AAAAy/B;AAAA;AAAA58E;AAAAC;AAAAC;AAAAC;AAAA;ADZ5BwT;;;;;;AAAwBA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEGxBpN;;;;;;AAA+CA;;;;ACG/C,UAAMs2E,sBAAsB,GAAG,gBAA/B;AACA,UAAMC,qBAAqB,GAAG,eAA9B;;UAOaC;AAyBX,kCACUC,qBADV,EAEU19D,gBAFV,EAE4C;AAAA;;AADlC;AACA;AAvBA,qCAAsB,IAAI/Y,uDAAJ,EAAtB;AACD,yBAA+B,EAA/B;AACA,2BAAY,IAAZ;AACA,0BAAW,KAAX;AAqBL;;;;eAnBJ,eAAa;AAAA;;AACX,gBAAMye,IAAI,GAAG,CAAC,KAAKviB,OAAL,IAAgB,EAAjB,EAAqBogB,IAArB,CAA0B,UAACpV,CAAD;AAAA,qBAAOA,CAAC,CAACqG,EAAF,KAAS,QAAI,CAACmpE,aAArB;AAAA,aAA1B,CAAb;;AACA,gBAAIj4D,IAAJ,EAAU;AACR,qBAAOA,IAAI,CAAC4W,IAAZ;AACD;;AACD,mBAAO,EAAP;AACD;;;eAED,eAAa;AAAA;;AACX,gBAAM5W,IAAI,GAAG,CAAC,KAAKviB,OAAL,IAAgB,EAAjB,EAAqBogB,IAArB,CAA0B,UAACpV,CAAD;AAAA,qBAAOA,CAAC,CAACqG,EAAF,KAAS,QAAI,CAACmpE,aAArB;AAAA,aAA1B,CAAb;;AACA,gBAAIj4D,IAAJ,EAAU;AACR,qBAAOA,IAAI,CAACzZ,IAAZ;AACD;;AACD,mBAAO7C,SAAP;AACD;;;iBAOD,oBAAQ,CAAK;;;iBAEC,iCAAqB;;;;;;;;;;AAC3BgiB,gCAA+B;+DAChB,CAAC,KAAKjoB,OAAL,IAAgB,EAAjB,EAAqB2K,MAArB,CAA4B,UAACK,CAAD;AAAA,+BAAO,CAACA,CAAC,CAACyvE,QAAV;AAAA,uBAA5B;;;;;;;;AAAVC;;AACc,uCAAM,QAAI,CAAC79D,gBAAL,CAC1BZ,GAD0B,CACtBy+D,MAAM,CAACvhD,IADe,EAE1B7sB,SAF0B,EAAN;;;AAAjBquE;AAGN1yD,uCAAO,CAAC9hB,IAAR,CAAa;AACXgzB,sCAAI,EAAEwhD,cADK;AAEX7xE,sCAAI,EAAE4xE,MAAM,CAAC5xE,IAFF;AAGX06B,sCAAI,EAAEk3C,MAAM,CAACrpE,EAAP,KAAc,QAAI,CAACmpE,aAAnB,GAAmC,UAAnC,GAAgDv0E,SAH3C;AAIXy9B,yCAAO,EAAE;AAAA,2CAAM,QAAI,CAACk3C,gBAAL,CAAsBF,MAAM,CAACrpE,EAA7B,CAAN;AAAA;AAJE,iCAAb;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;4BAOE,KAAKmpE,aAAL,KAAuBv0E,SAAvB,IAAoC,KAAK40E;;;;;;AACf,6BAAM,KAAKh+D,gBAAL,CAC/BZ,GAD+B,CAC3Bo+D,qBAD2B,EAE/B/tE,SAF+B,EAAN;;;AAAtBwuE;AAGN7yD,6BAAO,CAACkqC,MAAR,CAAe,CAAf,EAAkB,CAAlB,EAAqB;AACnBh5B,4BAAI,EAAE2hD,mBADa;AAEnBp3C,+BAAO,EAAE;AAAA,iCAAM,QAAI,CAACk3C,gBAAL,CAAsB30E,SAAtB,CAAN;AAAA,yBAFU;AAGnBu9B,4BAAI,EAAE;AAHa,uBAArB;;;;AAM2B,6BAAM,KAAK3mB,gBAAL,CAChCZ,GADgC,CAC5Bm+D,sBAD4B,EAEhC9tE,SAFgC,EAAN;;;AAAvByuE;AAGN9yD,6BAAO,CAAC9hB,IAAR,CAAa;AACXgzB,4BAAI,EAAE4hD,oBADK;AAEXv3C,4BAAI,EAAE;AAFK,uBAAb;0DAIOvb;;;;;;;;;AACR;;;iBAEK,gCAAoB;;;;;;;2BAEpB,KAAKyyB;;;;;;AACe,6BAAM,KAAK79B,gBAAL,CACzBZ,GADyB,CACrB,KAAKy+B,KADgB,EAEzBpuC,SAFyB,EAAN;;;AAAtB0uE;;;2BAKE,KAAKC;;;;;;AACkB,6BAAM,KAAKp+D,gBAAL,CAC5BZ,GAD4B,CACxB,KAAKg/D,QADmB,EAE5B3uE,SAF4B,EAAN;;;AAAzB4uE;;;0DAIK;AACLF,2CAAmB,EAAnBA,mBADK;AAELE,8CAAsB,EAAtBA;AAFK;;;;;;;;;AAIR;;;iBAEK,sBAAU;;;;;;;;0BACT,KAAKT;;;;;;AACa,6BAAM,KAAKU,oBAAL,EAAN;;;AAAfl+D;;AACU,6BAAM,KAAKm+D,qBAAL,EAAN;;;AAAVnzD;;AACc,6BAAM,KAAKsyD,qBAAL,CAA2B1uE,MAA3B,CAAkC;AAC1D/G,8BAAM,EAAEmY,aAAY,CAAC+9D,mBADqC;AAE1DK,iCAAS,EAAEp+D,aAAY,CAACi+D,sBAFkC;AAG1DjzD,+BAAO,EAAPA;AAH0D,uBAAlC,CAAN;;;AAAdqzD;;AAKN,6BAAMA,WAAW,CAAClvE,OAAZ,EAAN;;;;;;;;;AAEH;;;iBAEO,0BAAiBiF,EAAjB,EAAoC;AAC1C,iBAAKmpE,aAAL,GAAqBnpE,EAArB;AACA,iBAAKkqE,mBAAL,CAAyBt0E,IAAzB,CAA8BoK,EAA9B;AACD;;;;;;;yBApGUipE,kBAAex2E;AAAA;;;cAAfw2E;AAAeh9E;AAAA2G;AAAAy2C;AAAAugC;AAAAT;AAAAx6E;AAAA66E;AAAAJ;AAAA;AAAAhR;AAAA8R;AAAA;AAAAh+E;AAAAC;AAAAC;AAAAC;AAAA;ADd5BoG;;AACEA;AAAA,qBAASq6D,gBAAT;AAAqB,aAArB;;AACFr6D;;AACAA;;AACAA;;AACEA;;;;AACFA;;AACAA;;;;AAJ8BA;;AAAAA;;AAE5BA;;AAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UECW03E;AALb;AAAA;;AAQE,wBAAS,KAAT;AACA,0BAAW,KAAX;AAEQ,kCAAmB,KAAnB;AA8BT;;;;iBA5BC,oBAAQ;AACN,iBAAKC,YAAL,GAAoB,KAAKr/E,GAAzB;AACD;;;iBAED,oBAAQ;AACN,iBAAKiN,MAAL,GAAc,IAAd;AACD;;;iBAED,mBAAO;AACL,gBAAI,KAAKqyE,gBAAT,EAA2B;AACzB,mBAAKryE,MAAL,GAAc,IAAd;AACA,mBAAKkmD,QAAL,GAAgB,IAAhB;AACD,aAHD,MAGO;AACL,mBAAKosB,gBAAL;AACD;AACF;;;iBAEO,4BAAgB;AACtB,gBAAI,KAAKv/E,GAAL,IAAY,KAAKA,GAAL,CAAS0K,OAAT,CAAiB,sBAAjB,IAA2C,CAA3D,EAA8D;AAC5D,mBAAK20E,YAAL,GAAoB,KAAKr/E,GAAL,CACjB+T,OADiB,CACT,QADS,EACC,KADD,EAEjBA,OAFiB,CAET,SAFS,EAEE,KAFF,CAApB;AAGD,aAJD,MAIO;AACL,mBAAK9G,MAAL,GAAc,IAAd;AACA,mBAAKkmD,QAAL,GAAgB,IAAhB;AACD;;AACD,iBAAKmsB,gBAAL,GAAwB,IAAxB;AACD;;;;;;;yBAnCUF;AAAqB;;;cAArBA;AAAqBl+E;AAAA2G;AAAA7H;AAAA;AAAAmB;AAAAC;AAAAC;AAAAC;AAAA;ACNlCoG;;AACEA;;AACEA;AAAA,qBAAiBq6D,cAAjB;AAA2B,aAA3B,EAA4B,UAA5B,EAA4B;AAAA,qBAAaA,aAAb;AAAsB,aAAlD;;AAAoDr6D;;AACtDA;;AACEA;;AACFA;;AACFA;;;;AAL8BA;;AAAAA,iLAAmD,KAAnD,EAAmDq6D,gBAAnD;;AAEKr6D;;AAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAjCA;;AACEA;;AACEA;;AACEA;;AAAsCA;AAAAA;;AAAA;;AAAA;AAAA;;AAAmBA;;;;AAAkCA;;AAC7FA;;AACFA;;AACFA;;;;AAH+DA;;AAAAA;;;;UCIpD83E;AAWX,6CAAoBnsE,MAApB,EAA4CjV,QAA5C,EAA8D;AAAA;;AAA1C;AAAwB;AAV5C,4BAAa,KAAb;AAMS,0BAAW,KAAX;AAIyD;;;;iBAElE,oBAAQ;AACN,iBAAKqhF,OAAL,GAAe,KAAKrhF,QAAL,CAAcoV,EAAd,CAAiB,SAAjB,IAA8B,UAA9B,GAA2C,OAA1D;;AACA,gBAAI,CAAC,KAAKksE,aAAV,EAAyB;AACvB,mBAAKA,aAAL,GAAqB,IAAIziE,yCAAJ,EAArB;AACD;AACF;;;iBAED,kBAAM;AACJ,iBAAKyiE,aAAL,CAAmBngF,IAAnB,CAAwB,IAAxB;AACD;;;iBAEO,4BAAgB;AACtB,mBAAO,KAAKmgF,aAAL,CAAmBh+D,YAAnB,GAAkCviB,IAAlC,CAAuC,sDAAK,CAAL,CAAvC,EAAgD+Q,SAAhD,EAAP;AACD;;;iBAEK,qBAAS;;;;;;;;;2BACT,KAAKyvE;;;;;AACDruC,sCAAgB,KAAKsuC,gBAAL;AACtBtuC,mCAAa,CAACx0C,IAAd,CAAmB;AAAA,+BAAM,QAAI,CAACogB,QAAL,EAAN;AAAA,uBAAnB,GACA;;AACA,2BAAK7J,MAAL,CAAYM,GAAZ,CAAgB,YAAK;AACnB,gCAAI,CAACksE,UAAL,GAAkB,IAAlB;AACD,uBAFD;;;AAIE,6BAAM,KAAKF,WAAL,CAAiBruC,aAAjB,CAAN;;;;AAEA,2BAAKp0B,QAAL;;;;;;;;;;AAGL;;;iBAEO,oBAAQ;AAAA;;AACd,iBAAK7J,MAAL,CAAYM,GAAZ,CAAgB,YAAK;AACnB,sBAAI,CAACmsE,SAAL,CAAe5iE,QAAf;AACD,aAFD;AAGA,iBAAK7J,MAAL,CAAYM,GAAZ,CAAgB,YAAK;AACnB,sBAAI,CAACksE,UAAL,GAAkB,KAAlB;AACD,aAFD;AAGD;;;;;;;yBAnDUL,6BAA0B93E;AAAA;;;cAA1B83E;AAA0Bt+E;AAAAkK;AAAA;sEAI1B20E,0DAAY;;;;;;;;;;;;;;;;;;;ADdzBr4E;;AAA4BA;AAAA,qBAAcq6D,eAAd;AAAyB,aAAzB;;AAC1Br6D;;AAEAA;;AAOFA;;;;AAVuDA;;AACEA;;AAAAA;;AAE5CA;;AAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UEWAs4E;AAWX,uCACUv8E,kBADV,EAEU4P,MAFV,EAEwB;AAAA;;AADd;AACA;AACN;;;;eAVJ,eACgB;AACd,uDACE,KAAKlT,OAAL,GAAe,KAAKA,OAAL,CAAaioB,WAAb,EAAf,GAA4C,EAD9C;AAGD;;;iBAOD,oBAAQ;AAAA;;AACN,iBAAKxL,YAAL,GAAoB,KAAKnZ,kBAAL,CAAwBC,QAAxB,CAAiCpE,SAAjC,CAClB,UAACa,OAAD,EAAY;AACV,sBAAI,CAACkT,MAAL,CAAYM,GAAZ,CAAgB,YAAK;AACnB,wBAAI,CAACxT,OAAL,GAAeA,OAAf;AACD,eAFD;AAGD,aALiB,CAApB;AAOD;;;iBAED,uBAAW;AACT,gBAAI,KAAKyc,YAAT,EAAuB;AACrB,mBAAKA,YAAL,CAAkB1B,WAAlB;AACD;AACF;;;;;;;yBA9BU8kE,uBAAoB9rE;AAAA;;;cAApB8rE;AAAoB9+E;AAAA++E;AAAAC;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCVpBC;AAeX,qCAAoBh3E,EAApB,EAAkC;AAAA;;AAAd;AAAkB;;;;iBAZtC,uBAAW;AACT,gBAAMi3E,MAAM,GACV,KAAKj3E,EAAL,CAAQq6D,aAAR,CAAsB6c,UAAtB,IACA,KAAKl3E,EAAL,CAAQq6D,aAAR,CAAsB8c,YAAtB,CAAmC;AAAEv4C,kBAAI,EAAE;AAAR,aAAnC,CAFF;;AAGA,gBAAIq4C,MAAJ,EAAY;AACV,kBAAIG,SAAS,GAAG,EAAhB;AACAA,uBAAS,IAAI,SAAb;AACAA,uBAAS,IAAI,KAAKC,eAAlB;AACAD,uBAAS,IAAI,UAAb;AACAH,oBAAM,CAACG,SAAP,IAAoBA,SAApB;AACD;AACF;;;;;;;yBAdUJ,qBAAkBz4E;AAAA;;;cAAlBy4E;AAAkBj/E;AAAA2G;AAAA24E;AAAA;AAAAxvE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCClByvE;;;;;;;iBACX,mBAAU93D,KAAV,EAAwB;AACtB,gBAAI;AACF,qBAAO/M,IAAI,CAACkS,GAAL,CAASnF,KAAT,CAAP;AACD,aAFD,CAEE,OAAOjpB,KAAP,EAAc;AACd,qBAAO,IAAP;AACD;AACF;;;;;;;yBAPU+gF;AAAO;;;;cAAPA;AAAOz8B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCEP08B;AACX,iCAAoBvF,iBAApB,EAAwD;AAAA;;AAApC;AAAwC;;;;iBAE5D,mBACExyD,KADF,EAIiB;AAAA,gBAFfg4D,cAEe,uEAFE,IAEF;AAAA,gBADfC,QACe,uEADJ,IACI;AAAA,gBAAfC,QAAe,uEAAJ,IAAI;AAEf,mBAAO,KAAK1F,iBAAL,CAAuB2F,gBAAvB,CACL,OAAOn4D,KAAP,KAAiB,QAAjB,GAA4BA,KAA5B,GAAoCA,KAAK,GAAGA,KAAK,CAACjJ,WAAN,EAAH,GAAyB,EAD7D,EAELihE,cAFK,EAGLC,QAHK,EAILC,QAJK,CAAP;AAMD;;;;;;;yBAfUH,iBAAcxsE;AAAA;;;;cAAdwsE;AAAc18B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCAd+8B;AACX,oCAAoBtgE,gBAApB,EAAsD;AAAA;;AAAlC;AAAsC;;;;iBAE1D,0BACEqU,UADF,EAKgC;AAAA,gBAH9B6rD,cAG8B,uEAHb,IAGa;AAAA,gBAF9BC,QAE8B,uEAFnB,IAEmB;AAAA,gBAD9BC,QAC8B,uEADnB,IACmB;AAAA,gBAA9BG,eAA8B,uEAAJ,IAAI;AAE9B,mBAAO,KAAKrF,UAAL,CACLh1C,wDAAiB7R,UAAjB,CADK,EAEL6rD,cAFK,EAGLC,QAHK,EAILC,QAJK,EAKLG,eALK,CAAP;AAOD;;;iBAEK,oBACJxhE,IADI,EAK0B;AAAA,gBAH9BmhE,cAG8B,uEAHb,IAGa;AAAA,gBAF9BC,QAE8B,uEAFnB,IAEmB;AAAA,gBAD9BC,QAC8B,uEADnB,IACmB;AAAA,gBAA9BG,eAA8B,uEAAJ,IAAI;;;;;;;AAExBC,iCAAWD,eAAe,IAAIr6C,gDAAStU,MAAT,CAAgB,GAAhB;;0BAC/B7S,IAAI,CAAC8rC,OAAL;;;;;0DACI;;;AAEH9wB,8BAAQ;AACV0mD,qCAAe1hE,IAAI,CAAC6S,MAAL,CAAY,OAAZ;;2BACfsuD;;;;;;AACiB,6BAAM,KAAKlgE,gBAAL,CACtBZ,GADsB,CAClB,mBADkB,EAEtB3P,SAFsB,EAAN;;;AAAbixE;AAGAC,kCAAYD,UAAU,CAAC/rE,KAAX,CAAiB,GAAjB,EAAsBoK,IAAI,CAAC6hE,KAAL,EAAtB,EAAoC3sC,IAApC;AAClBwsC,kCAAY,aAAM1hE,IAAI,CAAC6S,MAAL,CAAY,GAAZ,CAAN,eAA2B+uD,SAA3B,CAAZ;;;AAEF5mD,2BAAK,CAACzwB,IAAN,CAAWm3E,YAAX;;AACA,0BAAIN,QAAJ,EAAc;AACZpmD,6BAAK,CAACzwB,IAAN,CAAWyV,IAAI,CAAC6S,MAAL,CAAY,MAAZ,CAAX;AACD;;AACD,0BAAIwuD,QAAJ,EAAc;AACZrmD,6BAAK,CAACzwB,IAAN,CAAWyV,IAAI,CAAC6S,MAAL,CAAY,OAAZ,CAAX;;AACA,4BAAI7S,IAAI,CAAC6S,MAAL,CAAY,GAAZ,MAAqB4uD,QAAzB,EAAmC;AACjCzmD,+BAAK,CAACzwB,IAAN,YAAeyV,IAAI,CAAC6S,MAAL,CAAY,GAAZ,CAAf;AACD;AACF;;0DACMmI,KAAK,CAACjrB,IAAN,CAAW,GAAX;;;;;;;;;AACR;;;;;;;yBAlDUwxE,oBAAiB/4E;AAAA;;;eAAjB+4E;AAAiB5sE,iBAAjB4sE,kBAAiB;AAAAtsE,oBAFhB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCID6sE;AACX,mCAAoB7gE,gBAApB,EAAsD;AAAA;;AAAlC;AAAsC;;;;iBAE1D,2BAAkBvU,SAAlB,EAAsC;AACpC,gBAAMq1E,YAAY,GAAGr1E,SAAS,KAAKgxE,sEAAd,GAA+BA,kEAAUhxE,SAAV,CAA/B,GAAsD,MAA3E;AACA,mBAAO,sBAAeq1E,YAAf,EAA8BC,WAA9B,EAAP;AACD;;;iBAED,4BAAmBp/D,UAAnB,EAA0C;AAAA;;AACxC,gBAAIA,UAAU,IAAIA,UAAU,CAACtZ,MAAX,GAAoB,CAAtC,EAAyC;AACvC,qBAAOsZ,UAAU,CAAChY,GAAX,CAAe,UAAC8B,SAAD;AAAA,uBAAe,QAAI,CAACi5B,iBAAL,CAAuBj5B,SAAvB,CAAf;AAAA,eAAf,CAAP;AACD;;AACD,mBAAO,EAAP;AACD;;;iBAED,iBAAQkW,UAAR,EAA+B;AAC7B,gBAAMod,IAAI,GAAG,KAAKsF,kBAAL,CAAwB1iB,UAAxB,CAAb;AACA,mBAAO,KAAK3B,gBAAL,CACJZ,GADI,CACA2f,IADA,EAEJrgC,IAFI,CAEC,qDAAI,UAAC8b,GAAD;AAAA,qBAASukB,IAAI,CAACp1B,GAAL,CAAS,UAACq3E,CAAD;AAAA,uBAAOxmE,GAAG,CAACwmE,CAAD,CAAV;AAAA,eAAT,EAAwBlyE,IAAxB,CAA6B,KAA7B,CAAT;AAAA,aAAJ,CAFD,CAAP;AAGD;;;iBAED,4BAAgB;AACd,mBAAO4V,MAAM,CAACqa,IAAP,CAAY09C,iEAAZ,EACJ3uE,MADI,CACG,UAACshB,GAAD;AAAA,qBAAS,OAAOqtD,kEAAUrtD,GAAV,CAAP,KAA0B,QAAnC;AAAA,aADH,EAEJzlB,GAFI,CAEA,UAACylB,GAAD;AAAA,qBAASqtD,kEAAUrtD,GAAV,CAAT;AAAA,aAFA,CAAP;AAGD;;;;;;;yBA1BUyxD,mBAAgBt5E;AAAA;;;eAAhBs5E;AAAgBntE,iBAAhBmtE,iBAAgB;AAAA7sE,oBAFf;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCODitE;AAEX;AAAA;AAAgB;;;;iBAEhB,kBAAM,CAAW;;;iBAEjB,mBAAO,CAAW;;;iBAElB,0BAAiBvhF,OAAjB,EAAiC,CAAU;;;iBAE3C,iBAAQoQ,IAAR,EAA0B,CAAU;;;iBAEpC,eACE7Q,OADF,EAEEiiF,GAFF,EAGE53D,OAHF,EAI0B;AAAA,8CAArB63D,cAAqB;AAArBA,4BAAqB;AAAA;;AAExB,iBAAKr8D,GAAL,cAASwE,OAAT,EAAkBrqB,OAAlB,EAAyBmiF,4DAAzB,EAAyCF,GAAzC,SAAiDC,cAAjD;AACD;;;iBAED,eAAM73D,OAAN,EAAuB43D,GAAvB,EAA6D;AAAA,+CAArBC,cAAqB;AAArBA,4BAAqB;AAAA;;AAC3D,iBAAKr8D,GAAL,cAASwE,OAAT,EAAkB,IAAlB,EAAwB83D,4DAAxB,EAAwCF,GAAxC,SAAgDC,cAAhD;AACD;;;iBAED,aACE73D,OADF,EAEErqB,KAFF,EAGEoiF,KAHF,EAIEH,GAJF,EAK0B;AAExB,gBAAMj+C,GAAG,cAAOo+C,KAAK,CAACN,WAAN,EAAP,cACPG,GAAG,GAAG,MAAMA,GAAN,GAAY,GAAf,GAAqB,EADjB,cAEL53D,OAFK,CAAT;;AAFwB,+CAArB63D,cAAqB;AAArBA,4BAAqB;AAAA;;AAKxBA,0BAAc,CAAC94E,MAAf,GAAwB,CAAxB,GACIi5E,OAAO,CAACx8D,GAAR,CAAYme,GAAZ,EAAiBk+C,cAAjB,CADJ,GAEIG,OAAO,CAACx8D,GAAR,CAAYme,GAAZ,CAFJ;;AAGA,gBAAIhkC,KAAJ,EAAW;AACTqiF,qBAAO,CAACriF,KAAR,CAAcA,KAAd;AACD;AACF;;;;;;;yBAzCUgiF;AAAqB;;;eAArBA;AAAqBvtE,iBAArButE,sBAAqB;AAAAjtE,oBAFpB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACZd;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UA0CautE;AAaT,qCAAoBhiD,IAApB,EACoB5hC,QADpB,EAEoB6jF,aAFpB,EAEgD;AAAA;;AAF5B;AACA;AACA;AAbZ,iCAAkB,KAAlB;AACA,4BAAa,KAAb;AAGA,uBAAkB,EAAlB;AACA,4BAAa,KAAb;AAUN,eAAKC,aAAL,GAAqB,IAAIC,iBAAJ,CAAsB;AACzCC,6BAAiB,EAAE,KADsB;AAEzCC,wBAAY,EAAE,KAF2B;AAGzCC,yBAAa,EAAE,yBAH0B;AAIzCC,0BAAc,EAAE,qBAJyB;AAKzCC,wBAAY,EAAE,IAL2B;AAMzCC,uBAAW,EAAE,OAN4B;AAOzCC,wBAAY,EAAE,OAP2B;AAQzCC,mBAAO,EAAE3iD,IAAI,CAAC4iD,cAR2B;AASzCC,kBAAM,EAAE,MATiC;AAUzCC,qBAAS,EAAE,QAV8B;AAWzCC,mBAAO,EAAE;AAXgC,WAAtB,CAArB;AAaA,eAAK79D,MAAL,GAAc,KAAKg9D,aAAnB;AACD;AAED;;;;;;;iBAGA,cAAKc,aAAL,EAAsC;AAAA;;AACpC,mBAAO,KAAK5kF,QAAL,CAAcsC,KAAd,GACJ5D,IADI,CACC,YAAK;AACT,sBAAI,CAACooB,MAAL,GAAc,IAAIi9D,iBAAJ,CAAsBa,aAAtB,CAAd,CADS,CAET;;AACA,sBAAI,CAAC99D,MAAL,CAAY+9D,KAAZ,CAAkB,QAAI,CAACf,aAAvB;;AACA,kBAAI,CAAC,QAAI,CAACh9D,MAAL,CAAYy9D,OAAjB,EAA0B;AACxB,oBAAI,QAAI,CAACvkF,QAAL,CAAcoV,EAAd,CAAiB,QAAjB,CAAJ,EAAgC;AAC9B;AACA,0BAAI,CAAC0R,MAAL,CAAYy9D,OAAZ,GAAsB,QAAI,CAAC3iD,IAAL,CAAUgB,aAAhC;AACD,iBAHD,MAGO;AACL,0BAAI,CAACkiD,aAAL,CAAmB,0CAAnB;AACD;AACF;;AACD,sBAAI,CAACA,aAAL,CAAmB,iDAAiDnlE,IAAI,CAACC,SAAL,CAAe,QAAI,CAACkH,MAApB,CAApE;;AACA,sBAAI,CAACi+D,eAAL,GAAuB,KAAvB;;AACA,sBAAI,CAACD,aAAL,CAAmB,0BAAnB;;AACA,sBAAI,CAAC39D,GAAL,CAAS,0BAAT;;AACA,kBAAI,CAAC,QAAI,CAACnnB,QAAL,CAAcoV,EAAd,CAAiB,QAAjB,CAAL,EACA;AACE,wBAAI,CAAC0vE,aAAL,CAAmB,6EAA6E,QAAI,CAAC9kF,QAAL,CAAcoS,GAAd,EAAhG;;AACA,wBAAI,CAAC4yE,UAAL,GAAkB,IAAlB;AACA,uBAAOvmF,OAAO,CAACqO,OAAR,EAAP;AACD;;AACD,sBAAI,CAACg4E,aAAL,CAAmB,qBAAqB,QAAI,CAACh+D,MAAL,CAAYy9D,OAApD;;AACA,qBAAO,QAAI,CAAC3iD,IAAL,CAAUioB,QAAV,CAAmB,QAAI,CAAC/iC,MAAL,CAAYy9D,OAA/B,EAAwC,QAAI,CAACz9D,MAAL,CAAY29D,MAApD,EACJ/lF,IADI,CACC,YAAK;AACT,wBAAI,CAAComF,aAAL,CAAmB,yBAAnB;;AACA,uBAAO,QAAI,CAACG,WAAL,EAAP;AACD,eAJI,WAKE,aAAG,EAAG;AACX,wBAAI,CAACH,aAAL,CAAmB,uCAAuCnlE,IAAI,CAACC,SAAL,CAAere,GAAf,CAA1D;;AACA,uBAAO,QAAI,CAAC2jF,YAAL,EAAP;AACD,eARI,CAAP;AASD,aAjCI,CAAP;AAkCD;;;iBAED,mBAAO;AACL,mBAAO,KAAKH,eAAZ;AACD;AAED;;;;;;iBAGQ,wBAAY;AAAA;;AAClB,iBAAKD,aAAL,CAAmB,wCAAnB;AACA,mBAAO,KAAKljD,IAAL,CAAUqmB,SAAV,CAAoB,KAAKnhC,MAAL,CAAYy9D,OAAhC,EAAyC,KAAKz9D,MAAL,CAAY29D,MAArD,EAA6D,KAA7D,EACJ/lF,IADI,CACC,YAAK;AACT,sBAAI,CAAComF,aAAL,CAAmB,wCAAnB;;AACA,qBAAO,QAAI,CAACG,WAAL,EAAP;AACD,aAJI,WAKE,aAAG,EAAG;AACX,sBAAI,CAACD,UAAL,GAAkB,IAAlB;;AACA,sBAAI,CAACF,aAAL,CAAmB,yCAAyCnlE,IAAI,CAACC,SAAL,CAAere,GAAf,CAA5D;AACD,aARI,CAAP;AASD;AAED;;;;;;;iBAIQ,uBAAW;AAAA;;AACjB,iBAAKujF,aAAL,CAAmB,mCAAnB;AACA,mBAAO,KAAKljD,IAAL,CAAUqnB,OAAV,CAAkB,KAAKniC,MAAL,CAAYy9D,OAA9B,EAAuC,KAAKz9D,MAAL,CAAY29D,MAAnD,EACJ/lF,IADI,CACC,UAACwqD,OAAD,EAAqB;AACzB,kBAAIA,OAAO,IAAIA,OAAO,CAACx+C,MAAR,GAAiB,CAAhC,EAAmC;AACjC,wBAAI,CAACo6E,aAAL,CAAmB57B,OAAO,CAACx+C,MAAR,GAAiB,4BAApC;;AACA,uBAAO,QAAI,CAACy6E,YAAL,CAAkBj8B,OAAlB,CAAP;AACD,eAHD,MAGO;AACL,wBAAI,CAAC47B,aAAL,CAAmB,8BAAnB;;AACA,uBAAO,QAAI,CAACM,gBAAL,CAAsB,IAAtB,EAA4B,CAA5B,EAA+B,IAA/B,CAAP;AACD;AACF,aATI,WAUE,aAAG,EAAG;AACX,sBAAI,CAACN,aAAL,CAAmB,8BAA8BnlE,IAAI,CAACC,SAAL,CAAere,GAAf,EAAoBwlB,MAAM,CAACs+D,mBAAP,CAA2B9jF,GAA3B,CAApB,CAAjD;;AACA,oBAAMA,GAAN;AACD,aAbI,CAAP;AAcD;AAED;;;;;;;iBAIc,sBAAa2nD,OAAb,EAA6B;;;;;;;;;;AACzC,2BAAK47B,aAAL,CAAmB,yBAAyB57B,OAAO,CAACx+C,MAAjC,GAA0C,YAA7D;AACAw+C,6BAAO,GAAGo8B,2CAASp8B,OAAT,EAAkB,UAACC,KAAD;AAAA,+BAAkBA,KAAK,CAACC,MAAN,IAAgBD,KAAK,CAACnkC,IAAtB,IAA8BmkC,KAAK,CAACnkC,IAAN,CAAWpM,UAAX,CAAsB,QAAI,CAACkO,MAAL,CAAY49D,SAAlC,CAAhD;AAAA,uBAAlB,CAAV;;4BACIx7B,OAAO,CAACx+C,MAAR,KAAmB;;;;;0DACd,KAAK06E,gBAAL,CAAsB,IAAtB,EAA4B,CAA5B,EAA+B,IAA/B,WACE,aAAG,EAAG;AACX;AACA,gCAAI,CAACJ,UAAL,GAAkB,IAAlB;AACA,8BAAMzjF,GAAN;AACD,uBALI;;;AAOT2nD,6BAAO,GAAGo8B,4CAAUp8B,OAAV,EAAmB,CAAC,MAAD,CAAnB,EAA4B,CAAC,KAAD,CAA5B,CAAV;AACMnnC,8BAAQmnC,OAAO,CAACx+C;AAClB66E,mCAAa;AACbC,kCAAY;;AAEd;+DACoBt8B;;;;;;;;;;;AAATC;;AACI,6BAAM,KAAKs8B,WAAL,CAAiBt8B,KAAjB,CAAN;;;AAAPp4C;AACN;AACAw0E,gCAAU;AACVC,+BAAS,IAAIz0E,IAAb;AACA,2BAAK+zE,aAAL,CAAmB,WAAWS,UAAX,GAAwB,wBAAxB,GAAmDC,SAAtE;;4BACIA,SAAS,GAAG,KAAK1+D,MAAL,CAAYw9D;;;;;AAC1B,2BAAKQ,aAAL,CAAmB,wCAAwCU,SAA3D;0DACO,KAAKE,eAAL,CAAqBx8B,OAArB,EAA8Bn4C,IAA9B,WACE,aAAG,EAAG;AACX;AACA,gCAAI,CAACi0E,UAAL,GAAkB,IAAlB;AACA,8BAAMzjF,GAAN;AACD,uBALI;;;4BAMEgkF,UAAU,KAAKxjE;;;;;AACxB,2BAAK+iE,aAAL,CAAmB,gCAAgCU,SAAnD,GACA;;AACMG,kCAAYz8B,OAAO,CAACx+C,MAAR,GAAiB,CAAjB,GAAqBw+C,OAAO,CAACA,OAAO,CAACx+C,MAAR,GAAiB,CAAlB,CAA5B,GAAmD;0DAC9D,KAAK06E,gBAAL,CAAsBO,SAAtB,EAAiC50E,IAAjC,EAAuC,IAAvC,WACE,aAAG,EAAG;AACX;AACA,gCAAI,CAACi0E,UAAL,GAAkB,IAAlB;AACA,8BAAMzjF,GAAN;AACD,uBALI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASLokF,mCAAYz8B,OAAO,CAACx+C,MAAR,GAAiB,CAAjB,GAAqBw+C,OAAO,CAACA,OAAO,CAACx+C,MAAR,GAAiB,CAAlB,CAA5B,GAAmD,MACrE;;0DACO,KAAK06E,gBAAL,CAAsBO,UAAtB,EAAiC,CAAjC,2BACE,aAAG,EAAG;AACX;AACA,gCAAI,CAACX,UAAL,GAAkB,IAAlB;AACA,8BAAMzjF,GAAN;AACD,uBALI;;;;;;;;;AAOV;AAED;;;;;;;;iBAKc,qBAAY4nD,KAAZ,EAAwB;;;;;;0DAC7B,IAAI1qD,OAAJ,CAAY,UAACqO,OAAD,EAA8B8K,MAA9B,EAAwC;AACzDuxC,6BAAK,CAAC9uB,WAAN,CAAkB,kBAAQ,EAAG;AAC3BvtB,iCAAO,CAAC0zB,QAAQ,CAACzvB,IAAV,CAAP;AACD,yBAFD,EAEG,iBAAO,EAAG;AACX6G,gCAAM,CAAC,gDAAgD+H,IAAI,CAACC,SAAL,CAAegmE,OAAf,CAAjD,CAAN;AACD,yBAJD;AAKD,uBANM;;;;;;;;;AAOR;AAED;;;;;;;;;;iBAOQ,yBAAgB18B,OAAhB,EAAkC28B,aAAlC,EAAuD;AAAA;;AAC7D,mBAAO,KAAKl8B,UAAL,CAAgBT,OAAO,CAAC,CAAD,CAAvB,EACJxqD,IADI,CACC,YAAK;AACT,sBAAI,CAAComF,aAAL,CAAmB,4BAAnB,EADS,CAET;;;AACA57B,qBAAO,CAAC48B,KAAR,GAHS,CAIT;;AACA,qBAAO,QAAI,CAACX,YAAL,CAAkBj8B,OAAlB,CAAP;AACD,aAPI,WAQE,aAAG,EAAG;AACX,kBAAMy8B,SAAS,GAAGz8B,OAAO,CAACx+C,MAAR,GAAiB,CAAjB,GAAqBw+C,OAAO,CAACA,OAAO,CAACx+C,MAAR,GAAiB,CAAlB,CAA5B,GAAmD,IAArE,CADW,CAEX;;AACA,qBAAO,QAAI,CAAC06E,gBAAL,CAAsBO,SAAtB,EAAiCE,aAAjC,EAAgD,iDAAiDtkF,GAAjG,CAAP;AACD,aAZI,CAAP;AAaD;AAED;;;;;;;;;iBAMQ,0BAAiBokF,SAAjB,EAAmCE,aAAnC,EAA0DvkF,KAA1D,EAAuE;AAAA;;AAC7E,iBAAKwjF,aAAL,CAAmB,uBAAnB;;AACA,gBAAIa,SAAS,IAAIE,aAAa,GAAG,KAAK/+D,MAAL,CAAYu9D,WAA7C,EAA0D;AACxD,mBAAK0B,WAAL,GAAmBJ,SAAnB;AACA,mBAAKZ,eAAL,GAAuB,IAAvB;;AACA,kBAAIzjF,KAAJ,EAAW;AACT,qBAAK6lB,GAAL,CAAS7lB,KAAT;AACD;;AACD,mBAAKwjF,aAAL,CAAmB,+CAA+C,KAAKiB,WAAL,CAAiBC,QAAnF;AACA,mBAAK7+D,GAAL,CAAS,+CAA+C,KAAK4+D,WAAL,CAAiB/gE,IAAzE;AACA,qBAAOvmB,OAAO,CAACqO,OAAR,EAAP;AACD,aATD,MASO;AACL,mBAAKg4E,aAAL,CAAmB,2DAAnB;AACA,qBAAO,KAAKmB,cAAL,GACJvnF,IADI,CACC,YAAK;AACT,wBAAI,CAACqmF,eAAL,GAAuB,IAAvB;;AACA,oBAAIzjF,KAAJ,EAAW;AACT,0BAAI,CAAC6lB,GAAL,CAAS7lB,KAAT;AACD;;AACD,wBAAI,CAACwjF,aAAL,CAAmB,0CAA0C,QAAI,CAACiB,WAAL,CAAiBC,QAA9E;;AACA,wBAAI,CAAC7+D,GAAL,CAAS,0CAA0C,QAAI,CAAC4+D,WAAL,CAAiB/gE,IAApE;;AACA,uBAAOvmB,OAAO,CAACqO,OAAR,EAAP;AACD,eATI,CAAP;AAUD;AACF;AAED;;;;;;;iBAIQ,oBAAWq8C,KAAX,EAAuB;AAC7B,iBAAK27B,aAAL,CAAmB,oBAAoB37B,KAAK,CAAC68B,QAA7C;AACA,gBAAMA,QAAQ,GAAG78B,KAAK,CAAC68B,QAAvB;AACA,gBAAMznF,IAAI,GAAGynF,QAAQ,CAACrwE,OAAT,CAAiBwzC,KAAK,CAACnkC,IAAvB,EAA6B,EAA7B,CAAb;AACA,mBAAO,KAAK4c,IAAL,CAAU+nB,UAAV,CAAqB,KAAK7iC,MAAL,CAAYy9D,OAAZ,GAAsBhmF,IAA3C,EAAiD4qD,KAAK,CAACnkC,IAAvD,CAAP;AACD;AAED;;;;;;;;iBAKQ,qBAAY2G,OAAZ,EAA6BpqB,GAA7B,EAA0C;AAChD,gBAAM6f,IAAI,GAAG,IAAIC,IAAJ,EAAb;AACA,gBAAMqV,UAAU,GAAG,6DAAWtV,IAAX,EAAiB,KAAK0F,MAAL,CAAYo9D,aAA7B,EAA4C,OAA5C,CAAnB;AACA,gBAAMgC,UAAU,GAAG,MAAMxvD,UAAN,GAAmB,IAAnB,GAA0B/K,OAA1B,GAAoC,MAAvD;;AACA,gBAAI,KAAK7E,MAAL,CAAYm9D,YAAhB,EAA8B;AAC5B,kBAAI1iF,GAAJ,EAAS;AACPoiF,uBAAO,CAACriF,KAAR,CAAc4kF,UAAd;AACD,eAFD,MAEO;AACLvC,uBAAO,CAACx8D,GAAR,CAAY++D,UAAZ;AACD;AACF;;AACD,gBAAI,KAAKlB,UAAT,EAAqB;AACnB,mBAAKF,aAAL,CAAmB,gDAAnB;AACA;AACD,aAHD,MAGO;AACL;AACA,mBAAKqB,KAAL,CAAWx6E,IAAX,CAAgBu6E,UAAhB;;AACA,kBAAI,KAAKnB,eAAT,EAA0B;AACxB,oBAAI,KAAKoB,KAAL,CAAWz7E,MAAX,GAAoB,CAApB,IAAyB,CAAC,KAAK07E,UAAnC,EAA+C;AAC7C,uBAAKA,UAAL,GAAkB,IAAlB;AACA,uBAAKC,SAAL;AACD;AACF,eALD,MAKO;AACL,qBAAKvB,aAAL,CAAmB,iDAAnB;AACD;AACF;AACF;;;iBAED,aACEn5D,OADF,EAEErqB,KAFF,EAGEoiF,KAHF,EAIEH,GAJF,EAK0B;AAExB,gBAAIj+C,GAAG,cAAOo+C,KAAK,SAAL,SAAK,WAAL,GAAK,MAAL,QAAK,CAAEN,WAAP,EAAP,cACLG,GAAG,GAAG,MAAMA,GAAN,GAAY,GAAf,GAAqB,EADnB,cAEH53D,OAFG,CAAP;;AAFwB,+CAArB63D,cAAqB;AAArBA,4BAAqB;AAAA;;AAKxB,gBAAIA,cAAJ,EAAoB;AAClBl+C,iBAAG,wBAAiB,KAAK1lB,SAAL,CAAe4jE,cAAf,CAAjB,CAAH;AACD;;AACD,gBAAIliF,KAAK,IAAKoiF,KAAK,IAAIA,KAAK,IAAI4C,4DAAhC,EAAiD;AAC/C,mBAAK/kF,GAAL,CAAS+jC,GAAT,EAAchkC,KAAd;AACD,aAFD,MAEO;AACL,mBAAKilF,WAAL,CAAiBjhD,GAAjB,EAAsB,KAAtB;AACD;AACF;AAED;;;;;;;iBAIA,gBAAO3Z,OAAP,EAAsB;AACpB,gBAAI,KAAK7E,MAAL,CAAY69D,OAAhB,EAAyB;AACvB,mBAAKx9D,GAAL,CAAS,aAAawE,OAAtB;AACD;AACF;AAED;;;;;;;;iBAKA,aAAIA,OAAJ,EAAqBrqB,KAArB,EAAgC;AAC9B,gBAAI4kF,UAAU,GAAG,YAAYv6D,OAA7B;;AACA,gBAAIrqB,KAAJ,EAAW;AACT4kF,wBAAU,IAAI,OAAO,KAAKtmE,SAAL,CAAete,KAAf,CAArB;AACD;;AACD,iBAAKilF,WAAL,CAAiBL,UAAjB,EAA6B,IAA7B;AACD;;;iBAEO,mBAAUM,OAAV,EAAwB;AAC9B,gBAAIA,OAAO,IAAIA,OAAO,CAAC97E,MAAR,GAAiB,CAAhC,EAAmC;AACjC,qBAAOiV,IAAI,CAACC,SAAL,CAAe4mE,OAAf,CAAP;AACD;;AACD,mBAAO,EAAP;AACD;AAED;;;;;;iBAGQ,qBAAS;AAAA;;AACf,iBAAK1B,aAAL,CAAmB,2BAAnB;AACA,iBAAK2B,YAAL,GACG/nF,IADH,CACQ,YAAK;AACT,kBAAI,QAAI,CAACynF,KAAL,CAAWz7E,MAAX,GAAoB,CAAxB,EAA2B;AACzB,wBAAI,CAAC27E,SAAL;AACD,eAFD,MAEO;AACL,wBAAI,CAACK,eAAL,GACGhoF,IADH,CACQ,YAAK;AACT,0BAAI,CAAC0nF,UAAL,GAAkB,KAAlB;AACD,iBAHH,WAIS,aAAG,EAAG;AACX,0BAAI,CAACtB,aAAL,CAAmB,iCAAiCnlE,IAAI,CAACC,SAAL,CAAere,GAAf,CAApD;;AACA,0BAAI,CAAC6kF,UAAL,GAAkB,KAAlB;AACD,iBAPH;AAQD;AACF,aAdH,WAeS,aAAG,EAAG;AACX,sBAAI,CAACtB,aAAL,CAAmB,6BAA6BvjF,GAAhD;;AACA,sBAAI,CAAC6kF,UAAL,GAAkB,KAAlB;AACD,aAlBH;AAmBD;AAED;;;;;;iBAGQ,wBAAY;AAAA;;AAClB,iBAAKtB,aAAL,CAAmB,gCAAgC,KAAKqB,KAAL,CAAWz7E,MAA9D;;AACA,gBAAI,KAAKy7E,KAAL,CAAWz7E,MAAX,GAAoB,CAAxB,EAA2B;AACzB,kBAAMihB,OAAO,GAAG,KAAKw6D,KAAL,CAAWL,KAAX,EAAhB;AACA,qBAAO,KAAKlkD,IAAL,CAAUD,SAAV,CAAoB,KAAK7a,MAAL,CAAYy9D,OAAZ,GAAsB,GAAtB,GAA4B,KAAKz9D,MAAL,CAAY29D,MAA5D,EAAoE,KAAKsB,WAAL,CAAiB/gE,IAArF,EAA2F2G,OAA3F,EAAoG;AACzGkvB,sBAAM,EAAE,IADiG;AAEzGllC,uBAAO,EAAE;AAFgG,eAApG,EAIJjX,IAJI,CAIC,YAAK;AACT,wBAAI,CAACioF,KAAL;AACA,uBAAO,QAAI,CAACD,eAAL,EAAP;AACD,eAPI,WAQE,aAAG,EAAG;AACX,wBAAI,CAAC5B,aAAL,CAAmB,4BAA4BvjF,GAA/C;AACD,eAVI,CAAP;AAWD,aAbD,MAaO;AACL,qBAAO9C,OAAO,CAACqO,OAAR,EAAP;AACD;AACF;AAED;;;;;;iBAGQ,2BAAe;AACrB,gBAAI,KAAK65E,KAAL,IAAc,KAAK7/D,MAAL,CAAYs9D,YAA9B,EAA4C;AAC1C,mBAAKU,aAAL,CAAmB,yDAAnB;AACA,qBAAO,KAAKmB,cAAL,EAAP;AACD,aAHD,MAGO;AACL,qBAAOxnF,OAAO,CAACqO,OAAR,EAAP;AACD;AACF;AAED;;;;;;iBAGQ,6BAAiB;AACvB,gBAAMsU,IAAI,GAAG,IAAIC,IAAJ,EAAb;AACA,gBAAMqV,UAAU,GAAG,6DAAWtV,IAAX,EAAiB,KAAK0F,MAAL,CAAYq9D,cAA7B,EAA6C,OAA7C,CAAnB;AACA,mBAAO,KAAKr9D,MAAL,CAAY49D,SAAZ,GAAwB,GAAxB,GAA8BhuD,UAA9B,GAA2C,MAAlD;AACD;AAED;;;;;;iBAGQ,0BAAc;AAAA;;AACpB,gBAAM6K,QAAQ,GAAG,KAAKqlD,iBAAL,EAAjB;AACA,iBAAK9B,aAAL,CAAmB,mCAAmC,KAAKh+D,MAAL,CAAYy9D,OAA/C,GAAyD,KAAKz9D,MAAL,CAAY29D,MAArE,GAA8E,GAA9E,GAAoFljD,QAAvG;AACA,mBAAO,KAAKK,IAAL,CAAUilD,UAAV,CAAqB,KAAK//D,MAAL,CAAYy9D,OAAZ,GAAsB,GAAtB,GAA4B,KAAKz9D,MAAL,CAAY29D,MAA7D,EAAqEljD,QAArE,EAA+E,KAA/E,EACJ7iC,IADI,CACC,iBAAO,EAAG;AACd,sBAAI,CAACioF,KAAL,GAAa,CAAb;AACA,sBAAI,CAACZ,WAAL,GAAmBe,OAAnB;;AACA,sBAAI,CAAChC,aAAL,CAAmB,uBAAuB,QAAI,CAACiB,WAAL,CAAiBC,QAA3D;AACD,aALI,WAME,aAAG,EAAG;AACX,sBAAI,CAAClB,aAAL,CAAmB,gCAAgCnlE,IAAI,CAACC,SAAL,CAAere,GAAf,CAAnD;AACD,aARI,CAAP;AASD;AAED;;;;;;iBAGA,uBAAW;AACT,iBAAKujF,aAAL,CAAmB,kCAAnB;;AACA,gBAAI,KAAKE,UAAT,EAAqB;AACnB,mBAAKF,aAAL,CAAmB,gDAAnB;AACA,qBAAOrmF,OAAO,CAACqO,OAAR,CAAgB,EAAhB,CAAP;AACD,aAHD,MAGO;AACL,qBAAO,KAAK80B,IAAL,CAAUqnB,OAAV,CAAkB,KAAKniC,MAAL,CAAYy9D,OAA9B,EAAuC,KAAKz9D,MAAL,CAAY29D,MAAnD,CAAP;AACD;AACF;;;iBAEO,uBAAc94D,OAAd,EAA6B;AACnC,gBAAI,KAAK7E,MAAL,CAAYk9D,iBAAhB,EAAmC;AACjCL,qBAAO,CAACx8D,GAAR,CAAY,sBAAsBwE,OAAlC;AACD;AACF;;;iBAEK,2BAAe;;;;;;;;AACC,6BAAM,KAAKo7D,WAAL,EAAN;;;AAAdC;AACAC,kCAAsBD,WAAW,CAACh7E,GAAZ,CAAgB,eAAK;AAAA,+BAAIm9C,KAAK,CAAC+9B,KAAN,EAAJ;AAAA,uBAArB;AACtBrlC,oCAAcolC;AACd30E,8BAA8B;AAClC+gC,0BAAE,EAAE8zC,oEAD8B;AAElCtlC,mCAAW,EAAXA,WAFkC;AAGlCulC,+BAAO,EAAE,mBAHyB;AAIlCvnE,4BAAI,EAAE,EAJ4B;AAKlCwnE,8BAAM,EAAE;AAL0B;AAOpC,2BAAKxD,aAAL,CAAmBzrE,IAAnB,CAAwB9F,KAAxB;;;;;;;;;AACD;;;;;;;yBAxcQsxE,qBAAkBn5D;AAAA;;;eAAlBm5D;AAAkB7tE,iBAAlB6tE,mBAAkB;AAAAvtE,oBAFhB;;;UA6cT0tE;AAmCF,mCAAYuD,MAAZ,EAAuB;AAAA;;AACrB;AACA,eAAK,IAAMC,CAAX,IAAgBD,MAAhB,EAAwB;AACtB;AACA,iBAAKC,CAAL,IAAUD,MAAM,CAACC,CAAD,CAAhB;AACD;AACF;AAED;;;;;;;;iBAIA,eAAMzgE,MAAN,EAAiB;AACf,iBAAK,IAAMu8D,CAAX,IAAgBv8D,MAAhB,EAAwB;AACtB,kBAAI,EAAEu8D,CAAC,IAAI,IAAP,CAAJ,EAAkB;AAChB,qBAAKA,CAAL,IAAUv8D,MAAM,CAACu8D,CAAD,CAAhB;AACD;AACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1iBL,UAAYmE,SAAZ;;AAAA,iBAAYA,QAAZ,EAAoB;AAClBA;AACAA;AACAA;AACAA;AACAA;AACD,OAND,EAAYA,SAAQ,KAARA,SAAQ,MAApB;;;;;;;;;;;;;;;;;;;;;;;;;UCIsBC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCWTC;AAIX,gCACElwC,iBADF,EAEU/2C,kBAFV,EAEgD;AAAA;;AAAtC;AAER,eAAKknF,WAAL,GAAmBnwC,iBAAiB,CAACgB,aAAlB,EAAnB;AACA,eAAKrxB,GAAL,qBACe,KAAKwgE,WAAL,CAAiB3mE,OADhC,uBACoD,KAAK2mE,WAAL,CAAiB1mE,WADrE,GAEE,IAFF,EAGE2mE,2DAHF;AAKD;;;;iBAED,eACEtmF,OADF,EAEEiiF,GAFF,EAGE53D,OAHF,EAI0B;AAAA,+CAArB63D,cAAqB;AAArBA,4BAAqB;AAAA;;AAExB,iBAAKr8D,GAAL,cAASwE,OAAT,EAAkBrqB,OAAlB,EAAyBsmF,4DAAzB,EAAyCrE,GAAzC,SAAiDC,cAAjD;AACD;;;iBAED,eAAM73D,OAAN,EAAuB43D,GAAvB,EAA6D;AAAA,+CAArBC,cAAqB;AAArBA,4BAAqB;AAAA;;AAC3D,iBAAKr8D,GAAL,cAASwE,OAAT,EAAkB,IAAlB,EAAwBi8D,4DAAxB,EAAwCrE,GAAxC,SAAgDC,cAAhD;AACD;;;iBAED,0BAAiBzhF,OAAjB,EAAiC;AAC/B8lF,8DAAY;AACVC,iBAAG,EAAEC,gFAAyBpuE,yDAAzB,GAA8C,IADzC;AAEVquE,uBAAS,EAAEC,2DAFD;AAGVC,yBAAW,EACTnmF,OAAO,KAAKomF,oEAAZ,GACI,QADJ,GAEIpmF,OAAO,KAAKomF,oEAAZ,GACE,aADF,GAEE,aARE;AASVpjE,qBAAO,EAAEgjE,6EATC;AAUVK,qBAAO,EAAE,KAAKT,WAAL,CAAiB3mE,OAVhB;AAWVqnE,kBAAI,EAAE,KAAKV,WAAL,CAAiBzmE;AAXb,aAAZ;AAaD;;;iBAED,kBAAM;AACJ2mE,8DAAY;AACVC,iBAAG,EAAEC,gFAAyBpuE,yDAAzB,GAA8C,IADzC;AAEVoL,qBAAO,EAAEgjE;AAFC,aAAZ;AAID;;;iBAED,mBAAO;AACLF,8DAAY;AACVC,iBAAG,EAAE,IADK;AAEV/iE,qBAAO,EAAE;AAFC,aAAZ;AAID;;;iBAED,iBAAQ5S,IAAR,EAA0B;AACxB,gBAAIA,IAAI,IAAIA,IAAI,CAACG,KAAjB,EAAwB;AACtBg2E,0EAAsB,UAACC,KAAD,EAAU;AAC9BA,qBAAK,CAACrjE,OAAN,CAAc;AAAE5S,uBAAK,EAAEH,IAAI,CAACG;AAAd,iBAAd;AACD,eAFD;AAGD;AACF;;;iBAED,aACEqZ,OADF,EAEErqB,KAFF,EAGEoiF,KAHF,EAIEH,GAJF,EAK0B;AAAA,+CAArBC,cAAqB;AAArBA,4BAAqB;AAAA;;AAExB,iBAAK/iF,kBAAL,CAAwB0mB,GAAxB,CAA4BwE,OAA5B,EAAqCrqB,KAArC,EAA4CoiF,KAA5C,EAAmDH,GAAnD,EAAwDC,cAAxD,EAAwEliF,KAAxE;;AACA,gBACEqqB,OAAO,KACN+3D,KAAK,KAAKkE,8DAAV,IACClE,KAAK,KAAKkE,2DADX,IAEClE,KAAK,KAAKkE,4DAHL,CADT,EAKE;AACAU,yEAAqB;AACnBE,wBAAQ,EAAEjF,GADS;AAEnBjuE,oBAAI,EAAEkuE,cAFa;AAGnB73D,uBAAO,EAAPA,OAHmB;AAInB+3D,qBAAK,EAAGA;AAJW,eAArB;AAMD;;AACD,gBAAIpiF,KAAK,IAAIoiF,KAAK,KAAKkE,4DAAvB,EAAuC;AACrC,kBAAItmF,KAAJ,EAAW;AACTgnF,8EAAwBhnF,KAAxB;AACD;AACF;AACF;;;;;;;yBA7FUomF,gBAAa59B;AAAA;;;eAAb49B;AAAa3xE,iBAAb2xE,cAAa;AAAArxE,oBAFZ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACXd;;;;;;;AAKO,eAASoyE,wBAAT,CAAiC9pD,IAAjC,EAA6C;AAClD,YAAI1mB,MAAM,GAAG0mB,IAAb;;AACA,YAAI,OAAM,SAAN,UAAM,WAAN,GAAM,MAAN,SAAM,CAAEryB,OAAR,CAAgBo8E,2FAAhB,MAAuC,CAA3C,EAA8C;AAC5CzwE,gBAAM,GAAG0wE,0BAA0B,CAAC1wE,MAAD,EAAS,MAAT,EAAiB,eAAjB,CAAnC;AACD;;AACD,eAAOA,MAAP;AACD;AAGD;;;;;;;;;;AAQA,eAAS0wE,0BAAT,CAAoCv2E,GAApC,EAAiDw2E,QAAjD,EAAmEC,UAAnE,EAAqF;AACnF,YAAMC,EAAE,GAAG,IAAIrT,MAAJ,CAAW,cAAcmT,QAAd,GAAyB,mBAApC,EAAyD,GAAzD,CAAX;;AACA,YAAIx2E,GAAG,CAAC22E,KAAJ,CAAUD,EAAV,CAAJ,EAAmB;AACjB,iBAAO12E,GAAG,CAACuD,OAAJ,CAAYmzE,EAAZ,EAAgBF,QAAQ,GAAG,GAAX,GAAiBC,UAAjC,CAAP;AACD;;AACD,eAAOz2E,GAAP;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCgEY42E;;;;;yBAAAA;AAAY;;;cAAZA;;;kBAhEF,CACPC,0DADO,EAEPC,wDAFO,EAGPA,gEAHO,EAIPC,wDAJO,EAKPC,mEALO,EAMPC,iEANO,EAOPC,0DAPO,EAQPC,wEARO,EASPC,0DATO,EAUPC,wEAVO,GAkCPR,4DACAC,0DACAA,kEACAC,0DACAE,mEACAC,4DAEAF,qEACAG,0EAiBAC,4DACAC;;;;6HAIST,eAAY;AAAAtkF,yBAnDrBglF,4FAmDqB,EAlDrBC,sFAkDqB,EAjDrBC,qGAiDqB,EAhDrBC,qGAgDqB,EA/CrBC,sFA+CqB,EA9CrBC,2FA8CqB,EA7CrBC,+EA6CqB,EA5CrBC,uIA4CqB,EA3CrBC,qIA2CqB,EA1CrBC,2FA0CqB,EAzCrBC,iFAyCqB,EAxCrBC,sHAwCqB,EAvCrBC,+FAuCqB,EAtCrBC,iGAsCqB,EArCrBC,sFAqCqB,EApCrBC,kFAoCqB,EAnCrBC,qFAmCqB,EAlCrBC,6FAkCqB,EAjCrBC,qDAiCqB;AAjCdjrF,oBA9BPspF,0DA8BO,EA7BPC,wDA6BO,EA5BPA,gEA4BO,EA3BPC,wDA2BO,EA1BPC,mEA0BO,EAzBPC,iEAyBO,EAxBPC,0DAwBO,EAvBPC,wEAuBO,EAtBPC,0DAsBO,EArBPC,wEAqBO,CAiCc;AAtDA7pF,oBAwBrBqpF,0DAxBqB,EAyBrBC,wDAzBqB,EA0BrBA,gEA1BqB,EA2BrBC,wDA3BqB,EA4BrBE,iEA5BqB,EA6BrBC,0DA7BqB,EA8BrBI,4FA9BqB,EA+BrBN,mEA/BqB,EAgCrBG,wEAhCqB,EAiCrBI,sFAjCqB,EAkCrBC,qGAlCqB,EAmCrBC,qGAnCqB,EAoCrBC,sFApCqB,EAqCrBC,2FArCqB,EAsCrBC,+EAtCqB,EAuCrBC,uIAvCqB,EAwCrBC,qIAxCqB,EAyCrBC,2FAzCqB,EA0CrBC,iFA1CqB,EA2CrBC,sHA3CqB,EA4CrBC,+FA5CqB,EA6CrBC,iGA7CqB,EA8CrBC,sFA9CqB,EA+CrBC,kFA/CqB,EAgDrBE,6FAhDqB,EAiDrBnB,0DAjDqB,EAkDrBC,wEAlDqB,EAmDrBmB,qDAnDqB;AAsDA;AAHd;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtFLl0E;;AAAiCA;;;;AAA2BA;;;;;;AAA3BA;;AAAAA;;;;;;AACjCA;;AAAkDA;;;;;;AAClDA;;;;;;AADkDA;;AAAAA;;;;;;AAElDA;;AAAmDA;;;;;;AACtCA;;;;;;AADsCA;;AAAAA;;;;;;AAJrDA;;AACEA;;AACAA;;AAEAA;;AAEFA;;;;;;AANwDA;;AACvCA;;AAAAA;;AACAA;;AAAAA;;AAEAA;;AAAAA;;;;UCKRm0E;AAKX,gDACUxlF,kBADV,EAEUsZ,IAFV,EAGUte,cAHV,EAGwC;AAAA;;AAF9B;AACA;AACA;AACN;;;;iBAEJ,oBAAQ;AAAA;;AACN,iBAAKme,YAAL,GAAoB,qDAAc,CAChC,KAAKnZ,kBAAL,CAAwBsgB,SADQ,EAEhC,KAAKtgB,kBAAL,CAAwBogB,iBAFQ,CAAd,EAGjBvkB,SAHiB,CAGP,kBAAiC;AAAA;AAAA,kBAA/B2kB,QAA+B;AAAA,kBAArBH,gBAAqB;;AAC5C,kBAAM5X,SAAS,GAAG4X,gBAAgB,CAAC,CAAD,CAAlC;;AACA,sBAAI,CAAC/G,IAAL,CAAUpJ,GAAV,CAAc,YAAK;AACjB,wBAAI,CAACu1E,eAAL,GAAuB,QAAI,CAACC,gBAAL,CAAsBj9E,SAAtB,CAAvB;AACA,oBAAM0nB,2BAA2B,GAAG3P,QAAQ,CAACD,IAAT,CAClC,UAACpV,CAAD;AAAA,yBAAOA,CAAC,CAAC1C,SAAF,KAAgBA,SAAvB;AAAA,iBADkC,CAApC;;AAGA,oBAAI0nB,2BAAJ,EAAiC;AAC/B,0BAAI,CAACw1D,gBAAL,GAAwBx1D,2BAA2B,CAAC3P,QAApD;AACD;AACF,eARD;AASD,aAdmB,CAApB;AAeD;;;iBAED,uBAAW;AACT,iBAAKrH,YAAL,CAAkB1B,WAAlB;AACD;;;iBAED,0BAAiBhP,SAAjB,EAAqC;AACnC,mBAAO23B,sEAA+BwlD,kEAAUn9E,SAAV,CAA/B,EAAqD9B,GAArD,CACL,UAAC6Q,GAAD;AAAA,qBAAkB;AAChBA,mBAAG,EAAEA,GADW;AAEhB8hB,oBAAI,EAAE9hB,GAAG,KAAK,CAAR,GAAY,0BAAZ,GAAyCpR;AAF/B,eAAlB;AAAA,aADK,CAAP;AAMD;;;iBAEK,gBAAI;;;;;;;;;;;AACY,6BAAM,KAAKpG,kBAAL,CAAwB9C,YAAxB,CACvBxB,IADuB,CAClB,sDAAK,CAAL,CADkB,EAEvB+Q,SAFuB,EAAN;;;AAAdyE;AAGFgrC,gCAAU;+DACUhrC,WAAW,CAACmP;;;;8BAAzB5X;AACT,8BAAMo9E,aAAa,GAAG30E,WAAW,CAACkf,mBAAZ,CAAgC7P,IAAhC,CACpB,UAACpV,CAAD;AAAA,mCAAOA,CAAC,CAAC1C,SAAF,KAAgBA,SAAvB;AAAA,2BADoB,CAAtB;;AAGA,8BAAIo9E,aAAa,CAACrlE,QAAd,KAA2B,QAAI,CAACmlE,gBAApC,EAAsD;AACpDE,yCAAa,CAACrlE,QAAd,GAAyB,QAAI,CAACmlE,gBAA9B;AACAzpC,mCAAO,GAAG,IAAV;AACD;;;AAPH,kFAAsD;AAAA;AAQrD;;;;;;;AACD,0BAAIA,OAAJ,EAAa;AACX,6BAAKl8C,kBAAL,CAAwBggC,gBAAxB,CAAyC9uB,WAAzC;AACD;;;;;;;;;AACF;;;;;;;yBA3DUs0E,gCAA6Bn0E;AAAA;;;cAA7Bm0E;AAA6B/nF;AAAAC;AAAAC;AAAAC;AAAAC;AAAA;ADb1CwT;;AACEA;;AAA2CA;;;;AAAiCA;;AAC5EA;;AAAmFA;AAAA,qBAAaitD,UAAb;AAAmB,aAAnB,EAAoB,eAApB,EAAoB;AAAA;AAAA,aAApB;;;;AAEjFjtD;;AAOFA;;AACFA;;;;AAX6CA;;AAAAA;;AAC/BA;;AAAAA;;AACVA;;AACoCA;;AAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEaKw1C;;AAAoDA;;AAAUA;;;;;;AAInGA;;AACEA;;AACFA;;;;;;AAFmBA;;AACjBA;;AAAAA;;;;;;AAwBRA;;AACEA;;AACAA;;AACFA;;;;;;;;AAjDFA;;AACEA;;AACEA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACAA;;AACEA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACAA;;AACEA;;;;AAAqCA;;AACvCA;;AACAA;;AAA0DA;AAAAA;;AAAA;;AAAA;AAAA,aAAmC,eAAnC,EAAmC;AAAAA;;AAAA;;AAAA;AAAA,WAAnC;;;;AAExDA;;AAGFA;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACAA;;AACEA;;;;AACFA;;AACAA;;AAAYA;AAAAA;;AAAA;;AAAA;AAAA,aAAwC,WAAxC,EAAwC;AAAAA;;AAAA;;AAAA;AAAA,WAAxC;;AAA0EA;;AACxFA;;AACAA;;AACEA;;AACAA;;AACEA;;;;AACFA;;AACAA;;AAAYA;AAAAA;;AAAA;;AAAA;AAAA,aAA2C,WAA3C,EAA2C;AAAAA;;AAAA;;AAAA;AAAA,WAA3C;;AAA6EA;;AAC3FA;;AACAA;;AAIAA;;AACEA;;AAAiEA;;;;AAA4BA;;AAC7FA;;AAA0DA;AAAAA;;AAAA;;AAAA;AAAA,aAAkC,eAAlC,EAAkC;AAAAA;;AAAA;;AAAA;AAAA,WAAlC;;;;AAExDA;;AAA6CA;;;;;;AACLA;;AACxCA;;AAAiDA;;;;;;AACTA;;AACxCA;;AAAqDA;;;;AACrDA;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACFA;;AACAA;;AACAA;;AACEA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AAAUA;AAAAA;;AAAA;;AAAA;AAAA;;AACRA;;AACAA;;AAA8BA;;;;AAAmCA;;AACnEA;;AACAA;;AAAUA;AAAAA;;AAAA;;AAAA;AAAA;;AACRA;;AACAA;;AAA8BA;;;;AAAmCA;;AACnEA;;AACAA;;AAAUA;AAAAA;;AAAA;;AAAA;AAAA;;AACRA;;AACAA;;AAA8BA;;;;AAA2CA;;AAC3EA;;AACAA;;AAAUA;AAAAA;;AAAA;;AAAA;AAAA;;AACRA;;AACAA;;AAA8BA;;;;AAAqCA;;AACrEA;;AACFA;;AACAA;;AACEA;;AACEA;;;;AAAwCA;;AAAoDA;;AAC5FA;;AAAoBA;;AACpBA;;AAA+CA;;AAAIA;;AAAoBA;;AAAEA;;AACzCA;;AAAOA;;AACvCA;;;;AACAA;;AAAkDA;;AAAWA;;AAAoBA;;;;AACtCA;;AAA6CA;;AAAGA;;AAC7FA;;AACFA;;AACFA;;;;;;AAtGMA;;AAAAA;;AAQEA;;AAAAA;;AAMAA;;AAAAA;;AAA4CA;;AAAAA;;AAElCA;;AAAAA;;AAA8CA;;AAEGA;;AAAAA;;AAQ7DA;;AAAAA;;AAMAA;;AAAAA;;AAEUA;;AAAAA;;AAKVA;;AAAAA;;AAEUA;;AAAAA;;AAEiBA;;AAAAA;;AAKoCA;;AAAAA;;AACrDA;;AAAAA;;AAA8CA;;AAErCA;;AAAAA;;AAA0BA;;AAAAA;;AAE1BA;;AAAAA;;AAA8BA;;AAAAA;;AAE9BA;;AAAAA;;AAAkCA;;AAAAA;;AAQnDA;;AAAAA;;AAOFA;;AAAAA;;AAM8BA;;AAAAA;;AAIAA;;AAAAA;;AAIAA;;AAAAA;;AAIAA;;AAAAA;;AAK9BA;;AAAAA;;AAIAA;;AAAAA;;AACiFA;;AAAAA;;;;UC7E1Ei/B;AAoBX,oCACUpoE,kBADV,EAEU1d,kBAFV,EAGUiI,eAHV,EAIUu2E,aAJV,EAKUxhE,gBALV,EAMUm1B,iBANV,EAOUx3C,QAPV,EAQUmV,aARV,EASUF,MATV,EAUU/U,mBAVV,EAUkD;AAAA;;AATxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3BV,0BAAWulC,+CAAX;AACA,yBAAU2lD,+DAAV;AACA,yBAAUjnE,gEAAV;AACA,sCAAuB,KAAvB;AAEA,oCAIMshB,gFAAyC,UAACgF,IAAD;AAAA,mBAAU1jB,gCACpD0jB,IADoD,GAChD;AACP1mB,qBAAO,EAAEI,iEAAQsmB,IAAI,CAACA,IAAb;AADF,aADgD,CAAV;AAAA,WAAzC,CAJN;AAuBI;;;;iBAEE,oBAAQ;;;;;;;;AACZ,2BAAK4gD,sBAAL,GAA8B,KAAKtoE,kBAAL,CAC3BuoE,6CAD2B,GAE3BpqF,SAF2B,CAEjB,UAAC2b,GAAD,EAAQ;AACjB,gCAAI,CAAC5H,MAAL,CAAYM,GAAZ,CAAgB,YAAK;AACnB,kCAAI,CAACwb,WAAL,GAAmBlU,GAAnB;AACD,yBAFD;AAGD,uBAN2B,CAA9B;AAOA,2BAAK0uE,uBAAL,GAA+B,KAAKlmF,kBAAL,CAAwB9C,YAAxB,CAAqCrB,SAArC,CAC7B,UAAC2b,GAAD,EAAQ;AACN,gCAAI,CAAC5H,MAAL,CAAYM,GAAZ,CAAgB,YAAK;AACnB,kCAAI,CAACtV,YAAL,GAAoB4c,GAApB;AACD,yBAFD;AAGD,uBAL4B,CAA/B;AAOA,2BAAK2uE,oBAAL,GAA4B,4FAAe,KAAKxrF,QAApB,CAA5B;;;;;;;;;AACD;;;iBAED,4BAAgB;AACd,iBAAKqF,kBAAL,CAAwBggC,gBAAxB,CAAyC,KAAKplC,YAA9C;AACD;;;iBAED,uBAAW;AACT,gBAAI,KAAKorF,sBAAT,EAAiC;AAC/B,mBAAKA,sBAAL,CAA4BvuE,WAA5B;AACD;;AACD,gBAAI,KAAKyuE,uBAAT,EAAkC;AAChC,mBAAKA,uBAAL,CAA6BzuE,WAA7B;AACD;AACF;;;iBAED,8BAAkB;AAChB,iBAAKiG,kBAAL,CAAwB0oE,0CAAxB;AACD;;;iBAEK,0BAAc;;;;;;;;AACJ,6BAAM,KAAKn+E,eAAL,CAAqB+D,MAArB,CAA4B;AAC9CC,iCAAS,EAAEo6E;AADmC,uBAA5B,CAAN;;;AAAR/5E;AAGNA,2BAAK,CAACC,OAAN;;;;;;;;;AACD;;;iBAED,2BAAe;AACb,iBAAK3R,YAAL,CAAkBksC,iBAAlB,GAAsC,IAAtC;AACA,iBAAK9G,gBAAL;AACA,iBAAKlwB,aAAL,CAAmBkqC,YAAnB,CAAgC,cAAhC;AACD;;;iBAEK,qBAAS;;;;;;;;AACQ,6BAAM,KAAKh9B,gBAAL,CACxBZ,GADwB,CACpB,sBADoB,EAExB3P,SAFwB,EAAN;;;AAAf2Q;AAGAnQ,8BAA8B;AAClC+gC,0BAAE,EAAE5N,iEAD8B;AAElC2hD,+BAAO,EAAE3kE,YAFyB;AAGlC4kE,8BAAM,EAAE;AAH0B;AAKpC,2BAAKxD,aAAL,CAAmBzrE,IAAnB,CAAwB9F,KAAxB;;;;;;;;;AACD;;;iBAEK,wBAAY;;;;;;;;AACK,6BAAM,KAAK+P,gBAAL,CACxBZ,GADwB,CACpB,CAAC,+BAAD,EAAkC,2BAAlC,CADoB,EAExB3P,SAFwB,EAAN;;;AAAf2Q;;AAGa,6BAAM,KAAK+0B,iBAAL,CAAuBgB,aAAvB,EAAN;;;AAAbD;AACAjmC,8BAA8B;AAClC+gC,0BAAE,EAAE5N,iEAD8B;AAElC2hD,+BAAO,EACL,UAAG3kE,YAAY,CAAC,2BAAD,CAAf,eACE,KAAKziB,QAAL,CAAcoV,EAAd,CAAiB,KAAjB,IAA0B,KAA1B,GAAkC,EADpC,cAGG,KAAKpV,QAAL,CAAcoV,EAAd,CAAiB,SAAjB,IAA8B,SAA9B,GAA0C,EAH7C,eAIImjC,UAAU,CAACv3B,OAJf,cAI0Bu3B,UAAU,CAACt3B,WAJrC,cAIoDs3B,UAAU,CAACr3B,QAJ/D,CAHgC;AAQlCrB,4BAAI,EAAE4C,YAAY,CAAC,+BAAD,CARgB;AASlC4kE,8BAAM,EAAE;AAT0B;AAWpC,2BAAKxD,aAAL,CAAmBzrE,IAAnB,CAAwB9F,KAAxB;;;;;;;;;AACD;;;iBAED,0BAAc;AACZ;AACA,iBAAKjN,kBAAL,CAAwBggC,gBAAxB,CAAyC,KAAKplC,YAA9C,EAFY,CAIZ;;AACA,iBAAK8iB,kBAAL,CAAwB0oE,0CAAxB,CACE,KAAKvrF,mBAAL,CAAyBslB,yBAD3B;AAGD;;;;;;;yBAxHU2lE,oBAAiBj/B;AAAA;;;cAAjBi/B;AAAiBroF;AAAAC;AAAAC;AAAAC;AAAAC;AAAA;ADxB9BgpD;;;;AAA8CA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UEQjCy/B;;;;;yBAAAA;AAAwB;;;cAAxBA;AAAwB7oF;AAAAC;AAAAC;AAAAC;AAAAC;AAAA;ACRrCoG;;;;AACAA;;AACAA;;AACEA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACFA;;AACAA;;AAAGA;;;;AAA6CA;;AAChDA;;AACEA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACFA;;AACAA;;AAAGA;;;;AAAyCA;;AAC5CA;;AACEA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACFA;;AACAA;;AAAGA;;;;AAA4CA;;AAC/CA;;AACEA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACFA;;;;AAxHGA;;AASGA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;AAIHA;;AAAAA;;AAQGA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;AAIHA;;AAAAA;;AAQGA;;AAAAA;;AASAA;;AAAAA;;AAIHA;;AAAAA;;AAQGA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UC7GOsiF;;;;;yBAAAA;AAAyB;;;cAAzBA;AAAyB9oF;AAAAC;AAAAC;AAAAC;AAAAC;AAAA;ACRtCoG;;;;AACAA;;AACAA;;AACEA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACFA;;AACAA;;AACEA;;;;AACFA;;AACAA;;AACEA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACFA;;;;AA7HGA;;AASGA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;AAKJA;;AAAAA;;AASIA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrHC,UAAMuiF,cAAa,GAAG;AAC3B5mB,iBAAS,EAAE6mB,kGADgB;AAE3BC,mBAAW,EAAEC,qGAFc;AAG3BC,iBAAS,EAAEC,kGAHgB;AAI3BC,mBAAW,EAAEC;AAJc,OAAtB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCKMC;AACX,iDAAoB/+E,eAApB,EAAoD;AAAA;;AAAhC;AAAoC;;;;iBAElD,8BAAkB;;;;;;;;AACA,6BAAM,KAAKA,eAAL,CAAqB+D,MAArB,CAA4B;AACtDC,iCAAS,EAAEg7E;AAD2C,uBAA5B,CAAN;;;AAAhBC;AAGNA,mCAAa,CAAC36E,OAAd;;;;;;;;;AACD;;;;;;;yBARUy6E,iCAA8BziF;AAAA;;;cAA9ByiF;AAA8BvpF;AAAAC;AAAAC;AAAAC;AAAAC;AAAA;ACV3C0G;;AAAGA;;;;AAAgDA;;AACnDA;;AACEA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAAyBA;AAAA,qBAAS+5D,wBAAT;AAA6B,aAA7B;;AAA+B/5D;;;;AAAuCA;;AACjGA;;AACFA;;AACFA;;;;AA7DGA;;AAAAA;;AA0D2DA;;AAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxD5D8M;;AACEA;;;;AACAA;;AACEA;;AAEAA;;;;AACFA;;AACAA;;AACEA;;AAEAA;;;;AACFA;;AACAA;;AACEA;;AAEAA;;;;AACFA;;AAAMA;;AACRA;;;;AAhBKA;;AAAAA;;AAIDA;;AAAAA;;AAKAA;;AAAAA;;AAKAA;;AAAAA;;;;;;AAGJA;;AACEA;;;;AAA2EA;;AAC7EA;;;;AADKA;;AAAAA;;;;;;AApBPA;;AACEA;;AAkBAA;;AAGFA;;;;;;;;AArBiBA;;AAAAA;;AAkBAA;;AAAAA;;;;UCNJ81E;AAGX,2CACUnnF,kBADV,EACgD;AAAA;;AAAtC;AAER,eAAKonF,yBAAL,GAAiC,KAAKpnF,kBAAL,CAAwBonF,yBAAxB,CAAkD1rF,IAAlD,CAC/B,wFAD+B,CAAjC;AAGD;;;;iBAED,yBAAgByqC,YAAhB,EAA2C;AACzC,gBAAMy5B,SAAS,GAAGz5B,YAAY,CAAC5lB,IAAb,CAAkB,UAAC40C,CAAD;AAAA,qBAAOA,CAAC,CAACx1C,IAAF,IAAU,WAAjB;AAAA,aAAlB,CAAlB;;AACA,gBAAIigD,SAAS,IAAIA,SAAS,CAACv5B,OAAvB,IAAkCu5B,SAAS,CAACv5B,OAAV,CAAkB1mB,IAAlB,IAA0B,kBAAhE,EAAoF;AAClF,qBAAOigD,SAAS,CAACv5B,OAAV,CAAkB3mB,OAAzB;AACD;;AACD,mBAAO,KAAP;AACD;;;;;;;yBAjBUynE,2BAAwB91E;AAAA;;;cAAxB81E;AAAwB1pF;AAAAC;AAAAC;AAAAC;AAAAC;AAAA;ADdrCwT;;;;AAAuEA;;AACvEA;;;;AAuBAA;;;;AAxBGA;;AACYA;;AAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UEgBFg2E;AAKX,mDAAoBC,wBAApB,EAAsE;AAAA;;AAAlD;AAAsD;;;;iBAE1E,oBAAQ;AACN,iBAAKC,aAAL;AACD;;;iBAED,yBAAa;AACX,gBAAI,KAAK5nE,IAAL,IAAa6nE,2DAAc,KAAK7nE,IAAnB,CAAjB,EAA2C;AACzC,kBAAM8nE,gBAAgB,GAAG,KAAKH,wBAAL,CAA8BI,uBAA9B,CACvBF,2DAAc,KAAK7nE,IAAnB,CADuB,CAAzB;AAGA,mBAAKgoE,gBAAL,CAAsBC,eAAtB,CAAsCH,gBAAtC;AACD;AACF;;;;;;;yBAlBUJ,mCAAgC52E;AAAA;;;cAAhC42E;AAAgC5pF;AAAAkK;AAAA;8EAEA8I;;;;;;;;;;;;;;;;;ACnB7CA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCQao3E;;;;;yBAAAA;AAA0B;;;cAA1BA;AAA0BpqF;AAAAC;AAAAC;AAAAC;AAAAC;AAAA;ACRvCoG;;AAAGA;;;;AAA+CA;;AAClDA;;AACAA;;AACEA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AAEFA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACFA;;;;AAlEGA;;AAAAA;;AASGA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;AASAA;;AAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpDA80D;;AACEA;;AACEA;;;;AACFA;;AACAA;;AAAYA;AAAAA;;AAAA;;AAAA;AAAA,aAAyC,WAAzC,EAAyC;AAAAA;;AAAA;;AAAA;;AAAA;AAAA,WAAzC;;AAAsFA;;AACpGA;;;;;;AAHIA;;AAAAA;;AAEUA;;AAAAA;;;;;;AAMVA;;AAA+EA;;;;AAC/EA;;;;;;AADwDA;;AAAuBA;;AAAAA;;;;;;;;AAXrFA;;AACEA;;AAMAA;;AACEA;;AAAiEA;;;;AAA8BA;;AAC/FA;;AACEA;AAAAA;;AAAA;;AAAA;AAAA,aAAiC,WAAjC,EAAiC;AAAAA;;AAAA;;AAAA;;AAAA;AAAA,WAAjC;;;;AACAA;;AAEFA;;AACFA;;AACAA;;AACEA;;AACEA;;AACFA;;AACFA;;AACFA;;;;;;;;AAnBaA;;AAAAA;;AAOwDA;;AAAAA;;AAC5BA;;AAAAA;;AACnCA;;AACsCA;;AAAAA;;AAMNA;;AAAAA;;;;;;;;AA1BxCA;;AACEA;;AACEA;;AACAA;;AACEA;;;;AACFA;;AACAA;;AAAYA;AAAA;;AAAA;AAAA;AAAA,aAAiC,WAAjC,EAAiC;AAAA;;AAAA;;AAAA;;AAAA;AAAA,WAAjC;;AACZA;;AACFA;;AACAA;;AAqBFA;;;;;;;;AA1BMA;;AAAAA;;AAEUA;;AAAAA;;AAGiBA;;AAAAA;;;;;;AAVnCA;;AACEA;;AA+BFA;;;;;;;;AA/BwCA;;AAAAA,+FAAiB,cAAjB,EAAiBhxD,oBAAjB;;;;UCsB3B+/E;;;;;AAcX,4CACU9nF,kBADV,EAEU+nF,gBAFV,EAE4C;AAAA;;AAAA;;AAE1C;AAHQ;AACA;AAdF,6CAAkE,EAAlE;AAGR,mCAAgB,CACd;AAAEpoE,gBAAI,EAAE,wBAAR;AAAkCuF,iBAAK,EAAE;AAAzC,WADc,EAEd;AAAEvF,gBAAI,EAAE,KAAR;AAAeuF,iBAAK,EAAE;AAAtB,WAFc,EAGd;AAAEvF,gBAAI,EAAE,KAAR;AAAeuF,iBAAK,EAAE;AAAtB,WAHc,EAId;AAAEvF,gBAAI,EAAE,KAAR;AAAeuF,iBAAK,EAAE;AAAtB,WAJc,CAAhB;AAcE,mBAAKkiE,yBAAL,GAAiC,SAAKpnF,kBAAL,CAAwBonF,yBAAxB,CAAkD1rF,IAAlD,CAC/B,wFAD+B,CAAjC;AAIA,mBAAKssF,oBAAL,GAA4B,SAAKZ,yBAAL,CAA+BvrF,SAA/B,CAAyC,UAACsqC,YAAD,EAAiB;AACpFA,wBAAY,CAAC/S,OAAb,CACE,UAAC60D,WAAD;AAAA,qBAAiB,SAAKC,aAAL,CAAmBD,WAAnB,CAAjB;AAAA,aADF;;AAGA,qBAAKD,oBAAL,CAA0BvwE,WAA1B;AACD,WAL2B,CAA5B;AAOA,mBAAK0wE,eAAL,GAAuB;AACrBhvE,wBAAY,EAAE/S,SADO;AAErBgiF,mBAAO,EAAEL,gBAAgB,CAACM,wBAFL;AAGrBC,qBAAS,EAAE,mBAAC13E,CAAD;AAAA,qBAAO,IAAP;AAAA;AAHU,WAAvB;AAd0C;AAmB3C;;;;iBAED,uBAAW;AAAA,yDACc8Q,MAAM,CAACk4B,MAAP,CAAc,KAAK2uC,uBAAnB,EAA4Cn9C,MAA5C,CAAmD,CAAC,KAAK+8C,eAAN,CAAnD,CADd;AAAA;;AAAA;AACT,wEAAmG;AAAA,oBAAxFK,QAAwF;;AACjG,oBAAIA,QAAQ,CAACrvE,YAAT,IAAyB,CAACqvE,QAAQ,CAACrvE,YAAT,CAAsBoP,MAApD,EAA4D;AAC1DigE,0BAAQ,CAACrvE,YAAT,CAAsB1B,WAAtB;AACD;AACF;AALQ;AAAA;AAAA;AAAA;AAAA;AAMV;;;iBAED,uBAAc7Q,KAAd,EAA6BlB,EAA7B,EAA4C;AAC1C,mBAAOA,EAAE,CAACia,IAAV;AACD;;;iBAEK,uBAAcsoE,WAAd,EAAsC;;;;;;AAC1C,0BAAIA,WAAW,CAACQ,OAAhB,EAAyB;AACvB,6BAAKC,gBAAL,CAAsBT,WAAtB;AACD,uBAFD,MAEO;AACL,4BAAIA,WAAW,CAAC5hD,OAAhB,EAAyB;AACvB4hD,qCAAW,CAAC5hD,OAAZ,CAAoB3mB,OAApB,GAA8B,KAA9B;AACD;;AACDuoE,mCAAW,CAACvoE,OAAZ,GAAsB,KAAtB;AACA,6BAAKipE,YAAL,CAAkBV,WAAlB;AACD;;;;;;;;;AACF;;;iBAEK,0BAAiBA,WAAjB,EAAyC;;;;;;;;AAC7C,0BAAI,kBAAW,CAAC5hD,OAAZ,MAAmB,IAAnB,IAAmBhP,aAAnB,GAAmB,MAAnB,GAAmBA,GAAE3X,OAArB,MAAgC,iBAAW,CAAC2mB,OAAZ,MAAmB,IAAnB,IAAmB1M,aAAnB,GAAmB,MAAnB,GAAmBA,GAAE8uD,OAArD,CAAJ,EAAkE;AAChER,mCAAW,CAAC5hD,OAAZ,CAAoB3mB,OAApB,GAA8BuoE,WAAW,CAAC5hD,OAAZ,CAAoBoiD,OAAlD;AACA,6BAAKG,iBAAL,CAAuBX,WAAW,CAAC5hD,OAAnC;AACD;;AACD,0BAAI4hD,WAAW,CAACvoE,OAAZ,IAAuB,KAAKmpE,aAAL,CAAmBZ,WAAnB,CAA3B,EAA4D;AAC1DA,mCAAW,CAACvoE,OAAZ,GAAsB,CAAC,KAAKmpE,aAAL,CAAmBZ,WAAnB,CAAvB;AACA,6BAAKW,iBAAL,CAAuBX,WAAvB;AACD;;AACD,2BAAKU,YAAL,CAAkBV,WAAlB;;;;;;;;;AACD;;;iBAEK,sBAAaA,WAAb,EAAqC;;;;;;;;AACjB,6BAAM,KAAKjoF,kBAAL,CAAwB9C,YAAxB,CAC3BxB,IAD2B,CACtB,sDAAK,CAAL,CADsB,EAE3B+Q,SAF2B,EAAN;;;AAAlB2sE;AAGN,2BAAKp5E,kBAAL,CAAwBggC,gBAAxB,CAAwCte,gCACnC03D,eADmC,GACpB;AAClBjzC,oCAAY,EAAE,KAAK2iD,8BAAL,CACZb,WADY,EAEZ7O,eAAe,CAACjzC,YAFJ;AADI,uBADoB,CAAxC;;;;;;;;;AAOD;;;iBAED,uBAAc8hD,WAAd,EAAsC;;;AACpC,mBAAO,CAAC,EAAC,iBAAW,CAAC5hD,OAAZ,MAAmB,IAAnB,IAAmBhP,aAAnB,GAAmB,MAAnB,GAAmBA,GAAE3X,OAAtB,CAAR;AACD;;;iBAED,sBAAauoE,WAAb,EAAqC;AACnC,mBAAOA,WAAW,CAACvoE,OAAZ,IAAuB,KAAKmpE,aAAL,CAAmBZ,WAAnB,CAA9B;AACD;;;iBAED,6BAAsC;AAAA;;AAAA,gBAApBhiD,IAAoB,uEAAJ,IAAI;;AACpC,gBAAI,EAAEA,IAAI,CAACtmB,IAAL,IAAa,KAAK4oE,uBAApB,CAAJ,EAAkD;AAChD,mBAAKA,uBAAL,CAA6BtiD,IAAI,CAACtmB,IAAlC,IAA0C;AACxCxG,4BAAY,EAAE/S,SAD0B;AAExCgiF,uBAAO,EAAE,KAAKL,gBAAL,CAAsBgB,+BAFS;AAGxCT,yBAAS,EAAE,mBAACriD,IAAD;AAAA,yBAAU,CAACA,IAAI,CAAC+iD,gBAAhB;AAAA;AAH6B,eAA1C;AAKD;;AACD,aAAC,KAAKb,eAAN,EAAuB,KAAKI,uBAAL,CAA6BtiD,IAAI,CAACtmB,IAAlC,CAAvB,EAAgEyT,OAAhE,CAAwE,UAACo1D,QAAD,EAAa;AACnF,kBAAIA,QAAQ,CAACrvE,YAAT,IAAyB,CAACqvE,QAAQ,CAACrvE,YAAT,CAAsBoP,MAApD,EAA4D;AAC1DigE,wBAAQ,CAACrvE,YAAT,CAAsB1B,WAAtB;AACD;;AACD,kBAAIwuB,IAAI,CAACvmB,OAAL,IAAgB8oE,QAAQ,CAACF,SAAT,CAAmBriD,IAAnB,CAApB,EAA8C;AAC5CuiD,wBAAQ,CAACrvE,YAAT,GAAwBqvE,QAAQ,CAC7BJ,OADqB,CACba,IADa,CACR,QAAI,CAAClB,gBADG,EACe9hD,IAAI,CAACtmB,IADpB,EAErBjkB,IAFqB,CAEhB,2DAAU,QAAI,CAACoK,UAAf,CAFgB,EAGrBjK,SAHqB,EAAxB;AAID;AACF,aAVD;AAWD;;;iBAED,wCACEosF,WADF,EAEEiB,0BAFF,EAMK;AAEH,gBAAMC,SAAS,GAAG;AAChB/6E,qBAAO,EAAE65E,WAAW,CAAC75E,OADL;AAEhBuR,kBAAI,EAAEsoE,WAAW,CAACtoE,IAFF;AAGhBD,qBAAO,EAAEuoE,WAAW,CAACvoE,OAHL;AAIhB+oE,qBAAO,EAAER,WAAW,CAACQ;AAJL,aAAlB;;AAMA,gBAAIR,WAAW,CAAC5hD,OAAhB,EAAyB;AACvB8iD,uBAAS,CAAC,SAAD,CAAT,GAAuB;AACrBxpE,oBAAI,EAAEsoE,WAAW,CAAC5hD,OAAZ,CAAoB1mB,IADL;AAErBD,uBAAO,EAAEuoE,WAAW,CAAC5hD,OAAZ,CAAoB3mB,OAFR;AAGrB+oE,uBAAO,EAAER,WAAW,CAAC5hD,OAAZ,CAAoBoiD;AAHR,eAAvB;AAKD;;AACD,gDACKS,0BAA0B,CAACp+E,MAA3B,CAAkC,UAACxR,CAAD;AAAA,qBAAOA,CAAC,CAACqmB,IAAF,KAAWsoE,WAAW,CAACtoE,IAA9B;AAAA,aAAlC,CADL,IAEEwpE,SAFF;AAID;;;;QA5I4CC;;;yBAAlCtB,4BAAyB/uB;AAAA;;;cAAzB+uB;AAAyBrqF;AAAA8P;AAAA7P;AAAAC;AAAAC;AAAAC;AAAA;ADvBtCk7D;;;;;;AAAeA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEITA;;AACEA;;;;AACFA;;;;;;AADEA;;AAAAA;;;;;;AAHNA;;AACEA;;AACEA;;AAGFA;;AACAA;;AACEA;;AACFA;;AACFA;;;;;;AAPmBA;;AAAAA;;;;;;AAUnBA;;AACEA;;AACFA;;AACAA;;AACEA;;;;AACFA;;;;AADEA;;AAAAA;;;;UCLSswB;AAMX,8CACU3rE,kBADV,EAEU7iB,mBAFV,EAGU+U,MAHV,EAIU8a,eAJV,EAI0C;AAAA;;AAHhC;AACA;AACA;AACA;AARV,0BAAWpiB,+CAAX;AAEA,+BAAgC,EAAhC;AAOI;;;;iBAEJ,oBAAQ;AAAA;;AACN,iBAAK6V,aAAL,CAAmB7X,IAAnB,CACE,KAAKoX,kBAAL,CACGuoE,6CADH,GAEGpqF,SAFH,CAEa,UAAC2b,GAAD,EAAQ;AACjB,sBAAI,CAAC5H,MAAL,CAAYM,GAAZ,CAAgB,YAAK;AACnB,wBAAI,CAACwb,WAAL,GAAmBlU,GAAnB;AACD,eAFD;AAGD,aANH,CADF;AASA,iBAAK2G,aAAL,CAAmB7X,IAAnB,CACE,KAAKoX,kBAAL,CAAwB4rE,SAAxB,CACG5tF,IADH,CAEI,2DAAU,UAAC8V,EAAD;AAAA,qBAAQ,QAAI,CAACkZ,eAAL,CAAqBuD,oBAArB,CAA0Czc,EAA1C,CAAR;AAAA,aAAV,CAFJ,EAGI,qDAAI,UAAC1M,KAAD;AAAA,qBAAWA,KAAK,CAACwmB,SAAjB;AAAA,aAAJ,CAHJ,EAII,uEAJJ,EAMGzvB,SANH,CAMa,UAAC2b,GAAD,EAAQ;AACjB,sBAAI,CAAC5H,MAAL,CAAYM,GAAZ,CAAgB,YAAK;AACnB,wBAAI,CAACob,SAAL,GAAiB9T,GAAjB;AACD,eAFD;AAGD,aAVH,CADF;AAaD;;;iBACD,uBAAW;AAAA,yDACkB,KAAK2G,aADvB;AAAA;;AAAA;AACT,wEAA+C;AAAA,oBAApChF,YAAoC;AAC7CA,4BAAY,CAAC1B,WAAb;AACD;AAHQ;AAAA;AAAA;AAAA;AAAA;AAIV;;;iBAEK,sCAA0B;;;;;;;;2BAC1B,KAAK6T;;;;;AACP,2BAAKzwB,mBAAL,CAAyB0uF,wBAAzB;;;;;AAEA,2BAAKj+D,SAAL,GAAiB,IAAjB;;AACA,6BAAM,KAAK5N,kBAAL,CAAwB0oE,0CAAxB,CACJ,KAAKvrF,mBAAL,CAAyBslB,yBADrB,CAAN;;;AAGA9Z,gCAAU,CAAC,YAAK;AACd,gCAAI,CAACilB,SAAL,GAAiB,KAAjB;AACD,uBAFS,EAEP,GAFO,CAAV;;;;;;;;;AAIH;;;;;;;yBAvDU+9D,8BAA2BtwB;AAAA;;;cAA3BswB;AAA2B5rF;AAAAC;AAAAC;AAAAC;AAAAC;AAAA;ADbxCk7D;;AAAUA;AAAA,qBAASuF,gCAAT;AAAqC,aAArC;;AACRvF;;AAA2CA;;;;AAA0CA;;AACrFA;;AAUFA;;AACAA;;;;;;AAZ6CA;;AAAAA;;AAC5BA;;AAAAA,6FAAiB,UAAjB,EAAiB70D,GAAjB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEDfuM;;AAA2CA;AAAAA;;AAAA;;AAAA;AAAA;;AACzCA;;AACAA;;AACEA;;;;AACFA;;AACFA;;;;AAFIA;;AAAAA;;;;;;AAGJA;;AACEA;;AACEA;;AACAA;;AACEA;;AACFA;;AACFA;;AACAA;;AACEA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACFA;;;;;;AATMA;;AAAAA;;AAMAA;;AAAAA;;;;;;AAjBRA;;AACEA;;AAMAA;;AAcFA;;;;;;AApBaA;;AAAAA;;AAMIA;;AAAAA;;;;;;AAgBfA;;AACEA;;AACEA;;AACFA;;AACFA;;;;UChBW+4E;AAKX,qCACUC,iBADV,EAEU75E,MAFV,EAEwB;AAAA;;AADd;AACA;AANV,8BAA6B;AAAEkB,sBAAU,EAAE;AAAd,WAA7B;AACQ,4BAAa,IAAI8I,yCAAJ,EAAb;AACR,6BAAc,KAAd;AAKI;;;;iBAEJ,oBAAQ;AAAA;;AACN,iBAAK6vE,iBAAL,CAAuBzuE,aAAvB,CACGtf,IADH,CACQ,2DAAU,KAAKoK,UAAf,CADR,EAEGjK,SAFH,CAEa,UAAC2b,GAAD,EAAQ;AACjB,sBAAI,CAAC5H,MAAL,CAAYM,GAAZ,CAAgB,YAAK;AACnB,wBAAI,CAACW,YAAL,GAAoB2G,GAApB;AACD,eAFD;AAGD,aANH;AAOA,iBAAKiyE,iBAAL,CAAuBC,YAAvB,CACGhuF,IADH,CACQ,2DAAU,KAAKoK,UAAf,CADR,EAEGjK,SAFH,CAEa,UAAC2b,GAAD,EAAQ;AACjB,sBAAI,CAAC5H,MAAL,CAAYM,GAAZ,CAAgB,YAAK;AACnB,wBAAI,CAACy5E,WAAL,GAAmBnyE,GAAnB;AACD,eAFD;AAGD,aANH;AAOD;;;iBAED,iBAAK;AACH,iBAAKiyE,iBAAL,CAAuB14E,MAAvB;AACD;;;iBAED,uBAAW;AACT,iBAAKjL,UAAL,CAAgBhK,IAAhB;AACA,iBAAKgK,UAAL,CAAgB2T,QAAhB;AACD;;;;;;;yBAlCU+vE,qBAAkB/4E;AAAA;;;cAAlB+4E;AAAkB/rF;AAAAC;AAAAC;AAAAC;AAAAC;AAAA;ADX/B4S;;AAsBAA;;;;;;AAtBeA,+FAAmB,UAAnB,EAAmBvM,GAAnB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UEqCF0lF;;;;;yBAAAA;AAAc;;;cAAdA;;;kBAtBF,CAACC,+DAAD;;;;6HAsBED,iBAAc;AAAAvqF,yBApBvByqF,8EAoBuB,EAnBvBC,kHAmBuB,EAlBvBC,2FAkBuB,EAjBvBC,8HAiBuB,EAhBvBC,sHAgBuB,EAfvBC,oKAeuB,EAdvBC,wIAcuB,EAbvBC,2IAauB,EAZvBC,wIAYuB,EAXvBC,+IAWuB,EAVvBC,6JAUuB;AAVOlwF,oBAZtBuvF,+DAYsB,CAUP;AAtBHtvF,oBAoBZuvF,8EApBY;AAsBG;AAFE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCzBhBW;AAKX,2CACUxiF,eADV,EAEU/M,iBAFV,EAGUP,QAHV,EAG4B;AAAA;;AAFlB;AACA;AACA;AACN;;;;iBAEJ,oBAAQ;AACN,gBAAI,qFAAe,KAAKA,QAApB,CAAJ,EAAmC;AACjC,mBAAKO,iBAAL,CAAuBwvF,MAAvB;AACD;AACF;;;iBAED,uBAAW;AACT,gBAAI,qFAAe,KAAK/vF,QAApB,CAAJ,EAAmC;AACjC,mBAAKO,iBAAL,CAAuBkB,IAAvB,CAA4B,KAAKlB,iBAAL,CAAuBmB,YAAvB,CAAoCC,QAAhE;AACD;AACF;;;iBAED,sBAAU;AACR,iBAAK2L,eAAL,CAAqBukE,OAArB;AACD;;;;;;;yBAzBUie,2BAAwBlmF;AAAA;;;cAAxBkmF;AAAwBhtF;AAAA2G;AAAAgI;AAAAnH;AAAAC;AAAA;AAAAxH;AAAAC;AAAAC;AAAAC;AAAA;ACVrC0G;;AAAaA;AAAA,qBAAS+5D,gBAAT;AAAqB,aAArB;;AACX/5D;;AACEA;;AACEA;;AACEA;;AACFA;;AACFA;;AACFA;;AACFA;;;;AAJaA;;AAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCOAomF;;;;;yBAAAA;AAAyB;;;cAAzBA;;;kBALF,CAACC,uEAAD;;;;4HAKED,4BAAyB;AAAAtrF,yBAJrBwrF,wEAIqB,EAJAC,8FAIA;AAJmBxwF,oBAD7CswF,uEAC6C,CAInB;AALdrwF,oBAGZswF,wEAHY;AAKc;AAFP;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCDlBE;AACX,sCAAoB9iF,eAApB,EAAoD;AAAA;;AAAhC;AAAoC;;;;iBAExD,oBAAQ,CAAK;;;iBAEb,iBAAK;AACH,iBAAKA,eAAL,CAAqBukE,OAArB;AACD;;;;;;;yBAPUue,sBAAmBxmF;AAAA;;;cAAnBwmF;AAAmBttF;AAAAC;AAAAC;AAAAC;AAAAC;AAAA;ACRhC0G;;AACEA;;AACEA;;AACEA;;AAAYA;AAAA,qBAAS+5D,WAAT;AAAgB,aAAhB;;AAAkB/5D;;;;AAA8BA;;AAC9DA;;AACAA;;AACEA;;;;AACFA;;AACFA;;AACFA;;AACAA;;AACEA;;AACEA;;AACEA;;AACEA;;AACFA;;AACFA;;AACFA;;AACFA;;;;AAfoCA;;AAAAA;;AAG9BA;;AAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCNN;AACA;AACA;AACA;;;AACO,UAAMs+E,YAAW,GAAG;AACzBmI,kBAAU,EAAE;AADa,OAApB;AAIP;;;;;;AAMA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACdA;;;AASA,UAAIC,6EAAJ,EAA4B;AAC1B;AACD;;AAED,eAASC,QAAT,GAAiB;AACf5M,eAAO,CAACx8D,GAAR,CAAY,cAAZ;;AACAqpE,iFACGC,eADH,CACmBC,sDADnB,WAES,UAACnvF,GAAD;AAAA,iBAASoiF,OAAO,CAACx8D,GAAR,CAAY5lB,GAAZ,CAAT;AAAA,SAFT;AAGD;;AAED6kE,cAAQ,CAACuqB,gBAAT,CACE,OAAOC,OAAP,KAAmB,WAAnB,GAAiC,aAAjC,GAAiD,kBADnD,EAEE;AAAA,eAAY;AAAA;AAAA;AAAA;AAAA;AACVjN,yBAAO,CAACx8D,GAAR,CAAY,uBAAZ;AADU;AAAA;AAGR,yBAAMiJ,oDAAN;;AAHQ;AAIRmgE,0BAAQ;AAJA;AAAA;;AAAA;AAAA;AAAA;AAMR5M,yBAAO,CAACriF,KAAR,CAAc,6BAAd;AACAivF,0BAAQ,GAPA,CAOI;;AAPJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAZ;AAAA,OAFF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCPaM;;;;;;;iBAwLX,qBAAgB;AACd,gBAAM54E,MAAM,GAKN,EALN,CADc,CAOd;;AACA,iBAAK,IAAM64E,QAAX,IAAuBD,QAAO,CAACE,MAA/B,EAAuC;AACrC94E,oBAAM,CAACtM,IAAP,CAAYklF,QAAO,CAACE,MAAR,CAAeD,QAAf,CAAZ;AACD;;AACD,mBAAO74E,MAAP;AACD;;;iBAED,yBAAuB+M,IAAvB,EAAqCjjB,OAArC,EAAqD;AACnD,6BAAUijB,IAAV,cAAkBjjB,OAAlB;AACD;;;iBAED,0BAAqB;AACnB,gBAAMivF,MAAM,GAA0B,EAAtC;;AADmB,yDAECH,QAAO,CAACI,SAAR,EAFD;AAAA;;AAAA;AAEnB,wEAAyC;AAAA,oBAA9B5pE,KAA8B;;AACvC,oBAAIA,KAAK,CAACqrC,kBAAV,EAA8B;AAC5Bs+B,wBAAM,CAACrlF,IAAP,CAAY;AACVqZ,wBAAI,EAAE6rE,QAAO,CAACK,eAAR,CAAwB7pE,KAAK,CAACrC,IAA9B,EAAoCuhB,oEAApC,CADI;AAEV6c,yBAAK,EAAE/7B,KAAK,CAAC+7B,KAFH;AAGV+tC,2BAAO,EAAE9pE,KAAK,CAAC8pE;AAHL,mBAAZ;AAKAH,wBAAM,CAACrlF,IAAP,CAAY;AACVqZ,wBAAI,EAAE6rE,QAAO,CAACK,eAAR,CAAwB7pE,KAAK,CAACrC,IAA9B,EAAoCuhB,oEAApC,CADI;AAEV6c,yBAAK,EAAE/7B,KAAK,CAAC+7B,KAFH;AAGV+tC,2BAAO,EAAE9pE,KAAK,CAAC8pE;AAHL,mBAAZ;AAKAH,wBAAM,CAACrlF,IAAP,CAAY;AACVqZ,wBAAI,EAAE6rE,QAAO,CAACK,eAAR,CAAwB7pE,KAAK,CAACrC,IAA9B,EAAoCuhB,oEAApC,CADI;AAEV6c,yBAAK,EAAE/7B,KAAK,CAAC+7B,KAFH;AAGV+tC,2BAAO,EAAE9pE,KAAK,CAAC8pE;AAHL,mBAAZ;AAKD,iBAhBD,MAgBO;AACLH,wBAAM,CAACrlF,IAAP,CAAY;AACVqZ,wBAAI,EAAEqC,KAAK,CAACrC,IADF;AAEVo+B,yBAAK,EAAE/7B,KAAK,CAAC+7B,KAFH;AAGV+tC,2BAAO,EAAE9pE,KAAK,CAAC8pE;AAHL,mBAAZ;AAKD;AACF;AA1BkB;AAAA;AAAA;AAAA;AAAA;;AA2BnB,mBAAOH,MAAP;AACD;;;iBAED,gBAEiB;AAAA,gBADfI,MACe,uEADEzjF,iEACF;AAAA,gBAAf0jF,MAAe;;;;;;;AAEf,6BAAM,wDAAOC,cAAP,CAAsB;AAC1Bz6E,0BAAE,EAAEu6E,MADsB;AAE1BznD,4BAAI,EAAE0nD,MAAM,IAAI,4EAFU;AAG1BrwE,+BAAO,EAAE,GAHiB;AAI1BgwE,8BAAM,EAAE,KAAKO,cAAL,EAJkB;AAK1B;AACA;AACA;AACA;AACAnrD,+BAAO,EAAE,CACP;AACEphB,8BAAI,EAAE,mBADR;AAEEhE,iCAAO,EAAE,GAFX;AAGEwwE,sCAAY,EAAE,EAHhB;AAIEC,iCAAO,EAAE,CACP;AACEzsE,gCAAI,EAAE,mBADR;AAEE0sE,oCAAQ,EAAE,IAFZ;AAGEv2C,gCAAI,EAAE,cACJw2C,SADI,EAEJ7yE,QAFI,EAGF;AACF6yE,uCAAS,CAACC,GAAV,CAAc/6E,EAAd,GAAmB86E,SAAS,CAACC,GAAV,CAAc5sE,IAAjC;AACAlG,sCAAQ,CAAC6yE,SAAD,CAAR;AACD;AATH,2BADO;AAJX,yBADO;AATiB,uBAAtB,CAAN;;;;;;;;;AAgCD;;;iBAED,qBAAmB3sE,IAAnB,EAAiCjjB,OAAjC,EAAiD;AAC/C,mBAAO,gEAAQijB,IAAR,cAAgBjjB,OAAhB,EAAP;AACD;;;iBAED,iBACE0lB,OADF,EACkD;;;;;;;;0DAQzChpB,OAAO,CAAC27B,GAAR,CACLy2D,QAAO,CAACU,cAAR,GAAyBvlF,GAAzB,CAA6B,UAAC6lF,WAAD;AAAA,+BAC3B,QAAI,CAACC,UAAL,CAAgBD,WAAhB,EAA6BpqE,OAA7B,CAD2B;AAAA,uBAA7B,CADK;;;;;;;;;AAKR;;;iBAED,oBACEoqE,WADF,EAEEpqE,OAFF,EAEkD;;;;;;4BAE5CoqE,WAAW,CAAC7sE,IAAZ,KAAqB;;;;;;AACvB,6BAAM,KAAK+sE,oBAAL,CAA0BF,WAA1B,EAAuCpqE,OAAvC,CAAN;;;;;;;;AAEA,6BAAM,KAAKuqE,oBAAL,CAA0BH,WAA1B,EAAuCpqE,OAAvC,CAAN;;;;;;;;;AAEH;;;iBAEO,8BACNoqE,WADM,EAENpqE,OAFM,EAE0C;;;;;;;;AAG9C,6BAAM,sDAAKoqE,WAAW,CAAC7sE,IAAjB,EAAuBtI,KAAvB,CAA6B,QAA7B,EAAuCE,IAAvC,EAAN;;;;;;;;;;AAEA,0BAAI6K,OAAJ,EAAa;AACXA,+BAAO,CAACoqE,WAAW,CAAC7sE,IAAb,iBAAP;AACD;;;;;;;;;AAEJ;;;iBAEO,8BACN6sE,WADM,EAENpqE,OAFM,EAE0C;;;;;;;;AAG9C,6BAAM,sDAAKoqE,WAAW,CAAC7sE,IAAjB,EAAuBtI,KAAvB,CAA6B,MAA7B,EAAqCE,IAArC,EAAN;;;;;;;;;;AAEA,0BAAI6K,OAAJ,EAAa;AACXA,+BAAO,CAACoqE,WAAW,CAAC7sE,IAAb,iBAAP;AACD;;;;;AAGD,6BAAM,wDAAOtI,KAAP,CAAa,cAAb,EAA6Bm1E,WAA7B,EAA0Cj1E,IAA1C,EAAN;;;;;;;;;;AAEA,0BAAI6K,OAAJ,EAAa;AACXA,+BAAO,CAACoqE,WAAW,CAAC7sE,IAAb,iBAAP;AACD;;;;;;;;;AAEJ;;;;;;AA3UsB6rE,wBAAS;AAC9BoB,mBAAW,EAAE;AACXjtE,cAAI,EAAE,eADK;AAEX0tC,4BAAkB,EAAE,IAFT;AAGXtP,eAAK,EAAE;AACL,yBAAa;AAAE8uC,gBAAE,EAAE;AAAN,aADR;AAEL,gCAAoB,EAFf;AAGL,2BAAe,EAHV;AAIL,qBAAS;AAJJ,WAHI;AASXf,iBAAO,EAAE,EATE,CAUX;AACA;AACA;AACA;;AAbW,SADiB;AAgB9BgB,gBAAQ,EAAE;AACRntE,cAAI,EAAE,SADE;AAERo+B,eAAK,EAAE;AACL,uBAAW;AAAE8uC,gBAAE,EAAE;AAAN,aADN;AAEL,+BAAmB,EAFd;AAGL,gCAAoB,EAHf;AAIL,gCAAoB,EAJf;AAKL,+BAAmB,EALd;AAML,4BAAgB,EANX;AAOL,+BAAmB,EAPd;AAQL,8BAAkB;AARb,WAFC;AAYRf,iBAAO,EAAE;AAZD,SAhBoB;AA8B9BiB,yBAAiB,EAAE;AACjBptE,cAAI,EAAE,iBADW;AAEjBo+B,eAAK,EAAE;AACL,uBAAW;AAAE8uC,gBAAE,EAAE;AAAN,aADN;AAEL,4BAAgB,EAFX;AAGL,gCAAoB;AAHf,WAFU;AAOjBf,iBAAO,EAAE;AAPQ,SA9BW;AAuC9BkB,uBAAe,EAAE;AACfrtE,cAAI,EAAE,YADS;AAEf0tC,4BAAkB,EAAE,IAFL;AAGftP,eAAK,EAAE;AACL,yBAAa;AAAE8uC,gBAAE,EAAE;AAAN,aADR;AAEL,qBAAS;AAFJ,WAHQ;AAOff,iBAAO,EAAE;AAPM,SAvCa;AAgD9BmB,eAAO,EAAE;AACPttE,cAAI,EAAE,SADC;AAEPo+B,eAAK,EAAE;AACL,yBAAa;AAAE8uC,gBAAE,EAAE;AAAN,aADR;AAEL,qBAAS;AAFJ,WAFA;AAMPf,iBAAO,EAAE;AANF,SAhDqB;AAwD9BoB,yBAAiB,EAAE;AACjBvtE,cAAI,EAAE,mBADW;AAEjBo+B,eAAK,EAAE;AACL,yBAAa;AAAE8uC,gBAAE,EAAE;AAAN,aADR;AAEL,qBAAS;AAFJ,WAFU;AAMjBf,iBAAO,EAAE;AANQ,SAxDW;AAgE9BqB,mBAAW,EAAE;AACXxtE,cAAI,EAAE,YADK;AAEXo+B,eAAK,EAAE;AACL,2BAAe;AAAE8uC,gBAAE,EAAE;AAAN,aADV;AAEL,qBAAS;AAFJ,WAFI;AAMXf,iBAAO,EAAE;AANE,SAhEiB;AAwE9BsB,yBAAiB,EAAE;AACjBztE,cAAI,EAAE,iBADW;AAEjBo+B,eAAK,EAAE;AACL,yBAAa;AAAE8uC,gBAAE,EAAE;AAAN,aADR;AAEL,8BAAkB,EAFb;AAGL,iCAAqB,EAHhB;AAIL,2BAAe,EAJV;AAKL,8BAAkB,EALb;AAML,+BAAmB;AANd,WAFU;AAUjBf,iBAAO,EAAE;AACP,8BAAkB,EADX;AAEP,iCAAqB,EAFd;AAGP,2BAAe;AAHR;AAVQ,SAxEW;AAwF9BuB,8BAAsB,EAAE;AACtB1tE,cAAI,EAAE,sBADgB;AAEtBo+B,eAAK,EAAE;AACL,yBAAa;AAAE8uC,gBAAE,EAAE;AAAN,aADR;AAEL,4BAAgB,EAFX;AAGL,2BAAe;AAHV;AAFe,SAxFM;AAgG9BS,qBAAa,EAAE;AACb3tE,cAAI,EAAE,cADO;AAEbo+B,eAAK,EAAE;AACL,0BAAc;AAAE8uC,gBAAE,EAAE;AAAN,aADT;AAEL,2BAAe,EAFV;AAGL,iCAAqB,EAHhB;AAIL,2BAAe,EAJV;AAKL,8BAAkB;AALb,WAFM;AASbf,iBAAO,EAAE;AACP,iCAAqB;AADd;AATI,SAhGe;AA6G9ByB,0BAAkB,EAAE;AAClB5tE,cAAI,EAAE,kBADY;AAElBo+B,eAAK,EAAE;AACL,yBAAa;AAAE8uC,gBAAE,EAAE;AAAN,aADR;AAEL,qBAAS;AAFJ,WAFW;AAMlBf,iBAAO,EAAE;AANS,SA7GU;AAqH9B0B,qBAAa,EAAE;AACb7tE,cAAI,EAAE,cADO;AAEbo+B,eAAK,EAAE;AACL,yBAAa;AAAE8uC,gBAAE,EAAE;AAAN,aADR;AAEL,qBAAS;AAFJ,WAFM;AAMbf,iBAAO,EAAE;AANI,SArHe;AA6H9B2B,YAAI,EAAE;AACJ9tE,cAAI,EAAE,MADF;AAEJ0tC,4BAAkB,EAAE,IAFhB;AAGJtP,eAAK,EAAE;AACL,yBAAa;AAAE8uC,gBAAE,EAAE;AAAN,aADR;AAEL,qBAAS;AAFJ,WAHH;AAOJf,iBAAO,EAAE;AAPL,SA7HwB;AAsI9B4B,iBAAS,EAAE;AACT/tE,cAAI,EAAE,UADG;AAETo+B,eAAK,EAAE;AACL,yBAAa;AAAE8uC,gBAAE,EAAE;AAAN,aADR;AAEL,qBAAS;AAFJ,WAFE;AAMTf,iBAAO,EAAE;AANA,SAtImB;AA8I9Bl/B,oBAAY,EAAE;AACZjtC,cAAI,EAAE,cADM;AAEZ0tC,4BAAkB,EAAE,IAFR;AAGZtP,eAAK,EAAE;AACL,uBAAW;AAAE8uC,gBAAE,EAAE;AAAN,aADN;AAEL,qBAAS;AAFJ,WAHK;AAOZf,iBAAO,EAAE;AAPG,SA9IgB;AAuJ9Bj/B,oBAAY,EAAE;AACZltC,cAAI,EAAE,aADM;AAEZ0tC,4BAAkB,EAAE,IAFR;AAGZtP,eAAK,EAAE;AACL,2BAAe;AAAE8uC,gBAAE,EAAE;AAAN,aADV;AAEL,qBAAS;AAFJ,WAHK;AAOZf,iBAAO,EAAE;AAPG,SAvJgB;AAgK9B6B,uBAAe,EAAE;AACfhuE,cAAI,EAAE,QADS;AAEf0tC,4BAAkB,EAAE,IAFL;AAGftP,eAAK,EAAE;AACL,0BAAc;AAAE8uC,gBAAE,EAAE;AAAN,aADT;AAEL,6BAAiB,EAFZ;AAGL,qBAAS;AAHJ,WAHQ;AAQff,iBAAO,EAAE;AACP,6BAAiB;AADV;AARM,SAhKa;AA4K9Bh/B,kBAAU,EAAE;AACVntC,cAAI,EAAE,WADI;AAEV0tC,4BAAkB,EAAE,IAFV;AAGVtP,eAAK,EAAE;AACL,2BAAe;AAAE8uC,gBAAE,EAAE;AAAN,aADV;AAEL,qBAAS;AAFJ,WAHG;AAOVf,iBAAO,EAAE;AAPC;AA5KkB,OAAT;;;;;;;;;;;;;;;;;;;;;;;ACdzB;;;AACO,UAAM52C,SAAQ,GAAG;AACtBR,kBAAU,EAAE;AACVk5C,cAAI,EAAE;AACJC,qBAAS,EAAE,sCADP;AAEJC,uBAAW,EAAE,gGAFT;AAGJl5C,wBAAY,EAAE,mBAHV;AAIJC,oCAAwB,EAAEzuC,SAJtB;AAKJ2nF,kBAAM,EAAE,uBALJ;AAMJC,gBAAI,EAAE,IANF;AAOJC,0BAAc,EAAE,mDAPZ;AAQJC,qBAAS,EAAE,gCARP;AASJC,6BAAiB,EAAE;AATf,WADI;AAYVC,cAAI,EAAE;AACJP,qBAAS,EAAE,sCADP;AAEJC,uBAAW,EAAE,sGAFT;AAGJl5C,wBAAY,EAAE,mBAHV;AAIJC,oCAAwB,EAAEzuC,SAJtB;AAKJ2nF,kBAAM,EAAE,uBALJ;AAMJC,gBAAI,EAAE,IANF;AAOJC,0BAAc,EAAE,mDAPZ;AAQJC,qBAAS,EAAE,gCARP;AASJC,6BAAiB,EAAE;AATf,WAZI;AAuBVE,cAAI,EAAE;AACJR,qBAAS,EAAE,sCADP;AAEJC,uBAAW,EAAE,gGAFT;AAGJl5C,wBAAY,EAAE,mBAHV;AAIJC,oCAAwB,EAAEzuC,SAJtB;AAKJ2nF,kBAAM,EAAE,uBALJ;AAMJC,gBAAI,EAAE,IANF;AAOJC,0BAAc,EAAE,8CAPZ;AAQJC,qBAAS,EAAE,2BARP;AASJC,6BAAiB,EAAE;AATf;AAvBI,SADU;AAoCtBl/D,oBAAY,EAAE;AACZq/D,gCAAsB,EAAE,IADZ;AAEZ9tE,kBAAQ,EAAE;AACR+tE,gBAAI,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,IAAI,CAApB,CADE;AAERC,eAAG,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,IAAI,CAAjB,EAAoB,IAAI,EAAxB,CAFG;AAGRC,iBAAK,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,IAAI,CAApB,CAHC;AAIRC,gBAAI,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,IAAI,CAApB;AAJE,WAFE;AAQZC,kBAAQ,EAAE;AARE,SApCQ;AA8CtBC,gBAAQ,EAAE;AACRC,gBAAM,EAAE;AACN39C,kBAAM,EAAE;AACNm9C,kBAAI,EAAE,0BADA;AAEND,kBAAI,EAAE,+BAFA;AAGNR,kBAAI,EAAE,+BAHA,CAIN;;AAJM,aADF;AAONkB,sBAAU,EAAE;AACVT,kBAAI,EAAE,4CADI;AAEVD,kBAAI,EAAE,0CAFI;AAGVR,kBAAI,EAAE;AAHI,aAPN;AAYNmB,kBAAM,EAAE;AACNV,kBAAI,EAAE,uBADA;AAEND,kBAAI,EAAE,wBAFA;AAGNR,kBAAI,EAAE;AAHA,aAZF;AAiBNoB,yBAAa,EAAE,0BAjBT;AAkBNC,+BAAmB,EAAE,kCAlBf;AAmBNC,6BAAiB,EAAE,8CAnBb;AAoBNC,0BAAc,EAAE,iBApBV;AAqBNC,0BAAc,EAAE;AArBV,WADA;AAwBRvgD,iBAAO,EAAE;AACPwgD,mCAAuB,EAAE,CADlB;AAEPC,wBAAY,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,EAAhB,CAFP;AAGP9R,oBAAQ,EAAE,aAHH;AAIP+R,sBAAU,EAAE,YAJL;AAKPhB,gBAAI,EAAE;AACJr9C,oBAAM,EAAE,8DADJ;AAEJ69C,oBAAM,EAAE;AACNS,kBAAE,EAAE,yHADE;AAENC,kBAAE,EAAE;AAFE,eAFJ;AAMJC,yBAAW,EAAE;AANT,aALC;AAaPhB,gBAAI,EAAE;AACJx9C,oBAAM,EAAE,8DADJ;AAEJ69C,oBAAM,EAAE;AACNS,kBAAE,EAAE,wIADE;AAENC,kBAAE,EAAE;AAFE,eAFJ;AAMJC,yBAAW,EAAE;AANT,aAbC;AAqBPjB,iBAAK,EAAE;AACLv9C,oBAAM,EAAE,0DADH;AAEL69C,oBAAM,EAAE;AACNS,kBAAE,EAAE,oIADE;AAENC,kBAAE,EAAE;AAFE,eAFH;AAMLC,yBAAW,EAAE;AANR,aArBA;AA6BPlB,eAAG,EAAE;AACHt9C,oBAAM,EAAE,sDADL;AAEHw+C,yBAAW,EAAE;AAFV;AA7BE;AAxBD,SA9CY;AAyGtBvnC,UAAE,EAAE;AACFwnC,uBAAa,EAAE;AACb5D,kBAAM,EAAE,qBADK;AAEb5mF,oBAAQ,EAAE;AAFG,WADb;AAKFyqF,iBAAO,EAAE;AACP7D,kBAAM,EAAE;AADD;AALP,SAzGkB;AAkHtBplF,WAAG,EAAE;AACHkpF,eAAK,EAAE;AACLC,uBAAW,EAAE,YADR;AAELC,qBAAS,EAAE,CAFN;AAGLC,yCAA6B,EAAE,EAH1B;AAILC,uCAA2B,EAAE,IAJxB;AAKLC,2BAAe,EAAE,WALZ;AAMLC,uBAAW,EAAE,kCANR;AAOLC,uBAAW,EAAE,CAPR;AAQLC,mCAAuB,EAAE,CARpB;AASLC,oCAAwB,EAAE,CATrB;AAULp0B,mBAAO,EAAE,CAVJ;AAWLq0B,8BAAkB,EAAE,CAXf;AAYLt0B,mBAAO,EAAE,EAZJ;AAaLu0B,0BAAc,EAAE,EAbX;AAcLC,oCAAwB,EAAE,EAdrB;AAeL3oB,2BAAe,EAAE,CAfZ;AAgBL7E,wBAAY,EAAE,KAhBT;AAiBLlF,0BAAc,EAAE,KAjBX;AAkBL2yB,iCAAqB,EAAE,2GAlBlB;AAmBLC,iCAAqB,EAAE,wIAnBlB;AAoBLC,0BAAc,EAAE,kDApBX;AAqBLC,kCAAsB,EAAE,gGArBnB;AAsBL1qD,wBAAY,EAAE,CACZ;AACExmB,kBAAI,EAAE,WADR;AAEEza,yBAAW,EAAE,2BAFf;AAGE6H,iBAAG,EAAE,mFAHP;AAIE2S,qBAAO,EAAE,KAJX;AAKE+oE,qBAAO,EAAE,IALX;AAMEr6E,qBAAO,EAAE,GANX;AAOE43B,yBAAW,EAAE,EAPf;AAQEgjD,8BAAgB,EAAE,KARpB;AASE3iD,qBAAO,EAAE;AACP1mB,oBAAI,EAAE,kBADC;AAEPza,2BAAW,EAAE,kCAFN;AAGP6H,mBAAG,EAAE,mFAHE;AAIP2S,uBAAO,EAAE,IAJF;AAKP+oE,uBAAO,EAAE,IALF;AAMPO,gCAAgB,EAAE;AANX;AATX,aADY,EAmBZ;AACErpE,kBAAI,EAAE,WADR;AAEEza,yBAAW,EAAE,4BAFf;AAGE6H,iBAAG,EAAE,+FAHP;AAIE2S,qBAAO,EAAE,IAJX;AAKE+oE,qBAAO,EAAE,IALX;AAMEr6E,qBAAO,EAAE,GANX;AAOE43B,yBAAW,EAAE,EAPf;AAQEgjD,8BAAgB,EAAE;AARpB,aAnBY,EA6BZ;AACErpE,kBAAI,EAAE,aADR;AAEEza,yBAAW,EAAE,6BAFf;AAGE6H,iBAAG,EAAE,qFAHP;AAIE2S,qBAAO,EAAE,IAJX;AAKE+oE,qBAAO,EAAE,IALX;AAMEr6E,qBAAO,EAAE,GANX;AAOE43B,yBAAW,EAAE,EAPf;AAQEgjD,8BAAgB,EAAE;AARpB,aA7BY,EAuCZ;AACErpE,kBAAI,EAAE,aADR;AAEEza,yBAAW,EAAE,8BAFf;AAGE6H,iBAAG,EAAE,oFAHP;AAIE2S,qBAAO,EAAE,IAJX;AAKE+oE,qBAAO,EAAE,IALX;AAMEr6E,qBAAO,EAAE,GANX;AAOE43B,yBAAW,EAAE,EAPf;AAQEgjD,8BAAgB,EAAE;AARpB,aAvCY,CAtBT;AAwEL8H,8BAAkB,EAAE,CAClB,CAAC,kBAAD,EAAqB,CAAC,UAAtB,CADkB,EAElB,CAAC,kBAAD,EAAqB,WAArB,CAFkB,EAGlB,CAAC,iBAAD,EAAoB,WAApB,CAHkB,EAIlB,CAAC,iBAAD,EAAoB,CAAC,UAArB,CAJkB,EAKlB,CAAC,kBAAD,EAAqB,CAAC,UAAtB,CALkB;AAxEf,WADJ;AAiFHC,gBAAM,EAAE;AACNC,cAAE,EAAE;AACFjkF,iBAAG,EAAE,0CADH;AAEFkkF,wBAAU,EAAE,EAFV;AAGFC,wBAAU,EAAE,IAHV;AAIFC,8BAAgB,EAAE,IAJhB;AAKFC,0BAAY,EAAE;AALZ,aADE;AAQN9e,oBAAQ,EAAE;AACRvlE,iBAAG,EAAE,6BADG;AAERkkF,wBAAU,EAAE,EAFJ;AAGRI,sBAAQ,EAAE;AAHF,aARJ;AAaNC,6BAAiB,EAAE;AAbb,WAjFL;AAgGH58E,gBAAM,EAAE;AACN68E,oBAAQ,EAAE;AACRC,kBAAI,EAAE,CACJ,CAAC,SAAD,EAAY,QAAZ,CADI,EAEJ,CAAC,SAAD,EAAY,SAAZ,CAFI,EAGJ,CAAC,SAAD,EAAY,SAAZ,CAHI,EAIJ,CAAC,SAAD,EAAY,QAAZ,CAJI;AADE;AADJ,WAhGL;AA0GHC,8BAAoB,EAAE,EA1GnB;AA2GHC,0BAAgB,EAAE,CAAC,SAAD,EAAY,SAAZ,CA3Gf;AA4GHC,wBAAc,EAAE,EA5Gb;AA6GHC,0BAAgB,EAAE,EA7Gf,CA6GkB;;AA7GlB,SAlHiB;AAiOtBC,8BAAsB,EAAE,YAjOF;AAkOtBC,2BAAmB,EAAE,uBAlOC;AAmOtBC,WAAG,EAAE;AACHC,qCAA2B,EAAE;AAC3BC,8BAAkB,EAAE,IADO;AAE3Br7B,mBAAO,EAAE,KAAK,IAFa;AAG3Bs7B,sBAAU,EAAEC,QAHe,CAGN;;AAHM;AAD1B,SAnOiB;AA0OtBC,2BAAmB,EAAE,QA1OC;AA2OtBC,mBAAW,EAAE;AACXC,iBAAO,EAAE;AACPv2E,gBAAI,EAAE,YADC;AAEPw2E,uBAAW,EAAE;AAFN,WADE;AAKXC,gBAAM,EAAE;AACNz2E,gBAAI,EAAE,YADA;AAENw2E,uBAAW,EAAE;AAFP;AALG,SA3OS;AAqPtBtmE,mBAAW,EAAE;AACXwmE,0BAAgB,EAAE;AADP,SArPS;AAwPtB5b,iBAAS,EAAE;AACT4b,0BAAgB,EAAE;AADT,SAxPW;AA2PtBC,cAAM,EAAE;AACNhnF,cAAI,EAAE,IADA;AAENinF,iBAAO,EAAE;AAFH,SA3Pc;AA+PtBC,iBAAS,EAAE,2DA/PW;AAgQtBC,yBAAiB,EAAE,eAhQG;AAiQtBC,kCAA0B,EAAE,IAAI,EAAJ,GAAS,IAjQf;AAkQtBC,8BAAsB,EAAE,KAAK,IAlQP;AAmQtBC,mCAA2B,EAAE,OAAO,EAAP,GAAY,EAAZ,GAAiB,EAAjB,GAAsB,EAnQ7B;AAoQtBC,uBAAe,EAAE;AACfC,mBAAS,EAAE,eADI;AAEfC,qBAAW,EAAE;AAFE,SApQK;AAwQtBroE,gBAAQ,EAAE;AACRsoE,sBAAY,EAAE,IADN;AAERC,4BAAkB,EAAE,CAClB;AAAEjuD,gBAAI,EAAE,IAAR;AAAczlB,gBAAI,EAAE;AAApB,WADkB,EAElB;AAAEylB,gBAAI,EAAE,IAAR;AAAczlB,gBAAI,EAAE;AAApB,WAFkB,EAGlB;AAAEylB,gBAAI,EAAE,IAAR;AAAczlB,gBAAI,EAAE;AAApB,WAHkB,EAIlB;AAAEylB,gBAAI,EAAE,IAAR;AAAczlB,gBAAI,EAAE;AAApB,WAJkB,EAKlB;AAAEylB,gBAAI,EAAE,IAAR;AAAczlB,gBAAI,EAAE;AAApB,WALkB,EAMlB;AAAEylB,gBAAI,EAAE,IAAR;AAAczlB,gBAAI,EAAE;AAApB,WANkB,EAOlB;AAAEylB,gBAAI,EAAE,IAAR;AAAczlB,gBAAI,EAAE;AAApB,WAPkB;AAFZ;AAxQY,OAAjB;;;;;;ACDP;AACA,wCACA,KADA,EAEA,QAFA,EAGA,4DAHA,CADA;AAMA,iCACA,KADA,EAEA,QAFA,EAGA,qDAHA,CANA;AAWA,iCACA,KADA,EAEA,QAFA,EAGA,qDAHA,CAXA;AAgBA,oCACA,IADA,EAEA,QAFA,EAGA,wDAHA,CAhBA;AAqBA,uCACA,KADA,EAEA,QAFA,EAGA,2DAHA,CArBA;AA0BA,oCACA,KADA,EAEA,wDAFA,CA1BA;AA8BA,oCACA,KADA,EAEA,QAFA,EAGA,wDAHA,CA9BA;AAmCA,kCACA,KADA,EAEA,QAFA,EAGA,sDAHA,CAnCA;AAwCA,oCACA,KADA,EAEA,QAFA,EAGA,wDAHA,CAxCA;AA6CA,gCACA,KADA,EAEA,QAFA,EAGA,oDAHA,CA7CA;AAkDA,iCACA,KADA,EAEA,qDAFA,CAlDA;AAsDA,sCACA,KADA,EAEA,QAFA,EAGA,0DAHA,CAtDA;AA2DA,iCACA,KADA,EAEA,QAFA,EAGA,qDAHA,CA3DA;AAgEA,+BACA,KADA,EAEA,mDAFA,CAhEA;AAoEA,6CACA,KADA,EAEA,iEAFA,CApEA;AAwEA,iCACA,KADA,EAEA,QAFA,EAGA,qDAHA,CAxEA;AA6EA,yCACA,KADA,EAEA,QAFA,EAGA,6DAHA,CA7EA;AAkFA,kCACA,KADA,EAEA,QAFA,EAGA,sDAHA,CAlFA;AAuFA,mCACA,KADA,EAEA,QAFA,EAGA,uDAHA,CAvFA;AA4FA,kCACA,KADA,EAEA,QAFA,EAGA,sDAHA,CA5FA;AAiGA,iCACA,KADA,EAEA,QAFA,EAGA,qDAHA,CAjGA;AAsGA,iCACA,KADA,EAEA,QAFA,EAGA,qDAHA,CAtGA;AA2GA,mCACA,KADA,EAEA,QAFA,EAGA,uDAHA,CA3GA;AAgHA,wCACA,KADA,EAEA,QAFA,EAGA,4DAHA,CAhHA;AAqHA,mCACA,KADA,EAEA,QAFA,EAGA,uDAHA,CArHA;AA0HA,iCACA,IADA,EAEA,QAFA,EAGA,qDAHA,CA1HA;AA+HA,uCACA,KADA,EAEA,QAFA,EAGA,2DAHA,CA/HA;AAoIA,qCACA,KADA,EAEA,QAFA,EAGA,yDAHA,CApIA;AAyIA,yCACA,KADA,EAEA,6DAFA,CAzIA;AA6IA,mCACA,KADA,EAEA,QAFA,EAGA,uDAHA,CA7IA;AAkJA,qCACA,KADA,EAEA,QAFA,EAGA,yDAHA,CAlJA;AAuJA,qCACA,IADA,EAEA,QAFA,EAGA,yDAHA,CAvJA;AA4JA,oCACA,KADA,EAEA,QAFA,EAGA,wDAHA,CA5JA;AAiKA,mCACA,KADA,EAEA,uDAFA,CAjKA;AAqKA,mCACA,KADA,EAEA,QAFA,EAGA,uDAHA,CArKA;AA0KA,sCACA,KADA,EAEA,0DAFA,CA1KA;AA8KA,qCACA,KADA,EAEA,QAFA,EAGA,yDAHA,CA9KA;AAmLA,iCACA,KADA,EAEA,QAFA,EAGA,qDAHA,CAnLA;AAwLA,gCACA,KADA,EAEA,QAFA,EAGA,oDAHA,CAxLA;AA6LA,oCACA,KADA,EAEA,QAFA,EAGA,wDAHA,CA7LA;AAkMA,iCACA,KADA,EAEA,QAFA,EAGA,qDAHA,CAlMA;AAuMA,kCACA,KADA,EAEA,QAFA,EAGA,sDAHA,CAvMA;AA4MA,0CACA,KADA,EAEA,8DAFA;AA5MA;;AAiNA;AACA;AACA;AACA;AACA7mB;AACA;AACG,WAJH;AAKA;;AAEA;AAAA;AACA;AACA;AACE,SAFF;AAGA;;AACAw6F;AAAwC;AAAA,OAAxC;;AACAA;AACAt6F;;;;;;ACjOA;AACA,qBADA;AAEA,wBAFA;AAGA,qBAHA;AAIA,wBAJA;AAKA,2BALA;AAMA,wBANA;AAOA,2BAPA;AAQA,wBARA;AASA,2BATA;AAUA,wBAVA;AAWA,2BAXA;AAYA,wBAZA;AAaA,2BAbA;AAcA,wBAdA;AAeA,2BAfA;AAgBA,wBAhBA;AAiBA,qBAjBA;AAkBA,wBAlBA;AAmBA,qBAnBA;AAoBA,wBApBA;AAqBA,qBArBA;AAsBA,wBAtBA;AAuBA,qBAvBA;AAwBA,wBAxBA;AAyBA,qBAzBA;AA0BA,wBA1BA;AA2BA,2BA3BA;AA4BA,wBA5BA;AA6BA,qBA7BA;AA8BA,wBA9BA;AA+BA,qBA/BA;AAgCA,wBAhCA;AAiCA,qBAjCA;AAkCA,wBAlCA;AAmCA,qBAnCA;AAoCA,wBApCA;AAqCA,qBArCA;AAsCA,wBAtCA;AAuCA,qBAvCA;AAwCA,wBAxCA;AAyCA,qBAzCA;AA0CA,wBA1CA;AA2CA,oBA3CA;AA4CA,uBA5CA;AA6CA,qBA7CA;AA8CA,wBA9CA;AA+CA,2BA/CA;AAgDA,wBAhDA;AAiDA,2BAjDA;AAkDA,wBAlDA;AAmDA,qBAnDA;AAoDA,wBApDA;AAqDA,oBArDA;AAsDA,uBAtDA;AAuDA,wBAvDA;AAwDA,2BAxDA;AAyDA,wBAzDA;AA0DA,2BA1DA;AA2DA,wBA3DA;AA4DA,2BA5DA;AA6DA,wBA7DA;AA8DA,2BA9DA;AA+DA,wBA/DA;AAgEA,2BAhEA;AAiEA,wBAjEA;AAkEA,2BAlEA;AAmEA,wBAnEA;AAoEA,2BApEA;AAqEA,wBArEA;AAsEA,2BAtEA;AAuEA,qBAvEA;AAwEA,wBAxEA;AAyEA,qBAzEA;AA0EA,wBA1EA;AA2EA,2BA3EA;AA4EA,wBA5EA;AA6EA,2BA7EA;AA8EA,wBA9EA;AA+EA,2BA/EA;AAgFA,wBAhFA;AAiFA,qBAjFA;AAkFA,wBAlFA;AAmFA,qBAnFA;AAoFA,wBApFA;AAqFA,qBArFA;AAsFA,wBAtFA;AAuFA,qBAvFA;AAwFA,wBAxFA;AAyFA,sBAzFA;AA0FA,yBA1FA;AA2FA,qBA3FA;AA4FA,wBA5FA;AA6FA,qBA7FA;AA8FA,wBA9FA;AA+FA,2BA/FA;AAgGA,wBAhGA;AAiGA,2BAjGA;AAkGA,wBAlGA;AAmGA,qBAnGA;AAoGA,wBApGA;AAqGA,qBArGA;AAsGA,wBAtGA;AAuGA,qBAvGA;AAwGA,wBAxGA;AAyGA,qBAzGA;AA0GA,wBA1GA;AA2GA,2BA3GA;AA4GA,8BA5GA;AA6GA,2BA7GA;AA8GA,8BA9GA;AA+GA,qBA/GA;AAgHA,wBAhHA;AAiHA,qBAjHA;AAkHA,wBAlHA;AAmHA,qBAnHA;AAoHA,wBApHA;AAqHA,qBArHA;AAsHA,wBAtHA;AAuHA,qBAvHA;AAwHA,wBAxHA;AAyHA,wBAzHA;AA0HA,2BA1HA;AA2HA,qBA3HA;AA4HA,wBA5HA;AA6HA,qBA7HA;AA8HA,wBA9HA;AA+HA,qBA/HA;AAgIA,uBAhIA;AAiIA,0BAjIA;AAkIA,wBAlIA;AAmIA,qBAnIA;AAoIA,wBApIA;AAqIA,mBArIA;AAsIA,sBAtIA;AAuIA,qBAvIA;AAwIA,wBAxIA;AAyIA,qBAzIA;AA0IA,wBA1IA;AA2IA,qBA3IA;AA4IA,wBA5IA;AA6IA,qBA7IA;AA8IA,wBA9IA;AA+IA,qBA/IA;AAgJA,wBAhJA;AAiJA,qBAjJA;AAkJA,wBAlJA;AAmJA,qBAnJA;AAoJA,wBApJA;AAqJA,qBArJA;AAsJA,wBAtJA;AAuJA,qBAvJA;AAwJA,wBAxJA;AAyJA,qBAzJA;AA0JA,wBA1JA;AA2JA,qBA3JA;AA4JA,wBA5JA;AA6JA,qBA7JA;AA8JA,wBA9JA;AA+JA,qBA/JA;AAgKA,wBAhKA;AAiKA,qBAjKA;AAkKA,wBAlKA;AAmKA,qBAnKA;AAoKA,wBApKA;AAqKA,qBArKA;AAsKA,wBAtKA;AAuKA,qBAvKA;AAwKA,wBAxKA;AAyKA,qBAzKA;AA0KA,wBA1KA;AA2KA,2BA3KA;AA4KA,wBA5KA;AA6KA,oBA7KA;AA8KA,uBA9KA;AA+KA,oBA/KA;AAgLA,uBAhLA;AAiLA,oBAjLA;AAkLA,uBAlLA;AAmLA,qBAnLA;AAoLA,wBApLA;AAqLA,qBArLA;AAsLA,wBAtLA;AAuLA,2BAvLA;AAwLA,wBAxLA;AAyLA,qBAzLA;AA0LA,wBA1LA;AA2LA,yBA3LA;AA4LA,4BA5LA;AA6LA,wBA7LA;AA8LA,2BA9LA;AA+LA,qBA/LA;AAgMA,wBAhMA;AAiMA,qBAjMA;AAkMA,wBAlMA;AAmMA,2BAnMA;AAoMA,wBApMA;AAqMA,qBArMA;AAsMA,wBAtMA;AAuMA,qBAvMA;AAwMA,wBAxMA;AAyMA,qBAzMA;AA0MA,wBA1MA;AA2MA,qBA3MA;AA4MA,wBA5MA;AA6MA,qBA7MA;AA8MA,wBA9MA;AA+MA,qBA/MA;AAgNA,wBAhNA;AAiNA,qBAjNA;AAkNA,wBAlNA;AAmNA,qBAnNA;AAoNA,wBApNA;AAqNA,qBArNA;AAsNA,0BAtNA;AAuNA,6BAvNA;AAwNA,wBAxNA;AAyNA,qBAzNA;AA0NA,wBA1NA;AA2NA,qBA3NA;AA4NA,wBA5NA;AA6NA,oBA7NA;AA8NA,uBA9NA;AA+NA,qBA/NA;AAgOA,wBAhOA;AAiOA,qBAjOA;AAkOA,wBAlOA;AAmOA,sBAnOA;AAoOA,yBApOA;AAqOA,qBArOA;AAsOA,wBAtOA;AAuOA,qBAvOA;AAwOA,wBAxOA;AAyOA,qBAzOA;AA0OA,wBA1OA;AA2OA,wBA3OA;AA4OA,2BA5OA;AA6OA,sBA7OA;AA8OA,yBA9OA;AA+OA,qBA/OA;AAgPA,wBAhPA;AAiPA,sBAjPA;AAkPA,yBAlPA;AAmPA,sBAnPA;AAoPA,2BApPA;AAqPA,8BArPA;AAsPA,yBAtPA;AAuPA,wBAvPA;AAwPA,2BAxPA;AAyPA,qBAzPA;AA0PA,wBA1PA;AA2PA,qBA3PA;AA4PA,wBA5PA;AA6PA,qBA7PA;AA8PA,0BA9PA;AA+PA,6BA/PA;AAgQA,wBAhQA;AAiQA,qBAjQA;AAkQA,wBAlQA;AAmQA,2BAnQA;AAoQA,8BApQA;AAqQA,qBArQA;AAsQA,wBAtQA;AAuQA,wBAvQA;AAwQA,2BAxQA;AAyQA,wBAzQA;AA0QA,2BA1QA;AA2QA,wBA3QA;AA4QA,2BA5QA;AA6QA,wBA7QA;AA8QA;AA9QA;;AAkRA;AACA;AACA;AACA;;AACA;AACA;AACA;AACAF;AACA;AACA;;AACA;AACA;;AACAy6F;AACA;AACA,OAFA;;AAGAA;AACAv6F;AACAu6F;;;;;;ACnSA;AACA,oCADA;AAEA,oCAFA;AAGA,oCAHA;AAIA,oCAJA;AAKA,oCALA;AAMA;AANA;;AAUA;AACA;AACA;AACA;;AACA;AACA;AACA;AACAz6F;AACA;AACA;;AACA;AACA;;AACAy6F;AACA;AACA,OAFA;;AAGAA;AACAv6F;AACAu6F;;;;;;AC3BA;AACA,sCADA;AAEA,sCAFA;AAGA,sCAHA;AAIA,sCAJA;AAKA,sCALA;AAMA;AANA;;AAUA;AACA;AACA;AACA;;AACA;AACA;AACA;AACAz6F;AACA;AACA;;AACA;AACA;;AACAy6F;AACA;AACA,OAFA;;AAGAA;AACAv6F;AACAu6F;;;;;;AC3BA;;;;;;;ACAA;;;;;;;ACAA;;;;;;;ACAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":["e","webpackEmptyAsyncContext","module","routes","path","loadChildren","Promise","then","m","TabsPageModule","MyObservationsPageModule","__webpack_require__","UserSettingsPageModule","TripLogPageModule","StartWizardPageModule","ViewObservationPageModule","ObservationListPageModule","OfflineMapPageModule","LoginModule","RegistrationModule","LegacyTripPageModule","AppRoutingModule","_angular_router__WEBPACK_IMPORTED_MODULE_1__","relativeLinkResolution","imports","exports","DEBUG_TAG","ROUTER_DEBUG_TAG","AppComponent","platform","userSettings","dataMarshallService","offlineImageService","swipeBackService","loggingService","dbHelperService","screenOrientation","shortcutService","fileLoggingService","auth","router","swipeBackEnabled$","initializeApp","init","pipe","getUserSettings","initServices","subscribe","next","debug","afterAppInitialized","error","err","_capacitor_splash_screen__WEBPACK_IMPORTED_MODULE_0__","lock","ORIENTATIONS","PORTRAIT","src","lockScreenOrientation","configureLogging","appMode","_capacitor_status_bar__WEBPACK_IMPORTED_MODULE_12__","style","color","overlay","cleanupOldItems","initRouteNavigationLogger","ready","userSetting$","events","_angular_router__WEBPACK_IMPORTED_MODULE_25__","event","eventInfo","toString","_angular_core__WEBPACK_IMPORTED_MODULE_26__","selectors","decls","vars","consts","template","AppModule","bootstrap","_app_component__WEBPACK_IMPORTED_MODULE_0__","_app_providers__WEBPACK_IMPORTED_MODULE_2__","_angular_platform_browser__WEBPACK_IMPORTED_MODULE_13__","_angular_platform_browser_animations__WEBPACK_IMPORTED_MODULE_14__","_angular_common_http__WEBPACK_IMPORTED_MODULE_15__","_angular_forms__WEBPACK_IMPORTED_MODULE_16__","_ionic_angular__WEBPACK_IMPORTED_MODULE_17__","_app_routing_module__WEBPACK_IMPORTED_MODULE_1__","_ngx_translate_core__WEBPACK_IMPORTED_MODULE_18__","ngx_markdown__WEBPACK_IMPORTED_MODULE_19__","angular_svg_icon__WEBPACK_IMPORTED_MODULE_20__","_modules_shared_shared_module__WEBPACK_IMPORTED_MODULE_3__","_modules_map_map_module__WEBPACK_IMPORTED_MODULE_9__","_asymmetrik_ngx_leaflet__WEBPACK_IMPORTED_MODULE_10__","_modules_registration_registration_module__WEBPACK_IMPORTED_MODULE_4__","_pages_modal_pages_legal_terms_modal_legal_terms_modal_module__WEBPACK_IMPORTED_MODULE_5__","_modules_side_menu_side_menu_module__WEBPACK_IMPORTED_MODULE_6__","_modules_gps_debug_gps_debug_module__WEBPACK_IMPORTED_MODULE_8__","_modules_analytics_analytics_module__WEBPACK_IMPORTED_MODULE_7__","_varsom_regobs_common_regobs_api__WEBPACK_IMPORTED_MODULE_21__","_modules_common_registration_registration_module__WEBPACK_IMPORTED_MODULE_11__","declarations","DynamicLocaleId","service","currentLang","String","createTranslateLoader","http","_ngx_translate_http_loader__WEBPACK_IMPORTED_MODULE_39__","initCommonApiKey","apiKey","initAppModeService","userSettingService","appMode$","initCommonRegistrationOptions","options","autoSync","adapter","attachmentsSupported","initDb","dbService","rxdb__WEBPACK_IMPORTED_MODULE_35__","initDatabase","APP_PROVIDERS","_core_guards_start_wizard_guard__WEBPACK_IMPORTED_MODULE_15__","_core_guards_auth_guard__WEBPACK_IMPORTED_MODULE_17__","provide","_angular_router__WEBPACK_IMPORTED_MODULE_40__","useClass","_ionic_angular__WEBPACK_IMPORTED_MODULE_41__","_angular_core__WEBPACK_IMPORTED_MODULE_42__","deps","_ngx_translate_core__WEBPACK_IMPORTED_MODULE_43__","_ionic_native_device_orientation_ngx__WEBPACK_IMPORTED_MODULE_31__","_ionic_native_file_ngx__WEBPACK_IMPORTED_MODULE_3__","_ionic_native_android_permissions_ngx__WEBPACK_IMPORTED_MODULE_4__","_ionic_native_zip_ngx__WEBPACK_IMPORTED_MODULE_6__","_ionic_native_clipboard_ngx__WEBPACK_IMPORTED_MODULE_7__","_ionic_native_camera_ngx__WEBPACK_IMPORTED_MODULE_13__","_ionic_native_in_app_browser_ngx__WEBPACK_IMPORTED_MODULE_8__","_ionic_native_safari_view_controller_ngx__WEBPACK_IMPORTED_MODULE_28__","_ionic_native_http_ngx__WEBPACK_IMPORTED_MODULE_11__","_ionic_native_ionic_webview_ngx__WEBPACK_IMPORTED_MODULE_12__","_ionic_native_email_composer_ngx__WEBPACK_IMPORTED_MODULE_14__","_ionic_native_keyboard_ngx__WEBPACK_IMPORTED_MODULE_18__","_ionic_native_sqlite_ngx__WEBPACK_IMPORTED_MODULE_19__","_ionic_native_social_sharing_ngx__WEBPACK_IMPORTED_MODULE_20__","_ionic_native_network_ngx__WEBPACK_IMPORTED_MODULE_21__","_ionic_native_screen_orientation_ngx__WEBPACK_IMPORTED_MODULE_26__","_ionic_native_diagnostic_ngx__WEBPACK_IMPORTED_MODULE_29__","_angular_common_http__WEBPACK_IMPORTED_MODULE_44__","_core_http_interceptor_ApiInterceptor__WEBPACK_IMPORTED_MODULE_36__","multi","_core_error_handler_error_handler_class__WEBPACK_IMPORTED_MODULE_10__","_modules_shared_services_logging_logging_service__WEBPACK_IMPORTED_MODULE_22__","_environments_environment__WEBPACK_IMPORTED_MODULE_25__","_modules_shared_services_logging_sentry_service__WEBPACK_IMPORTED_MODULE_23__","_modules_shared_services_logging_console_logging_service__WEBPACK_IMPORTED_MODULE_24__","useFactory","_custom_translate_loader__WEBPACK_IMPORTED_MODULE_30__","_core_services_user_setting_user_setting_service__WEBPACK_IMPORTED_MODULE_9__","_core_app_init_deep_links_initializer__WEBPACK_IMPORTED_MODULE_32__","ionic_appauth__WEBPACK_IMPORTED_MODULE_33__","_varsom_regobs_common_regobs_api__WEBPACK_IMPORTED_MODULE_45__","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_46__","_modules_common_registration_module_options__WEBPACK_IMPORTED_MODULE_34__","_modules_common_registration_registration_services__WEBPACK_IMPORTED_MODULE_38__","useExisting","_core_services_data_marshall_data_marshall_service__WEBPACK_IMPORTED_MODULE_16__","_core_services_offline_map_offline_map_service__WEBPACK_IMPORTED_MODULE_27__","_core_services_background_geolocation_background_geolocation_service__WEBPACK_IMPORTED_MODULE_2__","window","hasOwnProperty","_core_services_background_geolocation_background_geolocation_native_service__WEBPACK_IMPORTED_MODULE_0__","_core_services_background_geolocation_background_geolocation_web_service__WEBPACK_IMPORTED_MODULE_1__","_core_services_background_download_background_download_service__WEBPACK_IMPORTED_MODULE_5__","_core_services_background_download_http_client_download_service__WEBPACK_IMPORTED_MODULE_37__","_angular_core__WEBPACK_IMPORTED_MODULE_0__","_r1","CompetenceComponent","inputs","competenceLevel","_r3","_angular_core__WEBPACK_IMPORTED_MODULE_2__","ImgSwiperComponent","cdr","autoplay","slidesPerView","zoom","rxjs__WEBPACK_IMPORTED_MODULE_3__","state","slides","activeIndex","header","description","location","imgUrl","length","type","getImageIndex","img","detach","el","swiper","target","shouldMoveMap","ngDestroy$","touchStart$","moveMapInSwiperToLeftOutsideView","updateUi","changes","destroy","undefined","setTimeout","push","getLocationSlides","getImageSlides","calculateNewState","detectChanges","map","index","imgHeaders","imgComments","$wrapperEl","transform","indexOf","imgUrlSrc","imgClick","emit","locationClick","slider","getActiveIndex","isEnd","resolve","getSwiperIndex","viewQuery","_ionic_angular__WEBPACK_IMPORTED_MODULE_8__","LegalTermsComponent","_angular_core__WEBPACK_IMPORTED_MODULE_19__","ctx_r0","ObservationListCardComponent","modalController","externalLinkService","socialSharing","analyticService","regobsAuthService","_settings__WEBPACK_IMPORTED_MODULE_0__","getBaseUrl","baseUrl","geoHazard","obs","GeoHazardTID","ObsLocation","Title","getLocation","dtObsDate","DtObsTime","icon","getGeoHazardCircleIcon","summaries","Summaries","Observer","CompetenceLevelName","updateImages","loaded","markForCheck","latLng","leaflet__WEBPACK_IMPORTED_MODULE_6__","Latitude","Longitude","startStopLocation","getStartStopLocation","damageLocations","getDamagePositions","AvalancheObs","start","StartLat","StartLong","stop","StopLong","StopLat","LandSlideObs","DamageObs","some","d","DamagePosition","filter","load","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_21__","imageHeaders","Attachments","x","RegistrationName","imageDescriptions","Comment","imageUrls","getImageUrl","attachment","size","UrlFormats","Url","reg","join","image","create","component","_pages_modal_pages_fullscreen_image_modal_fullscreen_image_modal_page__WEBPACK_IMPORTED_MODULE_2__","componentProps","imgSrc","_nano_sql_core_lib_utilities__WEBPACK_IMPORTED_MODULE_5__","modal","present","_modules_map_pages_modal_map_image_modal_map_image_page__WEBPACK_IMPORTED_MODULE_7__","toPromise","userSetings","loginHint","RegId","getLoggedInUserAsPromise","user","url","getRegistrationUrl","email","trackEvent","_modules_analytics_enums_app_event_category_enum__WEBPACK_IMPORTED_MODULE_9__","_modules_analytics_enums_app_event_action_enum__WEBPACK_IMPORTED_MODULE_10__","openExternalLink","share","features","ObservationSkeletonComponent","genericValue_r7","item_r32","SummaryComponent","_core_models_summmary_type_enum__WEBPACK_IMPORTED_MODULE_0__","showHeaders","DEFAULT_DURATION","EASE_IN_OUT_BACK","EASE_IN_OUT","CustomAnimation","fromScale","fromOpacity","opacity","delay","duration","easing","createScaleInInitialStyle","createScaleInAnimation","createScaleInTransition","baseEl","opts","baseAnimation","backdropAnimation","addElement","querySelector","fromTo","wrapperAnimation","beforeStyles","beforeAddClass","addAnimation","modalWrapperElement","currentTranslateX","getAttribute","currentOpacity","parseInt","initDeepLinks","ngZone","authService","navController","is","_capacitor_app__WEBPACK_IMPORTED_MODULE_0__","data","run","authorizationCallback","deepLinkRoute","createUrlTree","replace","navigateForward","AppErrorHandler","_angular_core__WEBPACK_IMPORTED_MODULE_1__","factory","AuthGuard","_","loggedInUser","isLoggedIn","signIn","providedIn","StartWizardGuard","userSetting","completedStartWizard","navigate","_angular_core__WEBPACK_IMPORTED_MODULE_3__","CancelPromiseTimer","timeoutMs","id","clearTimeout","getStarCount","split","s","BASE64_MARKER","DataUrlHelper","blob","mimeType","toDataUrl","dataUrl","buffer","Blob","Uint8Array","byteLength","reject","xhr","XMLHttpRequest","onload","response","result","onabort","onerror","open","responseType","send","reader","FileReader","onloadend","ensureCorrectMimeType","readAsDataURL","startsWith","substr","dataUri","base64","substring","raw","atob","rawLength","array","i","charCodeAt","convertDataURIToBinary","isAndroidOrIos","SVALBARD_BOUNDS","leaflet__WEBPACK_IMPORTED_MODULE_0__","_settings__WEBPACK_IMPORTED_MODULE_1__","coordinate","NORWEGIAN_BOUNDS","BorderHelper","bounds","contains","p","lng","lat","toBBox","isInSvalbard","inSvalbard","inNorway","isInNorway","latLngBounds","getSouthWest","getNorthEast","geometry","UserMarker","position","stroke","weight","fillOpacity","fillColor","clickable","userMarkerIcon","className","iconSize","html","coords","latitude","longitude","userMarker","addTo","setAccuracy","setLatLng","degrees","element","getElement","childNodes","rotateZ","display","accuracyMarker","accuracy","accuracyCircleStyle","setRadius","NSqlFullUpdateObservable","query","observer","exec","val","unsubscribe","rxjs__WEBPACK_IMPORTED_MODULE_0__","NumberHelper","n","isNaN","parseFloat","isFinite","decimalPlaces","isNumeric","sign","Math","round","pow","toFixed","min","max","required","integer","isNullOrEmpty","nNumverValue","Number","isInteger","toPromiseWithCancel","observable","cancel","timeoutInMs","subscription","Error","enterZone","zone","source","rxjs__WEBPACK_IMPORTED_MODULE_1__","complete","setObservableTimeout","NgDestoryBase","rxjs__WEBPACK_IMPORTED_MODULE_2__","ApiInterceptor","loggerService","storage","req","isB2cApi","handle","_angular_common_http__WEBPACK_IMPORTED_MODULE_5__","setItem","src_app_modules_auth_services_regobs_auth_service__WEBPACK_IMPORTED_MODULE_2__","JSON","stringify","body","isRegObsApi","headers","has","addAuthHeader","requestWithAuthHeader","handleResponseError","request","loggedInUser$","rxjs__WEBPACK_IMPORTED_MODULE_8__","set","token","clone","status","refreshToken","_angular_core__WEBPACK_IMPORTED_MODULE_11__","SummaryType","TopoMap","AppVersionService","version","buildNumber","revision","branch","date","Date","toISOString","BackgroundDownloadService","HttpClientDownloadService","get","reportProgress","observe","previous","isHttpProgressEvent","progress","total","content","isHttpResponse","_angular_common_http__WEBPACK_IMPORTED_MODULE_1__","BackgroundGeolocationNativeService","tripLogger","translateService","geolocation","backgroundGeolocation","BackgroundGeolocation","translations","Geolocation","BackgroundGeolocationWebService","BackgroundGeolocationService","DataMarshallService","warningService","observationService","kdvService","helpTextService","registrationService","tripLoggerService","cancelUpdateObservationsSubject","rxjs__WEBPACK_IMPORTED_MODULE_13__","asObservable","runOutsideAngular","subscriptions","hasDaysBackChangedToLargerValue","updateObservations","appModeAndLanguage$","updateKdvElements","updateHelpTexts","appModeLanguageAndCurrentGeoHazard$","langKey","geoHazards","trackDimension","_modules_analytics_enums_app_custom_dimension_enum__WEBPACK_IMPORTED_MODULE_11__","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_15__","gh","updateWarnings","consentForSendingAnalytics","consent","enable","disable","showMapCenter$","showMapCenter","topoMap","supportTiles$","st","enabled","name","supportMap","setUser","pause","stopForegroundUpdate","resume","startForegroundUpdate","unsubscribeAll","cancelObservationsPromise","currentGeoHazard$","currentGeoHazard","daysBack$","find","daysBack","prev","foregroundUpdateInterval","setInterval","backgroundFetchUpdate","_settings__WEBPACK_IMPORTED_MODULE_5__","useTimeout","cancelTimer","_helpers_cancel_promise_timer__WEBPACK_IMPORTED_MODULE_3__","syncRegistrations","cancelPromiseForObservations","race","cleanupOldLegacyTrip","_angular_core__WEBPACK_IMPORTED_MODULE_22__","DEBUG_CONTEXT","DbHelperService","sqlite","config","Object","androidDatabaseProvider","sqliteobj","executeSql","log","_modules_shared_services_logging_log_level_model__WEBPACK_IMPORTED_MODULE_6__","table","idColumn","getItemByIdSqlLite","fallbackGetItemById","onError","_nanosql__WEBPACK_IMPORTED_MODULE_5__","select","sqlResult","rows","jsonString","item","parse","nanoSqlResult","idSelector","rebuildIndexes","fastInsertSqlLite","fastInsertNanoSql","_idSelector","_data","statements","sqlBatch","rawImport","_angular_core__WEBPACK_IMPORTED_MODULE_8__","VALID_URL_PROTOCOLS","SAFARI_TINT_COLOR","SAFARI_BAR_COLOR","SAFARI_TOOLBAR_COLOR","SAFARI_CONTROL_TINT_COLOR","ExternalLinkService","inAppBrowser","safariViewController","validatedUrl","ensureCorrectUrl","openExternalLinkFallback","isAvailable","available","show","tintColor","barColor","toolbarColor","controlTintColor","_modules_shared_services_logging_log_level_model__WEBPACK_IMPORTED_MODULE_3__","validProtocol","toLowerCase","_angular_core__WEBPACK_IMPORTED_MODULE_5__","FullscreenService","_subject","isFullscreen$","isFullscreen","_capacitor_status_bar__WEBPACK_IMPORTED_MODULE_0__","value","_helpers_observable_helper__WEBPACK_IMPORTED_MODULE_1__","_angular_core__WEBPACK_IMPORTED_MODULE_7__","GeoPositionErrorCode","GeoPositionService","deviceOrientation","alertController","rxjs__WEBPACK_IMPORTED_MODULE_9__","startGeolocationTrackingSubscription","currentPosition","cp","currentHeading","gpsPositionLog","stopSubscriptions","anyComponentsTracking","trackingComponents","getPlatformIsActiveObservable","platformIsActive","activate","startSubscriptions","message","code","_geo_position_error_enum__WEBPACK_IMPORTED_MODULE_4__","highAccuracyEnabled","timestamp","moment__WEBPACK_IMPORTED_MODULE_5___default","unix","pos","geopos","getTimestamp","forcePermissionDialog","checkPermissions","valid","createPositionError","getTrackingComponentsExcludeByName","startWatchingPosition","startWatchingHeading","stopWatchingHeading","stopWatchingPosition","watchPositionCallbackId","addStatusToGpsPositionLog","_capacitor_geolocation__WEBPACK_IMPORTED_MODULE_0__","watchPositionCallback","createGpsPositionLogElement","isValidPosition","heading","currentPermissions","authorized","showPermissionDeniedError","newPermissionsAfterRequest","buttons","alert","headingSubscription","closed","isIos","getHeadingNative","getWebHeadingObservable","validateAndSetHeading","watchHeading","magneticHeading","appleHeading","webkitCompassHeading","getAbsoluteHeading","alpha","absolute","isValidHeading","_angular_core__WEBPACK_IMPORTED_MODULE_20__","HelperService","distanceInMeter","numDecimals","minimumFractionDigits","maximumFractionDigits","toLocaleString","showMilliseconds","milliseconds","floor","seconds","minutes","hours","bytes","fractionDigits","si","thresh","abs","units","u","KdvService","kdvApiService","dataLoadService","_kdvElements$","getKdvElementsObservable","checkLastUpdatedAndUpdateDataIfNeeded","language","_nanosql__WEBPACK_IMPORTED_MODULE_2__","getState","getDataLoadId","dataLoad","isLoadingTimeout","moment__WEBPACK_IMPORTED_MODULE_4___default","subtract","isLoading","startedDate","isAfter","lastUpdateLimit","lastUpdated","isBefore","updateKdvElementsForLanguage","dataLoadId","startLoading","KdvElementsGetKdvs","langkey","kdvElements","loadingCompleted","loadingError","key","kdvElements$","KdvRepositories","ViewRepositories","language$","getKdvElementsFromDbAsStream","_helpers_nano_sql_NSqlFullUpdateObservable__WEBPACK_IMPORTED_MODULE_7__","where","listen","getDefaultKdvElements","langKeyName","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_14__","defaultKdvElements","_angular_core__WEBPACK_IMPORTED_MODULE_15__","ObservationService","searchService","latestObservations","rxjs__WEBPACK_IMPORTED_MODULE_11__","_observationsObservable","getObservationsAsObservable","_dataLoadObservable","getDataLoadObservable","cancelled","_nanosql__WEBPACK_IMPORTED_MODULE_3__","moment__WEBPACK_IMPORTED_MODULE_1___default","getDaysBackToFetchAsDate","fromDate","itemsFromDate","updateObservationsForGeoHazard","getStateAsObservable","toDate","getObservationsDaysBack","startOf","isCanceled","SearchSearch","FromDtObsTime","SelectedGeoHazards","NumberOfRecords","LangKey","TimeZone","format","searchResult","updateLatestObservations","saveAndClenupOfflineObservations","_modules_shared_services_logging_log_level_model__WEBPACK_IMPORTED_MODULE_9__","observations","latestObs","getValue","getGeoHazardKeyFull","instanceName","now","fastInsert","getTime","deleteObservationNoLongerInResult","deleteResult","deleteOldObservations","pageNr","numberOfRecords","Offset","ObserverGuid","regId","currentGeoHazards","getRegistrationByRegIdFromApi","daysBackForCurrentGeoHazard","observationDaysBack","setting","items","isSameOrAfter","getMaxDaysBackForGeoHazard","deleteOldRecordsFrom","geoHazardString","getGeoHazardKey","y","localeCompare","getDistinctUserSettingsToChangeObservations","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_19__","getUserSettingsObservableDistinctToChangeObservations","filteredObservations","observationByParameterFilter","getObservationDaysBackAsDate","getObservationsByParametersAsObservable","dateString","observerGuid","_helpers_nano_sql_NSqlFullUpdateObservable__WEBPACK_IMPORTED_MODULE_10__","getObservationsByParametersQuery","debounce","unique","compareFn","a","b","isDifferent","sort","diff","rowsA","rowsB","getUniqueObservations","DtChangeTime","uniqueObservation","count","_angular_core__WEBPACK_IMPORTED_MODULE_23__","OfflineImageService","getOfflineAssetFromDb","offlineAsset","updateLastAccess","lastAccess","_nanosql__WEBPACK_IMPORTED_MODULE_0__","_helpers_data_url_helper__WEBPACK_IMPORTED_MODULE_6__","_modules_shared_services_logging_log_level_model__WEBPACK_IMPORTED_MODULE_5__","METADATA_FILE","ROOT_MAP_DIR","arrayBufferToBase64","binary","forEach","byte","fromCharCode","btoa","OfflineMapService","webView","backgroundDownloadService","helperService","packages","rxjs__WEBPACK_IMPORTED_MODULE_12__","finishedPackageIds","downloadAndUnzipProgress","_offline_tiles_registry__WEBPACK_IMPORTED_MODULE_9__","getMapPackages","packages$","getDeviceFreeDiskSpace","used","calculateTotalOfflinePackagesDiskspaceUsed","availableDiskspace","registerOfflineMapPackages","_capacitor_filesystem__WEBPACK_IMPORTED_MODULE_0__","getRootFileUrl","readdir","readDirResult","getFolderNameWithCompleteFiles","files","packageNames","all","getMetadata","mapPackages","offlineTilesRegistry","clear","mapPackage","add","reduce","pv","cv","downloadComplete","folders","folder","hasCompleteFile","packageName","packageMetadataCombined","checkAvailableDiskSpace","availableSpace","isPermissionToSaveFilesDenied","createOfflineMapPackage","downloadSubscription","startDownloadNextItemInQueue","permissionStatus","publicStorage","permissionStatusAfterRequest","nextInQueue","step","_progress_step_model__WEBPACK_IMPORTED_MODULE_10__","onProgress","percentage","startDownloadPackage","offlineMapPackage","parts","compoundPackageMetadata","getParts","downloadAndUnzipPart","removePackageFromDownloadAndProgress","onCancelled","_a","part","partNumber","download","downloadProgress","reportDownloadProgress","handleUnzip","onUnzipOrDownloadError","totalParts","root","unzipFile","onUnzipStepComplete","calculateTotalProgress","currentProgress","currentPart","partOfStep","stepsForEachPart","totalPartsOfWork","currentPartOfWork","progressForTotalParts","nextPart","onDownloadAndUnzipComplete","getNeededDiskSpaceForPackage","neededSpace","humanReadableByteSize","_modules_shared_services_logging_log_level_model__WEBPACK_IMPORTED_MODULE_4__","showNotEnoughDiskSpaceAvailableErrorMessage","compressionFactor","neededSpaceForCurrentPackage","getSizeInMiB","getNeededSpaceForItemsInQueue","neededSpaceForItemsInQueue","downloadAndUnzipProgress$","text","isDownloading","messageKey","externalStorage","DiskSpacePlugin","_b","info","success","free","newPackage","packageNameToRemove","deleteDirectory","getCompleteFileUrl","encoding","fileContent","fileStat","mtime","niceError","stack","uri","getMapPackageFileUrl","filenames","filename","readCompleteFile","completeFile","maps","getMapsInPackageFolder","metadataPath","readFileResult","metadata","convertFileSrc","getName","downloadStart","moment__WEBPACK_IMPORTED_MODULE_3___default","zipFile","onComplete","zip","jszip__WEBPACK_IMPORTED_MODULE_2___default","loadAsync","createFolders","zipEntries","keys","dir","mod","fileName","zippedFile","async","fileNameWithPath","writeFile","file","arrayBuffer","done","numAttemptsLeft","recursive","noMoreAttemptsError","unzipProgress","errorMessageKey","resetCancelAndStartNextItemInQueue","showDownloadOrUnzipErrorMessage","secondsSpent","rate","addMapPackage","removeMapPackageByName","rootFileUrl","getDataDirectory","dataDirectory","directory","includes","uriResult","endsWith","slice","dirName","folderUrl","OfflineTilesRegistry","Map","registry","mapType","registryForMapType","registryKey","getKey","rootTile","z","zMin","zMax","lowestRootTileZ","highestRootTileZ","highestZmax","packageInfo","findRegisteredPackage","_x","_y","_z","rootTileInfo","ProgressStep","PopupInfoService","delayMs","checkInfoPopup","limitMs","lastTimestamp","showWhenNull","limit","okText","headerKey","okKey","timestampType","timestampName","saveUserSettings","msg","ok_txt","refreshTimeMs","_settings__WEBPACK_IMPORTED_MODULE_2__","us","checkLastTimestamp","geAlertTranslations","showAlert","saveInfoAboutRecievedTimestamp","_angular_core__WEBPACK_IMPORTED_MODULE_10__","FLAG_ACTIVITY_CLEAR_TOP","ShortcutService","geoHelperService","w","plugins","Shortcuts","initAndroidShortcusts","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_3__","getAllGeoHazards","geoHazardsKeys","getTranslationKeys","getLongLabelTranslation","geoHazardName","getShortLabel","shortLabel","getTranslationKey","longLabel","iconFromResource","getImage","supportsDynamic","supported","getShortcuts","shortcuts","shortcutsFull","intent","action","flags","setDynamic","_modules_shared_services_logging_log_level_model__WEBPACK_IMPORTED_MODULE_1__","SwipeBackService","TripLoggerService","tripService","toastController","rxjs__WEBPACK_IMPORTED_MODULE_6__","getLegacyTripFromDbByAppMode","legacyTrip","tripStartedSubject","_nanosql__WEBPACK_IMPORTED_MODULE_1__","_helpers_nano_sql_NSqlFullUpdateObservable__WEBPACK_IMPORTED_MODULE_5__","moment__WEBPACK_IMPORTED_MODULE_0___default","orderBy","ta","tripDto","TripPost","infoMessage","showConfirm","confirmStopTrip","callStopLegacyTripApiAndDeleteFromDb","role","cssClass","handler","getLegacyTripAsObservable","trip","TripPut","DeviceGuid","deleteLegacyTripsFromDb","showTripErrorMessage","started","presentToast","mode","toast","_angular_core__WEBPACK_IMPORTED_MODULE_17__","UserSettingService","translate","rxjs__WEBPACK_IMPORTED_MODULE_14__","userSettingInMemory","getUserSettingsFromDbOrDefaultSettings","fast_deep_equal__WEBPACK_IMPORTED_MODULE_4___default","showObservations$","showObservations","getSupportTilesOptions","createLanguageChangeListener","createSaveToDbOnChangeListener","lang","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_23__","_angular_common_locales_nb__WEBPACK_IMPORTED_MODULE_8___default","_angular_common_locales_en__WEBPACK_IMPORTED_MODULE_10___default","_angular_common_locales_de__WEBPACK_IMPORTED_MODULE_11___default","_angular_common_locales_sv__WEBPACK_IMPORTED_MODULE_9___default","_angular_common_locales_sl__WEBPACK_IMPORTED_MODULE_12___default","_angular_common_locales_nn__WEBPACK_IMPORTED_MODULE_13___default","use","saveUserSettingsToDb","flat","supportTilesForCurrentGeoHazard","geoHazardId","tile","usSupportTile","supportTiles","usTiles","subTile","getUserSettingsFromDb","_helpers_observable_helper__WEBPACK_IMPORTED_MODULE_5__","_angular_core__WEBPACK_IMPORTED_MODULE_30__","DEFAULT_USER_SETTINGS","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_2__","tilesCacheSizev2","emailReceipt","_models_topo_map_enum__WEBPACK_IMPORTED_MODULE_1__","showGeoSelectInfo","useRetinaMap","consentForSendingAnalyticsDialogCompleted","featureToggeGpsDebug","featureToggleDeveloperMode","WarningGroup","group","_warningGroup","groupId","regionId","groupName","regionName","warnings","regionType","counties","validFrom","validTo","sortOrder","warningsForDay","isBetween","v","warningLevel","daysToAdd","day","getMomentAtNoon","getWarningForDay","daysAhead","getMaxWarning","hasWarning","dayWarning","getDayWarning","emergencyWarning","WarningService","httpClient","mapService","nativeHttp","latestWarnings","rxjs__WEBPACK_IMPORTED_MODULE_15__","_warningsObservable","getWarningsForCurrentLanguageAsObservable","_warningsForCurrentGeoHazardObservable","getWarningsForCurrentLanguageAndCurrentGeoHazard","_warningGroupInMapViewObservable","getWarningsForCurrentMapViewAsObservable","_nanosql__WEBPACK_IMPORTED_MODULE_4__","getLatestWarningKey","getSupportedLanguage","currentValue","getGeoHazardsToUpdate","updateWarningsForGeoHazard","getFavouritesAsObservable","favourites","favouriteGeoHazards","acc","current","Array","from","Set","moment__WEBPACK_IMPORTED_MODULE_2___default","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_18__","updateAvalancheWarnings","updateIceWarnings","updateFloodAndLandslideWarnings","g","_helpers_nano_sql_NSqlFullUpdateObservable__WEBPACK_IMPORTED_MODULE_14__","warningGroups","wg","getDefaultWarningGroups","__","getLatestWarningsOrFallbackToOffline","concat","getOfflineWarningsAsObservable","getDefaultAvalancheWarningGroups","getDefaultIceWarningGroups","getCountyWarningGroups","iceRegionsDefaultJson","getDefaultIceForecastRegions","regionGroups","forecastRegions","region","regions","Id","Name","convertCoutyToSortOrder","countyId","countyNr","regionFixedCountyNr","avalancheRegions","properties","omradeID","omradeNavn","sortID","getWarningsAsObservable","mapAndSort","waringGroup","_warning_group_model__WEBPACK_IMPORTED_MODULE_5__","mapViewAndAreaObservable$","mapViewArea","getWarningsForCurrentMapView","warningGroup","arr","groupIsInRegion","regionInCenter","regionsInViewBounds","regionsInViewBuffer","warningsForCurrentGeoHazardObservable$","center","isGroupInMapCenter","viewBounds","isGroupInViewBounds","isGroupInViewBuffer","cancelPromise","dateRange","getDefaultDateRange","to","warningsresult","aggregateWarningRegions","updateLatestWarnings","saveWarningResultsToDb","existing","newWarning","publishTime","isSame","regionMap","CountyList","collection","dayWarningMap","warning","subRegionMap","subRegionId","shouldReplaceWarning","getWarningByDay","getMostRelevantDayWarning","warningsForSubRegions","getMostRelevantWarningForSubRegion","warningsForSubRegionsArray","getWarningByRegions","filterWarningsForGroup","MunicipalityCsvString","mainText","MainText","getDate","ValidFrom","ValidTo","PublishTime","ActivityLevel","regionResult","deleteRegionsNoLongerInResult","_modules_shared_services_logging_log_level_model__WEBPACK_IMPORTED_MODULE_13__","supportedLang","moment__WEBPACK_IMPORTED_MODULE_2__","TypeName","AvalancheWarningList","simpleWarning","convertSimpleWarningToAppWarning","DangerLevel","EmergencyWarning","ids","r","dbItem","getIceWarningsFromApi","getIceWarningsFromApiNative","setDataSerializer","trim","apiUrl","fromMoment","toMoment","endOf","initTranslateService","addLangs","l","setDefaultLang","AnalyticsModule","ngModule","_services_analytic_service__WEBPACK_IMPORTED_MODULE_0__","initializeAnalyticService","AppCustomDimension","AppEventAction","AppEventCategory","AnalyticService","injector","appVersionService","_angular_router__WEBPACK_IMPORTED_MODULE_6__","ga","safeUrl","dimension","eventCategory","eventAction","eventLabel","eventValue","_environments_environment__WEBPACK_IMPORTED_MODULE_3__","_modules_shared_services_logging_log_level_model__WEBPACK_IMPORTED_MODULE_2__","localStorage","clientId","getItem","tracker","appVersion","getAppVersion","startTrackingPageViews","urlAfterRedirects","trackView","AuthCallbackPageModule","AuthRoutingModule","AuthModule","_openid_appauth__WEBPACK_IMPORTED_MODULE_0__","_factories_storage_factory__WEBPACK_IMPORTED_MODULE_5__","_ionic_angular__WEBPACK_IMPORTED_MODULE_9__","_factories_http_factory__WEBPACK_IMPORTED_MODULE_4__","_angular_common_http__WEBPACK_IMPORTED_MODULE_10__","ionic_appauth__WEBPACK_IMPORTED_MODULE_2__","ionic_appauth_lib_capacitor__WEBPACK_IMPORTED_MODULE_7__","_factories_auth_factory__WEBPACK_IMPORTED_MODULE_3__","_core_services_user_setting_user_setting_service__WEBPACK_IMPORTED_MODULE_6__","_angular_common__WEBPACK_IMPORTED_MODULE_11__","_auth_routing_module__WEBPACK_IMPORTED_MODULE_1__","AUTH_CALLBACK_PATH","authFactory","requestor","browser","_services_regobs_auth_service_override__WEBPACK_IMPORTED_MODULE_1__","authConfig","origin","redirect_url","end_session_redirect_url","httpFactory","_ng_http_service__WEBPACK_IMPORTED_MODULE_0__","storageFactory","NgHttpService","settings","method","getHeaders","post","put","httpHeaders","append","RegobsAuthServiceOverride","ionic_appauth__WEBPACK_IMPORTED_MODULE_1__","codeVerifier","_super","requestAccessToken","call","error_description","notifyActionListers","requestTokenRefresh","clearTokensIfRefreshTokenIsExpired","tokenResponseFullString","tokenResponseFull","_token_response_full__WEBPACK_IMPORTED_MODULE_3__","isRefreshTokenValid","removeItem","RETURN_URL_KEY","TOKEN_RESPONSE_KEY","TOKEN_RESPONSE_FULL_KEY","RegobsAuthService","logger","navCtrl","accountService","accountApi","rxjs__WEBPACK_IMPORTED_MODULE_5__","initComplete$","isComplete","createLoggedInUser$","events$","ionic_appauth__WEBPACK_IMPORTED_MODULE_0__","showErrorMessage","redirectToReturnUrl","checkAndSetNickIfNickIsNull","logout","myPageData$","AccountGetMyPageData","initRefreshTokenOnStartup","_isLoggingInSubject","tokenWithClaims$","createTokenWithClaims$","tokenResponseWithClaims","tokenResponse","issuedAt","issuedAtNice","gotToken","idToken","tokenIssuedAt","claims","_c","token$","parseJwt","isTokenOlderThan","ageInSeconds","setReturnUrl","ui_locales","getSupportedLoginLocales","prompt","endSessionCallback","AccountGetObserver","Nick","showSetNickDialog","nick","AccountUpdateObserver","headerTextKey","messageTextKey","okTextKey","backdropDismiss","onDidDismiss","values","returnUrl","replaceState","serializeUrl","navigateRoot","messageText","extraMessage","base64Url","jsonPayload","decodeURIComponent","c","AUTH_EXPIRY_BUFFER","TokenResponseFull","refresh_token_expires_in","refreshTokenExpiresIn","expiresIn","AttachmentMetaSchema","title","keyCompression","primary","RegistrationTID","ref","fileSize","AttachmentId","AttachmentUploadId","Photographer","Copyright","Aspect","AttachmentMimeType","IsMainAttachment","GenericSchema","RegistrationSyncProgressSchema","recordsLeft","uniqueItems","totalRecords","startedTimestamp","errors","RegistrationSchema","changed","syncStatus","lastSync","syncError","syncStatusCode","changedRegistrationTid","attachments","encrypted","UploadProgressSchema","totalBytes","getBlobFromUrl","getAllAttachments","registrationTid","_registration_models__WEBPACK_IMPORTED_MODULE_1__","getAllAttachmentsFromResponse","getAllAttachmentsFromRequest","getAttachmentsFromRegistrationViewModel","viewModel","getDamageObsAttachments","getWaterLevelAttachments","WaterLevel2","WaterLevelMeasurement","getAllAttachmentsFromViewModel","damageObsAttachments","waterLevelAttachmetns","deleteExistingAttachmentById","attachmentId","wlm","editExistingAttachmentById","model","assign","getPropertyName","_models_registration_tid_enum__WEBPACK_IMPORTED_MODULE_0__","getRegistationPropertyForModel","regModel","getRegistationProperty","getRegistrationTids","isObservationModelEmptyForRegistrationTid","isObservationEmptyForRegistrationTid","hasAnyObservations","registrationTids","isArrayType","tid","getRegistrationTidsForGeoHazard","commonTypes","geoHazardValidTypes","getOrCreateNewRegistrationForm","RegistrationTid","SummaryKind","TextSummary","_summary_kind_enum__WEBPACK_IMPORTED_MODULE_0__","_header","_value","UrlSummary","ensureValidUrl","validProtocols","vp","toLocaleLowerCase","pIndex","SyncStatus","FOR_ROOT_OPTIONS_TOKEN","SUMMARY_PROVIDER_TOKEN","KdvDescriptionPipe","kdvKey","returnDescription","getKdvRepositoryByKeyObservable","kdvelements","kdvelement","Description","pure","offlineDbServiceOptionsFactory","offlineDbServiceOptions","_services_offline_db_offline_db_service_options__WEBPACK_IMPORTED_MODULE_2__","getFakeKdvElementsService","fakeService","getFakeHelpTextApiService","HelptextGet","_ngx_translate_http_loader__WEBPACK_IMPORTED_MODULE_11__","translateModuleForRoot","_ngx_translate_core__WEBPACK_IMPORTED_MODULE_12__","loader","_angular_common_http__WEBPACK_IMPORTED_MODULE_13__","providers","_module_options__WEBPACK_IMPORTED_MODULE_8__","useValue","_services_item_sync_callback_regobs_api_sync_callback_service__WEBPACK_IMPORTED_MODULE_1__","_services_summary_providers_general_observation_general_observation_summary_provider__WEBPACK_IMPORTED_MODULE_3__","_services_summary_providers_snow_weather_weather_summary_provider__WEBPACK_IMPORTED_MODULE_5__","ngx_connectivity__WEBPACK_IMPORTED_MODULE_14__","_services_add_new_attachment_new_attachment_service__WEBPACK_IMPORTED_MODULE_4__","_services_add_new_attachment_file_attachment_service__WEBPACK_IMPORTED_MODULE_9__","_services_add_new_attachment_offline_db_new_attachment_service__WEBPACK_IMPORTED_MODULE_7__","forRoot","_services_item_sync_callback_fake_item_sync_callback_service__WEBPACK_IMPORTED_MODULE_0__","_varsom_regobs_common_regobs_api__WEBPACK_IMPORTED_MODULE_15__","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_17__","_registration_pipes__WEBPACK_IMPORTED_MODULE_6__","PIPES","_pipes_kdvDescription_pipe__WEBPACK_IMPORTED_MODULE_0__","RegobsRegistrationPipesModule","ROOT_DIR","FileAttachmentService","attachmentsChanged","registrationId","getRootPath","rootDir","createDir","attachmentFileName","getFileExtension","saveAttachmentMeta$","meta","getAttachmentsFromFile","getBlobInternal","removeAttachmentInternal","removeAttachment$","removeDir","removeAttachments","fileUrl","dataFolder","getDataDirectoryFileUrl","hasCreatedRootFolder","directoryForRegistrationExists","listDir","entries","entry","isFile","readMetadataFile","readAsText","readAsArrayBuffer","rootPath","metadataFileName","getMetadataFileName","removeFile","remainingEntries","checkDir","_angular_core__WEBPACK_IMPORTED_MODULE_9__","NewAttachmentService","OfflineDbNewAttachmentService","offlineDbService","appModeService","getRegistrationOfflineDocumentById","doc","putAttachment","rxjs__WEBPACK_IMPORTED_MODULE_7__","getAnyChangesToMetaData$","allAttachments","getAttachmentMetaFromDocument","getAttachmentMetaDbCollectionForAppMode","$","getAttachments","getAttachment","getData","getRegistrationAttachmentDocument","remove","getAttachmentMetaDocument","metaDoc","regDoc","getAttachmentMetaDocumentsFromRegistrationDocument","metaDocs","getRegistrationDbCollectionForAppMode","atomicUpsert","toJSON","attachmentMetaDocs","mdoc","findByIds$","attachmentMetaData","dbCollection","getAttachmentMetaDbCollection","getDbCollection","_offline_db_offline_db_service__WEBPACK_IMPORTED_MODULE_0__","getRegistrationsDbCollection","_angular_core__WEBPACK_IMPORTED_MODULE_14__","API_SYNCE_OFFLINE_BASE_SERVICE_OPTIONS_CONFIG","ApiSyncOfflineBaseService","languageService","data$","getDataObservable","isUpdatingSubject","getUpdatedDataAndSaveResultIfSuccess","metaData","getInvalidTime","validSeconds","getOfflineDataAndReturnIfDataIsUpToDate","updatedData","getUpdatedDataAndSaveResultIfSuccessOrFallbackToAssetsFolder","getOfflineData","offlineMeta","isValid","warn","getOfflineDataOrFallbackToAssets","getUpdatedData","saveDataToOfflineDb","getOfflineStorageDbKey","db","getTableName","useLangKeyAsDbKey","offlineTableKey","getFallbackData","VALID_HELP_TEXT_SECONDS","HELP_TEXTS_ASSETS_FOLDER","HelpTextService","helpTextApiService","helptexts","helpText","Text","getHelpTextObservable","_api_sync_offline_base_api_sync_offline_base_service__WEBPACK_IMPORTED_MODULE_1__","_angular_core__WEBPACK_IMPORTED_MODULE_6__","FakeItemSyncCallbackService","createRandomDelay","random","ItemSyncCallbackService","RegobsApiSyncCallbackService","regobsApiRegistrationService","apiAttachmentService","newAttachmentService","progressService","RegistrationDelete","ignoreVersionCheck","insertOrUpdate","uploadAttachments","uploadAttachmentResult","uploadSuccess","attachmentStatusCode","clonedItem","clone_deep__WEBPACK_IMPORTED_MODULE_2___default","setRequestAttachments","callInsertOrUpdate","removeAllNewAttachments","statusCode","errorMsg","getErrorModelStateMessageOrErrorMsg","uploadedAttachments","uploadedAttachment","addUploadedAttachmentToRequest","RegistrationInsertOrUpdate","registration","externalReferenceId","RegistrationInsert","removeAttachments$","getAttachmentsToUpload","attachmentsToUpload","uploadAttachmentAndSetAttachmentUploadId","attachmentUpload","getBlob","uploadAttachmentWithProgress","uploadId","attachmentUploadEditModel","addWaterLevelAttachment","addDamageObsAttachment","predicate","measurement","attachmentPostPath","rootUrl","_varsom_regobs_common_regobs_api__WEBPACK_IMPORTED_MODULE_9__","formData","FormData","_angular_common_http__WEBPACK_IMPORTED_MODULE_11__","setAttachmentProgress","ok","statusText","_angular_core__WEBPACK_IMPORTED_MODULE_13__","KDV_ASSETS_FOLDER","kdvElementsService","OfflineDbServiceOptions","TABLE_NAMES","REGISTRATION","KDV_ELEMENTS","HELP_TEXTS","ATTACHMENT_META","REGISTRATION_SYNC_PROGRESS","UPLOAD_PROGRESS","collections","schema","_db_schemas_registration_schema__WEBPACK_IMPORTED_MODULE_1__","instancePerAppMode","_db_schemas_generic_schema__WEBPACK_IMPORTED_MODULE_3__","_db_schemas_attachment_meta_schema__WEBPACK_IMPORTED_MODULE_4__","_db_schemas_registration_sync_progress_schema__WEBPACK_IMPORTED_MODULE_5__","_db_schemas_upload_progress_schema__WEBPACK_IMPORTED_MODULE_6__","loadRxDBPlugins","rxdb_plugins_local_documents__WEBPACK_IMPORTED_MODULE_8__","rxdb_plugins_attachments__WEBPACK_IMPORTED_MODULE_7__","rxdb_plugins_leader_election__WEBPACK_IMPORTED_MODULE_9__","OfflineDbService","dbInstance","waitForLeadership","tableName","getDbCollectionName","pouchSettings","revs_limit","ignoreDuplicate","getCollections","colData","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_13__","_angular_core__WEBPACK_IMPORTED_MODULE_12__","SYNC_PROGRESS_ID","ProgressService","registrationSyncProgress$","getRegistrationSyncProgressCollection","records","rec","convertToSyncProgress","fast_deep_equal__WEBPACK_IMPORTED_MODULE_2___default","recordId","getSyncProgressDocument","docJson","imageId","getUploadProgressCollection","findByIds","documents","estimatedTimeLeftMs","hasError","inProgress","itemsLeft","percentageComplete","percentageCompleteFormatted","getEmptySyncProgress","calculatePercentageComplete","calculateTimeLeftMs","startedMoment","ms","completed","msPerCompleted","SYNC_TIMER_TRIGGER_MS","SYNC_BUFFER_MS","RegistrationService","internetConnectivity","offlineRegistrationSyncService","fallbackSummaryProvider","registrationStorage$","getRegistrationObservable","initAutoSync","_models_sync_status_enum__WEBPACK_IMPORTED_MODULE_1__","saveRegistration","updateChangedTimestamp","saveAndSyncSingleRegistration","saveRegistrationToOfflineStorage","_registrationSyncSubscription","syncSingleRegistration","deleteItem","registrations","resultMap","resetSyncProgress","getAutoSyncObservable","draftsOnly","getDraftsForGeoHazardObservable","docs","regs","getAllRegistrations$","deleteRegistrationFromOfflineStorage","deleteAllRegistrationsFromOfflineStorage$","getRegistrationByIdShared$","regToEdit","clone_deep__WEBPACK_IMPORTED_MODULE_7___default","makeExistingRegistrationEditable","splice","deleteExistingAttachmentsForRegistrationType","saveAndSync","draft","registrationViewModel","createNewEmptyDraft","ExternalReferenceId","getRegistrationsToSyncObservable","resetProgressAndSyncItems","getAutosyncChangeTrigger","filterWhenProgressIsAllreadyRunning","networkOrTimerTrigger$","getNetworkOnlineObservable","hasRecords","flattenRegistrationsToSync","row","setSyncProgress","updateRowAndReturnItem","getRegistrationEditOrViewModel","isEmpty","hasAnyAttachmentsForRegistrationTid$","getAllAttachmentsForRegistrationTid$","getRegistrationTypesForGeoHazard","regTypes","regType","hasAnyDataToShowInRegistrationTypes","anyData","getSummaryForRegistrationTid","addIfEmpty","generateSummary","genericSummary","generateEmptySummary","getDraftSummary","getResponseSummaryForRegistrationTid","kdv","summary","getRegistrationName","registrationName","registrationTidsForGeoHazard","flatViewrepository$","getViewRepositoryByKeyObservable","parseViewRepositoryType","flattenRegistrationTypes","vr","types","t","subTypes","getRegistrationById","upsertLocal","saveRollbackState$","getLocal","rollbackChanges$","getAllAttachmentsForRegistration$","existingAttachments","newAttachments","getExistingAttachmentsForRegistrationTid$","getNewAttachmentsForRegistrationTid$","fast_deep_equal__WEBPACK_IMPORTED_MODULE_10___default","isOnline$","online","syncProgress","includeThrottle","shouldSync","isNotEmpty","notEmpty","hasRegistrationAnyAttachment$","shouldThrottle","msToNextSync","getMsUntilNextSync","lastSyncTimeUnixTimestamp","timeout","msSinceLastSync","syncRecord","syncItem","mapItemSyncCompleteStatusToRegistration","_angular_core__WEBPACK_IMPORTED_MODULE_34__","_module_options__WEBPACK_IMPORTED_MODULE_11__","BaseSummaryProvider","generateSummaryForType","registrationProp","registrationItem","generateTypeSpesificSummaries","createSummary","registrationKdvs","urls","translationKey","Kind","_models_summary_summary_kind_enum__WEBPACK_IMPORTED_MODULE_1__","KindType","Header","Value","_models_summary_url_summary__WEBPACK_IMPORTED_MODULE_0__","UrlDescription","UrlLine","headerTranslationKey","_models_summary_text_summary__WEBPACK_IMPORTED_MODULE_2__","translation","kdvElement","FallbackSummaryProvider","_reg","_registrationTid","_registrationName","generateGenericSummaries","getTextSummary","_base_summary_provider__WEBPACK_IMPORTED_MODULE_0__","_angular_core__WEBPACK_IMPORTED_MODULE_4__","GeneralObservationSummaryProvider","_registration_models__WEBPACK_IMPORTED_MODULE_0__","generateGeneralObservationSummaries","ObsComment","ObsHeader","Urls","getUrlSummary","_base_summary_provider__WEBPACK_IMPORTED_MODULE_1__","WeatherSummaryProvider","generateWeatherObservationSummaries","hasTID","PrecipitationTID","getKdvSummary","AirTemperature","WindDirection","WindSpeed","getWindDirectionValue","CloudCover","wdString$","getWindDirectionTranslationKey","wdString","windDirection","DataLoadService","totalItems","existingItem","completedDate","itemsComplete","errorMessage","saveDataLoadItem","itemsToDate","_core_helpers_nano_sql_NSqlFullUpdateObservable__WEBPACK_IMPORTED_MODULE_3__","GpsDebugComponent","geoPositionService","isOpen","isTracking","showLog$","log$","geoPositionLog","scrollToBottom","panel","local","_core_services_geo_position_geo_position_error_enum__WEBPACK_IMPORTED_MODULE_4__","GpsDebugModule","_shared_shared_module__WEBPACK_IMPORTED_MODULE_1__","_components_gps_debug_gps_debug_component__WEBPACK_IMPORTED_MODULE_0__","START_ICON","END_ICON","DAMAGE_ICON","MapImageComponent","maxZoom","minZoom","bounceAtZoomLimits","attributionControl","zoomControl","scrollWheelZoom","touchZoom","trackResize","iconUrl","iconAnchor","shadowUrl","shadowSize","mapCenterSubject","eachLayer","layer","addTileLayers","setView","setMarker","setStartStopLocation","setDamageLocations","allowZoom","tap","doubleClickZoom","dragging","keyboard","boxZoom","redrawMap","counter","invalidateSize","_core_helpers_leaflet_border_helper__WEBPACK_IMPORTED_MODULE_2__","updateWhenIdle","keepBuffer","_map_core_classes_regobs_geohazard_marker__WEBPACK_IMPORTED_MODULE_3__","interactive","getStartStopIcon","locations","getDamageIcon","ctx","MapImageModule","_angular_common__WEBPACK_IMPORTED_MODULE_3__","_angular_forms__WEBPACK_IMPORTED_MODULE_4__","_ionic_angular__WEBPACK_IMPORTED_MODULE_5__","_ngx_translate_core__WEBPACK_IMPORTED_MODULE_6__","_asymmetrik_ngx_leaflet__WEBPACK_IMPORTED_MODULE_1__","_map_image_component__WEBPACK_IMPORTED_MODULE_0__","LOCATION_INFO_REQUEST_TIMEOUT","requestCounter","MapCenterInfoComponent","mapSearchService","clipboard","currentPosition$","followMode$","newPos","followMode","userPos","relevantMapChangeWithInitialView$","newMapView","mapCenter","elevation","steepness","fetchNewLocationInfo","infoBoxElement","nativeElement","distanceTo","altitude","getDistanceText","mapView","loading","locationInfoRequest","getViewInfo","requestIndex","viewInfo","textToCopy","useNativeClipboardPlugin","copy","copyToClipBoardWeb","toastText","selBox","document","createElement","left","top","appendChild","focus","execCommand","removeChild","src_app_core_helpers_observable_helper__WEBPACK_IMPORTED_MODULE_5__","_r4","FullscreenToggleComponent","fullscreenService","toggleFullscreen","GpsCenterComponent","cdRef","centerMapToUser","MapControlsComponent","fullscreen$","showMapSearch","showFullscreenToggle","showGpsCenter","MapSearchComponent","_pages_modal_search_modal_search_page__WEBPACK_IMPORTED_MODULE_1__","keyboardClose","enterAnimation","_core_animations_custom_animation__WEBPACK_IMPORTED_MODULE_0__","leaveAnimation","isTopoLayer","mapId","_core_models_topo_map_enum__WEBPACK_IMPORTED_MODULE_8__","redrawLayersInLayerGroup","layerGroup","redraw","getNativeZoomOptions","detectRetina","minNativeZoom","maxNativeZoom","MapLayerZIndex","MapComponent","rxjs__WEBPACK_IMPORTED_MODULE_18__","offlineMapService","_core_services_offline_map_offline_map_service__WEBPACK_IMPORTED_MODULE_11__","_getMapPanePos","_mapPane","_rawPanBy","offset","maxBounds","maxBoundsViscosity","isActive","rxjs__WEBPACK_IMPORTED_MODULE_20__","autoActivate","mapView$","currentView","firstPositionUpdate","stopTrackingComponent","showScale","imperial","offlineTopoLayerGroup","offlineSupportMapLayerGroup","offlinePackageMode","on","getContainer","configureTileLayers","updateMapView","centerMapToUser$","startTrackingComponent","mapSearchClick$","disableFollowMode","latlng","flyTo","getPosition","firstClickOnZoomToUser","flyToMaxZoom","getZoom","onMapMove","onMapMoveEnd","showUserLocation","onPositionUpdate","currentHeading$","setHeading","startActiveSubscriptions","startInvalidateSizeMapTimer","initOfflineMaps","mapReady","createOfflineLayers","tileSize","nwPoint","scaleBy","sePoint","nw","unproject","se","clearLayers","enabledSupportMaps","offlinePackage","createTopoMapOfflineLayer","createSupportMapOfflineLayer","tileCoordsToBounds","nativeZoomOptions","zIndex","Top","OfflineBackgroundLayer","addLayer","OfflineSupportLayer","active","geoTag","sendMapMoveStart","isDoingMoveAction","getBounds","getCenter","getMaxZoom","edgeBufferTiles","setMaxZoom","createTileLayerFactory","getTileLayerFactory","createTileLayer","getTileLayerDefaultOptions","OnlineBackgroundLayer","supportMaps","OnlineSupportLayer","updateInterval","createSupportMapTileLayer","setOpacity","_core_classes_regobs_tile_layer__WEBPACK_IMPORTED_MODULE_9__","createNorwegianMixedMap","createStatensKartverk","createOpenTopoMap","createArcGisOnlineMap","createGeoDataLandskapMap","createArGisOnlineMixMap","OnlineMixedBackgroundLayer","excludeBounds","_core_helpers_leaflet_border_helper__WEBPACK_IMPORTED_MODULE_10__","timer","dispatchEvent","Event","_core_helpers_leaflet_user_marker_user_marker__WEBPACK_IMPORTED_MODULE_3__","updatePosition","usePan","animate","showSupportMaps","outputs","RegobsGeoHazardMarker","isSelected","getIconSvg","_selected","_geoHazard","selected","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_1__","getSnowSvg","getWaterSvg","getDirtSvg","getIceSvg","RegObsTileLayer","tileBounds","_core_helpers_leaflet_border_helper__WEBPACK_IMPORTED_MODULE_1__","RegObsOfflineAwareTileLayer","offlineTiles","canUseOfflineTiles","MapModule","_angular_common__WEBPACK_IMPORTED_MODULE_14__","_angular_forms__WEBPACK_IMPORTED_MODULE_15__","_ionic_angular__WEBPACK_IMPORTED_MODULE_16__","angular_svg_icon__WEBPACK_IMPORTED_MODULE_17__","_angular_router__WEBPACK_IMPORTED_MODULE_19__","ngx_leaflet_edgebuffer__WEBPACK_IMPORTED_MODULE_8__","_pages_modal_search_modal_search_module__WEBPACK_IMPORTED_MODULE_7__","_pages_modal_map_image_modal_map_image_module__WEBPACK_IMPORTED_MODULE_9__","_pages_support_map_info_support_map_info_module__WEBPACK_IMPORTED_MODULE_10__","_map_image_map_image_module__WEBPACK_IMPORTED_MODULE_11__","_shared_shared_module__WEBPACK_IMPORTED_MODULE_12__","_components_map_map_component__WEBPACK_IMPORTED_MODULE_0__","_components_map_controls_map_controls_component__WEBPACK_IMPORTED_MODULE_2__","_components_map_controls_map_search_map_search_component__WEBPACK_IMPORTED_MODULE_3__","_components_map_controls_fullscreen_toggle_fullscreen_toggle_component__WEBPACK_IMPORTED_MODULE_4__","_components_map_controls_gps_center_gps_center_component__WEBPACK_IMPORTED_MODULE_5__","_components_map_center_info_map_center_info_component__WEBPACK_IMPORTED_MODULE_6__","ModalMapImagePageModule","_angular_common__WEBPACK_IMPORTED_MODULE_4__","_angular_forms__WEBPACK_IMPORTED_MODULE_5__","_ionic_angular__WEBPACK_IMPORTED_MODULE_6__","_ngx_translate_core__WEBPACK_IMPORTED_MODULE_7__","_map_image_map_image_module__WEBPACK_IMPORTED_MODULE_2__","_modal_map_image_page__WEBPACK_IMPORTED_MODULE_0__","ModalMapImagePage","dismiss","ModalSearchPageModule","_modal_search_page__WEBPACK_IMPORTED_MODULE_0__","_pipes_starts_with_highlight_pipe__WEBPACK_IMPORTED_MODULE_1__","SWIPE_BOUNDRY","ModalSearchPage","renderer","domCtrl","searchField","_angular_forms__WEBPACK_IMPORTED_MODULE_6__","searchHistory$","getSearchHistoryAsObservable","searchTextObservable","valueChanges","searchResult$","hasResults","searchText","searchValue","searchAll","createGesture","validLatLng","isValidLatLng","mapSearchItemSelected","closeModal","getTop","modalTop","gesture","gestureName","direction","disableScroll","onMove","ev","onMoveHandler","onEnd","onPanend","separators","sep","isValidLatLngArray","trimmedLatString","trimAndReplaceString","trimmedLngString","_core_helpers_number_helper__WEBPACK_IMPORTED_MODULE_2__","leaflet__WEBPACK_IMPORTED_MODULE_1__","input","setFocus","width","offsetWidth","swipeOffset","deltaX","swipePercentage","setPageSwipeAttributes","write","setAttribute","setStyle","SupportMapInfoPageModule","_support_map_info_page__WEBPACK_IMPORTED_MODULE_0__","SupportMapInfoPage","StartsWithHighlightPipe","sanitizer","args","RegExp","bypassSecurityTrustHtml","MapSearchService","geoCodeService","_mapSearchItemClickSubject","_mapSearchItemClickObservable","saveSearchHistoryToDb","searchNorwegianPlaces","searchWorld","s1","s2","returSted","hits","totaltAntallTreff","resultList","navn","removeDuplicates","resp","skrivemåte","formatLocationDescription","navneobjekttype","representasjonspunkt","nord","øst","nameType","norwegian","county","fylker","fylkesnavn","kommuner","municipality","kommunenavn","stedsnummer","geoData","geonames","countryCode","fcodeName","adminName1","countryName","GeoCodeLocationInfo","adminName","WarningRegionName","AdminAreaName","Masl","Steepness","existingHistory","_core_helpers_nano_sql_NSqlFullUpdateObservable__WEBPACK_IMPORTED_MODULE_6__","_angular_core__WEBPACK_IMPORTED_MODULE_16__","MapService","_followModeSubject","_followModeObservable","_centerMapToUserSubject","_centerMapToUserObservable","_mapViewSubject","_mapView$","_relevantMapChange$","getMapViewThatHasRelevantChange","_mapMoveStartSubject","_mapMoveStart$","_mapViewAndAreaObservable","getMapViewAreaObservable","metersBuffer","getMapMetersChanged","triggerWhenMetersReached","currenteMapViewAndGeoHazards","relevantMapChange$","cvg","Worker","URL","CanDeactivateRouteGuard","canLeave","SaveAsDraftRouteGuard","nextState","isInWhitelist","src_app_modules_common_registration_registration_models__WEBPACK_IMPORTED_MODULE_1__","createAlert","save","whiteList","OverviewPageModule","SetTimePageModule","ObsLocationPageModule","GroupPageModule","GeneralCommentPageModule","WaterLevelPageModule","DamagePageModule","IceCoverPageModule","IceThicknessPageModule","LandslideObsPageModule","DangerObsPageModule","IncidentPageModule","AvalancheObsPageModule","AvalancheActivityPageModule","WeatherPageModule","SnowSurfacePageModule","SnowProfilePageModule","CompressionTestPageModule","AvalancheProblemPageModule","AvalancheEvaluationPageModule","RegistrationRoutingModule","_pages_can_deactivate_route_guard__WEBPACK_IMPORTED_MODULE_2__","_pages_save_as_draft_guard__WEBPACK_IMPORTED_MODULE_3__","_registration_routing_module__WEBPACK_IMPORTED_MODULE_0__","_varsom_regobs_common_regobs_api__WEBPACK_IMPORTED_MODULE_5__","helptextApiService","updateHelpTextsForLanguage","helpTexts","getHelpTexts","getHelpTextsFromDb","resultFromDb","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_9__","defaultHelptexts","commonRegistrationService","registrations$","drafts$","src_app_modules_common_registration_registration_models__WEBPACK_IMPORTED_MODULE_9__","clean","newId","AddMenuComponent","dateHelperService","geoHazardInfo$","showTrip","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_11__","drafts","convertDraftToDate","tripStarted$","isTripRunning$","formatDate","menuFab","close","closeAndNavigate","tripStarted","stopLegacyTrip","ExternalLinkComponent","preventDefault","ngContentSelectors","GEOHAZARD_TYPES","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_6__","GeoFabComponent","selectableGeoHazards$","animateOnEnter","animationTimout","animateOnEnterState","triggerOpenClose","isOpenChange","currentSettings","showLabels","_core_animations_custom_animation__WEBPACK_IMPORTED_MODULE_2__","optional","GeoIconComponent","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_0__","geoClass","useGeoColors","GeoNameComponent","name$","GeoSelectComponent","geoHazardTypes","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_4__","userSettings$","HeaderComponent","tripRunning","showMenuButton","fullscreenSupport","defaultHref","TRANSLATION_KEY_CANCEL","TRANSLATION_KEY_RESET","SelectComponent","actionSheetController","selectedValue","disabled","option","translatedText","setSelectedValue","showReset","resetTextTranslated","cancelTextTranslated","titleTextTranslated","subTitle","subTitleTextTranslated","getTitleTranslations","getActionSheetButtons","subHeader","actionSheet","selectedValueChange","OfflineImageComponent","_srcInternal","hasTriedFallback","tryFallbackImage","RefreshWithCancelComponent","spinner","cancelSubject","refreshFunc","getCancelPromise","showCancel","refresher","_ionic_angular__WEBPACK_IMPORTED_MODULE_4__","HeaderColorDirective","hostVars","hostBindings","ShadowCssDirective","shadow","shadowRoot","attachShadow","innerHTML","shadowCustomCss","AbsPipe","FormatDatePipe","showMonthNames","showYear","showTime","formatDateString","DateHelperService","currentTimeZone","timezone","dateAndMonth","monthNames","monthName","month","GeoHelperService","geoHazardKey","toUpperCase","k","ConsoleLoggingService","tag","optionalParams","_log_level_model__WEBPACK_IMPORTED_MODULE_0__","level","console","FileLoggingService","emailComposer","defaultConfig","LogProviderConfig","enableMetaLogging","logToConsole","logDateFormat","fileDateFormat","fileMaxLines","fileMaxSize","totalLogSize","baseDir","cacheDirectory","logDir","logPrefix","devMode","configuration","merge","debug_metaLog","fileLoggerReady","initFailed","initLogFile","createLogDir","cleanupFiles","cleanupCompleted","getOwnPropertyNames","lodash__WEBPACK_IMPORTED_MODULE_1__","calculated","sizeTotal","getFileSize","maxSizeExceeded","lastEntry","failure","lastEntrySize","shift","currentFile","fullPath","createNextFile","logMessage","queue","processing","doProcess","_log_level_model__WEBPACK_IMPORTED_MODULE_4__","logInternal","objects","processQueue","checkFileLength","lines","createLogFileName","createFile","newFile","getLogFiles","fileEntries","filePaths","toURL","src_settings__WEBPACK_IMPORTED_MODULE_3__","subject","isHtml","fields","f","LogLevel","LoggingService","SentryService","versionInfo","_log_level_model__WEBPACK_IMPORTED_MODULE_3__","_sentry_browser__WEBPACK_IMPORTED_MODULE_5__","dsn","_environments_environment__WEBPACK_IMPORTED_MODULE_2__","transport","_sentry_browser__WEBPACK_IMPORTED_MODULE_6__","environment","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_7__","release","dist","_sentry_browser__WEBPACK_IMPORTED_MODULE_8__","scope","category","removeOauthTokenFromUrl","src_app_modules_auth_factories_auth_factory__WEBPACK_IMPORTED_MODULE_0__","updateQueryStringParameter","paramKey","paramValue","re","match","SharedModule","_angular_common__WEBPACK_IMPORTED_MODULE_23__","_angular_forms__WEBPACK_IMPORTED_MODULE_24__","_ionic_angular__WEBPACK_IMPORTED_MODULE_25__","angular_svg_icon__WEBPACK_IMPORTED_MODULE_26__","_ngx_translate_core__WEBPACK_IMPORTED_MODULE_27__","_angular_router__WEBPACK_IMPORTED_MODULE_28__","_map_image_map_image_module__WEBPACK_IMPORTED_MODULE_18__","_auth_auth_module__WEBPACK_IMPORTED_MODULE_19__","ngx_virtual_scroller__WEBPACK_IMPORTED_MODULE_20__","_directives_shadow_css_shadow_css_directive__WEBPACK_IMPORTED_MODULE_10__","_components_add_menu_add_menu_component__WEBPACK_IMPORTED_MODULE_12__","_components_offline_image_offline_image_component__WEBPACK_IMPORTED_MODULE_16__","_components_external_link_external_link_component__WEBPACK_IMPORTED_MODULE_13__","_components_geo_icon_geo_icon_component__WEBPACK_IMPORTED_MODULE_11__","_components_geo_select_geo_select_component__WEBPACK_IMPORTED_MODULE_7__","_pipes_format_date_format_date_pipe__WEBPACK_IMPORTED_MODULE_8__","_components_observation_observation_list_card_observation_list_card_component__WEBPACK_IMPORTED_MODULE_0__","_components_observation_observation_skeleton_observation_skeleton_component__WEBPACK_IMPORTED_MODULE_3__","_components_img_swiper_img_swiper_component__WEBPACK_IMPORTED_MODULE_1__","_components_header_header_component__WEBPACK_IMPORTED_MODULE_15__","_components_refresh_with_cancel_refresh_with_cancel_component__WEBPACK_IMPORTED_MODULE_14__","_components_observation_summary_summary_component__WEBPACK_IMPORTED_MODULE_2__","_directives_header_color_header_color_directive__WEBPACK_IMPORTED_MODULE_9__","_components_input_select_select_component__WEBPACK_IMPORTED_MODULE_4__","_components_geo_fab_geo_fab_component__WEBPACK_IMPORTED_MODULE_5__","_components_geo_name_geo_name_component__WEBPACK_IMPORTED_MODULE_6__","_components_competence_competence_component__WEBPACK_IMPORTED_MODULE_17__","_pipes_abs_pipe__WEBPACK_IMPORTED_MODULE_21__","ObservationsDaysBackComponent","daysBackOptions","getDaysBackArray","selectedDaysBack","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_5__","existingValue","SideMenuComponent","_core_models_topo_map_enum__WEBPACK_IMPORTED_MODULE_4__","lastUpdateSubscription","getLastUpdatedForCurrentGeoHazardAsObservable","userSettingSubscription","offlineMapsAvailable","forceUpdateObservationsForCurrentGeoHazard","_pages_modal_pages_legal_terms_modal_legal_terms_modal_page__WEBPACK_IMPORTED_MODULE_3__","ClayzonesLegendComponent","FloodzonesLegendComponent","legendsConfig","_steepness_legend_steepness_legend_component__WEBPACK_IMPORTED_MODULE_0__","floodzoones","_floodzones_legend_floodzones_legend_component__WEBPACK_IMPORTED_MODULE_1__","clayzones","_clayzones_legend_clayzones_legend_component__WEBPACK_IMPORTED_MODULE_2__","weakenedice","_weakenedice_legend_weakenedice_legend_component__WEBPACK_IMPORTED_MODULE_3__","SteepnessCommonLegendComponent","_map_pages_support_map_info_support_map_info_page__WEBPACK_IMPORTED_MODULE_0__","modalInfoPage","SteepnessLegendComponent","supportTilesWithSubTiles$","SupportTileLegendLoaderComponent","componentFactoryResolver","loadComponent","_legends_config__WEBPACK_IMPORTED_MODULE_0__","componentFactory","resolveComponentFactory","viewContainerRef","createComponent","WeakenediceLegendComponent","SupportTilesMenuComponent","popupInfoService","subTileInstantiation","supportTile","onTileChanged","checkSupportMap","checker","checkSupportMapInfoPopup","condition","checkOfflineSupportMaps","checkMap","checked","onSubTileChanged","saveSettings","checkForInfoPopup","isChildActive","addOrUpdateSupportTileSettings","checkOfflineSupportMapInfoPopup","availableOffline","bind","currentSupportTileSettings","storeTile","_core_helpers_observable_helper__WEBPACK_IMPORTED_MODULE_1__","UpdateObservationsComponent","dataLoad$","cancelUpdateObservations","UserLoginComponent","regobsauthService","isLoggingIn$","isLoggingIn","SideMenuModule","_shared_shared_module__WEBPACK_IMPORTED_MODULE_5__","_components_side_menu_component__WEBPACK_IMPORTED_MODULE_0__","_components_support_tiles_menu_support_tiles_menu_component__WEBPACK_IMPORTED_MODULE_1__","_components_user_login_user_login_component__WEBPACK_IMPORTED_MODULE_2__","_components_observations_days_back_observations_days_back_component__WEBPACK_IMPORTED_MODULE_3__","_components_update_observations_update_observations_component__WEBPACK_IMPORTED_MODULE_4__","_components_support_tiles_menu_legends_support_tile_legend_loader_support_tile_legend_loader_component__WEBPACK_IMPORTED_MODULE_6__","_components_support_tiles_menu_legends_steepness_legend_steepness_legend_component__WEBPACK_IMPORTED_MODULE_7__","_components_support_tiles_menu_legends_floodzones_legend_floodzones_legend_component__WEBPACK_IMPORTED_MODULE_8__","_components_support_tiles_menu_legends_clayzones_legend_clayzones_legend_component__WEBPACK_IMPORTED_MODULE_9__","_components_support_tiles_menu_legends_weakenedice_legend_weakenedice_legend_component__WEBPACK_IMPORTED_MODULE_10__","_components_support_tiles_menu_legends_steepness_common_legend_steepness_common_legend_component__WEBPACK_IMPORTED_MODULE_11__","FullscreenImageModalPage","unlock","LegalTermsModalPageModule","_modules_shared_shared_module__WEBPACK_IMPORTED_MODULE_1__","_legal_terms_modal_page__WEBPACK_IMPORTED_MODULE_0__","_components_legal_terms_legal_terms_component__WEBPACK_IMPORTED_MODULE_2__","LegalTermsModalPage","production","_environments_environment__WEBPACK_IMPORTED_MODULE_1__","startApp","_angular_platform_browser__WEBPACK_IMPORTED_MODULE_5__","bootstrapModule","_app_app_module__WEBPACK_IMPORTED_MODULE_0__","addEventListener","cordova","NanoSql","tableDef","TABLES","tables","getTables","getInstanceName","indexes","dbName","dbMode","createDatabase","getTableModels","dependencies","filters","priority","inputArgs","res","tableConfig","resetTable","dropAndRecreateTable","deleteAllRowsInTable","OBSERVATION","pk","TRIP_LOG","TRIP_LOG_ACTIVITY","LEGACY_TRIP_LOG","WARNING","WARNING_FAVOURITE","OFFLINE_MAP","OFFLINE_MAP_TILES","OFFLINE_MAP_CACHE_SIZE","OFFLINE_ASSET","MAP_SEARCH_HISTORY","USER_SETTINGS","USER","DATA_LOAD","OBSERVER_GROUPS","TEST","client_id","server_host","scopes","pkce","getObserverUrl","myPageUrl","updateObserverUrl","DEMO","PROD","maxObservationsToFetch","Snow","Ice","Water","Dirt","timeZone","services","regObs","serviceUrl","webUrl","createUserUrl","passwordRecoveryUrl","changePasswordUrl","viewProfileUrl","apiJsonVersion","defaultWarningDaysAhead","summerMonths","dateFormat","nb","en","featureName","simpleStorage","nanoSql","tiles","cacheFolder","cacheSize","cacheSaveBufferThrottleTimeMs","cacheSaveBufferIdleInterval","tileImageFormat","embeddedUrl","defaultZoom","embeddedUrlMaxZoomWorld","embeddedUrlMaxZoomNorway","minZoomSupportMaps","zoomInPosition","zoomLevelObservationList","statensKartverkMapUrl","geoDataLandskapMapUrl","openTopoMapUrl","arcGisOnlineTopoMapUrl","supportTilesBounds","search","no","maxResults","exactFirst","coordinateSystem","resultFields","username","searchHistorySize","svalbard","bbox","mapSearchZoomToLevel","unknownMapCenter","flyToOnGpsZoom","maxClusterRadius","snowRegionsGeoJsonName","cordovaNotAvailable","gps","highAccuracyPositionOptions","enableHighAccuracy","maximumAge","Infinity","offlineAssetsFolder","dateFormats","angular","dateAndTime","moment","daysBeforeUpdate","images","quality","sentryDsn","errorEmailAddress","foregroundUpdateIntervalMs","backgroundFetchTimeout","popupDisclamerRefreshTimeMs","googleAnalytics","trackerId","anonymizeIp","fallbackLang","supportedLanguages","webpackAsyncContext","webpackContext"],"sources":["webpack:///$_lazy_route_resources|lazy|groupOptions:%20%7B%7D|namespace%20object","webpack:///src/app/app-routing.module.ts","webpack:///src/app/app.component.ts","webpack:///src/app/app.component.html","webpack:///src/app/app.module.ts","webpack:///src/app/app.providers.ts","webpack:///src/app/components/competence/competence.component.html","webpack:///src/app/components/competence/competence.component.ts","webpack:///src/app/components/img-swiper/img-swiper.component.html","webpack:///src/app/components/img-swiper/img-swiper.component.ts","webpack:///src/app/components/legal-terms/legal-terms.component.ts","webpack:///src/app/components/legal-terms/legal-terms.component.html","webpack:///src/app/components/observation/observation-list-card/observation-list-card.component.html","webpack:///src/app/components/observation/observation-list-card/observation-list-card.component.ts","webpack:///src/app/components/observation/observation-skeleton/observation-skeleton.component.ts","webpack:///src/app/components/observation/observation-skeleton/observation-skeleton.component.html","webpack:///src/app/components/observation/summary/summary.component.html","webpack:///src/app/components/observation/summary/summary.component.ts","webpack:///src/app/core/animations/custom.animation.ts","webpack:///src/app/core/app-init/deep-links-initializer.ts","webpack:///src/app/core/error-handler/error-handler.class.ts","webpack:///src/app/core/guards/auth.guard.ts","webpack:///src/app/core/guards/start-wizard.guard.ts","webpack:///src/app/core/helpers/cancel-promise-timer.ts","webpack:///src/app/core/helpers/competence-helper.ts","webpack:///src/app/core/helpers/data-url.helper.ts","webpack:///src/app/core/helpers/ionic/platform-helper.ts","webpack:///src/app/core/helpers/leaflet/border-helper.ts","webpack:///src/app/core/helpers/leaflet/user-marker/user-marker.ts","webpack:///src/app/core/helpers/nano-sql/NSqlFullUpdateObservable.ts","webpack:///src/app/core/helpers/number-helper.ts","webpack:///src/app/core/helpers/observable-helper.ts","webpack:///src/app/core/http-interceptor/ApiInterceptor.ts","webpack:///src/app/core/models/summmary-type.enum.ts","webpack:///src/app/core/models/topo-map.enum.ts","webpack:///src/app/core/services/app-version/app-version.service.ts","webpack:///src/app/core/services/background-download/background-download.service.ts","webpack:///src/app/core/services/background-download/http-client-download.service.ts","webpack:///src/app/core/services/background-geolocation/background-geolocation-native.service.ts","webpack:///src/app/core/services/background-geolocation/background-geolocation-web.service.ts","webpack:///src/app/core/services/background-geolocation/background-geolocation.service.ts","webpack:///src/app/core/services/data-marshall/data-marshall.service.ts","webpack:///src/app/core/services/db-helper/db-helper.service.ts","webpack:///src/app/core/services/external-link/external-link.service.ts","webpack:///src/app/core/services/fullscreen/fullscreen.service.ts","webpack:///src/app/core/services/geo-position/geo-position-error.enum.ts","webpack:///src/app/core/services/geo-position/geo-position.service.ts","webpack:///src/app/core/services/helpers/helper.service.ts","webpack:///src/app/core/services/kdv/kdv.service.ts","webpack:///src/app/core/services/observation/observation.service.ts","webpack:///src/app/core/services/offline-image/offline-image.service.ts","webpack:///src/app/core/services/offline-map/offline-map.service.ts","webpack:///src/app/core/services/offline-map/offline-tiles-registry.ts","webpack:///src/app/core/services/offline-map/progress-step.model.ts","webpack:///src/app/core/services/popup-info/popup-info.service.ts","webpack:///src/app/core/services/shortcut/shortcut.service.ts","webpack:///src/app/core/services/swipe-back/swipe-back.service.ts","webpack:///src/app/core/services/trip-logger/trip-logger.service.ts","webpack:///src/app/core/services/user-setting/user-setting.service.ts","webpack:///src/app/core/services/user-setting/user-settings.default.ts","webpack:///src/app/core/services/warning/warning-group.model.ts","webpack:///src/app/core/services/warning/warning.service.ts","webpack:///src/app/custom-translate.loader.ts","webpack:///src/app/modules/analytics/analytics.module.ts","webpack:///src/app/modules/analytics/enums/app-custom-dimension.enum.ts","webpack:///src/app/modules/analytics/enums/app-event-action.enum.ts","webpack:///src/app/modules/analytics/enums/app-event-category.enum.ts","webpack:///src/app/modules/analytics/services/analytic.service.ts","webpack:///src/app/modules/auth/auth-routing.module.ts","webpack:///src/app/modules/auth/auth.module.ts","webpack:///src/app/modules/auth/factories/auth-factory.ts","webpack:///src/app/modules/auth/factories/http-factory.ts","webpack:///src/app/modules/auth/factories/storage-factory.ts","webpack:///src/app/modules/auth/ng-http.service.ts","webpack:///src/app/modules/auth/services/regobs-auth-service-override.ts","webpack:///src/app/modules/auth/services/regobs-auth.service.ts","webpack:///src/app/modules/auth/services/token-response-full.ts","webpack:///src/app/modules/common-registration/db/schemas/attachment-meta.schema.ts","webpack:///src/app/modules/common-registration/db/schemas/generic.schema.ts","webpack:///src/app/modules/common-registration/db/schemas/registration-sync-progress.schema.ts","webpack:///src/app/modules/common-registration/db/schemas/registration.schema.ts","webpack:///src/app/modules/common-registration/db/schemas/upload-progress.schema.ts","webpack:///src/app/modules/common-registration/helpers/object-url-blob.helper.ts","webpack:///src/app/modules/common-registration/helpers/registration.helper.ts","webpack:///src/app/modules/common-registration/models/registration-tid.enum.ts","webpack:///src/app/modules/common-registration/models/summary/summary-kind.enum.ts","webpack:///src/app/modules/common-registration/models/summary/text-summary.ts","webpack:///src/app/modules/common-registration/models/summary/url-summary.ts","webpack:///src/app/modules/common-registration/models/sync-status.enum.ts","webpack:///src/app/modules/common-registration/module.options.ts","webpack:///src/app/modules/common-registration/pipes/kdvDescription.pipe.ts","webpack:///src/app/modules/common-registration/registration.module.ts","webpack:///src/app/modules/common-registration/registration.pipes.ts","webpack:///src/app/modules/common-registration/services/add-new-attachment/file-attachment.service.ts","webpack:///src/app/modules/common-registration/services/add-new-attachment/new-attachment.service.ts","webpack:///src/app/modules/common-registration/services/add-new-attachment/offline-db-new-attachment.service.ts","webpack:///src/app/modules/common-registration/services/api-sync-offline-base/api-sync-offline-base.service.ts","webpack:///src/app/modules/common-registration/services/help-text/help-text.service.ts","webpack:///src/app/modules/common-registration/services/item-sync-callback/fake-item-sync-callback.service.ts","webpack:///src/app/modules/common-registration/services/item-sync-callback/item-sync-callback.service.ts","webpack:///src/app/modules/common-registration/services/item-sync-callback/regobs-api-sync-callback.service.ts","webpack:///src/app/modules/common-registration/services/kdv/kdv.service.ts","webpack:///src/app/modules/common-registration/services/offline-db/offline-db-service.options.ts","webpack:///src/app/modules/common-registration/services/offline-db/offline-db.service.ts","webpack:///src/app/modules/common-registration/services/progress/progress.service.ts","webpack:///src/app/modules/common-registration/services/registration/registration.service.ts","webpack:///src/app/modules/common-registration/services/summary-providers/base.summary-provider.ts","webpack:///src/app/modules/common-registration/services/summary-providers/fallback-provider.ts","webpack:///src/app/modules/common-registration/services/summary-providers/general-observation/general-observation.summary-provider.ts","webpack:///src/app/modules/common-registration/services/summary-providers/snow/weather/weather.summary-provider.ts","webpack:///src/app/modules/data-load/services/data-load.service.ts","webpack:///src/app/modules/gps-debug/components/gps-debug/gps-debug.component.html","webpack:///src/app/modules/gps-debug/components/gps-debug/gps-debug.component.ts","webpack:///src/app/modules/gps-debug/gps-debug.module.ts","webpack:///src/app/modules/map-image/map-image.component.ts","webpack:///src/app/modules/map-image/map-image.component.html","webpack:///src/app/modules/map-image/map-image.module.ts","webpack:///src/app/modules/map/components/map-center-info/map-center-info.component.html","webpack:///src/app/modules/map/components/map-center-info/map-center-info.component.ts","webpack:///src/app/modules/map/components/map-controls/fullscreen-toggle/fullscreen-toggle.component.ts","webpack:///src/app/modules/map/components/map-controls/fullscreen-toggle/fullscreen-toggle.component.html","webpack:///src/app/modules/map/components/map-controls/gps-center/gps-center.component.ts","webpack:///src/app/modules/map/components/map-controls/gps-center/gps-center.component.html","webpack:///src/app/modules/map/components/map-controls/map-controls.component.html","webpack:///src/app/modules/map/components/map-controls/map-controls.component.ts","webpack:///src/app/modules/map/components/map-controls/map-search/map-search.component.ts","webpack:///src/app/modules/map/components/map-controls/map-search/map-search.component.html","webpack:///src/app/modules/map/components/map/map.component.html","webpack:///src/app/modules/map/components/map/map.component.ts","webpack:///src/app/modules/map/core/classes/regobs-geohazard-marker.ts","webpack:///src/app/modules/map/core/classes/regobs-tile-layer.ts","webpack:///src/app/modules/map/map.module.ts","webpack:///src/app/modules/map/pages/modal-map-image/modal-map-image.module.ts","webpack:///src/app/modules/map/pages/modal-map-image/modal-map-image.page.ts","webpack:///src/app/modules/map/pages/modal-map-image/modal-map-image.page.html","webpack:///src/app/modules/map/pages/modal-search/modal-search.module.ts","webpack:///src/app/modules/map/pages/modal-search/modal-search.page.html","webpack:///src/app/modules/map/pages/modal-search/modal-search.page.ts","webpack:///src/app/modules/map/pages/support-map-info/support-map-info.module.ts","webpack:///src/app/modules/map/pages/support-map-info/support-map-info.page.ts","webpack:///src/app/modules/map/pages/support-map-info/support-map-info.page.html","webpack:///src/app/modules/map/pipes/starts-with-highlight.pipe.ts","webpack:///src/app/modules/map/services/map-search/map-search.service.ts","webpack:///src/app/modules/map/services/map/map.service.ts","webpack:///src/app/modules/registration/pages/can-deactivate-route.guard.ts","webpack:///src/app/modules/registration/pages/save-as-draft.guard.ts","webpack:///src/app/modules/registration/registration-routing.module.ts","webpack:///src/app/modules/registration/registration.module.ts","webpack:///src/app/modules/registration/services/help-text/help-text.service.ts","webpack:///src/app/modules/registration/services/registration.service.ts","webpack:///src/app/modules/shared/components/add-menu/add-menu.component.html","webpack:///src/app/modules/shared/components/add-menu/add-menu.component.ts","webpack:///src/app/modules/shared/components/external-link/external-link.component.ts","webpack:///src/app/modules/shared/components/external-link/external-link.component.html","webpack:///src/app/modules/shared/components/geo-fab/geo-fab.component.html","webpack:///src/app/modules/shared/components/geo-fab/geo-fab.component.ts","webpack:///src/app/modules/shared/components/geo-icon/geo-icon.component.ts","webpack:///src/app/modules/shared/components/geo-icon/geo-icon.component.html","webpack:///src/app/modules/shared/components/geo-name/geo-name.component.ts","webpack:///src/app/modules/shared/components/geo-name/geo-name.component.html","webpack:///src/app/modules/shared/components/geo-select/geo-select.component.html","webpack:///src/app/modules/shared/components/geo-select/geo-select.component.ts","webpack:///src/app/modules/shared/components/header/header.component.html","webpack:///src/app/modules/shared/components/header/header.component.ts","webpack:///src/app/modules/shared/components/input/select/select.component.html","webpack:///src/app/modules/shared/components/input/select/select.component.ts","webpack:///src/app/modules/shared/components/offline-image/offline-image.component.ts","webpack:///src/app/modules/shared/components/offline-image/offline-image.component.html","webpack:///src/app/modules/shared/components/refresh-with-cancel/refresh-with-cancel.component.html","webpack:///src/app/modules/shared/components/refresh-with-cancel/refresh-with-cancel.component.ts","webpack:///src/app/modules/shared/directives/header-color/header-color.directive.ts","webpack:///src/app/modules/shared/directives/shadow-css/shadow-css.directive.ts","webpack:///src/app/modules/shared/pipes/abs.pipe.ts","webpack:///src/app/modules/shared/pipes/format-date/format-date.pipe.ts","webpack:///src/app/modules/shared/services/date-helper/date-helper.service.ts","webpack:///src/app/modules/shared/services/geo-helper/geo-helper.service.ts","webpack:///src/app/modules/shared/services/logging/console-logging.service.ts","webpack:///src/app/modules/shared/services/logging/file-logging.service.ts","webpack:///src/app/modules/shared/services/logging/log-level.model.ts","webpack:///src/app/modules/shared/services/logging/logging.service.ts","webpack:///src/app/modules/shared/services/logging/sentry.service.ts","webpack:///src/app/modules/shared/services/logging/url-utils.ts","webpack:///src/app/modules/shared/shared.module.ts","webpack:///src/app/modules/side-menu/components/observations-days-back/observations-days-back.component.html","webpack:///src/app/modules/side-menu/components/observations-days-back/observations-days-back.component.ts","webpack:///src/app/modules/side-menu/components/side-menu.component.html","webpack:///src/app/modules/side-menu/components/side-menu.component.ts","webpack:///src/app/modules/side-menu/components/support-tiles-menu/legends/clayzones-legend/clayzones-legend.component.ts","webpack:///src/app/modules/side-menu/components/support-tiles-menu/legends/clayzones-legend/clayzones-legend.component.html","webpack:///src/app/modules/side-menu/components/support-tiles-menu/legends/floodzones-legend/floodzones-legend.component.ts","webpack:///src/app/modules/side-menu/components/support-tiles-menu/legends/floodzones-legend/floodzones-legend.component.html","webpack:///src/app/modules/side-menu/components/support-tiles-menu/legends/legends.config.ts","webpack:///src/app/modules/side-menu/components/support-tiles-menu/legends/steepness-common-legend/steepness-common-legend.component.ts","webpack:///src/app/modules/side-menu/components/support-tiles-menu/legends/steepness-common-legend/steepness-common-legend.component.html","webpack:///src/app/modules/side-menu/components/support-tiles-menu/legends/steepness-legend/steepness-legend.component.html","webpack:///src/app/modules/side-menu/components/support-tiles-menu/legends/steepness-legend/steepness-legend.component.ts","webpack:///src/app/modules/side-menu/components/support-tiles-menu/legends/support-tile-legend-loader/support-tile-legend-loader.component.ts","webpack:///src/app/modules/side-menu/components/support-tiles-menu/legends/support-tile-legend-loader/support-tile-legend-loader.component.html","webpack:///src/app/modules/side-menu/components/support-tiles-menu/legends/weakenedice-legend/weakenedice-legend.component.ts","webpack:///src/app/modules/side-menu/components/support-tiles-menu/legends/weakenedice-legend/weakenedice-legend.component.html","webpack:///src/app/modules/side-menu/components/support-tiles-menu/support-tiles-menu.component.html","webpack:///src/app/modules/side-menu/components/support-tiles-menu/support-tiles-menu.component.ts","webpack:///src/app/modules/side-menu/components/update-observations/update-observations.component.html","webpack:///src/app/modules/side-menu/components/update-observations/update-observations.component.ts","webpack:///src/app/modules/side-menu/components/user-login/user-login.component.html","webpack:///src/app/modules/side-menu/components/user-login/user-login.component.ts","webpack:///src/app/modules/side-menu/side-menu.module.ts","webpack:///src/app/pages/modal-pages/fullscreen-image-modal/fullscreen-image-modal.page.ts","webpack:///src/app/pages/modal-pages/fullscreen-image-modal/fullscreen-image-modal.page.html","webpack:///src/app/pages/modal-pages/legal-terms-modal/legal-terms-modal.module.ts","webpack:///src/app/pages/modal-pages/legal-terms-modal/legal-terms-modal.page.ts","webpack:///src/app/pages/modal-pages/legal-terms-modal/legal-terms-modal.page.html","webpack:///src/environments/environment.ts","webpack:///src/main.ts","webpack:///src/nanosql.ts","webpack:///src/settings.ts","webpack:///node_modules/@ionic/core/dist/esm|lazy|/^/.*/.entry/.js$/|include:%20/.entry/.js$/|exclude:%20/.system/.entry/.js$/|groupOptions:%20%7B%7D|namespace%20object","webpack:///node_modules/moment/locale|sync|/^/.*$","webpack:///src/assets/json|sync|/^/helptexts/..*/.json$","webpack:///src/assets/json|sync|/^/kdvelements/..*/.json$","webpack:///src/methods/node.js","webpack:///ignored|C:\\Repos\\regobs\\regObs4\\node_modules\\pouchdb-utils\\node_modules\\immediate\\lib|./nextTick","webpack:///ignored|C:\\Repos\\regobs\\regObs4\\node_modules\\side-channel\\node_modules\\object-inspect|./util.inspect","webpack:///ignored|C:\\Repos\\regobs\\regObs4\\node_modules\\unload\\dist\\es|./node.js"],"sourcesContent":["function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 98255;\nmodule.exports = webpackEmptyAsyncContext;","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    loadChildren: () =>\r\n      import('./pages/tabs/tabs.module').then((m) => m.TabsPageModule)\r\n  },\r\n  {\r\n    path: 'my-observations',\r\n    loadChildren: () =>\r\n      import('./pages/my-observations/my-observations.module').then(\r\n        (m) => m.MyObservationsPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'user-settings',\r\n    loadChildren: () =>\r\n      import('./pages/user-settings/user-settings.module').then(\r\n        (m) => m.UserSettingsPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'trip-log',\r\n    loadChildren: () =>\r\n      import('./pages/trip-log/trip-log.module').then(\r\n        (m) => m.TripLogPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'start-wizard',\r\n    loadChildren: () =>\r\n      import('./pages/start-wizard/start-wizard.module').then(\r\n        (m) => m.StartWizardPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'view-observation/:id',\r\n    loadChildren: () =>\r\n      import('./pages/view-observation/view-observation.module').then(\r\n        (m) => m.ViewObservationPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'observation-list',\r\n    loadChildren: () =>\r\n      import('./pages/observation-list/observation-list.module').then(\r\n        (m) => m.ObservationListPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'offline-map',\r\n    loadChildren: () =>\r\n      import('./pages/offline-map/offline-map.module').then(\r\n        (m) => m.OfflineMapPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'login',\r\n    loadChildren: () =>\r\n      import('./modules/login/login.module').then((m) => m.LoginModule)\r\n  },\r\n  {\r\n    path: 'registration',\r\n    loadChildren: () =>\r\n      import('./modules/registration/registration.module').then(\r\n        (m) => m.RegistrationModule\r\n      )\r\n  },\r\n  {\r\n    path: 'legacy-trip',\r\n    loadChildren: () =>\r\n      import('./pages/legacy-trip/legacy-trip.module').then(\r\n        (m) => m.LegacyTripPageModule\r\n      )\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forRoot(routes, { relativeLinkResolution: 'legacy' })],\r\n  exports: [RouterModule]\r\n})\r\nexport class AppRoutingModule {}\r\n","import { Component } from '@angular/core';\r\nimport { Platform } from '@ionic/angular';\r\nimport { SplashScreen } from '@capacitor/splash-screen';\r\nimport { UserSettingService } from './core/services/user-setting/user-setting.service';\r\nimport { DataMarshallService } from './core/services/data-marshall/data-marshall.service';\r\nimport { OfflineImageService } from './core/services/offline-image/offline-image.service';\r\nimport { SwipeBackService } from './core/services/swipe-back/swipe-back.service';\r\nimport { Observable, from, forkJoin, of } from 'rxjs';\r\nimport { LoggingService } from './modules/shared/services/logging/logging.service';\r\nimport { DbHelperService } from './core/services/db-helper/db-helper.service';\r\nimport { ScreenOrientation } from '@ionic-native/screen-orientation/ngx';\r\nimport { ShortcutService } from './core/services/shortcut/shortcut.service';\r\nimport { isAndroidOrIos } from './core/helpers/ionic/platform-helper';\r\nimport { switchMap, take, concatMap, catchError, filter } from 'rxjs/operators';\r\nimport { UserSetting } from './core/models/user-settings.model';\r\nimport { FileLoggingService } from './modules/shared/services/logging/file-logging.service';\r\nimport { AuthService } from 'ionic-appauth';\r\nimport { StatusBar, Style } from '@capacitor/status-bar';\r\nimport { NavigationError, Router, RouterEvent } from '@angular/router';\r\nimport { removeOauthTokenFromUrl } from './modules/shared/services/logging/url-utils';\r\n\r\nconst DEBUG_TAG = 'AppComponent';\r\nconst ROUTER_DEBUG_TAG = 'Router';\r\n\r\n@Component({\r\n  selector: 'app-root',\r\n  templateUrl: 'app.component.html'\r\n})\r\nexport class AppComponent {\r\n  swipeBackEnabled$: Observable<boolean>;\r\n\r\n  constructor(\r\n    private platform: Platform,\r\n    private userSettings: UserSettingService,\r\n    private dataMarshallService: DataMarshallService,\r\n    private offlineImageService: OfflineImageService,\r\n    private swipeBackService: SwipeBackService,\r\n    private loggingService: LoggingService,\r\n    private dbHelperService: DbHelperService,\r\n    private screenOrientation: ScreenOrientation,\r\n    private shortcutService: ShortcutService,\r\n    private fileLoggingService: FileLoggingService,\r\n    private auth: AuthService,\r\n    private router: Router\r\n  ) {\r\n    this.swipeBackEnabled$ = this.swipeBackService.swipeBackEnabled$;\r\n    this.initializeApp();\r\n  }\r\n\r\n  initializeApp(): void {\r\n    from(this.fileLoggingService.init({})).pipe(switchMap(() =>\r\n      this.getUserSettings()\r\n        .pipe(this.initServices())))\r\n      .subscribe({ next: () => {\r\n        this.loggingService.debug('Init complete. Hide splash screen', DEBUG_TAG);\r\n        this.afterAppInitialized();\r\n      }, error: (err) => {\r\n        this.loggingService.error(err, DEBUG_TAG, 'Error when init app.');\r\n        this.afterAppInitialized();\r\n      }});\r\n  }\r\n\r\n  private afterAppInitialized() {\r\n    SplashScreen.hide();\r\n  }\r\n\r\n  private lockScreenOrientation() {\r\n    if (isAndroidOrIos(this.platform)) {\r\n      this.screenOrientation.lock(this.screenOrientation.ORIENTATIONS.PORTRAIT);\r\n    }\r\n  }\r\n\r\n  private initServices(): (src: Observable<unknown>) => Observable<unknown> {\r\n    return (src: Observable<UserSetting>) =>\r\n      src.pipe(\r\n        concatMap((userSettings) =>\r\n          forkJoin([\r\n            of(this.lockScreenOrientation()).pipe(\r\n              catchError((err) =>\r\n                this.loggingService.error(\r\n                  err,\r\n                  DEBUG_TAG,\r\n                  'Could not lock lockScreenOrientation'\r\n                )\r\n              )\r\n            ),\r\n            from(this.dbHelperService.init()).pipe(\r\n              catchError((err) =>\r\n                this.loggingService.error(err, DEBUG_TAG, 'Could not init db')\r\n              )\r\n            ),\r\n            of(this.loggingService.configureLogging(userSettings.appMode)).pipe(\r\n              catchError((err) =>\r\n                this.loggingService.error(\r\n                  err,\r\n                  DEBUG_TAG,\r\n                  'Could not configure logging'\r\n                )\r\n              )\r\n            ),\r\n            from(StatusBar.setStyle({ style: Style.Dark })).pipe(\r\n              catchError((err) => {\r\n                this.loggingService.error(\r\n                  err,\r\n                  DEBUG_TAG,\r\n                  'Could not set styleLightContent'\r\n                );\r\n                return of(void null);\r\n              }\r\n              )\r\n            ),\r\n            from(StatusBar.setBackgroundColor({ color: '#99044962'})).pipe(\r\n              catchError((err) => {\r\n                this.loggingService.error(\r\n                  err,\r\n                  DEBUG_TAG,\r\n                  'Could not set backgroundColorByHexString'\r\n                );\r\n                return of(void null);\r\n              }\r\n              )\r\n            ),\r\n            from(StatusBar.setOverlaysWebView({ overlay: false })).pipe(\r\n              catchError((err) =>\r\n              {\r\n                this.loggingService.error(\r\n                  err,\r\n                  DEBUG_TAG,\r\n                  'Could not set overlaysWebView'\r\n                );\r\n                return of(void null);\r\n              }\r\n              )\r\n            ),\r\n            from(this.offlineImageService.cleanupOldItems()).pipe(\r\n              catchError((err) =>\r\n                this.loggingService.error(\r\n                  err,\r\n                  DEBUG_TAG,\r\n                  'Could not cleanup old items'\r\n                )\r\n              )\r\n            ),\r\n            of(this.shortcutService.init()).pipe(\r\n              catchError((err) =>\r\n                this.loggingService.error(\r\n                  err,\r\n                  DEBUG_TAG,\r\n                  'Could not init shortcutService'\r\n                )\r\n              )\r\n            ),\r\n            from(this.auth.init()).pipe(\r\n              catchError((err) =>\r\n                this.loggingService.error(\r\n                  err,\r\n                  DEBUG_TAG,\r\n                  'Could not init auth service'\r\n                )\r\n              )\r\n            ),\r\n            of( this.dataMarshallService.init()).pipe(\r\n              catchError((err) =>\r\n                this.loggingService.error(\r\n                  err,\r\n                  DEBUG_TAG,\r\n                  'Could not init dataMarshallService'\r\n                )\r\n              )\r\n            ),\r\n            of ( this.initRouteNavigationLogger()).pipe(\r\n              catchError((err) =>\r\n                this.loggingService.error(\r\n                  err,\r\n                  DEBUG_TAG,\r\n                  'Could not init route navigation logging'\r\n                )\r\n              )\r\n            )\r\n          ])\r\n        )\r\n      );\r\n  }\r\n\r\n  private getUserSettings() {\r\n    return from(this.platform.ready()).pipe(\r\n      switchMap(() => this.userSettings.userSetting$.pipe(take(1)))\r\n    );\r\n  }\r\n\r\n  private async initRouteNavigationLogger(): Promise<void> {\r\n    this.router.events.pipe(\r\n      filter((e): e is RouterEvent => e instanceof RouterEvent)\r\n    ).subscribe((event) => {\r\n      const eventInfo = removeOauthTokenFromUrl(event.toString());\r\n      if (event instanceof NavigationError) {\r\n        this.loggingService.error(event.error, ROUTER_DEBUG_TAG, eventInfo);\r\n      } else {\r\n        this.loggingService.debug(eventInfo);\r\n      }\r\n    });\r\n  }\r\n}\r\n","<ion-app>\r\n  <ion-menu contentId=\"main-content\" side=\"end\" type=\"overlay\" maxEdgeStart=\"0\">\r\n    <ion-content>\r\n      <app-side-menu></app-side-menu>\r\n    </ion-content>\r\n  </ion-menu>\r\n  <ion-router-outlet id=\"main-content\" [swipeGesture]=\"swipeBackEnabled$ | async\"></ion-router-outlet>\r\n  <app-gps-debug></app-gps-debug>\r\n</ion-app>","import { NgModule } from '@angular/core';\r\nimport { BrowserModule } from '@angular/platform-browser';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { AppComponent } from './app.component';\r\nimport { AppRoutingModule } from './app-routing.module';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { HttpClientModule } from '@angular/common/http';\r\nimport { APP_PROVIDERS } from './app.providers';\r\nimport { settings } from '../settings';\r\nimport { AngularSvgIconModule } from 'angular-svg-icon';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { SharedModule } from './modules/shared/shared.module';\r\nimport { RegistrationModule } from './modules/registration/registration.module';\r\nimport { LegalTermsModalPageModule } from './pages/modal-pages/legal-terms-modal/legal-terms-modal.module';\r\nimport { MarkdownModule } from 'ngx-markdown';\r\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\r\nimport { SideMenuModule } from './modules/side-menu/side-menu.module';\r\nimport { AnalyticsModule } from './modules/analytics/analytics.module';\r\nimport { GpsDebugModule } from './modules/gps-debug/gps-debug.module';\r\nimport { MapModule } from './modules/map/map.module';\r\nimport { LeafletModule } from '@asymmetrik/ngx-leaflet';\r\nimport {\r\n  RegistrationModule as CommonRegistrationModule,\r\n} from './modules/common-registration/registration.module';\r\nimport {\r\n  RegobsApiModuleWithConfig,\r\n} from '@varsom-regobs-common/regobs-api';\r\n\r\n@NgModule({\r\n  declarations: [AppComponent],\r\n  imports: [\r\n    BrowserModule,\r\n    BrowserAnimationsModule,\r\n    HttpClientModule,\r\n    FormsModule,\r\n    IonicModule.forRoot(),\r\n    AppRoutingModule,\r\n    TranslateModule.forRoot(),\r\n    MarkdownModule.forRoot(),\r\n    AngularSvgIconModule.forRoot(),\r\n    SharedModule,\r\n    MapModule,\r\n    LeafletModule,\r\n    RegistrationModule,\r\n    LegalTermsModalPageModule,\r\n    SideMenuModule,\r\n    GpsDebugModule,\r\n    AnalyticsModule.forRoot(),\r\n    RegobsApiModuleWithConfig.forRoot(),\r\n    CommonRegistrationModule.forRoot(),\r\n  ],\r\n  providers: APP_PROVIDERS,\r\n  bootstrap: [AppComponent]\r\n})\r\n\r\nexport class AppModule {}\r\n","import { Router, RouteReuseStrategy } from '@angular/router';\r\nimport { IonicRouteStrategy, NavController, Platform } from '@ionic/angular';\r\nimport { BackgroundGeolocationNativeService } from './core/services/background-geolocation/background-geolocation-native.service';\r\nimport { BackgroundGeolocationWebService } from './core/services/background-geolocation/background-geolocation-web.service';\r\nimport { BackgroundGeolocationService } from './core/services/background-geolocation/background-geolocation.service';\r\nimport { File } from '@ionic-native/file/ngx';\r\nimport { AndroidPermissions } from '@ionic-native/android-permissions/ngx';\r\nimport { BackgroundDownloadService } from './core/services/background-download/background-download.service';\r\n// import { BackgroundDownloadWebService } from './core/services/background-download/background-download-web.service';\r\n// import { BackgroundDownloadNativeService } from './core/services/background-download/background-download-native.service';\r\nimport { Zip } from '@ionic-native/zip/ngx';\r\nimport { Clipboard } from '@ionic-native/clipboard/ngx';\r\nimport { InAppBrowser } from '@ionic-native/in-app-browser/ngx';\r\nimport { UserSettingService } from './core/services/user-setting/user-setting.service';\r\nimport {\r\n  ErrorHandler,\r\n  Provider,\r\n  forwardRef,\r\n  LOCALE_ID,\r\n  APP_INITIALIZER,\r\n  NgZone\r\n} from '@angular/core';\r\nimport { AppErrorHandler } from './core/error-handler/error-handler.class';\r\nimport { HTTP } from '@ionic-native/http/ngx';\r\nimport { WebView } from '@ionic-native/ionic-webview/ngx';\r\nimport { HttpClient, HTTP_INTERCEPTORS } from '@angular/common/http';\r\nimport { Camera } from '@ionic-native/camera/ngx';\r\nimport { EmailComposer } from '@ionic-native/email-composer/ngx';\r\nimport { StartWizardGuard } from './core/guards/start-wizard.guard';\r\nimport { DataMarshallService } from './core/services/data-marshall/data-marshall.service';\r\nimport { AuthGuard } from './core/guards/auth.guard';\r\nimport { Keyboard } from '@ionic-native/keyboard/ngx';\r\nimport { SQLite } from '@ionic-native/sqlite/ngx';\r\nimport { SocialSharing } from '@ionic-native/social-sharing/ngx';\r\nimport { Network } from '@ionic-native/network/ngx';\r\nimport { LoggingService } from './modules/shared/services/logging/logging.service';\r\nimport { SentryService } from './modules/shared/services/logging/sentry.service';\r\nimport { ConsoleLoggingService } from './modules/shared/services/logging/console-logging.service';\r\nimport { environment } from '../environments/environment';\r\nimport { ScreenOrientation } from '@ionic-native/screen-orientation/ngx';\r\nimport { OfflineMapService } from './core/services/offline-map/offline-map.service';\r\nimport { TranslateLoader, TranslateService } from '@ngx-translate/core';\r\nimport { SafariViewController } from '@ionic-native/safari-view-controller/ngx';\r\nimport { Diagnostic } from '@ionic-native/diagnostic/ngx';\r\nimport { initTranslateService } from './custom-translate.loader';\r\nimport { DeviceOrientation } from '@ionic-native/device-orientation/ngx';\r\nimport { initDeepLinks } from './core/app-init/deep-links-initializer';\r\nimport { AuthService } from 'ionic-appauth';\r\nimport { TranslateHttpLoader } from '@ngx-translate/http-loader';\r\nimport { API_KEY_TOKEN, IRegobsApiKeyProvider } from '@varsom-regobs-common/regobs-api';\r\nimport {\r\n  IRegistrationModuleOptions,\r\n  FOR_ROOT_OPTIONS_TOKEN as COMMON_REGISTRATION_FOR_ROOT_OPTIONS_TOKEN,\r\n} from './modules/common-registration/module.options';\r\nimport { AppModeService } from '@varsom-regobs-common/core';\r\nimport { addRxPlugin } from 'rxdb';\r\nimport { ApiInterceptor } from './core/http-interceptor/ApiInterceptor';\r\nimport { HttpClientDownloadService } from './core/services/background-download/http-client-download.service';\r\nimport { OfflineDbService } from './modules/common-registration/registration.services';\r\n\r\n// export const API_INTERCEPTOR_PROVIDER: Provider = {\r\n//   provide: HTTP_INTERCEPTORS,\r\n//   useExisting: forwardRef(() => ApiInterceptor),\r\n//   multi: true\r\n// };\r\n\r\nexport class DynamicLocaleId extends String {\r\n  constructor(protected service: TranslateService) {\r\n    super('');\r\n  }\r\n  toString(): string {\r\n    return this.service.currentLang;\r\n  }\r\n}\r\n\r\nfunction createTranslateLoader(http: HttpClient) {\r\n  return new TranslateHttpLoader(http, '../assets/i18n/', '.json');\r\n}\r\n\r\nexport function initCommonApiKey(): IRegobsApiKeyProvider {\r\n  return { apiKey: require('../assets/apikey.json').apiKey };\r\n}\r\n\r\nexport function initAppModeService(userSettingService: UserSettingService): any {\r\n  return { appMode$: userSettingService.appMode$  };\r\n}\r\n\r\n// export function initCommonApiOptions(\r\n//   appConfig: IAppConfig\r\n// ): RegobsApiConfigurationInterface {\r\n//   return { rootUrl: appConfig.api.baseUrl };\r\n// }\r\nexport function initCommonRegistrationOptions(\r\n): IRegistrationModuleOptions {\r\n  const options = {\r\n    autoSync: false,\r\n    adapter: 'idb',\r\n    attachmentsSupported: false\r\n  };\r\n  return options;\r\n}\r\n\r\nexport function initDb(dbService: OfflineDbService) {\r\n  return (): Promise<void> =>  {\r\n    return import('pouchdb-adapter-idb').then(addRxPlugin).then(() => dbService.initDatabase('idb'));\r\n  };\r\n}\r\n\r\n// export function initAppMode(userSettings: UserSettingService, appModeService: AppModeService){\r\n//   return () => {\r\n//     userSettings.appMode$.subscribe((appMode) => appModeService.setAppMode(appMode));\r\n//   }\r\n// }\r\n\r\nexport const APP_PROVIDERS = [\r\n  StartWizardGuard,\r\n  AuthGuard,\r\n  { provide: RouteReuseStrategy, useClass: IonicRouteStrategy },\r\n  {\r\n    provide: LOCALE_ID,\r\n    useClass: DynamicLocaleId,\r\n    deps: [TranslateService]\r\n  },\r\n  DeviceOrientation,\r\n  File,\r\n  AndroidPermissions,\r\n  Zip,\r\n  Clipboard,\r\n  Camera,\r\n  InAppBrowser,\r\n  SafariViewController,\r\n  HTTP,\r\n  WebView,\r\n  EmailComposer,\r\n  Keyboard,\r\n  SQLite,\r\n  SocialSharing,\r\n  Network,\r\n  ScreenOrientation,\r\n  Diagnostic,\r\n  {\r\n    provide: HTTP_INTERCEPTORS,\r\n    useClass: ApiInterceptor, // TODO: Move to auth module\r\n    multi: true\r\n  },\r\n  // API_INTERCEPTOR_PROVIDER,\r\n  // { provide: RegobsApiConfiguration, useClass: ApiConfiguration },\r\n\r\n  { provide: ErrorHandler, useClass: AppErrorHandler },\r\n  {\r\n    provide: LoggingService,\r\n    useClass: environment.production ? SentryService : ConsoleLoggingService\r\n  },\r\n  {\r\n    provide: TranslateLoader,\r\n    useFactory: createTranslateLoader,\r\n    deps: [HttpClient]\r\n  },\r\n\r\n  // APP initializers\r\n  {\r\n    provide: APP_INITIALIZER,\r\n    useFactory: initTranslateService,\r\n    deps: [TranslateService, UserSettingService],\r\n    multi: true\r\n  },\r\n  {\r\n    provide: APP_INITIALIZER,\r\n    useFactory: initDeepLinks,\r\n    deps: [Platform, NgZone, AuthService, NavController, Router],\r\n    multi: true\r\n  },\r\n\r\n  // @varsom-regobs-common providers\r\n  {\r\n    provide: API_KEY_TOKEN,\r\n    useFactory: initCommonApiKey,\r\n  },\r\n  {\r\n    provide: AppModeService,\r\n    useFactory: initAppModeService,\r\n    deps: [UserSettingService]\r\n  },\r\n  // {\r\n  //   provide: FOR_ROOT_OPTIONS_TOKEN,\r\n  //   useFactory: initCommonApiOptions,\r\n  //   deps: [APP_CONFIG]\r\n  // },\r\n  {\r\n    provide: COMMON_REGISTRATION_FOR_ROOT_OPTIONS_TOKEN,\r\n    useFactory: initCommonRegistrationOptions,\r\n    deps: []\r\n  },\r\n  {\r\n    provide: APP_INITIALIZER,\r\n    useFactory: initDb,\r\n    multi: true,\r\n    deps: [OfflineDbService]\r\n  },\r\n  // {\r\n  //   provide: APP_INITIALIZER,\r\n  //   useFactory: initAppMode,\r\n  //   multi: true,\r\n  //   deps: [UserSettingService, AppModeService]\r\n  // },\r\n\r\n  // Interface implementations\r\n  { provide: 'OnReset', useExisting: DataMarshallService, multi: true },\r\n  { provide: 'OnReset', useExisting: UserSettingService, multi: true },\r\n  { provide: 'OnReset', useExisting: OfflineMapService, multi: true },\r\n\r\n  // Custom native/web providers\r\n  {\r\n    provide: BackgroundGeolocationService,\r\n    useClass: window.hasOwnProperty('cordova')\r\n      ? BackgroundGeolocationNativeService\r\n      : BackgroundGeolocationWebService\r\n  },\r\n  {\r\n    provide: BackgroundDownloadService,\r\n    // useClass: window.hasOwnProperty('cordova')\r\n    //   ? BackgroundDownloadNativeService\r\n    //   : BackgroundDownloadWebService\r\n    // TODO: Implement Download Manager for Android\r\n    useClass: HttpClientDownloadService\r\n  }\r\n];\r\n","<div class=\"competence-wrapper\">\r\n  <ng-container *ngIf=\"competenceLevel > 0 else noCompetence\">\r\n    <ng-container *ngFor=\"let index of [0,1,2,3,4]\">\r\n      <svg-icon *ngIf=\"competenceLevel > index else emptyStar\" src=\"/assets/icon/star-selected.svg\"\r\n        [svgStyle]=\"{'width.px':12, 'height.px':12  }\"></svg-icon>\r\n    </ng-container>\r\n  </ng-container>\r\n</div>\r\n<ng-template #emptyStar>\r\n  <svg-icon src=\"/assets/icon/star-empty.svg\" [svgStyle]=\"{'width.px':12, 'height.px':12  }\"></svg-icon>\r\n</ng-template>\r\n<ng-template #noCompetence>\r\n  <ion-label class=\"small-text\">({{'COMPETENCE.UNKNOWN' | translate}})</ion-label>\r\n</ng-template>","import { Component, OnInit, Input } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-competence',\r\n  templateUrl: './competence.component.html',\r\n  styleUrls: ['./competence.component.scss']\r\n})\r\nexport class CompetenceComponent implements OnInit {\r\n  readonly maxCompetenceLevel = 5;\r\n\r\n  @Input() competenceLevel = 0;\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {}\r\n}\r\n","<div class=\"slides-wrapper\" *ngIf=\"!isEmpty\" [ngClass]=\"{'animated-background': isSwiper, 'loaded': isSwiperLoaded }\">\r\n  <ion-slides *ngIf=\"isSwiper\" [options]=\"slideOptions\" [pager]=\"false\" [ngClass]=\"{'loaded': isSwiperLoaded}\"\r\n    (ionSlideTransitionEnd)=\"onSlideTransitionEnd()\" (ionSlidesDidLoad)=\"slidesLoaded($event)\"\r\n    (ionSlideTouchStart)=\"onSlideTouchStart()\">\r\n    <ion-slide *ngFor=\"let slide of slides; let i = index\" [ngSwitch]=\"slide.type\">\r\n      <app-offline-image *ngSwitchCase=\"'image'\" [src]=\"slide.img\" (click)=\"onImageClick(slide.img)\">\r\n      </app-offline-image>\r\n      <app-map-image *ngSwitchCase=\"'location'\" [location]=\"slide.img\" (click)=\"onLocationClick()\"></app-map-image>\r\n    </ion-slide>\r\n  </ion-slides>\r\n  <app-offline-image *ngIf=\"isSingleImage\" class=\"single\" (click)=\"onImageClick(imgUrl[0])\" [src]=\"imgUrl[0]\">\r\n  </app-offline-image>\r\n  <app-map-image *ngIf=\"isSingleMap\" class=\"single\" [location]=\"location\" (click)=\"onLocationClick()\">\r\n  </app-map-image>\r\n  <ion-label *ngIf=\"showLabel\" [ngClass]=\"{'loaded': isLoaded}\">\r\n    <span class=\"img-comment-header\" *ngIf=\"showIndex\">{{imageIndex + 1}}/{{imageLength}}&nbsp;</span>\r\n    <span [ngClass]=\"{'img-comment-header': slides[activeIndex].description }\"\r\n      *ngIf=\"slides[activeIndex].header\">{{ slides[activeIndex].header | translate }}<ng-container\r\n        *ngIf=\"slides[activeIndex].description\">:&nbsp;\r\n      </ng-container></span>\r\n    <ng-container *ngIf=\"slides[activeIndex].description\">{{ slides[activeIndex].description }}</ng-container>\r\n  </ion-label>\r\n</div>","import {\r\n  Component,\r\n  OnInit,\r\n  Input,\r\n  EventEmitter,\r\n  Output,\r\n  ViewChild,\r\n  OnChanges,\r\n  SimpleChanges,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  OnDestroy\r\n} from '@angular/core';\r\nimport { IonSlides } from '@ionic/angular';\r\nimport { ImgSwiperSlide } from './img-swiper-slide';\r\nimport { Subject, interval, race } from 'rxjs';\r\nimport { takeUntil } from 'rxjs/operators';\r\nimport { ImageLocation } from './image-location.model';\r\n\r\n@Component({\r\n  selector: 'app-img-swiper',\r\n  templateUrl: './img-swiper.component.html',\r\n  styleUrls: ['./img-swiper.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ImgSwiperComponent implements OnInit, OnChanges, OnDestroy {\r\n  @Input() imgUrl: string[] = [];\r\n  @Input() showLabels = true;\r\n  @Input() imgComments: string[] = [];\r\n  @Input() imgHeaders: string[] = [];\r\n  @Output() imgClick: EventEmitter<{\r\n    index: number;\r\n    imgUrl: string;\r\n  }> = new EventEmitter();\r\n  @Input() location: ImageLocation;\r\n  @Output() locationClick: EventEmitter<ImageLocation> = new EventEmitter();\r\n\r\n  slideOptions = {\r\n    autoplay: false,\r\n    slidesPerView: 'auto',\r\n    zoom: false\r\n  };\r\n\r\n  swiper: any;\r\n  state:\r\n    | 'loading'\r\n    | 'empty'\r\n    | 'singleimage'\r\n    | 'singlemap'\r\n    | 'loading-swiper'\r\n    | 'swiper-ready' = 'loading';\r\n  slides: ImgSwiperSlide[];\r\n  activeIndex = 0;\r\n\r\n  private ngDestroy$ = new Subject<void>();\r\n  private touchStart$ = new Subject<void>();\r\n\r\n  @ViewChild(IonSlides) slider: IonSlides;\r\n\r\n  get isEmpty() {\r\n    return this.state === 'empty';\r\n  }\r\n\r\n  get isLoaded() {\r\n    return this.state !== 'loading' && this.state !== 'loading-swiper';\r\n  }\r\n\r\n  get isSwiperLoaded() {\r\n    return this.state === 'swiper-ready';\r\n  }\r\n\r\n  get isSwiper() {\r\n    return this.state === 'swiper-ready' || this.state === 'loading-swiper';\r\n  }\r\n\r\n  get isSingleImage() {\r\n    return this.state === 'singleimage';\r\n  }\r\n\r\n  get isSingleMap() {\r\n    return this.state === 'singlemap';\r\n  }\r\n\r\n  get showLabel() {\r\n    return (\r\n      this.slides &&\r\n      this.slides[this.activeIndex] &&\r\n      (this.slides[this.activeIndex].header ||\r\n        this.slides[this.activeIndex].description)\r\n    );\r\n  }\r\n\r\n  get shouldMoveMap() {\r\n    return this.location && this.imgUrl && this.imgUrl.length > 0;\r\n  }\r\n\r\n  get imageLength() {\r\n    return this.imgUrl ? this.imgUrl.length : 0;\r\n  }\r\n\r\n  get imageIndex() {\r\n    if (\r\n      this.slides[this.activeIndex] &&\r\n      this.slides[this.activeIndex].type === 'image'\r\n    ) {\r\n      return this.getImageIndex(this.slides[this.activeIndex].img as string);\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  get showIndex() {\r\n    if (this.imgUrl && this.imgUrl.length > 1) {\r\n      return this.location ? this.activeIndex > 0 : true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  constructor(private cdr: ChangeDetectorRef) {}\r\n\r\n  ngOnInit() {}\r\n\r\n  ngOnDestroy(): void {\r\n    this.cdr.detach();\r\n  }\r\n\r\n  slidesLoaded(el: any) {\r\n    this.swiper = el.target.swiper;\r\n    if (this.shouldMoveMap) {\r\n      this.activeIndex = 1;\r\n      interval(100)\r\n        .pipe(takeUntil(race(this.ngDestroy$, this.touchStart$)))\r\n        .subscribe(() => {\r\n          this.moveMapInSwiperToLeftOutsideView();\r\n        });\r\n    }\r\n    this.state = 'swiper-ready';\r\n    this.updateUi();\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    this.state = 'loading';\r\n    if (this.swiper) {\r\n      this.swiper.destroy();\r\n      this.swiper = undefined;\r\n    }\r\n    this.updateUi();\r\n    setTimeout(() => this.init(), 0);\r\n  }\r\n\r\n  private init() {\r\n    this.slides = [];\r\n    if (this.location) {\r\n      this.slides.push({\r\n        type: 'location',\r\n        img: this.location,\r\n        header: 'REGISTRATION.OBS_LOCATION.TITLE'\r\n      });\r\n    }\r\n    this.slides = [...this.getLocationSlides(), ...this.getImageSlides()];\r\n    this.activeIndex = 0;\r\n    this.state = this.calculateNewState();\r\n    this.updateUi();\r\n  }\r\n\r\n  private updateUi() {\r\n    if (!this.cdr['destroyed']) {\r\n      this.cdr.detectChanges();\r\n    }\r\n  }\r\n\r\n  private calculateNewState() {\r\n    if (this.location && (!this.imgUrl || this.imgUrl.length === 0)) {\r\n      return 'singlemap';\r\n    } else if (!this.location && this.imgUrl && this.imgUrl.length === 1) {\r\n      return 'singleimage';\r\n    } else if (!this.location && (!this.imgUrl || this.imgUrl.length === 0)) {\r\n      return 'empty';\r\n    } else {\r\n      return 'loading-swiper';\r\n    }\r\n  }\r\n\r\n  private getLocationSlides(): ImgSwiperSlide[] {\r\n    return this.location\r\n      ? [\r\n        {\r\n          type: 'location',\r\n          img: this.location,\r\n          header: 'REGISTRATION.OBS_LOCATION.TITLE'\r\n        }\r\n      ]\r\n      : [];\r\n  }\r\n\r\n  private getImageSlides(): ImgSwiperSlide[] {\r\n    return (this.imgUrl || []).map((img, index) => ({\r\n      type: 'image',\r\n      img,\r\n      header: this.imgHeaders[index],\r\n      description: this.imgComments[index]\r\n    }));\r\n  }\r\n\r\n  private moveMapInSwiperToLeftOutsideView() {\r\n    if (this.swiper && this.swiper.$wrapperEl && this.swiper.$wrapperEl[0]) {\r\n      this.swiper.$wrapperEl[0].style.transform = 'translate3d(-60%, 0px, 0px)';\r\n    }\r\n  }\r\n\r\n  getImageIndex(src: string) {\r\n    return this.imgUrl && this.imgUrl.length > 0\r\n      ? this.imgUrl.indexOf(src)\r\n      : -1;\r\n  }\r\n\r\n  onImageClick(imgUrlSrc: string) {\r\n    const index = this.getImageIndex(imgUrlSrc);\r\n    if (index >= 0) {\r\n      this.imgClick.emit({ index, imgUrl: imgUrlSrc });\r\n    }\r\n  }\r\n\r\n  onLocationClick() {\r\n    this.locationClick.emit(this.location);\r\n  }\r\n\r\n  onSlideTouchStart() {\r\n    this.touchStart$.next();\r\n  }\r\n\r\n  async getSwiperIndex() {\r\n    const index = await (this.slider ? this.slider.getActiveIndex() : 0);\r\n    const isEnd = await (this.slider\r\n      ? this.slider.isEnd()\r\n      : Promise.resolve(false));\r\n    return isEnd ? (this.slides ? this.slides.length - 1 : 0) : index;\r\n  }\r\n\r\n  async onSlideTransitionEnd() {\r\n    this.activeIndex = await this.getSwiperIndex();\r\n    this.updateUi();\r\n  }\r\n}\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-legal-terms',\r\n  templateUrl: './legal-terms.component.html',\r\n  styleUrls: ['./legal-terms.component.scss']\r\n})\r\nexport class LegalTermsComponent implements OnInit {\r\n  constructor() {}\r\n\r\n  ngOnInit() {}\r\n}\r\n","<ion-grid class=\"full-grid legal-grid\">\r\n  <ion-row class=\"legal-info-row\">\r\n    <ion-col class=\"ion-padding ion-align-self-bottom\">\r\n      <div class=\"legal-icon\">&sect;\r\n      </div>\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row class=\"legal-text-row\">\r\n    <ion-col align-self-top>\r\n      <h2>{{'LEGAL_TERMS.HEADER' | translate}}</h2>\r\n      <h3 class=\"ion-no-padding ion-text-wrap\">\r\n        <ul>\r\n          <li>{{'LEGAL_TERMS.LINE_1' | translate}}</li>\r\n          <li>{{'LEGAL_TERMS.LINE_2' | translate}}</li>\r\n          <li>{{'LEGAL_TERMS.LINE_3' | translate}}</li>\r\n        </ul>\r\n      </h3>\r\n    </ion-col>\r\n  </ion-row>\r\n</ion-grid>","<ion-card *ngIf=\"loaded\">\r\n  <ion-card-header>\r\n    <h3 color=\"medium\">{{ header }}</h3>\r\n  </ion-card-header>\r\n  <ion-card-content>\r\n    <ion-grid class=\"ion-no-padding\">\r\n      <ion-row class=\"row-padding-start\">\r\n        <ion-col size=\"12\">\r\n          <div class=\"card-icon-item\">\r\n            <svg-icon class=\"card-icon-item-icon\" src=\"/assets/icon/time.svg\"\r\n              [svgStyle]=\"{'width.px':16, 'height.px':16  }\"></svg-icon>\r\n            {{\r\n            dtObsDate | formatDate | async }}\r\n          </div>\r\n          <div class=\"card-icon-item\">\r\n            <svg-icon class=\"card-icon-item-icon\" [src]=\"icon\" [svgStyle]=\"{'width.px':16, 'height.px':16  }\">\r\n            </svg-icon>\r\n            <app-geo-name [geoHazards]=\"[geoHazard]\"></app-geo-name>\r\n          </div>\r\n          <div class=\"card-icon-item\">\r\n            <svg-icon class=\"card-icon-item-icon\" src=\"/assets/icon/moh.svg\"\r\n              [svgStyle]=\"{'width.px':16, 'height.px':16  }\"></svg-icon>\r\n            {{\r\n            obs.ObsLocation.Height }}\r\n            {{'MAP_CENTER_INFO.ABOVE_SEA_LEVEL' | translate}}\r\n          </div>\r\n          <div class=\"card-icon-item\">\r\n            <svg-icon class=\"card-icon-item-icon\" src=\"/assets/icon/user.svg\"\r\n              [svgStyle]=\"{'width.px':16, 'height.px':16  }\"></svg-icon>\r\n            {{obs.Observer.NickName}}\r\n            <app-competence [competenceLevel]=\"competenceLevel\"></app-competence>\r\n          </div>\r\n          <div class=\"card-icon-item\" *ngIf=\"obs.ObserverGroupName\">\r\n            <svg-icon class=\"card-icon-item-icon\" src=\"/assets/icon/usergroup.svg\"\r\n              [svgStyle]=\"{'width.px':16, 'height.px':16  }\"></svg-icon>\r\n            {{obs.ObserverGroupName }}\r\n          </div>\r\n        </ion-col>\r\n      </ion-row>\r\n      <ion-row>\r\n        <ion-col size=\"12\" class=\"ion-no-padding\">\r\n          <app-img-swiper [location]=\"location\" [imgUrl]=\"imageUrls\" [imgHeaders]=\"imageHeaders\"\r\n            [imgComments]=\"imageDescriptions\" (imgClick)=\"openImage($event)\" (locationClick)=\"openLocation($event)\">\r\n          </app-img-swiper>\r\n        </ion-col>\r\n      </ion-row>\r\n      <!-- <ng-container *ngIf=\"summaries.length > 1\">\r\n        <ion-row class=\"row-padding-start\">\r\n          <ion-col size=\"12\">\r\n            <ion-badge (click)=\"toggleAllSelected()\" [color]=\"allSelected ? 'medium' : 'light'\" [ngClass]=\"{'outline': !allSelected}\">\r\n              {{'OBSERVATION_LIST.ALL_OBSERVATIONS' | translate}}\r\n            </ion-badge>\r\n            <ion-badge (click)=\"toggleRegistration(i)\" class=\"ion-text-wrap\" [color]=\"(s.open && (summaries.length <= 1 || !allSelected)) ? 'medium' : 'light'\"\r\n              *ngFor=\"let s of summaries; let i = index\" [ngClass]=\"{'outline': !(s.open && (summaries.length <= 1 || !allSelected))}\">\r\n              {{ s.summary.RegistrationName }}\r\n            </ion-badge>\r\n          </ion-col>\r\n        </ion-row>\r\n      </ng-container> -->\r\n      <ion-row class=\"row-padding-start\">\r\n        <ion-col size=\"12\">\r\n          <app-summary [summaries]=\"summaries\" [showHeaders]=\"false\"></app-summary>\r\n        </ion-col>\r\n      </ion-row>\r\n    </ion-grid>\r\n    <ion-item class=\"ion-no-padding\" color=\"light\">\r\n      <ion-button mode=\"ios\" fill=\"clear\" class=\"link-title\" (click)=\"openWeb()\">\r\n        {{'OBSERVATION_LIST.GO_TO_OBSERVATION' | translate}}\r\n      </ion-button>\r\n      <ion-button mode=\"ios\" fill=\"clear\" class=\"reg-id\" slot=\"end\" (click)=\"share()\">\r\n        ID: {{ obs.RegId }}\r\n        <ion-icon slot=\"end\" class=\"share-icon\" name=\"share-social\"></ion-icon>\r\n      </ion-button>\r\n    </ion-item>\r\n  </ion-card-content>\r\n</ion-card>","import {\r\n  Component,\r\n  Input,\r\n  OnChanges,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\nimport { GeoHazard } from '@varsom-regobs-common/core';\r\nimport { settings } from '../../../../settings';\r\nimport {\r\n  AttachmentViewModel,\r\n  RegistrationViewModel,\r\n  Summary\r\n} from '@varsom-regobs-common/regobs-api';\r\nimport { ModalController } from '@ionic/angular';\r\nimport { UserSettingService } from '../../../core/services/user-setting/user-setting.service';\r\nimport { FullscreenImageModalPage } from '../../../pages/modal-pages/fullscreen-image-modal/fullscreen-image-modal.page';\r\nimport { SocialSharing } from '@ionic-native/social-sharing/ngx';\r\nimport { ExternalLinkService } from '../../../core/services/external-link/external-link.service';\r\nimport * as utils from '@nano-sql/core/lib/utilities';\r\nimport * as L from 'leaflet';\r\nimport { ModalMapImagePage } from '../../../modules/map/pages/modal-map-image/modal-map-image.page';\r\nimport { AnalyticService } from '../../../modules/analytics/services/analytic.service';\r\nimport { AppEventCategory } from '../../../modules/analytics/enums/app-event-category.enum';\r\nimport { AppEventAction } from '../../../modules/analytics/enums/app-event-action.enum';\r\nimport { ImageLocation } from '../../img-swiper/image-location.model';\r\nimport 'leaflet.utm';\r\nimport { getStarCount } from '../../../core/helpers/competence-helper';\r\nimport { take } from 'rxjs/operators';\r\nimport { RegobsAuthService } from 'src/app/modules/auth/services/regobs-auth.service';\r\n\r\n@Component({\r\n  selector: 'app-observation-list-card',\r\n  templateUrl: './observation-list-card.component.html',\r\n  styleUrls: ['./observation-list-card.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ObservationListCardComponent implements OnChanges {\r\n  @Input() obs: RegistrationViewModel;\r\n\r\n  dtObsDate: string;\r\n  icon: string;\r\n  settings = settings;\r\n  header: string;\r\n  summaries: Summary[] = [];\r\n  allSelected = true;\r\n  loaded = false;\r\n  imageHeader = '';\r\n  imageDecription = '';\r\n  competenceLevel: number;\r\n  geoHazard: GeoHazard;\r\n\r\n  imageUrls: string[] = [];\r\n  imageHeaders: string[] = [];\r\n  imageDescriptions: string[] = [];\r\n  location: ImageLocation;\r\n\r\n  constructor(\r\n    private modalController: ModalController,\r\n    private externalLinkService: ExternalLinkService,\r\n    private userSettingService: UserSettingService,\r\n    private socialSharing: SocialSharing,\r\n    private cdr: ChangeDetectorRef,\r\n    private analyticService: AnalyticService,\r\n    private regobsAuthService: RegobsAuthService\r\n  ) {}\r\n\r\n  private async load() {\r\n    const baseUrl = await this.getBaseUrl();\r\n    this.geoHazard = <GeoHazard>this.obs.GeoHazardTID;\r\n    this.header = this.obs.ObsLocation.Title;\r\n    this.location = this.getLocation(this.obs);\r\n    this.dtObsDate = this.obs.DtObsTime;\r\n    this.icon = this.getGeoHazardCircleIcon(this.geoHazard);\r\n    this.summaries = this.obs.Summaries;\r\n    this.competenceLevel = getStarCount(this.obs.Observer.CompetenceLevelName);\r\n    this.updateImages(baseUrl);\r\n    this.loaded = true;\r\n\r\n    this.cdr.markForCheck();\r\n  }\r\n\r\n  private getLocation(obs: RegistrationViewModel): ImageLocation {\r\n    return {\r\n      latLng: L.latLng(\r\n        this.obs.ObsLocation.Latitude,\r\n        this.obs.ObsLocation.Longitude\r\n      ),\r\n      geoHazard: this.geoHazard,\r\n      startStopLocation: this.getStartStopLocation(obs),\r\n      damageLocations: this.getDamagePositions(obs)\r\n    };\r\n  }\r\n\r\n  private getStartStopLocation(\r\n    obs: RegistrationViewModel\r\n  ): { start?: L.LatLng; stop?: L.LatLng } {\r\n    if (obs.AvalancheObs) {\r\n      return {\r\n        start:\r\n          obs.AvalancheObs.StartLat && obs.AvalancheObs.StartLong\r\n            ? L.latLng(obs.AvalancheObs.StartLat, obs.AvalancheObs.StartLong)\r\n            : undefined,\r\n        stop:\r\n          obs.AvalancheObs.StopLong && obs.AvalancheObs.StopLong\r\n            ? L.latLng(obs.AvalancheObs.StopLat, obs.AvalancheObs.StopLong)\r\n            : undefined\r\n      };\r\n    }\r\n    if (obs.LandSlideObs) {\r\n      return {\r\n        start:\r\n          obs.LandSlideObs.StartLat && obs.LandSlideObs.StartLong\r\n            ? L.latLng(obs.LandSlideObs.StartLat, obs.LandSlideObs.StartLong)\r\n            : undefined,\r\n        stop:\r\n          obs.LandSlideObs.StopLat && obs.LandSlideObs.StopLong\r\n            ? L.latLng(obs.LandSlideObs.StopLat, obs.LandSlideObs.StopLong)\r\n            : undefined\r\n      };\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  private getDamagePositions(obs: RegistrationViewModel) {\r\n    if (obs && obs.DamageObs && obs.DamageObs.some((d) => d.DamagePosition)) {\r\n      return obs.DamageObs.filter(\r\n        (d) =>\r\n          d.DamagePosition &&\r\n          d.DamagePosition.Latitude &&\r\n          d.DamagePosition.Longitude\r\n      ).map((d) =>\r\n        L.latLng(d.DamagePosition.Latitude, d.DamagePosition.Longitude)\r\n      );\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  ngOnChanges(): void {\r\n    this.load();\r\n  }\r\n\r\n  getGeoHazardCircleIcon(geoHazard: GeoHazard): string {\r\n    switch (geoHazard) {\r\n    case GeoHazard.Soil:\r\n      return '/assets/icon/dirt_circle.svg';\r\n    case GeoHazard.Ice:\r\n      return '/assets/icon/ice_circle.svg';\r\n    case GeoHazard.Snow:\r\n      return '/assets/icon/snow_circle.svg';\r\n    case GeoHazard.Water:\r\n      return '/assets/icon/water_circle.svg';\r\n    }\r\n  }\r\n\r\n  updateImages(baseUrl: string): void {\r\n    this.imageHeaders = this.obs.Attachments.map((x) => x.RegistrationName);\r\n    this.imageDescriptions = this.obs.Attachments.map((x) => x.Comment);\r\n    this.imageUrls = this.obs.Attachments.map((x) =>\r\n      this.getImageUrl(x)\r\n    );\r\n  }\r\n\r\n  getImageUrl(\r\n    attachment: AttachmentViewModel,\r\n    size: 'Thumbnail' | 'Medium' | 'Large' | 'Original' | 'Raw' = 'Large'\r\n  ): string {\r\n    return attachment.UrlFormats[size] || attachment.Url;\r\n  }\r\n\r\n  getRegistrationNames(): string {\r\n    return this.obs.Summaries.map((reg) => reg.RegistrationName).join(', ');\r\n  }\r\n\r\n  async openImage(event: { index: number; imgUrl: string }): Promise<void> {\r\n    const image = this.obs.Attachments[event.index];\r\n    const modal = await this.modalController.create({\r\n      component: FullscreenImageModalPage,\r\n      componentProps: {\r\n        imgSrc: `${this.getImageUrl(\r\n          image,\r\n          'Original'\r\n        )}?r=${utils.uuid()}`,\r\n        header: this.obs.Attachments[event.index].RegistrationName,\r\n        description: this.obs.Attachments[event.index].Comment\r\n      }\r\n    });\r\n    modal.present();\r\n  }\r\n\r\n  async openLocation(location: {\r\n    latLng: L.LatLng;\r\n    geoHazard: GeoHazard;\r\n  }): Promise<void> {\r\n    const modal = await this.modalController.create({\r\n      component: ModalMapImagePage,\r\n      componentProps: {\r\n        location\r\n      }\r\n    });\r\n    modal.present();\r\n  }\r\n\r\n  private async getBaseUrl() {\r\n    const userSetings = await this.userSettingService.userSetting$\r\n      .pipe(take(1))\r\n      .toPromise();\r\n    return settings.services.regObs.webUrl[userSetings.appMode];\r\n  }\r\n\r\n  private getRegistrationUrl(baseUrl: string, loginHint?: string) {\r\n    return `${baseUrl}/Registration/${this.obs.RegId}${\r\n      loginHint ? `?login_hint=${loginHint}` : ''\r\n    }`;\r\n  }\r\n\r\n  async openWeb(): Promise<void> {\r\n    const baseUrl = await this.getBaseUrl();\r\n    const user = await this.regobsAuthService.getLoggedInUserAsPromise();\r\n    const url = this.getRegistrationUrl(baseUrl, user.email);\r\n    this.analyticService.trackEvent(\r\n      AppEventCategory.Observations,\r\n      AppEventAction.Click,\r\n      url,\r\n      this.obs.RegId\r\n    );\r\n    this.externalLinkService.openExternalLink(url);\r\n  }\r\n\r\n  async share(): Promise<void> {\r\n    const baseUrl = await this.getBaseUrl();\r\n    const url = this.getRegistrationUrl(baseUrl);\r\n    this.analyticService.trackEvent(\r\n      AppEventCategory.Observations,\r\n      AppEventAction.Share,\r\n      url,\r\n      this.obs.RegId\r\n    );\r\n    this.socialSharing.share(null, null, null, url);\r\n  }\r\n}\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-observation-skeleton',\r\n  templateUrl: './observation-skeleton.component.html',\r\n  styleUrls: ['./observation-skeleton.component.scss']\r\n})\r\nexport class ObservationSkeletonComponent implements OnInit {\r\n  constructor() {}\r\n\r\n  ngOnInit() {}\r\n}\r\n","<ion-card>\r\n  <ion-card-header>\r\n    <h3>\r\n      <ion-skeleton-text class=\"skeleton-header\" animated></ion-skeleton-text> / <ion-skeleton-text\r\n        class=\"skeleton-header\" animated></ion-skeleton-text>\r\n    </h3>\r\n  </ion-card-header>\r\n  <ion-card-content>\r\n    <ion-grid class=\"ion-no-padding\">\r\n      <ion-row class=\"row-padding-start\">\r\n        <ion-col size=\"12\">\r\n          <div class=\"card-icon-item\">\r\n            <svg-icon class=\"card-icon-item-icon\" src=\"/assets/icon/time.svg\"\r\n              [svgStyle]=\"{'width.px':15, 'height.px':15  }\"></svg-icon>\r\n            <ion-skeleton-text class=\"time-skeleton\" animated></ion-skeleton-text>\r\n          </div>\r\n          <div class=\"card-icon-item\">\r\n            <svg-icon class=\"card-icon-item-icon\" src=\"/assets/icon/moh.svg\"\r\n              [svgStyle]=\"{'width.px':15, 'height.px':15  }\"></svg-icon>\r\n            <ion-skeleton-text class=\"moh-skeleton\" animated></ion-skeleton-text>\r\n          </div>\r\n          <div class=\"card-icon-item\">\r\n            <svg-icon class=\"card-icon-item-icon\" src=\"/assets/icon/user.svg\"\r\n              [svgStyle]=\"{'width.px':15, 'height.px':15  }\"></svg-icon>\r\n            <ion-skeleton-text class=\"user-skeleton\" animated></ion-skeleton-text>\r\n          </div>\r\n          <div class=\"card-icon-item\">\r\n            <svg-icon class=\"card-icon-item-icon\" src=\"/assets/icon/usergroup.svg\"\r\n              [svgStyle]=\"{'width.px':15, 'height.px':15  }\"></svg-icon>\r\n            <ion-skeleton-text class=\"usergroup-skeleton\" animated></ion-skeleton-text>\r\n          </div>\r\n        </ion-col>\r\n      </ion-row>\r\n      <ion-row>\r\n        <ion-col size=\"12\" class=\"ion-no-padding\">\r\n          <ion-skeleton-text class=\"skeleton-image\" animated></ion-skeleton-text>\r\n        </ion-col>\r\n      </ion-row>\r\n      <ion-row>\r\n        <ion-col size=\"12\" class=\"ion-no-padding\">\r\n        </ion-col>\r\n      </ion-row>\r\n    </ion-grid>\r\n    <ion-item class=\"ion-no-padding\" color=\"light\">\r\n      <ion-button mode=\"ios\" fill=\"clear\" class=\"link-title\">\r\n        {{'OBSERVATION_LIST.GO_TO_OBSERVATION' | translate}}\r\n      </ion-button>\r\n      <ion-button mode=\"ios\" fill=\"clear\" class=\"reg-id\" slot=\"end\">\r\n        ID: - <ion-icon slot=\"end\" class=\"share-icon\" name=\"share-social\"></ion-icon>\r\n      </ion-button>\r\n    </ion-item>\r\n  </ion-card-content>\r\n</ion-card>","<div class=\"summaries\" *ngFor=\"let summary of summaries; let i = index\">\r\n  <ng-container *ngIf=\"summary.Summaries.length > 0\">\r\n    <h3>{{ summary.RegistrationName }}</h3>\r\n    <ng-container *ngFor=\"let genericValue of summary.Summaries; let i = index\">\r\n      <span *ngIf=\"i>0\" class=\"bullet\">&nbsp;&bull;&nbsp;</span>\r\n      <ng-container *ngTemplateOutlet=\"RegObsGenericValue; context:genericValue\">\r\n      </ng-container>\r\n    </ng-container>\r\n  </ng-container>\r\n</div>\r\n<ng-template #RegObsGenericValue let-kind=\"Kind\" let-header=\"Header\" let-value=\"Value\">\r\n  <ng-container [ngSwitch]=\"kind\">\r\n    <ng-container *ngSwitchCase=\"SummaryType.Text\">\r\n      <ng-container *ngTemplateOutlet=\"TextSummary\"></ng-container>\r\n    </ng-container>\r\n    <ng-container *ngSwitchCase=\"SummaryType.Url\">\r\n      <ng-container *ngTemplateOutlet=\"UrlSummary\"></ng-container>\r\n    </ng-container>\r\n    <ng-container *ngSwitchCase=\"SummaryType.List\">\r\n      <ng-container *ngTemplateOutlet=\"List\"></ng-container>\r\n    </ng-container>\r\n  </ng-container>\r\n  <ng-template #TextSummary>\r\n    <span *ngIf=\"showHeaders\">{{ header }}:&nbsp;</span><span>{{ value }}</span>\r\n  </ng-template>\r\n  <ng-template #UrlSummary>\r\n    <app-external-link [src]=\"value\">{{header}}</app-external-link>\r\n  </ng-template>\r\n  <ng-template #List>\r\n    <ng-container *ngFor=\"let item of value; let j = index\">\r\n      <span *ngIf=\"j>0\" class=\"bullet\">&nbsp;&bull;&nbsp;</span>\r\n      <ng-container *ngTemplateOutlet=\"RegObsGenericValue; context:item\"></ng-container>\r\n    </ng-container>\r\n  </ng-template>\r\n</ng-template>","import { Component, OnInit, Input } from '@angular/core';\r\nimport { Summary } from '@varsom-regobs-common/regobs-api';\r\nimport { SummaryType } from '../../../core/models/summmary-type.enum';\r\n\r\n@Component({\r\n  selector: 'app-summary',\r\n  templateUrl: './summary.component.html',\r\n  styleUrls: ['./summary.component.scss']\r\n})\r\nexport class SummaryComponent implements OnInit {\r\n  @Input() summaries: Summary[];\r\n  @Input() showHeaders = true;\r\n\r\n  SummaryType = SummaryType;\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {}\r\n}\r\n","import { createAnimation } from '@ionic/core';\r\nimport { transition, style, animate } from '@angular/animations';\r\n\r\nexport const DEFAULT_DURATION = 200;\r\nexport const EASE_IN_OUT_BACK = 'cubic-bezier(0.68, -0.55, 0.265, 1.55)';\r\nexport const EASE_IN_OUT = 'ease-in-out';\r\n\r\nexport class CustomAnimation {\r\n  static createScaleInInitialStyle(fromScale = 0, fromOpacity = 0) {\r\n    return style({\r\n      transform: `scale3d(${fromScale},${fromScale},1)`,\r\n      opacity: fromOpacity\r\n    }); // initial\r\n  }\r\n\r\n  static createScaleInAnimation(\r\n    delay = 0,\r\n    duration: number = DEFAULT_DURATION,\r\n    easing = EASE_IN_OUT\r\n  ) {\r\n    return animate(\r\n      `${duration}ms ${delay}ms ${easing}`,\r\n      style({ transform: 'scale3d(1,1,1)', opacity: 1 })\r\n    );\r\n  }\r\n\r\n  static createScaleInTransition(\r\n    delay = 0,\r\n    duration: number = DEFAULT_DURATION,\r\n    easing = EASE_IN_OUT,\r\n    fromScale = 0,\r\n    fromOpacity = 0\r\n  ) {\r\n    return [\r\n      CustomAnimation.createScaleInInitialStyle(fromScale, fromOpacity), // initial\r\n      CustomAnimation.createScaleInAnimation(delay, duration, easing)\r\n    ];\r\n  }\r\n\r\n  static createEnterScaleInAnimation(\r\n    delay = 0,\r\n    duration: number = DEFAULT_DURATION,\r\n    easing = EASE_IN_OUT,\r\n    fromScale = 0,\r\n    fromOpacity = 0\r\n  ) {\r\n    return [\r\n      transition(\r\n        ':enter',\r\n        CustomAnimation.createScaleInTransition(\r\n          delay,\r\n          duration,\r\n          easing,\r\n          fromScale,\r\n          fromOpacity\r\n        )\r\n      )\r\n    ];\r\n  }\r\n\r\n  static scaleUpEnter(baseEl: HTMLElement, opts?: any) {\r\n    const baseAnimation = createAnimation();\r\n\r\n    const backdropAnimation = createAnimation();\r\n    backdropAnimation.addElement(baseEl.querySelector('ion-backdrop'));\r\n\r\n    backdropAnimation.fromTo('opacity', 0.01, 0.4);\r\n\r\n    const wrapperAnimation = createAnimation();\r\n    wrapperAnimation.addElement(baseEl.querySelector('.modal-wrapper'));\r\n\r\n    wrapperAnimation\r\n      .beforeStyles({ transform: 'scale3d(0.7,0.7,0.7)', opacity: 0.01 })\r\n      .fromTo('transform', 'scale3d(0.7,0.7,0.7)', 'scale3d(1,1,1)')\r\n      .fromTo('opacity', 0.01, 1);\r\n\r\n    return Promise.resolve(\r\n      baseAnimation\r\n        .addElement(baseEl)\r\n        .easing(EASE_IN_OUT_BACK)\r\n        .duration(DEFAULT_DURATION)\r\n        .beforeAddClass('show-modal')\r\n        .addAnimation(backdropAnimation)\r\n        .addAnimation(wrapperAnimation)\r\n    );\r\n  }\r\n\r\n  static scaleUpEnterV2(baseEl: HTMLElement, opts?: any) {\r\n    const baseAnimation = createAnimation();\r\n\r\n    const backdropAnimation = createAnimation();\r\n    backdropAnimation.addElement(baseEl.querySelector('ion-backdrop'));\r\n\r\n    backdropAnimation.fromTo('opacity', 0, 0.4);\r\n\r\n    const wrapperAnimation = createAnimation();\r\n    wrapperAnimation.addElement(baseEl.querySelector('.modal-wrapper'));\r\n\r\n    wrapperAnimation\r\n      .beforeStyles({ transform: 'scale3d(0.7,1,0.7)', opacity: 0 })\r\n      .fromTo('transform', 'scale3d(0.7,1,0.7)', 'scale3d(1,1,1)')\r\n      .fromTo('opacity', 0, 1);\r\n\r\n    return Promise.resolve(\r\n      baseAnimation\r\n        .addElement(baseEl)\r\n        .duration(DEFAULT_DURATION)\r\n        .beforeAddClass('show-modal')\r\n        .addAnimation(backdropAnimation)\r\n        .addAnimation(wrapperAnimation)\r\n    );\r\n  }\r\n\r\n  static scaleUpLeave(baseEl: HTMLElement, opts?: any) {\r\n    const baseAnimation = createAnimation();\r\n\r\n    const backdropAnimation = createAnimation();\r\n    backdropAnimation.addElement(baseEl.querySelector('ion-backdrop'));\r\n\r\n    backdropAnimation.fromTo('opacity', 0.4, 0.0);\r\n\r\n    const wrapperAnimation = createAnimation();\r\n    wrapperAnimation.addElement(baseEl.querySelector('.modal-wrapper'));\r\n\r\n    wrapperAnimation\r\n      .addElement(baseEl.querySelector('.modal-wrapper'))\r\n      .beforeStyles({ transform: 'scale3d(1,1,1)', opacity: 1 })\r\n      .fromTo('transform', 'scale3d(1,1,1)', 'scale3d(0.6,0.6,0.6)')\r\n      .fromTo('opacity', 1, 0);\r\n\r\n    return Promise.resolve(\r\n      baseAnimation\r\n        .addElement(baseEl)\r\n        .easing('cubic-bezier(.1, .7, .1, 1)')\r\n        .duration(DEFAULT_DURATION)\r\n        .addAnimation(backdropAnimation)\r\n        .addAnimation(wrapperAnimation)\r\n    );\r\n  }\r\n\r\n  static scaleUpLeaveV2(baseEl: HTMLElement, opts?: any) {\r\n    const baseAnimation = createAnimation();\r\n\r\n    const backdropAnimation = createAnimation();\r\n    backdropAnimation.addElement(baseEl.querySelector('ion-backdrop'));\r\n\r\n    backdropAnimation.fromTo('opacity', 0.4, 0.0);\r\n\r\n    const wrapperAnimation = createAnimation();\r\n    wrapperAnimation.addElement(baseEl.querySelector('.modal-wrapper'));\r\n\r\n    wrapperAnimation\r\n      .addElement(baseEl.querySelector('.modal-wrapper'))\r\n      .beforeStyles({ transform: 'scale3d(1,1,1)', opacity: 1 })\r\n      .fromTo('transform', 'scale3d(1,1,1)', 'scale3d(0.6,1,0.6)')\r\n      .fromTo('opacity', 1, 0);\r\n\r\n    return Promise.resolve(\r\n      baseAnimation\r\n        .addElement(baseEl)\r\n        .duration(DEFAULT_DURATION)\r\n        .addAnimation(backdropAnimation)\r\n        .addAnimation(wrapperAnimation)\r\n    );\r\n  }\r\n\r\n  static slideInFromRight(baseEl: HTMLElement, opts?: any) {\r\n    const baseAnimation = createAnimation();\r\n\r\n    const backdropAnimation = createAnimation();\r\n    backdropAnimation.addElement(baseEl.querySelector('ion-backdrop'));\r\n\r\n    backdropAnimation.fromTo('opacity', 0.01, 0.4);\r\n\r\n    const wrapperAnimation = createAnimation();\r\n    wrapperAnimation.addElement(baseEl.querySelector('.modal-wrapper'));\r\n\r\n    wrapperAnimation\r\n      .beforeStyles({ transform: 'translateX(100%)', opacity: 0.01 })\r\n      .fromTo('transform', 'translateX(100%)', 'translateX(0)')\r\n      .fromTo('opacity', 0.01, 1);\r\n\r\n    return baseAnimation\r\n      .addElement(baseEl)\r\n      .easing('ease-in')\r\n      .duration(DEFAULT_DURATION)\r\n      .beforeAddClass('show-modal')\r\n      .addAnimation(backdropAnimation)\r\n      .addAnimation(wrapperAnimation);\r\n  }\r\n\r\n  static slideOutToRight(baseEl: HTMLElement, opts?: any) {\r\n    const baseAnimation = createAnimation();\r\n\r\n    const backdropAnimation = createAnimation();\r\n    backdropAnimation.addElement(baseEl.querySelector('ion-backdrop'));\r\n\r\n    backdropAnimation.fromTo('opacity', 0.4, 0.0);\r\n    const modalWrapperElement = baseEl.querySelector('.modal-wrapper');\r\n\r\n    const wrapperAnimation = createAnimation();\r\n    wrapperAnimation.addElement(modalWrapperElement);\r\n    const currentTranslateX = baseEl.getAttribute('data-offset-x');\r\n    const currentOpacity = baseEl.getAttribute('data-opacity');\r\n\r\n    wrapperAnimation\r\n      .fromTo(\r\n        'transform',\r\n        `translateX(${\r\n          currentTranslateX ? parseInt(currentTranslateX, 10) : 0\r\n        }%)`,\r\n        'translateX(100%)'\r\n      )\r\n      .fromTo('opacity', currentOpacity ? parseInt(currentOpacity, 10) : 0, 0);\r\n\r\n    return baseAnimation\r\n      .addElement(baseEl)\r\n      .easing('ease-out')\r\n      .duration(DEFAULT_DURATION)\r\n      .beforeAddClass('show-modal')\r\n      .addAnimation(backdropAnimation)\r\n      .addAnimation(wrapperAnimation);\r\n  }\r\n}\r\n","import { NgZone } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { NavController, Platform } from '@ionic/angular';\r\nimport { AuthService } from 'ionic-appauth';\r\nimport { App } from '@capacitor/app';\r\n\r\nexport function initDeepLinks(\r\n  platform: Platform,\r\n  ngZone: NgZone,\r\n  authService: AuthService,\r\n  navController: NavController,\r\n  router: Router\r\n) {\r\n  return () => {\r\n    if (platform.is('hybrid')) {\r\n      App.addListener('appUrlOpen', (data: any) => {\r\n        ngZone.run(() => {\r\n          if (data?.url.indexOf('regobs://callback') >= 0) {\r\n            authService.authorizationCallback(data.url);\r\n          } else {\r\n            const deepLinkRoute = router.createUrlTree([\r\n              data?.url.replace('regobs://', '')\r\n            ]);\r\n            navController.navigateForward(deepLinkRoute);\r\n          }\r\n        });\r\n      });\r\n    }\r\n  };\r\n}\r\n","import { ErrorHandler, Injectable } from '@angular/core';\r\nimport { LoggingService } from '../../modules/shared/services/logging/logging.service';\r\n\r\n@Injectable()\r\nexport class AppErrorHandler implements ErrorHandler {\r\n  constructor(private loggingService: LoggingService) {}\r\n\r\n  handleError(error: Error) {\r\n    this.loggingService.error(\r\n      error,\r\n      'UnhandledException',\r\n      'Unhandled exception occurred in app.'\r\n    );\r\n    throw error;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport {\r\n  CanActivate,\r\n  ActivatedRouteSnapshot,\r\n  RouterStateSnapshot,\r\n  Router\r\n} from '@angular/router';\r\nimport { RegobsAuthService } from '../../modules/auth/services/regobs-auth.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthGuard implements CanActivate {\r\n  constructor(private router: Router, private authService: RegobsAuthService) {}\r\n\r\n  async canActivate(\r\n    _: ActivatedRouteSnapshot,\r\n    state: RouterStateSnapshot\r\n  ): Promise<boolean> {\r\n    const loggedInUser = await this.authService.getLoggedInUserAsPromise();\r\n    if (!loggedInUser.isLoggedIn) {\r\n      this.authService.signIn();\r\n    }\r\n    return loggedInUser.isLoggedIn;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport {\r\n  Router,\r\n  CanActivate,\r\n  ActivatedRouteSnapshot,\r\n  RouterStateSnapshot\r\n} from '@angular/router';\r\nimport { UserSettingService } from '../services/user-setting/user-setting.service';\r\nimport { take } from 'rxjs/operators';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class StartWizardGuard implements CanActivate {\r\n  constructor(\r\n    private router: Router,\r\n    private userSettingService: UserSettingService\r\n  ) {}\r\n\r\n  async canActivate(\r\n    next: ActivatedRouteSnapshot,\r\n    state: RouterStateSnapshot\r\n  ): Promise<boolean> {\r\n    const userSetting = await this.userSettingService.userSetting$\r\n      .pipe(take(1))\r\n      .toPromise();\r\n    if (!userSetting.completedStartWizard) {\r\n      setTimeout(() => {\r\n        this.router.navigate(['start-wizard']);\r\n      }, 200); // Added 200ms timeout because of white screen on startup, this seems to help.\r\n    }\r\n\r\n    return userSetting.completedStartWizard;\r\n  }\r\n}\r\n","export class CancelPromiseTimer extends Promise<void> {\r\n  static createCancelPromiseTimer(timeoutMs: number) {\r\n    return new Promise<void>((resolve) => {\r\n      const id = setTimeout(() => {\r\n        clearTimeout(id);\r\n        resolve();\r\n      }, timeoutMs);\r\n    });\r\n  }\r\n}\r\n","export function getStarCount(competenceLevel: string): number {\r\n  if (!competenceLevel) {\r\n    return 0;\r\n  }\r\n  return competenceLevel.split('').filter((s) => s === '*').length;\r\n}\r\n","import { Observable, of } from 'rxjs';\r\n\r\nconst BASE64_MARKER = ';base64,';\r\n\r\nexport class DataUrlHelper {\r\n  static async toDataUrlWithSize(\r\n    blob: Blob,\r\n    mimeType: string\r\n  ): Promise<{ dataUrl: string; size: number }> {\r\n    const dataUrl = await this.toDataUrl(blob, mimeType);\r\n    return { size: blob.size, dataUrl };\r\n  }\r\n\r\n  static async toDataUrlWithSizeFromArrayBuffer(\r\n    buffer: ArrayBuffer,\r\n    mimeType: string\r\n  ): Promise<{ dataUrl: string; size: number }> {\r\n    const dataUrl = await this.toDataUrl(\r\n      new Blob([new Uint8Array(buffer, 0, buffer.byteLength)]),\r\n      mimeType\r\n    );\r\n    return { size: buffer.byteLength, dataUrl };\r\n  }\r\n\r\n  static getDataUrlFromSrcUrl(\r\n    src: string,\r\n    mimeType = 'image/jpeg'\r\n  ): Promise<string> {\r\n    return new Promise((resolve, reject) => {\r\n      const xhr = new XMLHttpRequest();\r\n      xhr.onload = async () => {\r\n        const result = await DataUrlHelper.toDataUrl(\r\n          <Blob>xhr.response,\r\n          mimeType\r\n        );\r\n        resolve(result);\r\n      };\r\n      xhr.onabort = () => reject();\r\n      xhr.onerror = () => reject();\r\n      xhr.open('GET', src);\r\n      xhr.responseType = 'blob';\r\n      xhr.send();\r\n    });\r\n  }\r\n\r\n  static toDataUrl(blob: Blob, mimeType: string) {\r\n    return new Promise<string>((resolve, reject) => {\r\n      const reader = new FileReader();\r\n      reader.onloadend = () =>\r\n        resolve(this.ensureCorrectMimeType(reader.result as string, mimeType));\r\n      reader.onerror = () => reject();\r\n      reader.onabort = () => reject();\r\n      reader.readAsDataURL(blob);\r\n    });\r\n  }\r\n\r\n  private static ensureCorrectMimeType(dataUrl: string, mimeType: string) {\r\n    if (dataUrl.startsWith(`data:${mimeType};`)) {\r\n      return dataUrl;\r\n    } else {\r\n      const index = dataUrl.indexOf(BASE64_MARKER) + BASE64_MARKER.length;\r\n      return `data:${mimeType}${BASE64_MARKER}${dataUrl.substr(index)}`;\r\n    }\r\n  }\r\n\r\n  static convertDataURIToBinary(dataUri: string) {\r\n    const index = dataUri.indexOf(BASE64_MARKER) + BASE64_MARKER.length;\r\n    const base64 = dataUri.substring(index);\r\n    const raw = atob(base64);\r\n    const rawLength = raw.length;\r\n    const array = new Uint8Array(rawLength);\r\n\r\n    for (let i = 0; i < rawLength; i++) {\r\n      array[i] = raw.charCodeAt(i);\r\n    }\r\n    return array;\r\n  }\r\n\r\n  static getDataUriByteLength(dataUri: string) {\r\n    const blob = this.convertDataURIToBinary(dataUri);\r\n    return blob.length;\r\n  }\r\n}\r\n","import { Platform } from '@ionic/angular';\r\n\r\nexport function isAndroidOrIos(platform: Platform): boolean {\r\n  return (\r\n    platform.is('hybrid') && (platform.is('android') || platform.is('ios'))\r\n  );\r\n}\r\n","import * as L from 'leaflet';\r\nimport { settings } from '../../../../settings';\r\nimport { of } from 'rxjs';\r\nimport {\r\n  bboxPolygon,\r\n  GeometryObject,\r\n  booleanWithin,\r\n  point,\r\n  Feature\r\n} from '@turf/turf';\r\nexport const SVALBARD_BOUNDS = L.latLngBounds(\r\n  settings.map.bounds.svalbard.bbox.map((coordinate) =>\r\n    L.latLng(coordinate[0], coordinate[1])\r\n  )\r\n);\r\nexport const NORWEGIAN_BOUNDS = require('../../../../assets/json/norway-mainland-simple.json')\r\n  .features[0].geometry;\r\n// export const NORWEGIAN_LATLNG_BOUNDS = L.geoJSON(NORWEGIAN_BOUNDS);\r\n\r\nexport class BorderHelper {\r\n  static isInSvalbard(latLng: L.LatLng, bounds = SVALBARD_BOUNDS) {\r\n    return bounds.contains(latLng);\r\n  }\r\n\r\n  static isInNorway(latLng: L.LatLng) {\r\n    const p = point([latLng.lng, latLng.lat]);\r\n    return booleanWithin(p, NORWEGIAN_BOUNDS);\r\n  }\r\n\r\n  static getSvalbardPolygon() {\r\n    return bboxPolygon(this.toBBox(SVALBARD_BOUNDS));\r\n  }\r\n\r\n  static getLatLngBoundInSvalbardOrNorwayAsObservable(latLng: L.LatLng) {\r\n    return this.isInSvalbard(latLng)\r\n      ? of({ inSvalbard: true, inNorway: true })\r\n      : this.isInNorway(latLng)\r\n        ? of({ inSvalbard: false, inNorway: true })\r\n        : of({ inSvalbard: false, inNorway: false });\r\n  }\r\n\r\n  static toBBox(\r\n    latLngBounds: L.LatLngBounds\r\n  ): [number, number, number, number] {\r\n    return [\r\n      latLngBounds.getSouthWest().lng, // minx\r\n      latLngBounds.getSouthWest().lat, // miny\r\n      latLngBounds.getNorthEast().lng, // maxx\r\n      latLngBounds.getNorthEast().lat // maxy\r\n    ];\r\n  }\r\n\r\n  static isInside(\r\n    latLngBounds: L.LatLngBounds,\r\n    geometry: Feature<GeometryObject>\r\n  ) {\r\n    return booleanWithin(bboxPolygon(this.toBBox(latLngBounds)), geometry);\r\n  }\r\n}\r\n","import * as L from 'leaflet';\r\nimport { Subscription } from 'rxjs';\r\nimport { Position } from '@capacitor/geolocation';\r\n\r\nexport class UserMarker {\r\n  userMarker: L.Marker;\r\n  userMarkerIcon: L.DivIcon;\r\n  headingSubscription: Subscription;\r\n  accuracyMarker: L.Circle;\r\n  map: L.Map;\r\n  position: Position;\r\n  watchId: number;\r\n\r\n  accuracyCircleStyle = {\r\n    stroke: true,\r\n    color: '#03f',\r\n    weight: 3,\r\n    opacity: 0.5,\r\n    fillOpacity: 0.15,\r\n    fillColor: '#03f',\r\n    clickable: false\r\n  };\r\n\r\n  constructor(map: L.Map, position: Position) {\r\n    this.map = map;\r\n    this.position = position;\r\n    this.userMarkerIcon = L.divIcon({\r\n      className: 'leaflet-usermarker',\r\n      iconSize: [18, 18],\r\n      html: '<div class=\\'heading\\'></div><i class=\\'pulse\\'></i>'\r\n    });\r\n    const latLng = {\r\n      lat: position.coords.latitude,\r\n      lng: position.coords.longitude\r\n    };\r\n    this.userMarker = L.marker(latLng, { icon: this.userMarkerIcon });\r\n    this.userMarker.addTo(this.map);\r\n    this.setAccuracy(position);\r\n  }\r\n\r\n  getPosition(): Position {\r\n    return this.position;\r\n  }\r\n\r\n  updatePosition(position: Position) {\r\n    this.position = position;\r\n    const latLng = {\r\n      lat: position.coords.latitude,\r\n      lng: position.coords.longitude\r\n    };\r\n    this.userMarker.setLatLng(latLng);\r\n    this.setAccuracy(position);\r\n    // if (position.coords.heading !== null) {\r\n    //     this.setHeading(position.coords.heading);\r\n    // }\r\n    // NOTE: This is set by compass instead of gps\r\n  }\r\n\r\n  setHeading(degrees: number) {\r\n    const element: HTMLElement = this.userMarker.getElement()\r\n      .childNodes[0] as HTMLElement;\r\n    const rotateZ = degrees - 90;\r\n    element.style['-webkit-transform'] =\r\n      'rotate(' + rotateZ + 'deg) translateX(15px)';\r\n    element.style.display = 'block';\r\n  }\r\n\r\n  private setAccuracy(position: Position) {\r\n    const latLng = {\r\n      lat: position.coords.latitude,\r\n      lng: position.coords.longitude\r\n    };\r\n    if (!this.accuracyMarker) {\r\n      this.accuracyMarker = L.circle(\r\n        latLng,\r\n        position.coords.accuracy,\r\n        this.accuracyCircleStyle\r\n      );\r\n      this.accuracyMarker.addTo(this.map);\r\n    } else {\r\n      this.accuracyMarker.setRadius(position.coords.accuracy);\r\n      this.accuracyMarker.setLatLng(latLng);\r\n    }\r\n  }\r\n}\r\n","import { InanoSQLObserverQuery } from '@nano-sql/core/lib/interfaces';\r\nimport { Observable } from 'rxjs';\r\n\r\nexport class NSqlFullUpdateObservable<T> extends Observable<T> {\r\n  constructor(query: InanoSQLObserverQuery) {\r\n    super((observer) => {\r\n      query.exec((val, err) => {\r\n        if (err) {\r\n          observer.error(err);\r\n        } else {\r\n          observer.next((val as unknown) as T);\r\n        }\r\n      });\r\n      return () => query.unsubscribe();\r\n    });\r\n  }\r\n}\r\n","export class NumberHelper {\r\n  static isNumeric(n: any) {\r\n    return !isNaN(parseFloat(n)) && isFinite(n);\r\n  }\r\n\r\n  static setDecimalPlaces(n: number, decimalPlaces?: number) {\r\n    if (this.isNumeric(n)) {\r\n      // return parseFloat(n.toFixed(decimalPlaces));\r\n      const sign = n >= 0 ? 1 : -1;\r\n      return parseFloat(\r\n        (\r\n          Math.round(n * Math.pow(10, decimalPlaces) + sign * 0.0001) /\r\n          Math.pow(10, decimalPlaces)\r\n        ).toFixed(decimalPlaces)\r\n      );\r\n    } else {\r\n      return n;\r\n    }\r\n  }\r\n\r\n  static isNullOrEmpty(n: any) {\r\n    return n === undefined || n === null || n === '';\r\n  }\r\n\r\n  static isValid(\r\n    n: any,\r\n    min?: number,\r\n    max?: number,\r\n    required = false,\r\n    integer = false\r\n  ) {\r\n    if (required && this.isNullOrEmpty(n)) {\r\n      return false;\r\n    }\r\n    if (!required && this.isNullOrEmpty(n)) {\r\n      return true;\r\n    }\r\n    if (!this.isNumeric(n)) {\r\n      return false;\r\n    }\r\n    const nNumverValue = parseFloat(n);\r\n    if (integer && !Number.isInteger(nNumverValue)) {\r\n      return false;\r\n    }\r\n    if (min !== undefined && nNumverValue < min) {\r\n      return false;\r\n    }\r\n    if (max !== undefined && nNumverValue > max) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n}\r\n","import { Observable, Subject, Subscription } from 'rxjs';\r\nimport { NgZone, OnDestroy, Injectable } from '@angular/core';\r\nimport { timeout } from 'rxjs/operators';\r\n\r\nexport function toPromiseWithCancel<T>(\r\n  observable: Observable<T>,\r\n  cancel?: Promise<void>,\r\n  timeoutInMs?: number,\r\n) {\r\n  return new Promise<T>((resolve, reject) => {\r\n    let subscription: Subscription = undefined;\r\n    subscription =\r\n    (timeoutInMs != null ? observable.pipe(timeout(timeoutInMs)) : observable).subscribe({\r\n      next: (result) => {\r\n        if(subscription) {\r\n          subscription.unsubscribe();\r\n        }\r\n        resolve(result);\r\n      },\r\n      error: (error) => {\r\n        if(subscription) {\r\n          subscription.unsubscribe();\r\n        }\r\n        reject(error);\r\n      }\r\n    });\r\n    if (cancel) {\r\n      cancel.then(() => {\r\n        if(subscription) {\r\n          subscription.unsubscribe();\r\n        }\r\n        reject(new Error('Cancelled'));\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nexport function enterZone(zone: NgZone) {\r\n  return <T>(source: Observable<T>) =>\r\n    new Observable<T>((observer) =>\r\n      source.subscribe({\r\n        next: (x) => zone.run(() => observer.next(x)),\r\n        error: (err) => observer.error(err),\r\n        complete: () => observer.complete()\r\n      })\r\n    );\r\n}\r\n\r\nexport function setObservableTimeout() {\r\n  return <T>(source: Observable<T>) =>\r\n    new Observable<T>((observer) =>\r\n      source.subscribe({\r\n        next: (x) => setTimeout(() => observer.next(x)),\r\n        error: (err) => observer.error(err),\r\n        complete: () => observer.complete()\r\n      })\r\n    );\r\n}\r\n\r\n@Injectable()\r\nexport class NgDestoryBase implements OnDestroy {\r\n  protected readonly ngDestroy$: Subject<void>;\r\n  constructor() {\r\n    this.ngDestroy$ = new Subject();\r\n  }\r\n  ngOnDestroy(): void {\r\n    this.ngDestroy$.next();\r\n    this.ngDestroy$.complete();\r\n  }\r\n}\r\n","import { catchError, map, switchMap, tap } from 'rxjs/operators';\r\nimport {\r\n  HttpRequest,\r\n  HttpInterceptor,\r\n  HttpHandler,\r\n  HttpEvent,\r\n  HttpEventType\r\n} from '@angular/common/http';\r\nimport { EMPTY, from, Observable } from 'rxjs';\r\nimport { Injectable } from '@angular/core';\r\nimport { settings } from '../../../settings';\r\nimport { LoggingService } from 'src/app/modules/shared/services/logging/logging.service';\r\nimport {\r\n  RegobsAuthService,\r\n  TOKEN_RESPONSE_FULL_KEY\r\n} from 'src/app/modules/auth/services/regobs-auth.service';\r\nimport { StorageBackend } from '@openid/appauth';\r\n\r\n/**\r\n * Sender innloggings-token med kall til Regobs API der kallene krever at man er logget inn.\r\n * Hvis api-kallet feiler pga. innloggingsfeil (HTTP 401), prøver vi å fornye tokenet og kjører kallet en gang til\r\n */\r\n@Injectable()\r\nexport class ApiInterceptor implements HttpInterceptor {\r\n  constructor(\r\n    private regobsAuthService: RegobsAuthService,\r\n    private loggerService: LoggingService,\r\n    private storage: StorageBackend\r\n  ) {}\r\n\r\n  private isRegObsApi(url: string): boolean {\r\n    return (\r\n      url.startsWith(\r\n        `${settings.services.regObs.apiUrl['TEST']}/Registration`\r\n      ) ||\r\n      url.startsWith(\r\n        `${settings.services.regObs.apiUrl['DEMO']}/Registration`\r\n      ) ||\r\n      url.startsWith(\r\n        `${settings.services.regObs.apiUrl['PROD']}/Registration`\r\n      ) ||\r\n      url.startsWith(`${settings.services.regObs.apiUrl['TEST']}/Account`) ||\r\n      url.startsWith(`${settings.services.regObs.apiUrl['DEMO']}/Account`) ||\r\n      url.startsWith(`${settings.services.regObs.apiUrl['PROD']}/Account`)\r\n    );\r\n  }\r\n\r\n  private isB2cApi(url: string): boolean {\r\n    return url.indexOf('/token') > -1;\r\n  }\r\n\r\n  intercept(\r\n    req: HttpRequest<unknown>,\r\n    next: HttpHandler\r\n  ): Observable<HttpEvent<unknown>> {\r\n    if (this.isB2cApi(req.url)) {\r\n      return next.handle(req).pipe(\r\n        tap((response) => {\r\n          if (response.type === HttpEventType.Response) {\r\n            this.storage.setItem(\r\n              TOKEN_RESPONSE_FULL_KEY,\r\n              JSON.stringify(response.body)\r\n            );\r\n          }\r\n        })\r\n      );\r\n    }\r\n    if (this.isRegObsApi(req.url) && !req.headers.has('Authorization')) {\r\n      return this.addAuthHeader(req).pipe(\r\n        switchMap((requestWithAuthHeader) => {\r\n          return next.handle(requestWithAuthHeader).pipe(\r\n            catchError((err) => {\r\n              return this.handleResponseError(err, requestWithAuthHeader, next);\r\n            })\r\n          );\r\n        })\r\n      );\r\n    }\r\n    return next.handle(req);\r\n  }\r\n\r\n  private addAuthHeader(\r\n    request: HttpRequest<unknown>\r\n  ): Observable<HttpRequest<unknown>> {\r\n    return this.regobsAuthService.loggedInUser$.pipe(\r\n      catchError((err) => {\r\n        this.loggerService.debug(\r\n          'Could not get valid token',\r\n          'API interceptor',\r\n          err\r\n        );\r\n        this.regobsAuthService.signIn();\r\n        return EMPTY; //TODO: Why this?\r\n      }),\r\n      map((user) => {\r\n        const headers = request.headers.set(\r\n          'Authorization',\r\n          `Bearer ${user.token}`\r\n        );\r\n        return request.clone({ headers });\r\n      })\r\n    );\r\n  }\r\n\r\n  private handleResponseError(\r\n    error,\r\n    request,\r\n    next: HttpHandler\r\n  ): Observable<HttpEvent<unknown>> {\r\n    if (error.status === 401) {\r\n      // Vi er ikke autorisert, trolig fordi tokenet ikke er gyldig\r\n      this.loggerService.debug(\r\n        'Got 401 from API, trying to refresh token and repeat API-call...'\r\n      );\r\n      return from(this.regobsAuthService.refreshToken()).pipe(\r\n        switchMap(() => this.addAuthHeader(request)),\r\n        switchMap((req) => next.handle(req))\r\n      );\r\n    }\r\n    throw error;\r\n  }\r\n}\r\n","export enum SummaryType {\r\n  List = 0,\r\n  Text = 1,\r\n  Url = 2\r\n}\r\n","export enum TopoMap {\r\n  default = 'mixArcGisOnline',\r\n  openTopo = 'openTopo',\r\n  arcGisOnline = 'arcGisOnline',\r\n  statensKartverk = 'statensKartverk',\r\n  mixArcGisOnline = 'mixArcGisOnlineV2',\r\n  mixOpenTopo = 'mixOpenTopo',\r\n  geoDataLandskap = 'geoDataLandskap',\r\n  mixGeoDataLandskap = 'mixGeoDataLandskap'\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { AppVersion } from '../../models/app-version.model';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AppVersionService {\r\n  getAppVersion(): AppVersion {\r\n    try {\r\n      // tslint:disable-next-line:no-var-requires\r\n      return require('../../../../environments/version.json');\r\n    } catch {\r\n      return {\r\n        version: '0.0.0',\r\n        buildNumber: 0,\r\n        revision: '',\r\n        branch: '',\r\n        date: new Date().toISOString()\r\n      };\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { DownloadProgress } from './download-progress';\r\n\r\n@Injectable()\r\nexport abstract class BackgroundDownloadService {\r\n  abstract download(\r\n     url: string\r\n  ): Observable<DownloadProgress>\r\n  // abstract downloadFile(\r\n  //   path: string,\r\n  //   filename: string,\r\n  //   url: string,\r\n  //   onComplete: () => void,\r\n  //   onProgress: (progress: Progress) => void,\r\n  //   onError: (error: Error) => void,\r\n  //   skipLocationSelector?: boolean\r\n  // ): Promise<void>;\r\n  // abstract cancelDownload(filename: string);\r\n  // abstract deleteFolder(path: string, dirName: string): Promise<void>;\r\n  // abstract getFileUrl(path: string, filename: string): Promise<string>;\r\n  // abstract selectDowloadFolder(): Promise<string>;\r\n  // abstract getAllFiles(path: string, dirName: string): Promise<{ directory: string, name: string, url: string, size: number }[]>;\r\n  // abstract downloadToDataUrl(url: string, type: string): Promise<{ dataUrl: string, size: number }>;\r\n}\r\n","import { HttpClient, HttpEvent, HttpEventType, HttpProgressEvent, HttpResponse } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { scan } from 'rxjs/operators';\r\nimport { BackgroundDownloadService } from './background-download.service';\r\nimport { DownloadProgress } from './download-progress';\r\n\r\n@Injectable()\r\nexport class HttpClientDownloadService implements BackgroundDownloadService {\r\n\r\n  constructor(private http: HttpClient) {\r\n  }\r\n\r\n  download(url: string): Observable<DownloadProgress> {\r\n    return this.http.get(url, {\r\n      reportProgress: true,\r\n      observe: 'events',\r\n      responseType: 'blob'\r\n    }).pipe(scan((previous: DownloadProgress, event: HttpEvent<Blob>): DownloadProgress => {\r\n      if (this.isHttpProgressEvent(event)) {\r\n        return {\r\n          progress: event.total\r\n            ?  (event.loaded / event.total)\r\n            : previous.progress,\r\n          state: 'IN_PROGRESS',\r\n          loaded: event.loaded,\r\n          total: event.total,\r\n          content: null\r\n        };\r\n      }\r\n      if (this.isHttpResponse(event)) {\r\n        return {\r\n          progress: 100,\r\n          state: 'DONE',\r\n          total: event.body.size,\r\n          loaded: event.body.size,\r\n          content: event.body\r\n        };\r\n      }\r\n      return previous;\r\n    },\r\n    {state: 'PENDING', progress: 0, loaded: 0, content: null}\r\n    ));\r\n  }\r\n\r\n  private isHttpResponse<T>(event: HttpEvent<T>): event is HttpResponse<T> {\r\n    return event.type === HttpEventType.Response;\r\n  }\r\n\r\n  private isHttpProgressEvent(event: HttpEvent<unknown>): event is HttpProgressEvent {\r\n    return event.type === HttpEventType.DownloadProgress\r\n        || event.type === HttpEventType.UploadProgress;\r\n  }\r\n}","import { Injectable } from '@angular/core';\r\nimport { BackgroundGeolocationService } from './background-geolocation.service';\r\n// import { BackgroundGeolocationConfig, BackgroundGeolocationResponse } from '@ionic-native/background-geolocation';\r\nimport { Platform } from '@ionic/angular';\r\nimport { TripLoggerService } from '../trip-logger/trip-logger.service';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { Geolocation } from '@capacitor/geolocation';\r\nimport { TripLogState } from '../trip-logger/trip-log-state.enum';\r\nimport { LoggingService } from '../../../modules/shared/services/logging/logging.service';\r\n\r\nconst DEBUG_TAG = 'BackgroundGeolocationNativeService';\r\n\r\n@Injectable()\r\nexport class BackgroundGeolocationNativeService\r\nimplements BackgroundGeolocationService {\r\n  backgroundGeolocation: any;\r\n\r\n  constructor(\r\n    private platform: Platform,\r\n    private tripLogger: TripLoggerService,\r\n    private translateService: TranslateService,\r\n    private geolocation: Geolocation,\r\n    private loggingService: LoggingService\r\n  ) {\r\n    this.platform.ready().then(() => {\r\n      this.backgroundGeolocation = (<any>window).BackgroundGeolocation;\r\n    });\r\n  }\r\n\r\n  private async configureBackgroundGeoLocation() {\r\n    await this.platform.ready();\r\n    const translations = await this.translateService\r\n      .get([\r\n        'GEOLOCATION_SERVICE.NOTIFICATION_TITLE',\r\n        'GEOLOCATION_SERVICE.NOTIFICATION_TEXT'\r\n      ])\r\n      .toPromise();\r\n    // const config: BackgroundGeolocationConfig = {\r\n    //     locationProvider: this.backgroundGeolocation.DISTANCE_FILTER_PROVIDER, // ANDROID_DISTANCE_FILTER_PROVIDER\r\n    //     desiredAccuracy: this.backgroundGeolocation.LOW_ACCURACY, // Low\r\n    //     stationaryRadius: 50,\r\n    //     distanceFilter: 50,\r\n    //     debug: false, //  enable this hear sounds for background-geolocation life-cycle.\r\n    //     stopOnTerminate: false, // enable this to clear background location settings when the app terminate\r\n    //     startForeground: true,\r\n    //     notificationTitle: translations['GEOLOCATION_SERVICE.NOTIFICATION_TITLE'],\r\n    //     notificationText: translations['GEOLOCATION_SERVICE.NOTIFICATION_TEXT'],\r\n    //     activityType: 'OtherNavigation',\r\n    //     maxLocations: 1, // Disable local storage of locations, because we handle this in nanoSQL instead\r\n    // };\r\n    // this.backgroundGeolocation.configure(config, () => {\r\n    //     this.loggingService.debug('BackgroundGeolocation set up success!', DEBUG_TAG);\r\n    // }, (error) => {\r\n    //     this.loggingService.error(error, DEBUG_TAG, 'Could not configure background geolocation!');\r\n    // });\r\n  }\r\n\r\n  // savePositionUpdate(location: BackgroundGeolocationResponse) {\r\n  //     return this.tripLogger.saveTripLogItem({\r\n  //         latitude: location.latitude,\r\n  //         longitude: location.longitude,\r\n  //         timestamp: location.time,\r\n  //         accuracy: location.accuracy,\r\n  //         altitude: location.altitude,\r\n  //         heading: location.bearing,\r\n  //         speed: location.speed\r\n  //     });\r\n  // }\r\n\r\n  async start() {\r\n    // await this.tripLogger.updateState(TripLogState.Running);\r\n    // await this.configureBackgroundGeoLocation();\r\n    // this.backgroundGeolocation.on('location', (location: BackgroundGeolocationResponse) => {\r\n    //     // handle your locations here\r\n    //     // to perform long running operation on iOS\r\n    //     // you need to create background task\r\n    //     this.backgroundGeolocation.startTask(async (taskKey) => {\r\n    //         // execute long running task\r\n    //         // eg. ajax post location\r\n    //         // IMPORTANT: task has to be ended by endTask\r\n    //         try {\r\n    //             await this.savePositionUpdate(location);\r\n    //         } catch (error) {\r\n    //             this.loggingService.error(error, DEBUG_TAG, 'Error saving position update!');\r\n    //         } finally {\r\n    //             this.backgroundGeolocation.endTask(taskKey);\r\n    //         }\r\n    //     });\r\n    // });\r\n    // this.backgroundGeolocation.on('error', async (error) => {\r\n    //     this.loggingService.error(\r\n    //         new Error(`Error code: ${error.code}. Message:${error.message}`),\r\n    //         DEBUG_TAG, 'Error in background geolocation!');\r\n    //     await this.tripLogger.updateState(TripLogState.Paused);\r\n    // });\r\n    // this.backgroundGeolocation.on('start', () => {\r\n    //     this.loggingService.debug('BackgroundGeolocation service has been started', DEBUG_TAG);\r\n    // });\r\n    // this.backgroundGeolocation.on('stop', () => {\r\n    //     this.loggingService.debug('BackgroundGeolocation service has been stopped', DEBUG_TAG);\r\n    // });\r\n    // this.backgroundGeolocation.on('authorization', (status) => {\r\n    //     this.loggingService.debug('BackgroundGeolocation authorization status', DEBUG_TAG, status);\r\n    //     if (status !== this.backgroundGeolocation.AUTHORIZED) {\r\n    //         return this.backgroundGeolocation.showAppSettings();\r\n    //     }\r\n    // });\r\n    // this.backgroundGeolocation.checkStatus((status) => {\r\n    //     this.loggingService.debug('BackgroundGeolocation service status', DEBUG_TAG, status);\r\n    //     // you don't need to check status before start (this is just the example)\r\n    //     if (!status.isRunning) {\r\n    //         this.backgroundGeolocation.start(); // triggers start on start event\r\n    //     }\r\n    // });\r\n  }\r\n\r\n  async stop() {\r\n    // await this.platform.ready();\r\n    // await this.tripLogger.updateState(TripLogState.Paused);\r\n    // this.backgroundGeolocation.stop();\r\n    // const lastPosition = await this.geolocation.getCurrentPosition({\r\n    //     enableHighAccuracy: true,\r\n    //     maximumAge: 60 * 1000,\r\n    // });\r\n    // if (lastPosition.coords) {\r\n    //     await this.tripLogger.saveTripLogItem({\r\n    //         latitude: lastPosition.coords.latitude,\r\n    //         longitude: lastPosition.coords.longitude,\r\n    //         accuracy: lastPosition.coords.accuracy,\r\n    //         altitude: lastPosition.coords.altitude,\r\n    //         speed: lastPosition.coords.speed,\r\n    //         timestamp: lastPosition.timestamp,\r\n    //         heading: lastPosition.coords.heading,\r\n    //     });\r\n    // }\r\n    // this.tripLogger.updateState(TripLogState.Paused);\r\n    // for (const event of this.backgroundGeolocation.events) {\r\n    //     return this.backgroundGeolocation.removeAllListeners(event);\r\n    // }\r\n  }\r\n\r\n  isRunning(): Promise<boolean> {\r\n    return Promise.resolve(false);\r\n    // return new Promise((resolve) => {\r\n    //     this.backgroundGeolocation.checkStatus((status) => {\r\n    //         resolve(status.isRunning);\r\n    //     });\r\n    // });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { BackgroundGeolocationService } from './background-geolocation.service';\r\nimport { Subscription } from 'rxjs';\r\n// import {\r\n//   Geoposition,\r\n//   Geolocation,\r\n//   PositionError\r\n// } from '@ionic-native/geolocation/ngx';\r\nimport { TripLoggerService } from '../trip-logger/trip-logger.service';\r\nimport { TripLogState } from '../trip-logger/trip-log-state.enum';\r\nimport { LoggingService } from '../../../modules/shared/services/logging/logging.service';\r\n\r\n//TODO: Har kommentert ut denne servicen når vi fjernet @ionic-native/geolocation/ngx, siden det later til at den ikke er i bruk. Vurder om vi skal slette servicen!\r\n@Injectable()\r\nexport class BackgroundGeolocationWebService\r\nimplements BackgroundGeolocationService {\r\n  watchSubscription?: Subscription;\r\n\r\n  constructor(\r\n    private geolocation: Geolocation,\r\n    private tripLogger: TripLoggerService,\r\n    private loggingService: LoggingService\r\n  ) {}\r\n\r\n  async start() {\r\n    // await this.tripLogger.updateState(TripLogState.Running);\r\n    // this.watchSubscription = this.geolocation\r\n    //   .watchPosition({ maximumAge: 60000, enableHighAccuracy: true })\r\n    //   .subscribe(\r\n    //     (data) => this.onPositionUpdate(data),\r\n    //     (error) => this.onPositionError(error)\r\n    //   );\r\n  }\r\n\r\n  // private onPositionUpdate(data: Geoposition | PositionError) {\r\n  //   // data can be a set of coordinates, or an error (if an error occurred).\r\n  //   // data.coords.latitude\r\n  //   // data.coords.longitude\r\n  //   const pos = data as Geoposition;\r\n  //   if (pos.coords) {\r\n  //     this.tripLogger.saveTripLogItem({\r\n  //       latitude: pos.coords.latitude,\r\n  //       longitude: pos.coords.longitude,\r\n  //       accuracy: pos.coords.accuracy,\r\n  //       altitude: pos.coords.altitude,\r\n  //       speed: pos.coords.speed,\r\n  //       timestamp: pos.timestamp,\r\n  //       heading: pos.coords.heading\r\n  //     });\r\n  //   }\r\n  // }\r\n\r\n  // private onPositionError(error: any) {\r\n  //   this.loggingService.error(error, 'BackgroundGeolocationWebService');\r\n  // }\r\n\r\n  async stop() {\r\n    // await this.tripLogger.updateState(TripLogState.Paused);\r\n    // this.watchSubscription.unsubscribe();\r\n    // this.watchSubscription = null;\r\n  }\r\n\r\n  isRunning() {\r\n    return Promise.resolve(false);\r\n    // return Promise.resolve(!!this.watchSubscription);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\n@Injectable()\r\nexport abstract class BackgroundGeolocationService {\r\n  abstract start(): void;\r\n  abstract stop(): void;\r\n  abstract isRunning(): Promise<boolean>;\r\n}\r\n","import { Injectable, NgZone } from '@angular/core';\r\nimport { WarningService } from '../warning/warning.service';\r\nimport { ObservationService } from '../observation/observation.service';\r\nimport { KdvService } from '../kdv/kdv.service';\r\nimport { CancelPromiseTimer } from '../../helpers/cancel-promise-timer';\r\nimport { UserSettingService } from '../user-setting/user-setting.service';\r\nimport { settings } from '../../../../settings';\r\nimport { Platform } from '@ionic/angular';\r\nimport { RegistrationService } from '../../../modules/registration/services/registration.service';\r\nimport { HelpTextService } from '../../../modules/registration/services/help-text/help-text.service';\r\nimport { TripLoggerService } from '../trip-logger/trip-logger.service';\r\nimport { LoggingService } from '../../../modules/shared/services/logging/logging.service';\r\nimport { Subject, Subscription } from 'rxjs';\r\nimport {\r\n  map,\r\n  switchMap,\r\n  distinctUntilChanged,\r\n  pairwise,\r\n  filter,\r\n  take\r\n} from 'rxjs/operators';\r\nimport { OnReset } from '../../../modules/shared/interfaces/on-reset.interface';\r\nimport { AnalyticService } from '../../../modules/analytics/services/analytic.service';\r\nimport { LangKey, GeoHazard } from '@varsom-regobs-common/core';\r\nimport { AppCustomDimension } from '../../../modules/analytics/enums/app-custom-dimension.enum';\r\nimport { RegobsAuthService } from '../../../modules/auth/services/regobs-auth.service';\r\nimport { Router } from '@angular/router';\r\nconst DEBUG_TAG = 'DataMarshallService';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DataMarshallService implements OnReset {\r\n  foregroundUpdateInterval: NodeJS.Timeout;\r\n  private cancelUpdateObservationsSubject: Subject<boolean>;\r\n  private subscriptions: Subscription[] = [];\r\n\r\n  get observableCancelSubject(): Subject<boolean> {\r\n    return this.cancelUpdateObservationsSubject;\r\n  }\r\n\r\n  get cancelObservationsPromise(): Promise<boolean> {\r\n    return this.cancelUpdateObservationsSubject\r\n      .asObservable()\r\n      .pipe(take(1))\r\n      .toPromise();\r\n  }\r\n\r\n  constructor(\r\n    private ngZone: NgZone,\r\n    private warningService: WarningService,\r\n    private observationService: ObservationService,\r\n    private kdvService: KdvService,\r\n    private helpTextService: HelpTextService,\r\n    private userSettingService: UserSettingService,\r\n    private regobsAuthService: RegobsAuthService,\r\n    private platform: Platform,\r\n    private registrationService: RegistrationService,\r\n    private tripLoggerService: TripLoggerService,\r\n    private loggingService: LoggingService,\r\n    private analyticService: AnalyticService,\r\n    private router: Router\r\n  ) {\r\n    this.cancelUpdateObservationsSubject = new Subject<boolean>();\r\n  }\r\n\r\n  init(): void {\r\n    this.ngZone.runOutsideAngular(() => {\r\n      this.subscriptions.push(\r\n        this.hasDaysBackChangedToLargerValue().subscribe(() => {\r\n          this.loggingService.debug(\r\n            'DaysBack has changed to a larger value. Update observations.',\r\n            DEBUG_TAG\r\n          );\r\n          this.updateObservations();\r\n        })\r\n      );\r\n\r\n      this.subscriptions.push(\r\n        this.userSettingService.appModeAndLanguage$.subscribe(() => {\r\n          this.kdvService.updateKdvElements();\r\n          this.helpTextService.updateHelpTexts();\r\n          this.loggingService.debug(\r\n            'AppMode or Language has changed. Update kdv elements and help texts.',\r\n            DEBUG_TAG\r\n          );\r\n        })\r\n      );\r\n      this.subscriptions.push(\r\n        this.userSettingService.appModeLanguageAndCurrentGeoHazard$.subscribe(\r\n          ([appMode, langKey, geoHazards]) => {\r\n            this.loggingService.debug(\r\n              'AppMode, Language or CurrentGeoHazard has changed. Update observations and warnings.',\r\n              DEBUG_TAG\r\n            );\r\n            this.analyticService.trackDimension(\r\n              AppCustomDimension.language,\r\n              LangKey[langKey]\r\n            );\r\n            this.analyticService.trackDimension(\r\n              AppCustomDimension.appMode,\r\n              appMode\r\n            );\r\n            this.analyticService.trackDimension(\r\n              AppCustomDimension.geoHazard,\r\n              geoHazards.map((gh) => GeoHazard[gh]).join(',')\r\n            );\r\n            this.updateObservations();\r\n            this.warningService.updateWarnings();\r\n          }\r\n        )\r\n      );\r\n      this.subscriptions.push(\r\n        this.userSettingService.userSetting$\r\n          .pipe(\r\n            map((userSetting) => userSetting.consentForSendingAnalytics),\r\n            distinctUntilChanged()\r\n          )\r\n          .subscribe((consent) => {\r\n            if (consent) {\r\n              this.analyticService.enable();\r\n              this.loggingService.enable();\r\n              this.analyticService.trackDimension(\r\n                AppCustomDimension.enabledAnalytics,\r\n                consent\r\n              );\r\n            } else {\r\n              this.analyticService.trackDimension(\r\n                AppCustomDimension.enabledAnalytics,\r\n                consent\r\n              );\r\n              this.analyticService.disable();\r\n              this.loggingService.disable();\r\n            }\r\n          })\r\n      );\r\n      this.subscriptions.push(\r\n        this.userSettingService.showMapCenter$.subscribe((showMapCenter) => {\r\n          this.analyticService.trackDimension(\r\n            AppCustomDimension.showMapCenter,\r\n            showMapCenter.toString()\r\n          );\r\n        })\r\n      );\r\n      this.subscriptions.push(\r\n        this.userSettingService.userSetting$\r\n          .pipe(\r\n            map((userSetting) => userSetting.topoMap),\r\n            distinctUntilChanged()\r\n          )\r\n          .subscribe((topoMap) => {\r\n            this.analyticService.trackDimension(\r\n              AppCustomDimension.topoMap,\r\n              topoMap\r\n            );\r\n          })\r\n      );\r\n      this.subscriptions.push(\r\n        this.userSettingService.supportTiles$\r\n          .pipe(\r\n            map((st) =>\r\n              st\r\n                .filter((x) => x.enabled)\r\n                .map((x) => x.name)\r\n                .join(',')\r\n            ),\r\n            distinctUntilChanged()\r\n          )\r\n          .subscribe((supportMap) => {\r\n            this.analyticService.trackDimension(\r\n              AppCustomDimension.supportMap,\r\n              supportMap\r\n            );\r\n          })\r\n      );\r\n      this.subscriptions.push(\r\n        this.regobsAuthService.loggedInUser$.subscribe((user) =>\r\n          this.loggingService.setUser(user)\r\n        )\r\n      );\r\n      this.subscriptions.push(\r\n        this.userSettingService.appMode$.subscribe((appMode) =>\r\n          this.loggingService.configureLogging(appMode)\r\n        )\r\n      );\r\n\r\n      this.subscriptions.push(\r\n        this.platform.pause.subscribe(() => {\r\n          this.loggingService.debug(\r\n            'App paused. Stop foreground updates.',\r\n            DEBUG_TAG\r\n          );\r\n          this.stopForegroundUpdate();\r\n        })\r\n      );\r\n      this.subscriptions.push(\r\n        this.platform.resume.subscribe(() => {\r\n          this.loggingService.debug(\r\n            `App resumed. Start foreground updates. Current route is '${this.router.url}'`,\r\n            DEBUG_TAG\r\n          );\r\n          this.startForegroundUpdate();\r\n        })\r\n      );\r\n    });\r\n    // this.startForegroundUpdate();\r\n    // No need to unsubscribe this observables when the service is singleton. It get destroyed when app exits.\r\n  }\r\n\r\n  appOnReset(): void {\r\n    this.loggingService.debug('App reset. Unsubscribe all.', DEBUG_TAG);\r\n    this.unsubscribeAll();\r\n  }\r\n\r\n  appOnResetComplete(): void {\r\n    this.init(); // Re-Init service after reset has completed\r\n  }\r\n\r\n  private unsubscribeAll() {\r\n    for (const subscription of this.subscriptions) {\r\n      subscription.unsubscribe();\r\n    }\r\n    this.subscriptions = [];\r\n  }\r\n\r\n  cancelUpdateObservations(): void {\r\n    this.cancelUpdateObservationsSubject.next(true);\r\n  }\r\n\r\n  updateObservations(): void {\r\n    this.observationService.updateObservations(this.cancelObservationsPromise);\r\n  }\r\n\r\n  /**\r\n   * Emits only when days back has changed to a larger value for current geoHazard\r\n   */\r\n  private hasDaysBackChangedToLargerValue() {\r\n    return this.userSettingService.currentGeoHazard$.pipe(\r\n      switchMap((currentGeoHazard) =>\r\n        this.userSettingService.daysBack$.pipe(\r\n          map(\r\n            (val) =>\r\n              val.find((x) => x.geoHazard === currentGeoHazard[0]).daysBack\r\n          ),\r\n          distinctUntilChanged(),\r\n          pairwise(),\r\n          filter(([prev, next]) => next > prev)\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  startForegroundUpdate(): void {\r\n    if (this.foregroundUpdateInterval) {\r\n      this.stopForegroundUpdate();\r\n    }\r\n    this.foregroundUpdateInterval = setInterval(() => {\r\n      this.backgroundFetchUpdate();\r\n    }, settings.foregroundUpdateIntervalMs);\r\n    this.backgroundFetchUpdate(); // Update on resume\r\n  }\r\n\r\n  stopForegroundUpdate(): void {\r\n    clearTimeout(this.foregroundUpdateInterval);\r\n  }\r\n\r\n  backgroundFetchUpdate(useTimeout = false): Promise<void> {\r\n    return this.ngZone.runOutsideAngular(async () => {\r\n      const cancelTimer = useTimeout\r\n        ? CancelPromiseTimer.createCancelPromiseTimer(\r\n          settings.backgroundFetchTimeout\r\n        )\r\n        : null;\r\n      // Use max 20 seconds to backround update, else app will crash (after 30 seconds)\r\n      await this.registrationService.syncRegistrations(cancelTimer);\r\n      const cancelPromiseForObservations = cancelTimer\r\n        ? Promise.race([this.cancelObservationsPromise, cancelTimer])\r\n        : this.cancelObservationsPromise;\r\n      await this.observationService.updateObservations(\r\n        cancelPromiseForObservations\r\n      );\r\n      await this.warningService.updateWarnings(cancelTimer);\r\n      await this.kdvService.updateKdvElements(cancelTimer);\r\n      await this.helpTextService.updateHelpTexts(cancelTimer);\r\n      await this.tripLoggerService.cleanupOldLegacyTrip();\r\n      this.loggingService.debug('Background update completed', DEBUG_TAG);\r\n    });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport {\r\n  SQLite,\r\n  SQLiteObject,\r\n  SQLiteDatabaseConfig\r\n} from '@ionic-native/sqlite/ngx';\r\nimport { Platform } from '@ionic/angular';\r\nimport { settings } from '../../../../settings';\r\nimport '../../helpers/ionic/platform-helper';\r\nimport { LoggingService } from '../../../modules/shared/services/logging/logging.service';\r\nimport { nSQL } from '@nano-sql/core';\r\nimport { NanoSql } from '../../../../nanosql';\r\nimport { LogLevel } from '../../../modules/shared/services/logging/log-level.model';\r\nimport { isAndroidOrIos } from '../../helpers/ionic/platform-helper';\r\nconst stringify = require('json-stringify-safe');\r\n\r\nconst DEBUG_CONTEXT = 'DbHelperService';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DbHelperService {\r\n  sqliteobj: SQLiteObject;\r\n\r\n  constructor(\r\n    private sqlite: SQLite,\r\n    private platform: Platform,\r\n    private loggingService: LoggingService\r\n  ) {}\r\n\r\n  async init() {\r\n    if (isAndroidOrIos(this.platform)) {\r\n      this.loggingService.debug(\r\n        'Create sqlite database connection (helper methods)',\r\n        DEBUG_CONTEXT\r\n      );\r\n      const config: SQLiteDatabaseConfig = {\r\n        name: settings.db.nanoSql.dbName,\r\n        location: 'default'\r\n      };\r\n      this.sqliteobj = await this.sqlite.create(<any>{\r\n        ...config,\r\n        androidDatabaseProvider: 'system'\r\n      });\r\n\r\n      try {\r\n        await this.sqliteobj.executeSql(\r\n          'PRAGMA journal_mode = WAL; PRAGMA synchronous = NORMAL',\r\n          []\r\n        );\r\n      } catch (err) {\r\n        this.loggingService.log(\r\n          'Could not execute PRAGMA',\r\n          err,\r\n          LogLevel.Warning,\r\n          DEBUG_CONTEXT\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * A faster query than NanoSQL. Does a direct qurey by id against SQlite database\r\n   * @param table table name\r\n   * @param id id\r\n   */\r\n  async getItemById<T>(table: string, id: string | number, idColumn = 'id') {\r\n    if (this.sqliteobj) {\r\n      return this.getItemByIdSqlLite<T>(table, id, idColumn);\r\n    } else {\r\n      return this.fallbackGetItemById<T>(table, id, idColumn);\r\n    }\r\n  }\r\n\r\n  async resetDb(onError?: (tableName: string, ex: Error) => void) {\r\n    if (this.sqliteobj) {\r\n      try {\r\n        await this.sqliteobj.executeSql(\r\n          'CREATE TABLE IF NOT EXISTS \"_ai\" (id TEXT PRIMARY KEY UNIQUE, inc BIGINT)'\r\n        );\r\n      } catch (err) {\r\n        if (onError) {\r\n          onError('Could not create _ai table', err);\r\n        }\r\n      }\r\n    }\r\n    await NanoSql.resetDb(onError);\r\n    // await this.init();\r\n  }\r\n\r\n  private async getItemByIdSqlLite<T>(\r\n    table: string,\r\n    id: string | number,\r\n    idColumn = 'id'\r\n  ): Promise<T> {\r\n    const select = `SELECT data FROM '${table}' where id = ?1`;\r\n    const sqlResult = await this.sqliteobj.executeSql(select, [id]);\r\n    if (sqlResult.rows && sqlResult.rows.length > 0) {\r\n      const jsonString = sqlResult.rows.item(0).data;\r\n      if (jsonString) {\r\n        const result: T = JSON.parse(jsonString);\r\n        return result;\r\n      }\r\n    }\r\n  }\r\n\r\n  private async fallbackGetItemById<T>(\r\n    table: string,\r\n    id: string | number,\r\n    idColumn = 'id'\r\n  ): Promise<T> {\r\n    const nanoSqlResult = await nSQL(table)\r\n      .query('select', [`${idColumn}`, '=', id])\r\n      .exec();\r\n    return <T>nanoSqlResult[0];\r\n  }\r\n\r\n  async fastInsert<T>(\r\n    table: string,\r\n    data: T[],\r\n    idSelector?: (data: T) => any,\r\n    rebuildIndexes = false\r\n  ) {\r\n    if (this.sqliteobj) {\r\n      await this.fastInsertSqlLite(table, data, idSelector);\r\n    } else {\r\n      await this.fastInsertNanoSql(table, data, idSelector);\r\n    }\r\n    if (rebuildIndexes) {\r\n      nSQL(table).query('rebuild indexes').exec();\r\n      // NOTE: There is a bug in rebuild indexes, so this might throw an exception\r\n    }\r\n  }\r\n\r\n  private fastInsertSqlLite<T>(\r\n    table: string,\r\n    data: T[],\r\n    idSelector?: (data: T) => any\r\n  ) {\r\n    const _idSelector = idSelector ? idSelector : (_data: T) => (<any>_data).id;\r\n    const statements = data.map((val) => [\r\n      `INSERT OR REPLACE INTO ${table} VALUES (?1, ?2)`,\r\n      [_idSelector(val), stringify(val)]\r\n    ]);\r\n    return this.sqliteobj.sqlBatch(statements);\r\n  }\r\n\r\n  private fastInsertNanoSql<T>(\r\n    table: string,\r\n    data: T[],\r\n    idSelector?: (data: T) => any\r\n  ) {\r\n    return nSQL().rawImport({ [table]: data }, false);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { InAppBrowser } from '@ionic-native/in-app-browser/ngx';\r\nimport { SafariViewController } from '@ionic-native/safari-view-controller/ngx';\r\nimport { Platform } from '@ionic/angular';\r\nimport { LoggingService } from '../../../modules/shared/services/logging/logging.service';\r\nimport { LogLevel } from '../../../modules/shared/services/logging/log-level.model';\r\n\r\nconst DEBUG_TAG = 'ExternalLinkService';\r\nconst VALID_URL_PROTOCOLS = ['http', 'https'];\r\nexport const SAFARI_TINT_COLOR = '#ffffff';\r\nexport const SAFARI_BAR_COLOR = '#044962';\r\nexport const SAFARI_TOOLBAR_COLOR = '#044962';\r\nexport const SAFARI_CONTROL_TINT_COLOR = '#ffffff';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ExternalLinkService {\r\n  constructor(\r\n    private inAppBrowser: InAppBrowser,\r\n    private safariViewController: SafariViewController,\r\n    private loggingService: LoggingService,\r\n    private platform: Platform\r\n  ) {}\r\n\r\n  async openExternalLink(url: string) {\r\n    const validatedUrl = this.ensureCorrectUrl(url);\r\n    if (!this.platform.is('hybrid')) {\r\n      this.openExternalLinkFallback(validatedUrl);\r\n      return;\r\n    }\r\n    const available = await this.safariViewController.isAvailable();\r\n    if (!available) {\r\n      this.loggingService.debug(\r\n        'Safari ViewController or Chrome Custom Tabs not available. Fallback to ianAppBrowser.',\r\n        DEBUG_TAG\r\n      );\r\n      this.openExternalLinkFallback(validatedUrl);\r\n      return;\r\n    }\r\n    this.safariViewController\r\n      .show({\r\n        url: validatedUrl,\r\n        tintColor: SAFARI_TINT_COLOR,\r\n        barColor: SAFARI_BAR_COLOR,\r\n        toolbarColor: SAFARI_TOOLBAR_COLOR,\r\n        controlTintColor: SAFARI_CONTROL_TINT_COLOR\r\n      })\r\n      .subscribe(\r\n        () => {\r\n          this.loggingService.debug(\r\n            'External url opened in Safari ViewController or Chrome Custom Tabs',\r\n            DEBUG_TAG\r\n          );\r\n        },\r\n        (error) => {\r\n          // tslint:disable-next-line:max-line-length\r\n          this.loggingService.log(\r\n            'Could not open external url in Safari ViewController or Chrome Custom Tabs. Fallback to ianAppBrowser.',\r\n            error,\r\n            LogLevel.Warning,\r\n            DEBUG_TAG\r\n          );\r\n          this.openExternalLinkFallback(validatedUrl);\r\n        }\r\n      );\r\n  }\r\n\r\n  openExternalLinkFallback(url: string) {\r\n    this.inAppBrowser.create(url, '_system', 'location=yes,hardwareback=yes');\r\n  }\r\n\r\n  private ensureCorrectUrl(url: string) {\r\n    if (url !== null) {\r\n      if (\r\n        VALID_URL_PROTOCOLS.some((validProtocol) =>\r\n          url.toLowerCase().startsWith(validProtocol)\r\n        )\r\n      ) {\r\n        return url;\r\n      }\r\n      return `http://${url}`;\r\n    }\r\n    return url;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject, from } from 'rxjs';\r\nimport { switchMap, takeUntil } from 'rxjs/operators';\r\nimport { StatusBar } from '@capacitor/status-bar';\r\nimport { NgDestoryBase } from '../../helpers/observable-helper';\r\nimport { Platform } from '@ionic/angular';\r\nimport { isAndroidOrIos } from '../../helpers/ionic/platform-helper';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FullscreenService extends NgDestoryBase {\r\n  private readonly _subject: BehaviorSubject<boolean>;\r\n\r\n  get isFullscreen$() {\r\n    return this._subject.asObservable();\r\n  }\r\n\r\n  constructor(private platform: Platform) {\r\n    super();\r\n    this._subject = new BehaviorSubject(false);\r\n    if (isAndroidOrIos(this.platform)) {\r\n      this.platform.ready().then(() => {\r\n        this.isFullscreen$.pipe(\r\n          switchMap((isFullscreen) => from(isFullscreen ? StatusBar.hide() : StatusBar.show())),\r\n          takeUntil(this.ngDestroy$)\r\n        ).subscribe();\r\n      });\r\n    }\r\n  }\r\n\r\n  toggleFullscreen() {\r\n    this._subject.next(!this._subject.value);\r\n  }\r\n}\r\n","export enum GeoPositionErrorCode {\r\n  Unknown = 0,\r\n  PermissionDenied = 1,\r\n  PositionUnavailable = 2,\r\n  Timeout = 3\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\nimport {\r\n  BehaviorSubject,\r\n  ReplaySubject,\r\n  of,\r\n  Observable,\r\n  Subscription,\r\n  combineLatest,\r\n  merge,\r\n  fromEvent,\r\n  firstValueFrom\r\n} from 'rxjs';\r\nimport {\r\n  filter,\r\n  map,\r\n  distinctUntilChanged,\r\n  startWith\r\n} from 'rxjs/operators';\r\nimport {\r\n  CallbackID,\r\n  ClearWatchOptions,\r\n  Geolocation, Position, WatchPositionCallback,\r\n} from '@capacitor/geolocation';\r\nimport { settings } from '../../../../settings';\r\nimport { LoggingService } from '../../../modules/shared/services/logging/logging.service';\r\nimport { AlertController, Platform } from '@ionic/angular';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { LogLevel } from '../../../modules/shared/services/logging/log-level.model';\r\nimport { GeoPositionLog, PositionError } from './geo-position-log.interface';\r\nimport { GeoPositionErrorCode } from './geo-position-error.enum';\r\nimport moment from 'moment';\r\nimport { isAndroidOrIos } from '../../helpers/ionic/platform-helper';\r\nimport { DeviceOrientation } from '@ionic-native/device-orientation/ngx';\r\n\r\nconst DEBUG_TAG = 'GeoPositionService';\r\n\r\n/**\r\n * Henter posisjon fra GPS og himmelretning fra kompasset\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class GeoPositionService implements OnDestroy {\r\n  private highAccuracyEnabled = new BehaviorSubject(true);\r\n  private gpsPositionLog: ReplaySubject<GeoPositionLog> = new ReplaySubject(20);\r\n  private currentPosition: BehaviorSubject<Position> = new BehaviorSubject(\r\n    null\r\n  );\r\n  private currentHeading: BehaviorSubject<number> = new BehaviorSubject(null);\r\n\r\n  private readonly trackingComponents = new BehaviorSubject<string[]>([]);\r\n\r\n  // Subscriptions\r\n  private watchPositionCallbackId: CallbackID = null;\r\n  private headingSubscription: Subscription;\r\n\r\n  get currentPosition$(): Observable<Position> {\r\n    return this.currentPosition.pipe(filter((cp) => cp !== null));\r\n  }\r\n\r\n  get currentHeading$(): Observable<number> {\r\n    return this.currentHeading.pipe(filter((cp) => cp !== null));\r\n  }\r\n\r\n  get log$(): Observable<GeoPositionLog> {\r\n    return this.gpsPositionLog.asObservable();\r\n  }\r\n\r\n  constructor(\r\n    private deviceOrientation: DeviceOrientation,\r\n    private platform: Platform,\r\n    private loggingService: LoggingService,\r\n    private alertController: AlertController,\r\n    private translateService: TranslateService\r\n  ) {\r\n    this.startGeolocationTrackingSubscription();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.stopSubscriptions();\r\n  }\r\n\r\n  /**\r\n   * @returns last known position\r\n   * @see https://github.com/ionic-team/capacitor/issues/1279\r\n   */\r\n  getSingleCurrentPosition(): Promise<Position> {\r\n    // this.currentPosition always returns a value.\r\n    return firstValueFrom<Position>(this.currentPosition);\r\n  }\r\n\r\n  private startGeolocationTrackingSubscription() {\r\n    const anyComponentsTracking = this.trackingComponents.pipe(\r\n      map((val) => val.length > 0),\r\n      distinctUntilChanged()\r\n    );\r\n    combineLatest([this.getPlatformIsActiveObservable(), anyComponentsTracking])\r\n      .pipe(\r\n        map(([platformIsActive, anyComponentsTracking]) =>\r\n          platformIsActive && anyComponentsTracking ? true : false\r\n        )\r\n      )\r\n      .subscribe((activate) => {\r\n        if (activate) {\r\n          this.startSubscriptions();\r\n        } else {\r\n          this.stopSubscriptions();\r\n        }\r\n      });\r\n  }\r\n\r\n  private getPlatformIsActiveObservable() {\r\n    if (isAndroidOrIos(this.platform)) {\r\n      return merge(\r\n        this.platform.resume.pipe(map(() => true)),\r\n        this.platform.pause.pipe(map(() => false))\r\n      ).pipe(startWith(true));\r\n    }\r\n    return of(true);\r\n  }\r\n\r\n  private createPositionError(\r\n    message: string,\r\n    code: GeoPositionErrorCode = GeoPositionErrorCode.Unknown,\r\n    highAccuracyEnabled = true\r\n  ): GeoPositionLog {\r\n    return {\r\n      timestamp: moment().unix(),\r\n      status: 'PositionError',\r\n      pos: undefined,\r\n      highAccuracyEnabled,\r\n      err: {\r\n        code,\r\n        message\r\n      }\r\n    };\r\n  }\r\n\r\n  getTimestamp(geopos: Position) {\r\n    if (geopos && geopos.timestamp > 0) {\r\n      if (this.platform.is('hybrid') && this.platform.is('ios')) {\r\n        return geopos.timestamp / 1000;\r\n      }\r\n      return geopos.timestamp;\r\n    }\r\n    return moment().unix();\r\n  }\r\n\r\n  private createGpsPositionLogElement(pos: Position): GeoPositionLog {\r\n    const log: GeoPositionLog = {\r\n      timestamp: this.getTimestamp(pos),\r\n      status: (pos.coords === undefined\r\n        ? 'PositionError'\r\n        : 'PositionUpdate') as 'PositionError' | 'PositionUpdate',\r\n      pos,\r\n      highAccuracyEnabled: true,\r\n      err:\r\n        pos.coords === undefined\r\n          ? ((pos as unknown) as PositionError)\r\n          : undefined\r\n    };\r\n    return log;\r\n  }\r\n\r\n  private addStatusToGpsPositionLog(status: 'StartGpsTracking' | 'StopGpsTracking') {\r\n    this.gpsPositionLog.next({\r\n      timestamp: moment().unix(),\r\n      status,\r\n      highAccuracyEnabled: this.highAccuracyEnabled.value\r\n    });\r\n  }\r\n\r\n  public async startTrackingComponent(\r\n    name: string,\r\n    forcePermissionDialog = false\r\n  ) {\r\n    if (forcePermissionDialog) {\r\n      const valid = await this.checkPermissions();\r\n      if (!valid) {\r\n        this.gpsPositionLog.next(\r\n          this.createPositionError(\r\n            'Permission denied',\r\n            GeoPositionErrorCode.PermissionDenied\r\n          )\r\n        );\r\n        return;\r\n      }\r\n    }\r\n    this.trackingComponents.next([\r\n      ...this.getTrackingComponentsExcludeByName(name),\r\n      name\r\n    ]);\r\n  }\r\n\r\n  public stopTrackingComponent(name: string) {\r\n    this.trackingComponents.next([\r\n      ...this.getTrackingComponentsExcludeByName(name)\r\n    ]);\r\n  }\r\n\r\n  private getTrackingComponentsExcludeByName(name: string) {\r\n    return this.trackingComponents.value.filter((x) => x !== name);\r\n  }\r\n\r\n  private startSubscriptions() {\r\n    this.startWatchingPosition();\r\n    this.startWatchingHeading();\r\n  }\r\n\r\n  private stopSubscriptions() {\r\n    this.stopWatchingHeading();\r\n    this.stopWatchingPosition();\r\n  }\r\n\r\n  private stopWatchingPosition() {\r\n    if (this.watchPositionCallbackId !== null) {\r\n      this.loggingService.debug(`Stop current GPS position watch subscription with callback ID: ${this.watchPositionCallbackId}`, DEBUG_TAG);\r\n      this.addStatusToGpsPositionLog('StopGpsTracking');\r\n      const options:  ClearWatchOptions = { id : this.watchPositionCallbackId };\r\n      Geolocation.clearWatch(options);\r\n      this.watchPositionCallbackId = null;\r\n    }\r\n  }\r\n\r\n\r\n  private async startWatchingPosition(): Promise<void> {\r\n    const watchPositionCallback: WatchPositionCallback = (position: Position, err: any) => {\r\n      if (err) {\r\n        this.loggingService.log(\r\n          'Error when watchPosition',\r\n          err,\r\n          LogLevel.Warning,\r\n          DEBUG_TAG,\r\n          err\r\n        );\r\n        this.gpsPositionLog.next(this.createPositionError('Unknown error'));\r\n      }\r\n      if (position !== null) {\r\n        this.gpsPositionLog.next(this.createGpsPositionLogElement(position));\r\n        if (this.isValidPosition(position)) {\r\n          this.currentPosition.next(position);\r\n        }\r\n      }\r\n    };\r\n    this.addStatusToGpsPositionLog('StartGpsTracking');\r\n    this.stopWatchingPosition(); //we need to stop current watch of position if any\r\n    this.watchPositionCallbackId = await Geolocation.watchPosition(settings.gps.highAccuracyPositionOptions, watchPositionCallback);\r\n    this.loggingService.debug(`Start current GPS position watch subscription with callback ID: ${this.watchPositionCallbackId}`, DEBUG_TAG);\r\n  }\r\n\r\n  private isValidPosition(pos: Position): boolean {\r\n    return (\r\n      pos !== undefined &&\r\n      pos !== null &&\r\n      pos.coords !== undefined &&\r\n      pos.coords !== null &&\r\n      pos.coords.latitude >= -90 &&\r\n      pos.coords.latitude <= 90 &&\r\n      pos.coords.longitude >= -180 &&\r\n      pos.coords.longitude <= 180\r\n    );\r\n  }\r\n\r\n  private isValidHeading(heading: number) {\r\n    return heading >= 0 && heading <= 360;\r\n  }\r\n\r\n\r\n  private async checkPermissions(): Promise<boolean> {\r\n    // https://www.devhybrid.com/ionic-4-requesting-user-permissions/\r\n    try {\r\n      const currentPermissions = await Geolocation.checkPermissions();\r\n      this.loggingService.debug(`Geolocation (PermissionState) is ${currentPermissions?.location}`, DEBUG_TAG);\r\n      const authorized = currentPermissions.location === 'granted';\r\n      if (!authorized) {\r\n        if (this.platform.is('ios')) {\r\n          await this.showPermissionDeniedError();\r\n          return false;\r\n        }\r\n        // location is not authorized, request new. This only works on Android\r\n        const newPermissionsAfterRequest = await Geolocation.requestPermissions();\r\n        this.loggingService.debug(`Geolocation (PermissionState) after new request is ${newPermissionsAfterRequest?.location}`, DEBUG_TAG);\r\n        if (newPermissionsAfterRequest?.location === 'denied') {\r\n          await this.showPermissionDeniedError();\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    } catch (err) {\r\n      this.loggingService.error(\r\n        err,\r\n        DEBUG_TAG,\r\n        'Error asking for location permissions'\r\n      );\r\n      return true; // continute anyway on error\r\n    }\r\n  }\r\n\r\n  private async showPermissionDeniedError() {\r\n    const translations = await this.translateService\r\n      .get([\r\n        'ALERT.OK',\r\n        'PERMISSION.LOCATION_DENIED_HEADER',\r\n        'PERMISSION.LOCATION_DENIED_MESSAGE'\r\n      ])\r\n      .toPromise();\r\n    const alert = await this.alertController.create({\r\n      header: translations['PERMISSION.LOCATION_DENIED_HEADER'],\r\n      message: translations['PERMISSION.LOCATION_DENIED_MESSAGE'],\r\n      buttons: [translations['ALERT.OK']]\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  private startWatchingHeading() {\r\n    if (this.headingSubscription && !this.headingSubscription.closed) {\r\n      this.headingSubscription.unsubscribe();\r\n    }\r\n    // NOTE! Because of issues with show heading with W3C Devece Orientation API in iOS 13, the depricated\r\n    // plugin cordova-plugin-device-orientation is used instead on ios\r\n    // https://github.com/apache/cordova-plugin-device-orientation/issues/52\r\n    this.headingSubscription = (this.isIos()\r\n      ? this.getHeadingNative()\r\n      : this.getWebHeadingObservable()\r\n    ).subscribe((heading: number) => this.validateAndSetHeading(heading));\r\n  }\r\n\r\n  private isIos(): boolean {\r\n    return this.platform.is('hybrid') && this.platform.is('ios');\r\n  }\r\n\r\n  private getHeadingNative() {\r\n    return this.deviceOrientation\r\n      .watchHeading({filter: 1}) //get notified only if heading changes > 1 degree\r\n      .pipe(map((val) => val?.magneticHeading));\r\n  }\r\n\r\n  private getWebHeadingObservable() {\r\n    return merge(\r\n      fromEvent(<any>window, 'deviceorientationabsolute'),\r\n      fromEvent(<any>window, 'deviceorientation')\r\n    ).pipe(\r\n      map((event: DeviceOrientationEvent) => {\r\n        const appleHeading = (<any>event).webkitCompassHeading;\r\n        const heading: number = appleHeading || this.getAbsoluteHeading(event);\r\n        return heading;\r\n      })\r\n    );\r\n  }\r\n\r\n  // private requestDeviceOrientationPermission(): Promise<boolean> {\r\n  // TODO: iOS 13 ask for permission every time, and from localhost.\r\n  // this needs to be better supported before turning on\r\n  // or use another native plugin than depricated\r\n  // https://github.com/apache/cordova-plugin-device-orientation\r\n  // https://medium.com/flawless-app-stories/how-to-request-device-motion-and-orientation-permission-in-ios-13-74fc9d6cd140\r\n  // https://github.com/apache/cordova-plugin-device-orientation/issues/52\r\n\r\n  // const doe = <any>DeviceOrientationEvent;\r\n  // if (typeof doe.requestPermission === 'function') {\r\n  //   // iOS 13+\r\n  //   const response = await doe.requestPermission();\r\n  //   return response === 'granted';\r\n  // } else {\r\n  //   // non iOS 13+\r\n  // return Promise.resolve(true);\r\n  // }\r\n  // }\r\n\r\n  private getAbsoluteHeading(event: DeviceOrientationEvent) {\r\n    return event.alpha !== undefined && event.absolute\r\n      ? 360 - event.alpha\r\n      : undefined;\r\n  }\r\n\r\n  private validateAndSetHeading(heading: number) {\r\n    if (this.isValidHeading(heading)) {\r\n      this.currentHeading.next(heading);\r\n    }\r\n  }\r\n\r\n  private stopWatchingHeading() {\r\n    if (this.headingSubscription && !this.headingSubscription.closed) {\r\n      this.headingSubscription.unsubscribe();\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class HelperService {\r\n  constructor() {}\r\n\r\n  getDistanceText(distanceInMeter: number, numDecimals = 1): string {\r\n    const options = {\r\n      minimumFractionDigits: numDecimals,\r\n      maximumFractionDigits: numDecimals\r\n    };\r\n    if (distanceInMeter > 1000) {\r\n      return `${(distanceInMeter / 1000).toLocaleString(\r\n        undefined,\r\n        options\r\n      )}  km`;\r\n    } else {\r\n      return `${(distanceInMeter || 0).toFixed(0)} m`;\r\n    }\r\n  }\r\n\r\n  formatMsToTime(duration: number, showMilliseconds = false) {\r\n    const milliseconds = Math.floor((duration % 1000) / 100);\r\n    const seconds = Math.floor((duration / 1000) % 60);\r\n    const minutes = Math.floor((duration / (1000 * 60)) % 60);\r\n    const hours = Math.floor((duration / (1000 * 60 * 60)) % 24);\r\n\r\n    return (\r\n      `${hours < 10 ? '0' + hours : hours}` +\r\n      `:${minutes < 10 ? '0' + minutes : minutes}` +\r\n      `:${seconds < 10 ? '0' + seconds : seconds}` +\r\n      (showMilliseconds ? `.${milliseconds}` : '')\r\n    );\r\n  }\r\n\r\n  humanReadableByteSize(bytes: number, fractionDigits = 1, si = true) {\r\n    const thresh = si ? 1000 : 1024;\r\n    if (Math.abs(bytes) < thresh) {\r\n      return bytes + ' B';\r\n    }\r\n    const units = si\r\n      ? ['kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\r\n      : ['KiB', 'MiB', 'GiB', 'TiB', 'PiB', 'EiB', 'ZiB', 'YiB'];\r\n    let u = -1;\r\n    do {\r\n      bytes /= thresh;\r\n      ++u;\r\n    } while (Math.abs(bytes) >= thresh && u < units.length - 1);\r\n    return bytes.toFixed(fractionDigits) + ' ' + units[u];\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport * as RegobsApi from '@varsom-regobs-common/regobs-api';\r\nimport { settings } from '../../../../settings';\r\nimport { UserSettingService } from '../user-setting/user-setting.service';\r\nimport { LangKey, AppMode } from '@varsom-regobs-common/core';\r\nimport { NanoSql } from '../../../../nanosql';\r\nimport { KdvElementsResponseDto } from '@varsom-regobs-common/regobs-api';\r\nimport { combineLatest, Observable } from 'rxjs';\r\nimport { switchMap, map, shareReplay, take } from 'rxjs/operators';\r\nimport { DataLoadService } from '../../../modules/data-load/services/data-load.service';\r\nimport moment from 'moment';\r\nimport { toPromiseWithCancel } from '../../helpers/observable-helper';\r\nimport { LoggingService } from '../../../modules/shared/services/logging/logging.service';\r\nimport { NSqlFullUpdateObservable } from '../../helpers/nano-sql/NSqlFullUpdateObservable';\r\n\r\nconst DEBUG_TAG = 'KdvService';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class KdvService {\r\n  private _kdvElements$: Observable<KdvElementsResponseDto>;\r\n\r\n  get kdvElements$() {\r\n    return this._kdvElements$;\r\n  }\r\n\r\n  constructor(\r\n    private kdvApiService: RegobsApi.KdvElementsService,\r\n    private userSettingService: UserSettingService,\r\n    private dataLoadService: DataLoadService,\r\n    private loggingService: LoggingService\r\n  ) {\r\n    this._kdvElements$ = this.getKdvElementsObservable();\r\n  }\r\n\r\n  async updateKdvElements(cancel?: Promise<void>) {\r\n    const userSetting = await this.userSettingService.userSetting$\r\n      .pipe(take(1))\r\n      .toPromise();\r\n    await this.checkLastUpdatedAndUpdateDataIfNeeded(\r\n      userSetting.appMode,\r\n      userSetting.language,\r\n      cancel\r\n    );\r\n  }\r\n\r\n  private getDataLoadId(appMode: AppMode, language: LangKey) {\r\n    return `${NanoSql.TABLES.KDV_ELEMENTS.name}_${appMode}_${language}`;\r\n  }\r\n\r\n  private async checkLastUpdatedAndUpdateDataIfNeeded(\r\n    appMode: AppMode,\r\n    language: LangKey,\r\n    cancel?: Promise<void>\r\n  ) {\r\n    const dataLoad = await this.dataLoadService.getState(\r\n      this.getDataLoadId(appMode, language)\r\n    );\r\n    const isLoadingTimeout = moment().subtract(\r\n      settings.foregroundUpdateIntervalMs,\r\n      'milliseconds'\r\n    );\r\n    if (\r\n      dataLoad.isLoading &&\r\n      moment(dataLoad.startedDate).isAfter(isLoadingTimeout)\r\n    ) {\r\n      this.loggingService.debug(\r\n        'Kdv elements is allready being updated.',\r\n        DEBUG_TAG\r\n      );\r\n    } else {\r\n      const lastUpdateLimit = moment().subtract(\r\n        settings.kdvElements.daysBeforeUpdate,\r\n        'day'\r\n      );\r\n      if (\r\n        !dataLoad.lastUpdated ||\r\n        moment(dataLoad.lastUpdated).isBefore(lastUpdateLimit)\r\n      ) {\r\n        await this.updateKdvElementsForLanguage(appMode, language, cancel);\r\n      }\r\n    }\r\n  }\r\n\r\n  async updateKdvElementsForLanguage(\r\n    appMode: AppMode,\r\n    language: LangKey,\r\n    cancel?: Promise<void>\r\n  ) {\r\n    const dataLoadId = this.getDataLoadId(appMode, language);\r\n    await this.dataLoadService.startLoading(dataLoadId);\r\n    try {\r\n      const kdvElements = await toPromiseWithCancel(\r\n        this.kdvApiService.KdvElementsGetKdvs({ langkey: language }),\r\n        cancel,\r\n        20000\r\n      );\r\n      await NanoSql.getInstance(NanoSql.TABLES.KDV_ELEMENTS.name, appMode)\r\n        .query('upsert', { langKey: language, ...kdvElements })\r\n        .exec();\r\n      await this.dataLoadService.loadingCompleted(dataLoadId);\r\n      return true;\r\n    } catch (err) {\r\n      await this.dataLoadService.loadingError(dataLoadId, err.message);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  getKdvRepositoryByKeyObservable(key: string) {\r\n    return this.kdvElements$.pipe(map((val) => val.KdvRepositories[key]));\r\n  }\r\n\r\n  getViewRepositoryByKeyObservable(key: string) {\r\n    return this.kdvElements$.pipe(map((val) => val.ViewRepositories[key]));\r\n  }\r\n\r\n  private getKdvElementsObservable() {\r\n    return combineLatest([\r\n      this.userSettingService.appMode$,\r\n      this.userSettingService.language$\r\n    ]).pipe(\r\n      switchMap(([appMode, langKey]) =>\r\n        this.getKdvElementsFromDbAsStream(appMode, langKey)\r\n      ),\r\n      shareReplay(1)\r\n    );\r\n  }\r\n\r\n  private getKdvElementsFromDbAsStream(appMode: AppMode, langKey: LangKey) {\r\n    return new NSqlFullUpdateObservable<KdvElementsResponseDto[]>(\r\n      NanoSql.getInstance(NanoSql.TABLES.KDV_ELEMENTS.name, appMode)\r\n        .query('select')\r\n        .where(['langKey', '=', langKey])\r\n        .listen()\r\n    ).pipe(\r\n      map((val: KdvElementsResponseDto[]) =>\r\n        val.length > 0 ? val[0] : this.getDefaultKdvElements(langKey)\r\n      )\r\n    );\r\n  }\r\n\r\n  private getDefaultKdvElements(langKey: LangKey) {\r\n    const langKeyName = LangKey[langKey];\r\n    const defaultKdvElements: KdvElementsResponseDto = require(`../../../../assets/json/kdvelements.${langKeyName}.json`);\r\n    return defaultKdvElements;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { settings } from '../../../../settings';\r\nimport { RowCount } from '../../models/row-count.model';\r\nimport { Observable, combineLatest, of, BehaviorSubject } from 'rxjs';\r\nimport moment from 'moment';\r\nimport 'moment-timezone';\r\nimport { NanoSql } from '../../../../nanosql';\r\nimport {\r\n  map,\r\n  distinctUntilChanged,\r\n  switchMap,\r\n  shareReplay,\r\n  tap,\r\n  catchError,\r\n  take\r\n} from 'rxjs/operators';\r\nimport { UserSettingService } from '../user-setting/user-setting.service';\r\nimport { DataLoadService } from '../../../modules/data-load/services/data-load.service';\r\nimport { UserSetting } from '../../models/user-settings.model';\r\nimport { LangKey, GeoHazard, AppMode } from '@varsom-regobs-common/core';\r\nimport { SearchService } from '@varsom-regobs-common/regobs-api';\r\nimport {\r\n  RegistrationViewModel,\r\n  ObserverResponseDto\r\n} from '@varsom-regobs-common/regobs-api';\r\nimport { toPromiseWithCancel } from '../../helpers/observable-helper';\r\nimport { LoggingService } from '../../../modules/shared/services/logging/logging.service';\r\nimport { DbHelperService } from '../db-helper/db-helper.service';\r\nimport { LogLevel } from '../../../modules/shared/services/logging/log-level.model';\r\nimport { NSqlFullUpdateObservable } from '../../helpers/nano-sql/NSqlFullUpdateObservable';\r\n\r\nconst DEBUG_TAG = 'ObservationService';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ObservationService {\r\n  private _observationsObservable: Observable<RegistrationViewModel[]>;\r\n  private _dataLoadObservable: Observable<string>;\r\n  private latestObservations: BehaviorSubject<{\r\n    [key: string]: RegistrationViewModel[];\r\n  }>;\r\n\r\n  get observations$() {\r\n    return this._observationsObservable;\r\n  }\r\n\r\n  get dataLoad$() {\r\n    return this._dataLoadObservable;\r\n  }\r\n\r\n  constructor(\r\n    private searchService: SearchService,\r\n    private userSettingService: UserSettingService,\r\n    private dataLoadService: DataLoadService,\r\n    private loggingService: LoggingService,\r\n    private dbHelperService: DbHelperService\r\n  ) {\r\n    this.latestObservations = new BehaviorSubject({});\r\n    this._observationsObservable = this.getObservationsAsObservable();\r\n    this._dataLoadObservable = this.getDataLoadObservable();\r\n  }\r\n\r\n  async updateObservations(cancel?: Promise<any>) {\r\n    let cancelled = false;\r\n    if (cancel) {\r\n      cancel.then(() => {\r\n        cancelled = true;\r\n      });\r\n    }\r\n    const userSettings = await this.userSettingService.userSetting$\r\n      .pipe(take(1))\r\n      .toPromise();\r\n    if (!cancelled) {\r\n      const result = await this.checkLastUpdatedAndUpdateDataIfNeeded(\r\n        userSettings.currentGeoHazard,\r\n        userSettings,\r\n        cancel\r\n      );\r\n      return result;\r\n    } else {\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  private getDataLoadId(\r\n    appMode: AppMode,\r\n    geoHazards: GeoHazard[],\r\n    langKey: LangKey\r\n  ) {\r\n    return `${NanoSql.TABLES.OBSERVATION.name}_${geoHazards.join(\r\n      '-'\r\n    )}_${appMode}_${langKey}`;\r\n  }\r\n\r\n  private getDataLoadObservable() {\r\n    return this.userSettingService.appModeLanguageAndCurrentGeoHazard$.pipe(\r\n      map(([appMode, language, currentGeoHazard]) =>\r\n        this.getDataLoadId(appMode, currentGeoHazard, language)\r\n      )\r\n    );\r\n  }\r\n\r\n  private async checkLastUpdatedAndUpdateDataIfNeeded(\r\n    geoHazards: GeoHazard[],\r\n    userSetting: UserSetting,\r\n    cancel?: Promise<void>\r\n  ) {\r\n    const dataLoadId = this.getDataLoadId(\r\n      userSetting.appMode,\r\n      geoHazards,\r\n      userSetting.language\r\n    );\r\n    const dataLoad = await this.dataLoadService.getState(dataLoadId);\r\n    const isLoadingTimeout = moment().subtract(\r\n      settings.foregroundUpdateIntervalMs,\r\n      'milliseconds'\r\n    );\r\n    if (\r\n      dataLoad.isLoading &&\r\n      moment(dataLoad.startedDate).isAfter(isLoadingTimeout)\r\n    ) {\r\n      this.loggingService.debug('Observations is already loading.', DEBUG_TAG);\r\n      return 0;\r\n    } else {\r\n      const lastUpdateLimit = moment().subtract(15, 'minutes');\r\n      const fromDate = await this.getDaysBackToFetchAsDate(\r\n        userSetting,\r\n        geoHazards\r\n      );\r\n      if (\r\n        !dataLoad.lastUpdated ||\r\n        moment(dataLoad.lastUpdated).isBefore(lastUpdateLimit) ||\r\n        moment(dataLoad.itemsFromDate).isAfter(fromDate)\r\n      ) {\r\n        return this.updateObservationsForGeoHazard(\r\n          geoHazards,\r\n          userSetting,\r\n          cancel\r\n        );\r\n      } else {\r\n        this.loggingService.debug(\r\n          `No need to update ${geoHazards.join(', ')}.\r\n        Last updated is: ${dataLoad.lastUpdated}`,\r\n          DEBUG_TAG\r\n        );\r\n        return 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  getLastUpdatedForCurrentGeoHazardAsObservable() {\r\n    return this.userSettingService.appModeLanguageAndCurrentGeoHazard$.pipe(\r\n      switchMap(([appMode, language, currentGeoHazard]) =>\r\n        this.dataLoadService.getStateAsObservable(\r\n          this.getDataLoadId(appMode, currentGeoHazard, language)\r\n        )\r\n      ),\r\n      map((val) =>\r\n        val && val.lastUpdated ? moment(val.lastUpdated).toDate() : null\r\n      )\r\n    );\r\n  }\r\n\r\n  async forceUpdateObservationsForCurrentGeoHazard(cancel?: Promise<any>) {\r\n    const userSettings = await this.userSettingService.userSetting$\r\n      .pipe(take(1))\r\n      .toPromise();\r\n    return this.updateObservationsForGeoHazard(\r\n      userSettings.currentGeoHazard,\r\n      userSettings,\r\n      cancel\r\n    );\r\n  }\r\n\r\n  private async getDaysBackToFetchAsDate(\r\n    userSetting: UserSetting,\r\n    geoHazards: GeoHazard[]\r\n  ) {\r\n    const daysBack = await this.getObservationsDaysBack(\r\n      userSetting,\r\n      geoHazards\r\n    );\r\n    const fromDate = moment().subtract(daysBack, 'days').startOf('day');\r\n    return fromDate.toDate();\r\n  }\r\n\r\n  async updateObservationsForGeoHazard(\r\n    geoHazards: GeoHazard[],\r\n    userSetting: UserSetting,\r\n    cancel?: Promise<any>\r\n  ) {\r\n    this.loggingService.debug(\r\n      `Updating observations for geoHazard: ${geoHazards.join(', ')}`,\r\n      DEBUG_TAG\r\n    );\r\n    const dataLoadId = this.getDataLoadId(\r\n      userSetting.appMode,\r\n      geoHazards,\r\n      userSetting.language\r\n    );\r\n    await this.dataLoadService.startLoading(dataLoadId);\r\n    const fromDate = await this.getDaysBackToFetchAsDate(\r\n      userSetting,\r\n      geoHazards\r\n    );\r\n    let isCanceled = false;\r\n    if (cancel) {\r\n      cancel.then(() => {\r\n        isCanceled = true;\r\n      });\r\n    }\r\n    try {\r\n      const searchResult = await toPromiseWithCancel(\r\n        this.searchService.SearchSearch({\r\n          FromDtObsTime: fromDate.toISOString(),\r\n          SelectedGeoHazards: geoHazards,\r\n          NumberOfRecords: settings.observations.maxObservationsToFetch,\r\n          LangKey: userSetting.language,\r\n          TimeZone: moment().format('Z')\r\n        }),\r\n        cancel,\r\n        60000\r\n      );\r\n      this.loggingService.debug(\r\n        `Got ${\r\n          searchResult.length\r\n        } new observations for geoHazards ${geoHazards.join(', ')}`,\r\n        DEBUG_TAG\r\n      );\r\n      if (!isCanceled) {\r\n        this.updateLatestObservations(\r\n          userSetting.appMode,\r\n          userSetting.language,\r\n          geoHazards,\r\n          searchResult\r\n        );\r\n        await this.dataLoadService.loadingCompleted(\r\n          dataLoadId,\r\n          searchResult.length,\r\n          fromDate,\r\n          new Date()\r\n        );\r\n        this.saveAndClenupOfflineObservations(\r\n          fromDate,\r\n          geoHazards,\r\n          userSetting,\r\n          searchResult\r\n        );\r\n        return searchResult.length;\r\n      } else {\r\n        this.loggingService.debug(\r\n          'Operation cancelled. Saving load error.',\r\n          DEBUG_TAG\r\n        );\r\n        await this.dataLoadService.loadingError(\r\n          dataLoadId,\r\n          'Operation cancelled'\r\n        );\r\n        return 0;\r\n      }\r\n    } catch (err) {\r\n      if (isCanceled) {\r\n        this.loggingService.debug(err, DEBUG_TAG, 'Operation cancelled');\r\n      } else {\r\n        this.loggingService.log(\r\n          'Loading error. Is network available?',\r\n          err,\r\n          LogLevel.Warning\r\n        );\r\n      }\r\n      await this.dataLoadService.loadingError(dataLoadId, err.message);\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  private updateLatestObservations(\r\n    appMode: AppMode,\r\n    langKey: LangKey,\r\n    geoHazards: GeoHazard[],\r\n    observations: RegistrationViewModel[]\r\n  ) {\r\n    const latestObs = this.latestObservations.getValue();\r\n    const key = this.getGeoHazardKeyFull(appMode, langKey, geoHazards);\r\n    latestObs[key] = observations;\r\n    this.latestObservations.next(latestObs);\r\n  }\r\n\r\n  private async saveAndClenupOfflineObservations(\r\n    fromDate: Date,\r\n    geoHazards: GeoHazard[],\r\n    userSetting: UserSetting,\r\n    result: RegistrationViewModel[]\r\n  ) {\r\n    const instanceName = NanoSql.getInstanceName(\r\n      NanoSql.TABLES.OBSERVATION.name,\r\n      userSetting.appMode\r\n    );\r\n    const now = new Date();\r\n    await this.dbHelperService.fastInsert(\r\n      instanceName,\r\n      result,\r\n      (data) => data.RegId\r\n    );\r\n    this.loggingService.debug(\r\n      `fastInsert took ${new Date().getTime() - now.getTime()} ms`,\r\n      DEBUG_TAG\r\n    );\r\n    const deleteResult = await this.deleteObservationNoLongerInResult(\r\n      userSetting.appMode,\r\n      geoHazards,\r\n      fromDate,\r\n      result\r\n    );\r\n    this.loggingService.debug(\r\n      'Deleted items no longer in updated result',\r\n      DEBUG_TAG,\r\n      deleteResult\r\n    );\r\n    await this.deleteOldObservations(userSetting.appMode, geoHazards);\r\n  }\r\n\r\n  getObservationsForCurrentUser(\r\n    appMode: AppMode,\r\n    langKey: LangKey,\r\n    pageNr?: number,\r\n    numberOfRecords = 10\r\n  ): Observable<RegistrationViewModel[]> {\r\n    return this.searchService\r\n      .SearchSearch({\r\n        NumberOfRecords: numberOfRecords,\r\n        LangKey: langKey,\r\n        Offset: (pageNr || 0) * numberOfRecords,\r\n        ObserverGuid: 'user.Guid', //TODO: Create call for \"My registrations\" in api v5\r\n        TimeZone: moment().format('Z')\r\n      })\r\n      .pipe(catchError((err) => of([]))); // Return empty list if http request fails);\r\n  }\r\n\r\n  async updateObservationById(\r\n    regId: number,\r\n    appMode: AppMode,\r\n    langKey: LangKey,\r\n    currentGeoHazards: GeoHazard[]\r\n  ) {\r\n    const result = await this.getRegistrationByRegIdFromApi(\r\n      regId,\r\n      appMode,\r\n      langKey\r\n    ).toPromise();\r\n    if (result) {\r\n      await NanoSql.getInstance(NanoSql.TABLES.OBSERVATION.name, appMode)\r\n        .query('upsert', result)\r\n        .exec();\r\n      // Reset next observations, so it will be fetched from db when one item is updated\r\n      this.updateLatestObservations(\r\n        appMode,\r\n        langKey,\r\n        currentGeoHazards,\r\n        undefined\r\n      );\r\n    }\r\n    return result;\r\n  }\r\n\r\n  private getRegistrationByRegIdFromApi(\r\n    regId: number,\r\n    appMode: AppMode,\r\n    langKey: LangKey\r\n  ) {\r\n    return this.searchService\r\n      .SearchSearch({ RegId: regId, LangKey: langKey })\r\n      .pipe(map((result) => result[0]));\r\n  }\r\n\r\n  getObservationsDaysBack(\r\n    userSettings: UserSetting,\r\n    geoHazards: GeoHazard[]\r\n  ): number {\r\n    const daysBackForCurrentGeoHazard = userSettings.observationDaysBack.find(\r\n      (setting) => setting.geoHazard === geoHazards[0]\r\n    );\r\n    const daysBack = daysBackForCurrentGeoHazard\r\n      ? daysBackForCurrentGeoHazard.daysBack\r\n      : 3; // default to 3 days back if not found\r\n    return daysBack;\r\n  }\r\n\r\n  private getObservationDaysBackAsDate(userSettings: UserSetting): Date {\r\n    const daysBack = this.getObservationsDaysBack(\r\n      userSettings,\r\n      userSettings.currentGeoHazard\r\n    );\r\n    const fromDate = moment().subtract(daysBack, 'days').startOf('day');\r\n    return fromDate.toDate();\r\n  }\r\n\r\n  private deleteObservationNoLongerInResult(\r\n    appMode: AppMode,\r\n    geoHazards: GeoHazard[],\r\n    fromDate: Date,\r\n    items: RegistrationViewModel[]\r\n  ) {\r\n    return NanoSql.getInstance(NanoSql.TABLES.OBSERVATION.name, appMode)\r\n      .query('delete')\r\n      .where((reg: RegistrationViewModel) => {\r\n        return (\r\n          reg &&\r\n          geoHazards.indexOf(reg.GeoHazardTID) >= 0 &&\r\n          moment(reg.DtObsTime).isSameOrAfter(fromDate) &&\r\n          !items.find((item) => item.RegId === reg.RegId)\r\n        );\r\n      })\r\n      .exec();\r\n  }\r\n\r\n  private async deleteOldObservations(\r\n    appMode: AppMode,\r\n    geoHazards: GeoHazard[]\r\n  ) {\r\n    const daysBack = await this.getMaxDaysBackForGeoHazard(geoHazards);\r\n    const deleteOldRecordsFrom = moment().subtract(daysBack + 1, 'days');\r\n    return NanoSql.getInstance(NanoSql.TABLES.OBSERVATION.name, appMode)\r\n      .query('delete')\r\n      .where((reg: RegistrationViewModel) => {\r\n        return (\r\n          reg &&\r\n          moment(reg.DtObsTime).isBefore(deleteOldRecordsFrom) &&\r\n          geoHazards.indexOf(reg.GeoHazardTID) >= 0\r\n        );\r\n      })\r\n      .exec();\r\n  }\r\n\r\n  private getMaxDaysBackForGeoHazard(geoHazards: GeoHazard[]) {\r\n    const geoHazardString = this.getGeoHazardKey(geoHazards);\r\n    const daysBackForCurrentGeoHazard: number[] =\r\n      settings.observations.daysBack[geoHazardString];\r\n    return Math.max(...daysBackForCurrentGeoHazard);\r\n  }\r\n\r\n  private getUserSettingsObservableDistinctToChangeObservations() {\r\n    return this.userSettingService.userSetting$.pipe(\r\n      distinctUntilChanged<UserSetting, string>(\r\n        (x, y) => x.localeCompare(y) === 0,\r\n        (x) => this.getDistinctUserSettingsToChangeObservations(x)\r\n      )\r\n    );\r\n  }\r\n\r\n  private getGeoHazardKey(geoHazards: GeoHazard[]) {\r\n    return GeoHazard[geoHazards[0]];\r\n  }\r\n\r\n  private getGeoHazardKeyFull(\r\n    appMode: AppMode,\r\n    language: LangKey,\r\n    geoHazards: GeoHazard[]\r\n  ) {\r\n    return `${appMode}_${language}_${this.getGeoHazardKey(geoHazards)}`;\r\n  }\r\n\r\n  private getObservationsAsObservable(): Observable<RegistrationViewModel[]> {\r\n    return combineLatest([\r\n      this.getUserSettingsObservableDistinctToChangeObservations(),\r\n      this.latestObservations.asObservable()\r\n    ]).pipe(\r\n      tap((val) =>\r\n        this.loggingService.debug(\r\n          'User settings or latest observations triggered change',\r\n          DEBUG_TAG,\r\n          val\r\n        )\r\n      ),\r\n      switchMap(([userSetting, latestObservations]) => {\r\n        const key = this.getGeoHazardKeyFull(\r\n          userSetting.appMode,\r\n          userSetting.language,\r\n          userSetting.currentGeoHazard\r\n        );\r\n        if (latestObservations[key] !== undefined) {\r\n          const filteredObservations = latestObservations[key].filter((reg) =>\r\n            this.observationByParameterFilter(\r\n              reg,\r\n              userSetting.language,\r\n              userSetting.currentGeoHazard,\r\n              this.getObservationDaysBackAsDate(userSetting)\r\n            )\r\n          );\r\n          return of(filteredObservations);\r\n        }\r\n        return this.getObservationsByParametersAsObservable(\r\n          userSetting.appMode,\r\n          userSetting.language,\r\n          userSetting.currentGeoHazard,\r\n          this.getObservationDaysBackAsDate(userSetting)\r\n        );\r\n      }),\r\n      shareReplay(1)\r\n    );\r\n  }\r\n\r\n  private getDistinctUserSettingsToChangeObservations(\r\n    userSetting: UserSetting\r\n  ) {\r\n    const dateString = this.getObservationDaysBackAsDate(\r\n      userSetting\r\n    ).toISOString();\r\n    return `${userSetting.appMode}#${\r\n      userSetting.language\r\n    }#${userSetting.currentGeoHazard.join(',')}#${dateString}`;\r\n  }\r\n\r\n  private getObservationsByParametersQuery(\r\n    appMode: AppMode,\r\n    langKey: LangKey,\r\n    geoHazards?: GeoHazard[],\r\n    fromDate?: Date,\r\n  ) {\r\n    return NanoSql.getInstance(NanoSql.TABLES.OBSERVATION.name, appMode)\r\n      .query('select')\r\n      .where((reg: RegistrationViewModel) =>\r\n        this.observationByParameterFilter(\r\n          reg,\r\n          langKey,\r\n          geoHazards,\r\n          fromDate,\r\n        )\r\n      );\r\n  }\r\n\r\n  private observationByParameterFilter(\r\n    reg: RegistrationViewModel,\r\n    langKey: LangKey,\r\n    geoHazards?: GeoHazard[],\r\n    fromDate?: Date,\r\n    observerGuid?: string\r\n  ) {\r\n    return (\r\n      !!reg &&\r\n      (geoHazards ? geoHazards.indexOf(reg.GeoHazardTID) >= 0 : true) &&\r\n      (fromDate ? moment(reg.DtObsTime).isAfter(fromDate) : true)\r\n    );\r\n  }\r\n\r\n  // NOTE: Since we are using fastInsert, normal NanoSQL change feed is not supported, using subject trigger instead\r\n  /**\r\n   * Query observations by parameters\r\n   * @param appMode\r\n   * @param geoHazard\r\n   * @param fromDate\r\n   * @param user\r\n   */\r\n  getObservationsByParametersAsObservable(\r\n    appMode: AppMode,\r\n    langKey: LangKey,\r\n    geoHazards?: GeoHazard[],\r\n    fromDate?: Date,\r\n  ): Observable<RegistrationViewModel[]> {\r\n    return new NSqlFullUpdateObservable<RegistrationViewModel[]>(\r\n      this.getObservationsByParametersQuery(\r\n        appMode,\r\n        langKey,\r\n        geoHazards,\r\n        fromDate,\r\n      ).listen({\r\n        debounce: 500,\r\n        unique: true,\r\n        compareFn: (a, b) => this.isDifferent(a, b, langKey)\r\n      })\r\n    ).pipe(\r\n      map((items) =>\r\n        items.sort((a, b) => moment(b.DtObsTime).diff(moment(a.DtObsTime)))\r\n      ),\r\n      tap((items) =>\r\n        this.loggingService.debug(\r\n          'Observations observable change feed',\r\n          DEBUG_TAG,\r\n          items\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  isDifferent(rowsA: RegistrationViewModel[], rowsB: RegistrationViewModel[], langKey: LangKey) {\r\n    return (\r\n      this.getUniqueObservations(rowsA, langKey) !== this.getUniqueObservations(rowsB, langKey)\r\n    );\r\n  }\r\n\r\n  uniqueObservation(obs: RegistrationViewModel, langKey: LangKey) {\r\n    return `${obs.RegId}_${langKey}_${obs.DtChangeTime}`;\r\n  }\r\n\r\n  getUniqueObservations(rows: RegistrationViewModel[], langKey: LangKey) {\r\n    if (!rows) {\r\n      return '';\r\n    }\r\n    return rows.map((x) => this.uniqueObservation(x, langKey)).join('#');\r\n  }\r\n\r\n  async getObservationById(id: number, appMode: AppMode, langKey: LangKey) {\r\n    const result = await NanoSql.getInstance(\r\n      NanoSql.TABLES.OBSERVATION.name,\r\n      appMode\r\n    )\r\n      .query('select')\r\n      .where(['RegId', '=', id])\r\n      .exec();\r\n    return result[0] as RegistrationViewModel;\r\n  }\r\n\r\n  getObserableCount(appMode: AppMode): Observable<number> {\r\n    return new NSqlFullUpdateObservable<RowCount[]>(\r\n      NanoSql.getInstance(NanoSql.TABLES.OBSERVATION.name, appMode)\r\n        .query('select', ['COUNT(*) as count'])\r\n        .listen({\r\n          debounce: 100\r\n        })\r\n    ).pipe(\r\n      map((val: RowCount[]) => val[0].count),\r\n      distinctUntilChanged()\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { NanoSql } from '../../../../nanosql';\r\nimport moment from 'moment';\r\nimport { IOfflineAsset } from './offline-asset.interface';\r\nimport { LoggingService } from '../../../modules/shared/services/logging/logging.service';\r\nimport '../../helpers/ionic/platform-helper';\r\nimport { nSQL } from '@nano-sql/core';\r\nimport { LogLevel } from '../../../modules/shared/services/logging/log-level.model';\r\nimport { DataUrlHelper } from '../../helpers/data-url.helper';\r\n\r\nconst DEBUG_TAG = 'OfflineImageService';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class OfflineImageService {\r\n  constructor(private loggingService: LoggingService) {}\r\n\r\n  async getOfflineImage(url: string) {\r\n    const offlineAsset = await this.getOfflineAssetFromDb(url);\r\n    if (offlineAsset) {\r\n      this.updateLastAccess(offlineAsset);\r\n      return offlineAsset.dataUrl;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private updateLastAccess(offlineAsset: IOfflineAsset) {\r\n    offlineAsset.lastAccess = moment().unix();\r\n    return nSQL(NanoSql.TABLES.OFFLINE_ASSET.name)\r\n      .query('upsert', offlineAsset)\r\n      .exec();\r\n  }\r\n\r\n  async saveOfflineImageDataUrl(\r\n    url: string,\r\n    dataUrl: string,\r\n    type = 'image/jpg'\r\n  ) {\r\n    try {\r\n      const size = DataUrlHelper.getDataUriByteLength(dataUrl);\r\n\r\n      const offlineAsset: IOfflineAsset = {\r\n        url,\r\n        type,\r\n        lastAccess: moment().unix(),\r\n        size,\r\n        dataUrl\r\n      };\r\n      await nSQL(NanoSql.TABLES.OFFLINE_ASSET.name)\r\n        .query('upsert', offlineAsset)\r\n        .exec();\r\n      return offlineAsset;\r\n    } catch (error) {\r\n      this.loggingService.log(\r\n        'Could not save offline asset',\r\n        error,\r\n        LogLevel.Warning,\r\n        DEBUG_TAG,\r\n        url\r\n      );\r\n      return null;\r\n    }\r\n  }\r\n\r\n  async getOfflineAssetFromDb(url: string) {\r\n    const result = (await nSQL(NanoSql.TABLES.OFFLINE_ASSET.name)\r\n      .query('select')\r\n      .where(['url', '=', url])\r\n      .exec()) as IOfflineAsset[];\r\n    if (result.length > 0) {\r\n      return result[0];\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  async cleanupOldItems() {\r\n    const fromDate = moment().subtract(1, 'month').unix();\r\n    return nSQL(NanoSql.TABLES.OFFLINE_ASSET.name)\r\n      .query('delete')\r\n      .where((x) => x.lastAccess < fromDate)\r\n      .exec();\r\n  }\r\n\r\n  async reset() {\r\n    await nSQL(NanoSql.TABLES.OFFLINE_ASSET.name).query('delete').exec();\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Directory, Encoding, Filesystem } from '@capacitor/filesystem';\r\nimport { WebView } from '@ionic-native/ionic-webview/ngx';\r\nimport { AlertController, Platform } from '@ionic/angular';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport JSZip from 'jszip';\r\nimport moment from 'moment';\r\nimport { BehaviorSubject, firstValueFrom, from, Observable, Subject, Subscription } from 'rxjs';\r\nimport { finalize, map, mergeMap, switchMap } from 'rxjs/operators';\r\nimport { CompoundPackage, Part } from 'src/app/pages/offline-map/metadata.model';\r\nimport { LogLevel } from '../../../modules/shared/services/logging/log-level.model';\r\nimport { LoggingService } from '../../../modules/shared/services/logging/logging.service';\r\nimport { isAndroidOrIos } from '../../helpers/ionic/platform-helper';\r\nimport { BackgroundDownloadService } from '../background-download/background-download.service';\r\nimport { HelperService } from '../helpers/helper.service';\r\nimport { OfflineMapPackage, OfflineTilesMetadata } from './offline-map.model';\r\nimport { OfflineTilesRegistry } from './offline-tiles-registry';\r\nimport { ProgressStep } from './progress-step.model';\r\nimport { Progress } from './progress.model';\r\n\r\nconst DEBUG_TAG = 'OfflineMapService';\r\nconst METADATA_FILE = 'metadata.json';\r\nconst ROOT_MAP_DIR = 'maps';\r\n\r\nfunction arrayBufferToBase64(buffer: ArrayBuffer) {\r\n  let binary = '';\r\n  new Uint8Array(buffer).forEach((byte) => binary += String.fromCharCode(byte));\r\n  return btoa(binary);\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class OfflineMapService {\r\n  private packages: BehaviorSubject<OfflineMapPackage[]> = new BehaviorSubject([]);\r\n  packages$: Observable<OfflineMapPackage[]> = this.packages.asObservable();\r\n\r\n  private finishedPackageIds: Subject<string> = new Subject();\r\n\r\n  /**\r\n   * Through this you get name of packages when unpacking is finished and they are ready to use\r\n   */\r\n  finishedPackageIds$: Observable<string> = this.finishedPackageIds.asObservable();\r\n\r\n  private downloadAndUnzipProgress: BehaviorSubject<OfflineMapPackage[]> = new BehaviorSubject([]);\r\n  downloadAndUnzipProgress$ = this.downloadAndUnzipProgress.asObservable();\r\n\r\n  availableDiskspace: { available: number; used: number };\r\n  private downloadSubscription: Subscription;\r\n  private cancel = false;\r\n\r\n  private rootFileUrl = '';\r\n  offlineTilesRegistry = new OfflineTilesRegistry();\r\n\r\n  constructor(\r\n    private loggingService: LoggingService,\r\n    private webView: WebView,\r\n    private backgroundDownloadService: BackgroundDownloadService,\r\n    private platform: Platform,\r\n    private helperService: HelperService,\r\n    private translateService: TranslateService,\r\n    private alertController: AlertController\r\n  ) {\r\n    // Start with map packages already downloaded\r\n    this.getMapPackages()\r\n      .then((packages) => {\r\n        this.packages.next(packages);\r\n      })\r\n      .catch((err) => {\r\n        this.loggingService.error(err, DEBUG_TAG, 'Failed to get map packages');\r\n      });\r\n    this.packages$\r\n      .pipe(\r\n        switchMap((packages) =>\r\n          from(this.getDeviceFreeDiskSpace()).pipe(\r\n            map((available) => ({\r\n              available,\r\n              used: this.calculateTotalOfflinePackagesDiskspaceUsed(packages)\r\n            }))\r\n          )\r\n        )\r\n      )\r\n      .subscribe((val) => {\r\n        setTimeout(() => {\r\n          this.availableDiskspace = val;\r\n        });\r\n      });\r\n\r\n    this.packages$.subscribe((packages) =>\r\n      this.registerOfflineMapPackages(packages)\r\n    );\r\n  }\r\n\r\n  private async getMapPackages(): Promise<OfflineMapPackage[]> {\r\n    // TODO: Create own provider for fetching offline packages from storage\r\n    if (!isAndroidOrIos(this.platform)) {\r\n      return [];\r\n    }\r\n\r\n    // Read offline map package names\r\n    const readDirResult = await Filesystem.readdir({\r\n      path: await this.getRootFileUrl()\r\n    });\r\n    const packageNames = await this.getFolderNameWithCompleteFiles(\r\n      readDirResult.files\r\n    );\r\n    this.loggingService.debug('packageNames', DEBUG_TAG, packageNames);\r\n\r\n    // Read all package metadata\r\n    const packages = await Promise.all(\r\n      packageNames.map((name) => this.getMetadata(name))\r\n    );\r\n\r\n    return packages;\r\n  }\r\n\r\n  private registerOfflineMapPackages(mapPackages: OfflineMapPackage[]) {\r\n    this.loggingService.debug('registerOfflineMapPackages', DEBUG_TAG);\r\n\r\n    this.offlineTilesRegistry.clear();\r\n    for (const mapPackage of mapPackages) {\r\n      this.offlineTilesRegistry.add(mapPackage);\r\n    }\r\n  }\r\n\r\n  private calculateTotalOfflinePackagesDiskspaceUsed(\r\n    packages: OfflineMapPackage[]\r\n  ): number {\r\n    return packages.reduce(\r\n      (pv, cv) => (cv.downloadComplete && cv.size != null ? cv.size : 0) + pv,\r\n      0\r\n    );\r\n  }\r\n\r\n  private async getFolderNameWithCompleteFiles(folders: string[]): Promise<string[]> {\r\n    return (\r\n      await Promise.all(\r\n        folders.map((folder: string) =>\r\n          this.hasCompleteFile(folder).then((result) =>\r\n            result ? folder : null\r\n          )\r\n        )\r\n      )\r\n    ).filter((packageName) => packageName != null);\r\n  }\r\n\r\n  public async downloadPackage(\r\n    packageMetadataCombined: CompoundPackage,\r\n    checkAvailableDiskSpace = false\r\n  ): Promise<void> {\r\n    if (checkAvailableDiskSpace) {\r\n      //TODO: Ask user to prefer saving to external SD card if available?\r\n      const availableSpace = await this.checkAvailableDiskSpace(\r\n        packageMetadataCombined\r\n      );\r\n      if (!availableSpace) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (await this.isPermissionToSaveFilesDenied()) {\r\n      return;\r\n    }\r\n\r\n    const mapPackage = this.createOfflineMapPackage(packageMetadataCombined);\r\n\r\n    // Add new map package to progress subject\r\n    this.downloadAndUnzipProgress.next([\r\n      ...this.downloadAndUnzipProgress.value,\r\n      mapPackage\r\n    ]);\r\n\r\n    if (this.downloadSubscription == null) {\r\n      //Start downlaod if not anyting currently downloading\r\n      this.startDownloadNextItemInQueue();\r\n    }\r\n  }\r\n\r\n  private async isPermissionToSaveFilesDenied(): Promise<boolean> {\r\n    if (!this.platform.is('android')) {\r\n      return false; //this check is only required in Android\r\n    }\r\n    const permissionStatus = await Filesystem.checkPermissions();\r\n    if (permissionStatus.publicStorage !== 'granted') {\r\n      const permissionStatusAfterRequest =\r\n        await Filesystem.requestPermissions();\r\n      if (permissionStatusAfterRequest.publicStorage !== 'granted') {\r\n        this.loggingService.debug(\r\n          `Permission to save files = ${permissionStatusAfterRequest.publicStorage}`,\r\n          DEBUG_TAG\r\n        );\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private startDownloadNextItemInQueue() {\r\n    const nextInQueue = this.downloadAndUnzipProgress.value.filter(\r\n      (p) => p.progress.step === ProgressStep.pending\r\n    )[0];\r\n    if (nextInQueue != null) {\r\n      this.onProgress(nextInQueue, {\r\n        step: ProgressStep.download,\r\n        percentage: 0,\r\n        description: ''\r\n      });\r\n\r\n      this.startDownloadPackage(nextInQueue);\r\n    }\r\n  }\r\n\r\n  private startDownloadPackage(offlineMapPackage: OfflineMapPackage) {\r\n    // Find all zip-files (urls) to download and unzip\r\n    const parts = offlineMapPackage.compoundPackageMetadata.getParts();\r\n\r\n    // Start recursive download and unzip\r\n    this.downloadAndUnzipPart(\r\n      parts[0],\r\n      parts,\r\n      offlineMapPackage,\r\n      0,\r\n    );\r\n  }\r\n\r\n  public cancelDownloadPackage(offlineMapPackage: OfflineMapPackage) {\r\n    if (offlineMapPackage.progress.step === ProgressStep.pending) {\r\n      this.removePackageFromDownloadAndProgress(offlineMapPackage);\r\n    } else if (offlineMapPackage.error) {\r\n      this.onCancelled(offlineMapPackage);\r\n    } else if (\r\n      offlineMapPackage.progress.step === ProgressStep.download ||\r\n      offlineMapPackage.progress.step === ProgressStep.extractZip\r\n    ) {\r\n      this.cancel = true;\r\n      this.downloadSubscription?.unsubscribe();\r\n    }\r\n  }\r\n\r\n  private removePackageFromDownloadAndProgress(\r\n    offlineMapPackage: OfflineMapPackage\r\n  ) {\r\n    this.downloadAndUnzipProgress.next(\r\n      this.downloadAndUnzipProgress.value.filter(\r\n        (mapPackage) => mapPackage.name !== offlineMapPackage.name\r\n      )\r\n    );\r\n  }\r\n\r\n  private downloadAndUnzipPart(\r\n    part: Part,\r\n    parts: Part[],\r\n    mapPackage: OfflineMapPackage,\r\n    partNumber: number,\r\n  ) {\r\n    this.downloadSubscription = this.backgroundDownloadService\r\n      .download(part.url)\r\n      .pipe(\r\n        finalize(() => {\r\n          if (this.cancel) {\r\n            this.onCancelled(mapPackage);\r\n          }\r\n        })\r\n      )\r\n      .subscribe(\r\n        async (downloadProgress) => {\r\n          switch (downloadProgress.state) {\r\n          case 'IN_PROGRESS':\r\n            await this.reportDownloadProgress(mapPackage, downloadProgress.progress, partNumber, parts.length);\r\n            break;\r\n          case 'DONE':\r\n            await this.handleUnzip(mapPackage, downloadProgress.content, part, partNumber, parts);\r\n            break;\r\n          default:\r\n            break;\r\n          }\r\n        },\r\n        (err) => this.onUnzipOrDownloadError(mapPackage, err, true)\r\n      );\r\n  }\r\n\r\n  private async handleUnzip(\r\n    mapPackage: OfflineMapPackage,\r\n    blob: Blob,\r\n    part: Part,\r\n    partNumber: number,\r\n    parts: Part[]): Promise<void> {\r\n\r\n    const folder = `${mapPackage.name}/${part.name}`;\r\n    const totalParts = parts.length;\r\n    const root = await this.getRootFileUrl();\r\n    await this.unzipFile(\r\n      blob,\r\n      root,\r\n      folder,\r\n      () => this.onUnzipStepComplete(parts, mapPackage, partNumber),\r\n      async (progress) =>\r\n        this.onProgress(mapPackage, {\r\n          step: ProgressStep.extractZip,\r\n          percentage: this.calculateTotalProgress(progress, partNumber, totalParts, 'Unzipping'),\r\n          description: await firstValueFrom(this.translateService.get(\r\n            'OFFLINE_MAP.STATUS.UNZIP_PART_X_OF_Y', {\r\n              n: partNumber + 1,\r\n              totalParts\r\n            }))\r\n        }),\r\n      (error) => this.onUnzipOrDownloadError(mapPackage, error, false)\r\n    );\r\n  }\r\n\r\n  private async reportDownloadProgress(mapPackage: OfflineMapPackage,\r\n    progress: number,\r\n    partNumber: number,\r\n    totalParts: number): Promise<void> {\r\n\r\n    this.onProgress(mapPackage, {\r\n      step: ProgressStep.download,\r\n      percentage: this.calculateTotalProgress(progress, partNumber, totalParts, 'Downloading'),\r\n      description: await firstValueFrom(this.translateService.get(\r\n        'OFFLINE_MAP.STATUS.DOWNLOADING_PART_X_OF_Y', {\r\n          n: partNumber + 1,\r\n          totalParts\r\n        }))\r\n    });\r\n  }\r\n\r\n  public calculateTotalProgress(\r\n    currentProgress: number,\r\n    currentPart: number,\r\n    totalParts: number,\r\n    partOfStep: 'Downloading' | 'Unzipping'\r\n  ) {\r\n    const stepsForEachPart = 2; // Download and unzip\r\n    const totalPartsOfWork = totalParts * stepsForEachPart;\r\n    const currentPartOfWork =\r\n      (currentPart * stepsForEachPart +\r\n        (partOfStep === 'Downloading' ? 0 : 1)) /\r\n      totalPartsOfWork;\r\n    const progressForTotalParts =\r\n      currentProgress / totalPartsOfWork + currentPartOfWork;\r\n    return progressForTotalParts;\r\n  }\r\n\r\n  private onUnzipStepComplete(parts: Part[], mapPackage: OfflineMapPackage, partNumber: number) {\r\n    if (this.cancel) {\r\n      this.onCancelled(mapPackage);\r\n      return;\r\n    }\r\n\r\n    const nextPart = partNumber + 1;\r\n    const totalParts = parts.length;\r\n    if (nextPart < totalParts) {\r\n      this.downloadAndUnzipPart(\r\n        parts[nextPart],\r\n        parts,\r\n        mapPackage,\r\n        nextPart,\r\n      );\r\n    } else {\r\n      this.onDownloadAndUnzipComplete(mapPackage);\r\n    }\r\n  }\r\n\r\n  public async checkAvailableDiskSpace(\r\n    packageMetadataCombined: CompoundPackage\r\n  ): Promise<boolean> {\r\n    if (isAndroidOrIos(this.platform) && this.availableDiskspace != null) {\r\n      const neededSpace = await this.getNeededDiskSpaceForPackage(\r\n        packageMetadataCombined\r\n      );\r\n\r\n      this.loggingService.debug(\r\n        `Available storage is ${this.helperService.humanReadableByteSize(\r\n          this.availableDiskspace.available\r\n        )}. \r\n      Needs ${this.helperService.humanReadableByteSize(neededSpace)}`,\r\n        DEBUG_TAG\r\n      );\r\n\r\n      if (this.availableDiskspace.available < neededSpace) {\r\n        this.loggingService.log(\r\n          'Not enough disk space to save and extract package',\r\n          null,\r\n          LogLevel.Warning,\r\n          DEBUG_TAG\r\n        );\r\n\r\n        await this.showNotEnoughDiskSpaceAvailableErrorMessage();\r\n        return false;\r\n      }\r\n    } else {\r\n      return Promise.resolve(true);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public async getNeededDiskSpaceForPackage(\r\n    packageMetadataCombined: CompoundPackage,\r\n    compressionFactor = 1.1\r\n  ): Promise<number> {\r\n    const neededSpaceForCurrentPackage =\r\n      packageMetadataCombined.getSizeInMiB() * 1024 * 1024 * compressionFactor;\r\n    const neededSpaceForItemsInQueue = await this.getNeededSpaceForItemsInQueue(compressionFactor);\r\n    return neededSpaceForCurrentPackage + neededSpaceForItemsInQueue;\r\n  }\r\n\r\n  private async getNeededSpaceForItemsInQueue(compressionFactor): Promise<number> {\r\n    return firstValueFrom(this.downloadAndUnzipProgress$\r\n      .pipe(\r\n        map((items) =>\r\n          items\r\n            .filter((x) => x.downloadComplete == null && x.error == null)\r\n            .reduce((pv, cv) => (pv += cv.size * compressionFactor), 0)\r\n        )\r\n      ));\r\n  }\r\n\r\n  private async showNotEnoughDiskSpaceAvailableErrorMessage() {\r\n    const translations = await this.translateService\r\n      .get(['OFFLINE_MAP.DISKSPACE_ERROR_MESSAGE', 'ALERT.OK'])\r\n      .toPromise();\r\n    const alert = await this.alertController.create({\r\n      message: translations['OFFLINE_MAP.DISKSPACE_ERROR_MESSAGE'],\r\n      buttons: [\r\n        {\r\n          text: translations['ALERT.OK']\r\n        }\r\n      ]\r\n    });\r\n    alert.present();\r\n  }\r\n\r\n  private async showDownloadOrUnzipErrorMessage(isDownloading: boolean) {\r\n    let messageKey = null;\r\n    if (isDownloading) {\r\n      messageKey = 'OFFLINE_MAP.DOWNLOAD_ERROR_MESSAGE';\r\n    } else if (this.availableDiskspace?.available > 300000000) {\r\n      //we have more than 300MB available\r\n      messageKey = 'OFFLINE_MAP.UNZIP_ERROR_MESSAGE_GENERIC';\r\n    } else {\r\n      messageKey = 'OFFLINE_MAP.UNZIP_ERROR_MESSAGE_NO_SPACE_LEFT';\r\n    }\r\n    const translations = await firstValueFrom(this.translateService.get([messageKey, 'ALERT.OK']));\r\n    const alert = await this.alertController.create({\r\n      message: translations[messageKey],\r\n      buttons: [\r\n        {\r\n          text: translations['ALERT.OK']\r\n        }\r\n      ]\r\n    });\r\n    alert.present();\r\n  }\r\n\r\n  private getDeviceFreeDiskSpace(externalStorage = false): Promise<number> {\r\n    if (!isAndroidOrIos(this.platform)) {\r\n      return Promise.resolve(0);\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n      (window as any)?.DiskSpacePlugin?.info(\r\n        { location: externalStorage ? 2 : 1 },\r\n        (success) => resolve(success.free),\r\n        (err) => reject(err)\r\n      );\r\n    });\r\n  }\r\n\r\n  private addMapPackage(newPackage: OfflineMapPackage) {\r\n    const packages = this.packages.value;\r\n    this.packages.next([...packages, newPackage]);\r\n  }\r\n\r\n  async removeMapPackageByName(packageNameToRemove: string) {\r\n    // Delete files\r\n    const root = await this.getRootFileUrl();\r\n    await this.deleteDirectory(root, packageNameToRemove);\r\n    // Remove package from installed packages subject list\r\n    this.packages.next(\r\n      this.packages.value.filter(\r\n        (mapPackage) => mapPackage.name !== packageNameToRemove\r\n      )\r\n    );\r\n    // Also remove any pending / downloading packages in progress\r\n    this.downloadAndUnzipProgress.next(\r\n      this.downloadAndUnzipProgress.value.filter(\r\n        (mapPackage) => mapPackage.name !== packageNameToRemove\r\n      )\r\n    );\r\n  }\r\n\r\n  private async readCompleteFile(\r\n    packageName: string\r\n  ): Promise<{ size: number; downloadComplete: number }> {\r\n    const path = await this.getCompleteFileUrl(packageName);\r\n    try {\r\n      const fileContent = await Filesystem.readFile({\r\n        path,\r\n        encoding: Encoding.ASCII\r\n      });\r\n      const fileStat = await Filesystem.stat({ path });\r\n      return { size: +fileContent.data, downloadComplete: fileStat.mtime / 1000 };\r\n    } catch (error) {\r\n      const niceError = new Error(`Couldn't read COMPLETE file: ${path}`);\r\n      niceError.stack = error.stack;\r\n      throw niceError;\r\n    }\r\n  }\r\n\r\n  private async hasCompleteFile(packageName: string): Promise<boolean> {\r\n    try {\r\n      const path = await this.getCompleteFileUrl(packageName);\r\n      const uri = (await Filesystem.stat({ path })).uri;\r\n      this.loggingService.debug(\r\n        `Package '${packageName}' has complete file: ${uri}`,\r\n        DEBUG_TAG\r\n      );\r\n      return true;\r\n    } catch (err) {\r\n      // throws error if file does not exist\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private async getMapsInPackageFolder(packageName: string): Promise<string[]> {\r\n    const path = await this.getMapPackageFileUrl(packageName);\r\n    const filenames = await (await Filesystem.readdir({ path })).files;\r\n    //TODO: Hack, assumes that all files in folder is a directory unless it has name 'COMPLETE'\r\n    return filenames.filter((filename) => filename != 'COMPLETE');\r\n  }\r\n\r\n  /**\r\n   * @returns map package metadata\r\n   */\r\n  private async getMetadata(packageName: string): Promise<OfflineMapPackage> {\r\n    this.loggingService.debug(\r\n      'Reading metadata for package:',\r\n      DEBUG_TAG,\r\n      packageName\r\n    );\r\n    const path = await this.getMapPackageFileUrl(packageName);\r\n    const completeFile = await this.readCompleteFile(packageName);\r\n\r\n    const offlineMapPackage: OfflineMapPackage = {\r\n      name: packageName,\r\n      downloadComplete: completeFile.downloadComplete,\r\n      size: completeFile.size,\r\n      maps: {}\r\n    };\r\n\r\n    const maps = await this.getMapsInPackageFolder(packageName);\r\n    for (const map of maps) {\r\n      const metadataPath = `${path}/${map}/${METADATA_FILE}`;\r\n      this.loggingService.debug('Metadata path:', DEBUG_TAG, metadataPath);\r\n      const readFileResult = await Filesystem.readFile({\r\n        path: metadataPath,\r\n        encoding: Encoding.UTF8\r\n      });\r\n      const metadata = JSON.parse(readFileResult.data) as OfflineTilesMetadata;\r\n      this.loggingService.debug('Metadata:', DEBUG_TAG, metadata);\r\n\r\n      offlineMapPackage.maps[map] = {\r\n        ...metadata,\r\n        url: this.webView.convertFileSrc(`${path}/${map}`)\r\n      };\r\n    }\r\n\r\n    this.loggingService.debug(\r\n      'Offline map package metadata: ',\r\n      DEBUG_TAG,\r\n      offlineMapPackage\r\n    );\r\n\r\n    return offlineMapPackage;\r\n  }\r\n\r\n  private createOfflineMapPackage(\r\n    compoundPackageMetadata: CompoundPackage\r\n  ): OfflineMapPackage {\r\n    const mapPackage: OfflineMapPackage = {\r\n      name: compoundPackageMetadata.getName(),\r\n      size: compoundPackageMetadata.getSizeInMiB() * 1024 * 1024,\r\n      downloadStart: moment().unix(),\r\n      progress: {\r\n        percentage: 0,\r\n        step: ProgressStep.pending,\r\n        description: 'In queue...'\r\n      },\r\n      downloadComplete: null,\r\n      maps: {},\r\n      compoundPackageMetadata\r\n    };\r\n    return mapPackage;\r\n  }\r\n\r\n  async unzipFile(\r\n    zipFile: Blob,\r\n    path: string,\r\n    folder: string,\r\n    onComplete: () => void,\r\n    onProgress: (progress: number) => void,\r\n    onError: (error: Error) => void\r\n  ): Promise<void> {\r\n    try {\r\n      const zip = new JSZip();\r\n      const content = await zip.loadAsync(zipFile, {\r\n        createFolders: true\r\n      });\r\n      const zipEntries = Object.keys(content.files);\r\n      this.loggingService.debug(`Loaded ${zipEntries.length} zip entries`, DEBUG_TAG);\r\n\r\n      let i = 0;\r\n      const files = zipEntries.filter((name) => !content.files[name].dir);\r\n      const mod = Math.floor(files.length / 100);\r\n\r\n      const unzipFile = async (fileName: string) => {\r\n        if (this.cancel) {\r\n          return;\r\n        }\r\n        const zippedFile: JSZip.JSZipObject = content.files[fileName];\r\n        const blob: Blob = await zippedFile.async('blob');\r\n        const fileNameWithPath = `${path}/${folder}/${fileName}`;\r\n        await this.writeFile(blob, fileNameWithPath);\r\n\r\n        i++;\r\n        if (i % mod === 0) {\r\n          this.loggingService.debug(\r\n            `Har pakket ut ${i} av ${files.length} filer. Framdrift: ${(i / files.length) * 100}%`,\r\n            DEBUG_TAG\r\n          );\r\n\r\n          onProgress(i / files.length);\r\n        }\r\n      };\r\n\r\n      this.loggingService.debug('Unzipping files');\r\n      await from(files)\r\n        .pipe(mergeMap((file) => unzipFile(file), 10))\r\n        .toPromise();\r\n      onComplete();\r\n    } catch (err) {\r\n      onError(err);\r\n    }\r\n  }\r\n\r\n  private async writeFile(blob: Blob, path: string): Promise<void> {\r\n    if (isAndroidOrIos(this.platform)) {\r\n      const buffer = await blob.arrayBuffer();\r\n      const base64 = arrayBufferToBase64(buffer);\r\n\r\n      let done = false;\r\n      let numAttemptsLeft = 5;\r\n      while (!done && numAttemptsLeft > 0) {\r\n        try {\r\n          await Filesystem.writeFile({\r\n            path,\r\n            data: base64,\r\n            recursive: true\r\n          });\r\n          done = true;\r\n        } catch (error) {\r\n          numAttemptsLeft --;\r\n          const message = `Write of ${path} failed. ${numAttemptsLeft} attempts left`;\r\n          this.loggingService.error(error, DEBUG_TAG, message);\r\n          if (numAttemptsLeft === 0) {\r\n            const noMoreAttemptsError = new Error(message);\r\n            noMoreAttemptsError.stack = error.stack;\r\n            throw noMoreAttemptsError;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private onProgress(metadata: OfflineMapPackage, progress: Progress) {\r\n    metadata.progress = progress;\r\n    const unzipProgress = this.downloadAndUnzipProgress.value.filter(\r\n      (p) => p.name !== metadata.name\r\n    );\r\n    this.downloadAndUnzipProgress.next([...unzipProgress, metadata]);\r\n  }\r\n\r\n  private async onUnzipOrDownloadError(\r\n    metadata: OfflineMapPackage,\r\n    error: Error,\r\n    isDownloading: boolean\r\n  ) {\r\n    this.loggingService.error(\r\n      error,\r\n      DEBUG_TAG,\r\n      `Error downloading map ${metadata.name}`\r\n    );\r\n    metadata.error = error || new Error('Unknown error');\r\n    const errorMessageKey = isDownloading ? 'OFFLINE_MAP.STATUS.DOWNLOAD_ERROR' : 'OFFLINE_MAP.STATUS.UNZIP_ERROR';\r\n    metadata.progress.description = await firstValueFrom(this.translateService.get(errorMessageKey));\r\n    const unzipProgress = this.downloadAndUnzipProgress.value.filter(\r\n      (p) => p.name !== metadata.name\r\n    );\r\n    this.downloadAndUnzipProgress.next([...unzipProgress, metadata]);\r\n    this.resetCancelAndStartNextItemInQueue();\r\n    this.showDownloadOrUnzipErrorMessage(isDownloading);\r\n  }\r\n\r\n  private async onDownloadAndUnzipComplete(mapPackage: OfflineMapPackage) {\r\n    if (!isAndroidOrIos(this.platform)) {\r\n      this.onUnzipOrDownloadError(\r\n        mapPackage,\r\n        new Error('Offline maps for web not implemented!'),\r\n        false\r\n      );\r\n      return;\r\n    }\r\n    mapPackage.downloadComplete = moment().unix();\r\n    mapPackage.progress = { percentage: 1.0 };\r\n\r\n    // Store new combined metadata\r\n    const path = await this.getCompleteFileUrl(mapPackage.name);\r\n    await Filesystem.writeFile({\r\n      path,\r\n      data: `${mapPackage.size}`,\r\n      encoding: Encoding.ASCII\r\n    });\r\n\r\n    // Remove from progress tracking\r\n    const unzipProgress = this.downloadAndUnzipProgress.value.filter(\r\n      (p) => p.name !== mapPackage.name\r\n    );\r\n    this.downloadAndUnzipProgress.next(unzipProgress);\r\n\r\n    // Start any pending downloads\r\n    this.resetCancelAndStartNextItemInQueue();\r\n\r\n    const secondsSpent = mapPackage.downloadComplete - mapPackage.downloadStart;\r\n    const rate = mapPackage.size / 1024 / secondsSpent;\r\n    this.loggingService.debug(\r\n      `Unzip of ${mapPackage.name} finished in ${secondsSpent}s. Speed: ${rate}kb/s`,\r\n      DEBUG_TAG\r\n    );\r\n\r\n    // Add metadata from map package\r\n    const newPackage = await this.getMetadata(mapPackage.name);\r\n    setTimeout(() => {\r\n      this.addMapPackage(newPackage);\r\n    });\r\n\r\n    this.finishedPackageIds.next(newPackage.name);\r\n  }\r\n\r\n  private onCancelled(mapPackage: OfflineMapPackage) {\r\n    this.removeMapPackageByName(mapPackage.name);\r\n    this.resetCancelAndStartNextItemInQueue();\r\n  }\r\n\r\n  private resetCancelAndStartNextItemInQueue() {\r\n    this.cancel = false;\r\n    this.downloadSubscription = null;\r\n    this.startDownloadNextItemInQueue();\r\n  }\r\n\r\n  //#region Directories and file urls\r\n\r\n  /**\r\n   * Get file url for data directory\r\n   *\r\n   * @returns file url as string, with trailing /\r\n   */\r\n  private async getDataDirectory(): Promise<Directory.Data> {\r\n    // if (this.platform.is('android')) {\r\n    //   const userSettings = await this.userSettingService.getUserSettings();\r\n    //   // TODO: Prefer save offline map on SD card? Show a dialog to ask if user wants to save on external directory?\r\n    //   if (false) {\r\n    //     return this.file.externalDataDirectory;\r\n    //   }\r\n    // }\r\n    return Directory.Data;\r\n  }\r\n\r\n  /**\r\n   * Get file url to the root directory\r\n   * containing all map packages.\r\n   *\r\n   * @returns file url as string, without trailing /\r\n   */\r\n  private async getRootFileUrl(): Promise<string> {\r\n    if (this.rootFileUrl === '') {\r\n      const dataDirectory = await this.getDataDirectory();\r\n      const readDirResult = await Filesystem.readdir({\r\n        path: '',\r\n        directory: dataDirectory\r\n      });\r\n      if (!readDirResult.files.includes(ROOT_MAP_DIR)) {\r\n        await Filesystem.mkdir({\r\n          path: ROOT_MAP_DIR,\r\n          directory: dataDirectory\r\n        });\r\n      }\r\n      const uriResult = await Filesystem.getUri({\r\n        path: ROOT_MAP_DIR,\r\n        directory: dataDirectory\r\n      });\r\n      this.rootFileUrl = uriResult.uri;\r\n\r\n      if (this.rootFileUrl.endsWith('/')) {\r\n        this.rootFileUrl = this.rootFileUrl.slice(0, -1);\r\n      }\r\n    }\r\n    return this.rootFileUrl;\r\n  }\r\n\r\n  /**\r\n   * Get file url to map package\r\n   *\r\n   * @param name - map package name\r\n   * @returns file url as string\r\n   */\r\n  private async getMapPackageFileUrl(name: string): Promise<string> {\r\n    const root = await this.getRootFileUrl();\r\n    return `${root}/${name}`;\r\n  }\r\n\r\n  /**\r\n   * Get file url to COMPLETE file in map package\r\n   *\r\n   * @param name - map package name\r\n   * @returns file url as string\r\n   */\r\n  private async getCompleteFileUrl(packageName: string): Promise<string> {\r\n    const path = await this.getMapPackageFileUrl(packageName);\r\n    return `${path}/COMPLETE`;\r\n  }\r\n\r\n  private async deleteDirectory(path: string, dirName: string): Promise<void> {\r\n    if (!isAndroidOrIos(this.platform)) {\r\n      return;\r\n    }\r\n    const folderUrl = `${path}/${dirName}`;\r\n    await Filesystem.rmdir({ path: folderUrl, recursive: true })\r\n      .then(() => {\r\n        this.loggingService.debug(`removed folder: ${folderUrl}`);\r\n      })\r\n      .catch((err) => {\r\n        this.loggingService.error(\r\n          err,\r\n          'background download native',\r\n          `remove folder failed: ${folderUrl}`\r\n        );\r\n      });\r\n  }\r\n\r\n  // TODO: Kan vi bruke disse til noe?\r\n  // Dette blir kalt når brukeren trykker \"resett app\" i innstillinger, så her må alle kartpakker slettes fra disk..\r\n  // appOnReset(): void | Promise<any> {}\r\n  // appOnResetComplete(): void | Promise<any> {}\r\n}\r\n","import { OfflineMapPackage } from './offline-map.model';\r\n\r\ninterface RegisteredPackageInfo {url: string; zMin: number; zMax: number}\r\ntype RegisterForMapType = Map<string, RegisteredPackageInfo>;\r\n\r\n\r\n/**\r\n * Registry structure (map of maps):\r\n *\r\n *   statensKartverk       // First map\r\n *       152_48_8          // Nested map, x_y_z key (root tile)\r\n *         url: \"...\"\r\n *         zMin: 14\r\n *         zMax: 8\r\n *\r\n *       152_49_8\r\n *         ...\r\n *\r\n *   steepness-outlet\r\n *       152_49_8\r\n *         ...\r\n */\r\nexport class OfflineTilesRegistry {\r\n  private registry: Map<string, RegisterForMapType> = new Map();\r\n  private lowestRootTileZ: number;\r\n  private highestRootTileZ: number;\r\n  private highestZmax = 0;\r\n\r\n  clear(): void {\r\n    this.registry.clear();\r\n  }\r\n\r\n  add(mapPackage: OfflineMapPackage): void {\r\n    for (const mapType in mapPackage.maps) {\r\n      const map = mapPackage.maps[mapType];\r\n      if (!this.registry.has(mapType)) {\r\n        this.registry.set(mapType, new Map());\r\n      }\r\n      const registryForMapType = this.registry.get(mapType);\r\n      const registryKey = this.getKey(map.rootTile.x, map.rootTile.y, map.rootTile.z);\r\n      registryForMapType.set(registryKey, { url: map.url, zMin: map.rootTile.z, zMax: map.zMax});\r\n      if (!this.lowestRootTileZ || map.rootTile.z < this.lowestRootTileZ) {\r\n        this.lowestRootTileZ = map.rootTile.z;\r\n      }\r\n      if (!this.highestRootTileZ || map.rootTile.z > this.highestRootTileZ) {\r\n        this.highestRootTileZ = map.rootTile.z;\r\n      }\r\n      if (map.zMax > this.highestZmax) {\r\n        this.highestZmax = map.zMax;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return a url template to an offline map package valid for the provided\r\n   * coordinates and map type. If there is no match between the coordinates\r\n   * / map types and registered packages, undefined is returned.\r\n   *\r\n   * @param mapType example: statensKartverk\r\n   */\r\n  getUrl(mapType: string, x: number, y: number, z: number): string | undefined {\r\n    if (z > this.highestZmax) {\r\n      return undefined;\r\n    }\r\n    const packageInfo = this.findRegisteredPackage(mapType, x, y, z);\r\n    if (packageInfo && packageInfo.zMax >= z) {\r\n      return packageInfo.url;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * Finds registered packages that overlaps with the search x,y coordinates.\r\n   * The returned package does not need to overlap in z axis.\r\n   */\r\n  findRegisteredPackage(mapType: string, x: number, y: number, z: number): RegisteredPackageInfo | undefined {\r\n    if (!this.registry.has(mapType)) {\r\n      return undefined;\r\n    }\r\n\r\n    let _x = x;\r\n    let _y = y;\r\n    let _z = z;\r\n\r\n    //find topmost tile x and y\r\n    while (_z > this.highestRootTileZ) {\r\n      _z--;\r\n      _x = Math.floor(_x / 2);\r\n      _y = Math.floor(_y / 2);\r\n    }\r\n    while (_z >= this.lowestRootTileZ) {\r\n      const registryKey = this.getKey(_x, _y, _z);\r\n      const rootTileInfo = this.registry.get(mapType).get(registryKey);\r\n      if (rootTileInfo) {\r\n        return rootTileInfo;\r\n      }\r\n      _x = Math.floor(_x / 2);\r\n      _y = Math.floor(_y / 2);\r\n      _z--;\r\n    }\r\n    return undefined; //we didn't find any topmost tile\r\n  }\r\n\r\n  private getKey(x: number, y: number, z: number): string {\r\n    return `${x}_${y}_${z}`;\r\n  }\r\n}","export enum ProgressStep {\r\n  pending = 0,\r\n  download = 1,\r\n  extractZip = 2,\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { UserSettingService } from '../user-setting/user-setting.service';\r\nimport { map, take, filter, switchMap, delay } from 'rxjs/operators';\r\nimport moment from 'moment';\r\nimport { AlertController } from '@ionic/angular';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { Observable, of, from } from 'rxjs';\r\nimport { settings } from '../../../../settings';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class PopupInfoService {\r\n  constructor(\r\n    private userSettingService: UserSettingService,\r\n    private alertController: AlertController,\r\n    private translateService: TranslateService\r\n  ) {}\r\n\r\n  checkObservationInfoPopup(_: string = null, delayMs = 2000) {\r\n    return this.checkInfoPopup(\r\n      delayMs,\r\n      'infoAboutObservationsRecievedTimestamps',\r\n      'static',\r\n      'POPUP_DISCLAMER.ABOUT_OBSERVATIONS.HEADER',\r\n      'POPUP_DISCLAMER.ABOUT_OBSERVATIONS.MESSAGE',\r\n      'POPUP_DISCLAMER.OK_I_UNDERSTAND'\r\n    );\r\n  }\r\n\r\n  checkSupportMapInfoPopup(_: string = null, delayMs = 2000) {\r\n    return this.checkInfoPopup(\r\n      delayMs,\r\n      'infoAboutSupportMapsRecievedTimestamps',\r\n      'static',\r\n      'POPUP_DISCLAMER.ABOUT_SUPPORT_MAPS.HEADER',\r\n      'POPUP_DISCLAMER.ABOUT_SUPPORT_MAPS.MESSAGE',\r\n      'POPUP_DISCLAMER.OK_I_UNDERSTAND'\r\n    );\r\n  }\r\n\r\n  checkOfflineSupportMapInfoPopup(name: string, delayMs = 2000) {\r\n    return this.checkInfoPopup(\r\n      delayMs,\r\n      'infoAboutOfflineSupportMapsRecievedTimestamps',\r\n      name,\r\n      'POPUP_DISCLAMER.ABOUT_OFFLINE_SUPPORT_MAPS.HEADER',\r\n      'POPUP_DISCLAMER.ABOUT_OFFLINE_SUPPORT_MAPS.MESSAGE',\r\n      'POPUP_DISCLAMER.OK_I_UNDERSTAND'\r\n    );\r\n  }\r\n\r\n  checkLastTimestamp(\r\n    limitMs: number,\r\n    lastTimestamp?: number,\r\n    showWhenNull = true\r\n  ): boolean {\r\n    if (lastTimestamp === undefined || lastTimestamp === null) {\r\n      return showWhenNull;\r\n    }\r\n    const limit = moment().subtract(limitMs, 'milliseconds');\r\n    return moment.unix(lastTimestamp).isBefore(limit);\r\n  }\r\n\r\n  async showAlert(\r\n    header: string,\r\n    message: string,\r\n    okText: string\r\n  ): Promise<void> {\r\n    const alert = await this.alertController.create({\r\n      header,\r\n      message,\r\n      buttons: [okText]\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  geAlertTranslations(\r\n    headerKey: string,\r\n    messageKey: string,\r\n    okKey: string\r\n  ): Observable<{ header: string; message: string; okText: string }> {\r\n    return this.translateService.get([headerKey, messageKey, okKey]).pipe(\r\n      map((translations) => ({\r\n        header: translations[headerKey],\r\n        message: translations[messageKey],\r\n        okText: translations[okKey]\r\n      }))\r\n    );\r\n  }\r\n\r\n  async saveInfoAboutRecievedTimestamp(timestampType: string, timestampName: string) {\r\n    let userSettings = await this.userSettingService.userSetting$\r\n      .pipe(take(1))\r\n      .toPromise();\r\n    userSettings = {\r\n      ...userSettings,\r\n      [timestampType]: timestampType in userSettings ? {\r\n        ...userSettings[timestampType],\r\n        [timestampName]: moment().unix(),\r\n      } : {[timestampName]: moment().unix()}\r\n    };\r\n    this.userSettingService.saveUserSettings(userSettings);\r\n  }\r\n\r\n  private checkInfoPopup(\r\n    delayMs = 2000,\r\n    timestampType: string,\r\n    timestampName: string,\r\n    header: string,\r\n    msg: string,\r\n    ok_txt: string,\r\n    refreshTimeMs: number = settings.popupDisclamerRefreshTimeMs,\r\n  ) {\r\n    return this.userSettingService.userSetting$.pipe(\r\n      take(1),\r\n      delay(delayMs),\r\n      filter((us) =>\r\n        this.checkLastTimestamp(\r\n          refreshTimeMs,\r\n          timestampType in us ? us[timestampType][timestampName] : null,\r\n        )\r\n      ),\r\n      switchMap(() =>\r\n        this.geAlertTranslations(header, msg, ok_txt)\r\n      ),\r\n      switchMap((translations) =>\r\n        from(\r\n          this.showAlert(\r\n            translations.header,\r\n            translations.message,\r\n            translations.okText\r\n          )\r\n        )\r\n      ),\r\n      switchMap(() => from(this.saveInfoAboutRecievedTimestamp(timestampType, timestampName)))\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Platform } from '@ionic/angular';\r\nimport { LoggingService } from '../../../modules/shared/services/logging/logging.service';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { LogLevel } from '../../../modules/shared/services/logging/log-level.model';\r\nimport { GeoHelperService } from '../../../modules/shared/services/geo-helper/geo-helper.service';\r\nimport { GeoHazard } from '@varsom-regobs-common/core';\r\n\r\nconst DEBUG_TAG = 'ShortcutService';\r\nconst FLAG_ACTIVITY_CLEAR_TOP = 67108864;\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ShortcutService {\r\n  constructor(\r\n    private platform: Platform,\r\n    private loggingService: LoggingService,\r\n    private translateService: TranslateService,\r\n    private geoHelperService: GeoHelperService\r\n  ) {}\r\n\r\n  init() {\r\n    const w = <any>window;\r\n    if (\r\n      this.platform.is('hybrid') &&\r\n      this.platform.is('android') &&\r\n      w.plugins &&\r\n      w.plugins.Shortcuts\r\n    ) {\r\n      this.initAndroidShortcusts();\r\n      return;\r\n    }\r\n    this.loggingService.debug('Dynamic shortcuts not supported', DEBUG_TAG);\r\n  }\r\n\r\n  private getImage(geoHazard: GeoHazard) {\r\n    switch (geoHazard) {\r\n    case GeoHazard.Snow:\r\n      return 'ic_snow';\r\n    case GeoHazard.Soil:\r\n      return 'ic_dirt';\r\n    case GeoHazard.Ice:\r\n      return 'ic_ice';\r\n    case GeoHazard.Water:\r\n      return 'ic_water';\r\n    }\r\n  }\r\n\r\n  private async getShortcuts() {\r\n    const geoHazards = this.geoHelperService.getAllGeoHazards();\r\n    const geoHazardsKeys = this.geoHelperService.getTranslationKeys(geoHazards);\r\n    const translations = await this.translateService\r\n      .get([\r\n        'ADD_MENU.NEW_OBSERVATION',\r\n        'MAP_ITEM_BAR.OBSERVATION',\r\n        ...geoHazardsKeys\r\n      ])\r\n      .toPromise();\r\n\r\n    const getLongLabelTranslation = (geoHazardName: string) =>\r\n      `${\r\n        translations['ADD_MENU.NEW_OBSERVATION']\r\n      } ${geoHazardName.toLowerCase()} ${\r\n        translations['MAP_ITEM_BAR.OBSERVATION']\r\n      }`;\r\n    const getShortLabel = (geoHazardName: string) => `+ ${geoHazardName}`;\r\n\r\n    return geoHazards.map((geoHazard) => ({\r\n      id: `regobs_shortcut_new_registration_${geoHazard}`,\r\n      url: `regobs://registration/new/${geoHazard}`,\r\n      shortLabel: getShortLabel(\r\n        translations[this.geoHelperService.getTranslationKey(geoHazard)]\r\n      ),\r\n      longLabel: getLongLabelTranslation(\r\n        translations[this.geoHelperService.getTranslationKey(geoHazard)]\r\n      ),\r\n      iconFromResource: this.getImage(geoHazard)\r\n    }));\r\n  }\r\n\r\n  private initAndroidShortcusts() {\r\n    this.loggingService.debug(\r\n      'Initializing dynamic shortcuts for Android',\r\n      DEBUG_TAG\r\n    );\r\n    const w = <any>window;\r\n    w.plugins.Shortcuts.supportsDynamic(\r\n      async (supported) => {\r\n        if (!supported) {\r\n          this.loggingService.debug(\r\n            'Dynamic shortcuts not supported',\r\n            DEBUG_TAG\r\n          );\r\n          return;\r\n        }\r\n        const shortcuts = await this.getShortcuts();\r\n        const shortcutsFull = shortcuts.map((s) => ({\r\n          ...s,\r\n          intent: {\r\n            action: 'android.intent.action.VIEW',\r\n            flags: FLAG_ACTIVITY_CLEAR_TOP, // FLAG_ACTIVITY_CLEAR_TOP\r\n            data: s.url // Must be a well-formed URI\r\n          }\r\n        }));\r\n        this.loggingService.debug(\r\n          'Adding dynamic shortcuts:',\r\n          DEBUG_TAG,\r\n          shortcutsFull\r\n        );\r\n        w.plugins.Shortcuts.setDynamic(\r\n          shortcutsFull,\r\n          () => {\r\n            this.loggingService.debug(\r\n              'Shortcuts were applied successfully',\r\n              DEBUG_TAG\r\n            );\r\n          },\r\n          (error) => {\r\n            this.loggingService.log(\r\n              'Error setting dynamic shortcuts!',\r\n              error,\r\n              LogLevel.Warning,\r\n              DEBUG_TAG\r\n            );\r\n          }\r\n        );\r\n      },\r\n      (error) => {\r\n        this.loggingService.log(\r\n          'Error when checking support for dynamic shortcuts!',\r\n          error,\r\n          LogLevel.Warning,\r\n          DEBUG_TAG\r\n        );\r\n      }\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Subject, Observable } from 'rxjs';\r\nimport { shareReplay } from 'rxjs/operators';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SwipeBackService {\r\n  private _subject: Subject<boolean>;\r\n\r\n  swipeBackEnabled$: Observable<boolean>;\r\n\r\n  constructor() {\r\n    this._subject = new Subject<boolean>();\r\n    this.swipeBackEnabled$ = this._subject.asObservable().pipe(shareReplay(1));\r\n    this._subject.next(true);\r\n  }\r\n\r\n  enableSwipeBack() {\r\n    this._subject.next(true);\r\n  }\r\n\r\n  disableSwipeBack() {\r\n    this._subject.next(false);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { TripLogItem } from './trip-log-item.model';\r\nimport moment from 'moment';\r\nimport { TripLogState } from './trip-log-state.enum';\r\nimport { TripLogActivity } from './trip-log-activity.model';\r\nimport { NanoSql } from '../../../../nanosql';\r\nimport { Observable, from, BehaviorSubject, throwError } from 'rxjs';\r\nimport { CreateTripDto, TripService } from '@varsom-regobs-common/regobs-api';\r\nimport {\r\n  switchMap,\r\n  take,\r\n  map,\r\n  concatMap,\r\n  filter,\r\n  tap,\r\n  catchError\r\n} from 'rxjs/operators';\r\nimport { UserSettingService } from '../user-setting/user-setting.service';\r\nimport { ToastController, AlertController } from '@ionic/angular';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { LegacyTrip } from './legacy-trip.model';\r\nimport { LoggingService } from '../../../modules/shared/services/logging/logging.service';\r\nimport { nSQL } from '@nano-sql/core';\r\nimport { NSqlFullUpdateObservable } from '../../helpers/nano-sql/NSqlFullUpdateObservable';\r\nimport { AppMode } from '@varsom-regobs-common/core';\r\n\r\nconst DEBUG_TAG = 'TripLoggerService';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class TripLoggerService {\r\n  get isTripRunning$(): Observable<boolean> {\r\n    return this.tripStartedSubject.asObservable();\r\n  }\r\n\r\n  private tripStartedSubject = new BehaviorSubject(false);\r\n\r\n  constructor(\r\n    private tripService: TripService,\r\n    private userSettingService: UserSettingService,\r\n    private translateService: TranslateService,\r\n    private alertController: AlertController,\r\n    private loggingService: LoggingService,\r\n    private toastController: ToastController\r\n  ) {\r\n    this.userSettingService.appMode$\r\n      .pipe(\r\n        switchMap((appMode) => from(this.getLegacyTripFromDbByAppMode(appMode)))\r\n      )\r\n      .subscribe((legacyTrip) => {\r\n        this.tripStartedSubject.next(legacyTrip != null);\r\n      });\r\n  }\r\n\r\n  saveTripLogItem(item: TripLogItem): Promise<unknown> {\r\n    return nSQL(NanoSql.TABLES.TRIP_LOG.name).query('upsert', item).exec();\r\n  }\r\n\r\n  getTripLogAsObservable(): Observable<TripLogItem[]> {\r\n    return new NSqlFullUpdateObservable<TripLogItem[]>(\r\n      nSQL(NanoSql.TABLES.TRIP_LOG.name).query('select').listen()\r\n    );\r\n  }\r\n\r\n  updateState(state: TripLogState): Promise<unknown> {\r\n    return nSQL(NanoSql.TABLES.TRIP_LOG_ACTIVITY.name)\r\n      .query('upsert', { state, timestamp: moment().unix() })\r\n      .exec();\r\n  }\r\n\r\n  getTripLogStateAsObservable(): Observable<TripLogActivity> {\r\n    return new NSqlFullUpdateObservable<TripLogActivity[]>(\r\n      nSQL(NanoSql.TABLES.TRIP_LOG_ACTIVITY.name)\r\n        .query('select')\r\n        .orderBy(['id: desc'])\r\n        .limit(1)\r\n        .listen({})\r\n    ).pipe(map((ta) => ta[0]));\r\n  }\r\n\r\n  getTripLogActivityAsObservable(): Observable<TripLogActivity[]> {\r\n    return new NSqlFullUpdateObservable<TripLogActivity[]>(\r\n      nSQL(NanoSql.TABLES.TRIP_LOG_ACTIVITY.name).query('select').listen()\r\n    );\r\n  }\r\n\r\n  getLegacyTripAsObservable(): Observable<LegacyTrip> {\r\n    return this.userSettingService.appMode$.pipe(\r\n      switchMap((appMode) => from(this.getLegacyTripFromDbByAppMode(appMode)))\r\n    );\r\n  }\r\n\r\n  async getLegacyTripFromDbByAppMode(appMode: AppMode): Promise<LegacyTrip> {\r\n    const result = (await NanoSql.getInstance(\r\n      NanoSql.TABLES.LEGACY_TRIP_LOG.name,\r\n      appMode\r\n    )\r\n      .query('select')\r\n      .exec()) as LegacyTrip[];\r\n    return result[0];\r\n  }\r\n\r\n  startLegacyTrip(tripDto: CreateTripDto): Observable<void> {\r\n    const legacyTrip: LegacyTrip = {\r\n      id: 'legacytrip',\r\n      timestamp: moment().unix(),\r\n      request: tripDto\r\n    };\r\n    return this.userSettingService.appMode$.pipe(\r\n      take(1),\r\n      switchMap((appMode) =>\r\n        this.tripService\r\n          .TripPost(tripDto)\r\n          .pipe(\r\n            switchMap(() =>\r\n              from(\r\n                NanoSql.getInstance(\r\n                  NanoSql.TABLES.LEGACY_TRIP_LOG.name,\r\n                  appMode\r\n                )\r\n                  .query('upsert', legacyTrip)\r\n                  .exec()\r\n              )\r\n            )\r\n          )\r\n      ),\r\n      tap(() => this.tripStartedSubject.next(true)),\r\n      switchMap(() => this.infoMessage(true)),\r\n      catchError((err) => {\r\n        this.tripStartedSubject.next(false);\r\n        return throwError(err);\r\n      })\r\n    );\r\n  }\r\n\r\n  stopLegacyTrip(showConfirm = true): void {\r\n    if (showConfirm) {\r\n      this.confirmStopTrip();\r\n    } else {\r\n      this.callStopLegacyTripApiAndDeleteFromDb();\r\n    }\r\n  }\r\n\r\n  async showTripErrorMessage(start: boolean): Promise<void> {\r\n    const translations = await this.translateService\r\n      .get(['ALERT.DEFAULT_HEADER', 'ALERT.OK', 'TRIP.ERROR', 'TRIP.END_ERROR'])\r\n      .toPromise();\r\n    const alert = await this.alertController.create({\r\n      header: translations['ALERT.DEFAULT_HEADER'],\r\n      message: start\r\n        ? translations['TRIP.ERROR']\r\n        : translations['TRIP.END_ERROR'],\r\n      buttons: [translations['ALERT.OK']]\r\n    });\r\n    return alert.present();\r\n  }\r\n\r\n  async showTripNoPositionErrorMessage(): Promise<void> {\r\n    const translations = await this.translateService\r\n      .get(['ALERT.DEFAULT_HEADER', 'ALERT.OK', 'TRIP.ERROR_POSITION'])\r\n      .toPromise();\r\n    const alert = await this.alertController.create({\r\n      header: translations['ALERT.DEFAULT_HEADER'],\r\n      message: translations['TRIP.ERROR_POSITION'],\r\n      buttons: [translations['ALERT.OK']]\r\n    });\r\n    return alert.present();\r\n  }\r\n\r\n  private async confirmStopTrip(): Promise<void> {\r\n    const translations = await this.translateService\r\n      .get([\r\n        'TRIP.STOP_TRIP',\r\n        'REGISTRATION.DELETE_CONFIRM',\r\n        'ALERT.OK',\r\n        'ALERT.CANCEL'\r\n      ])\r\n      .toPromise();\r\n    const alert = await this.alertController.create({\r\n      header: translations['TRIP.STOP_TRIP'] + '?',\r\n      message: translations['REGISTRATION.DELETE_CONFIRM'],\r\n      buttons: [\r\n        {\r\n          text: translations['ALERT.CANCEL'],\r\n          role: 'cancel',\r\n          cssClass: 'secondary'\r\n        },\r\n        {\r\n          text: translations['ALERT.OK'],\r\n          handler: () => this.callStopLegacyTripApiAndDeleteFromDb()\r\n        }\r\n      ]\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  private callStopLegacyTripApiAndDeleteFromDb() {\r\n    this.getLegacyTripAsObservable()\r\n      .pipe(\r\n        take(1),\r\n        filter((trip) => !!trip),\r\n        concatMap((trip) =>\r\n          this.tripService.TripPut({ DeviceGuid: trip.request.DeviceGuid })\r\n        ),\r\n        concatMap(() => this.deleteLegacyTripsFromDb()),\r\n        concatMap(() => this.infoMessage(false))\r\n      )\r\n      .subscribe(\r\n        () => {\r\n          this.tripStartedSubject.next(false);\r\n        },\r\n        async (error) => {\r\n          this.loggingService.error(error, DEBUG_TAG, 'Could not stop trip');\r\n          this.tripStartedSubject.next(false);\r\n          await this.showTripErrorMessage(false);\r\n        }\r\n      );\r\n  }\r\n\r\n  private deleteLegacyTripsFromDb() {\r\n    return this.userSettingService.appMode$.pipe(\r\n      concatMap((appMode) =>\r\n        from(\r\n          NanoSql.getInstance(NanoSql.TABLES.LEGACY_TRIP_LOG.name, appMode)\r\n            .query('delete')\r\n            .exec()\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  cleanupOldLegacyTrip(): Promise<unknown> {\r\n    return this.getLegacyTripAsObservable()\r\n      .pipe(\r\n        filter(\r\n          (trip) => trip && trip.timestamp < moment().startOf('day').unix()\r\n        ),\r\n        concatMap(() => this.deleteLegacyTripsFromDb()),\r\n        take(1)\r\n      )\r\n      .toPromise();\r\n  }\r\n\r\n  private infoMessage(started: boolean) {\r\n    const key = started ? 'TRIP.STARTED' : 'TRIP.STOPPED';\r\n    return this.translateService\r\n      .get(key)\r\n      .pipe(switchMap((message) => from(this.presentToast(message))));\r\n  }\r\n\r\n  async presentToast(message: string): Promise<void> {\r\n    const toast = await this.toastController.create({\r\n      message,\r\n      mode: 'md',\r\n      duration: 2000\r\n    });\r\n    return toast.present();\r\n  }\r\n\r\n  // getTripLogSummaryAsObservable(): Observer<TripLogSummary> {\r\n  //   return nSQL().observable<TripLogItem[]>(() => {\r\n  //     return nSQL(tableName).query('select').emit();\r\n  //   }).map((tripLog) => ({\r\n  //       started: moment(tripLog[0].timestamp)\r\n  //    }));\r\n  // }\r\n\r\n  // async endTrip() {\r\n  //   await nSQL(tableName)\r\n  //     .query('upsert', { stop: new Date() })\r\n  //     .where(['tripLogId', '=', this.currentTripLoggerId])\r\n  //     .exec();\r\n  //   this.currentTripLoggerId = null;\r\n  // }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { UserSetting } from '../../models/user-settings.model';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { GeoHazard, LangKey, AppMode } from '@varsom-regobs-common/core';\r\nimport { settings } from '../../../../settings';\r\nimport { NanoSql } from '../../../../nanosql';\r\nimport { Observable, combineLatest, BehaviorSubject, from, of } from 'rxjs';\r\nimport {\r\n  map,\r\n  shareReplay,\r\n  distinctUntilChanged,\r\n  tap,\r\n  takeUntil,\r\n  catchError,\r\n  debounceTime,\r\n  switchMap,\r\n  concatMap,\r\n  filter\r\n} from 'rxjs/operators';\r\nimport { LoggingService } from '../../../modules/shared/services/logging/logging.service';\r\nimport { nSQL } from '@nano-sql/core';\r\nimport { OnReset } from '../../../modules/shared/interfaces/on-reset.interface';\r\nimport equal from 'fast-deep-equal';\r\nimport { NgDestoryBase } from '../../helpers/observable-helper';\r\nimport { LogLevel } from '../../../modules/shared/services/logging/log-level.model';\r\nimport { DEFAULT_USER_SETTINGS } from './user-settings.default';\r\nimport { registerLocaleData } from '@angular/common';\r\nimport nbData from '@angular/common/locales/nb';\r\nimport svData from '@angular/common/locales/sv';\r\nimport enData from '@angular/common/locales/en';\r\nimport deData from '@angular/common/locales/de';\r\nimport slData from '@angular/common/locales/sl';\r\nimport nnData from '@angular/common/locales/nn';\r\nimport frData from '@angular/common/locales/fr';\r\nimport { UserSettingsPage } from 'src/app/pages/user-settings/user-settings.page';\r\nimport { SupportTile } from '../../models/support-tile.model';\r\n\r\nconst DEBUG_TAG = 'UserSettingService';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class UserSettingService extends NgDestoryBase implements OnReset {\r\n  // Setting this observable to be a shared instance since\r\n  // UserSettingService is a singleton service.\r\n  // The observable will be shared with many services\r\n  public readonly currentGeoHazard$: Observable<GeoHazard[]>;\r\n  public readonly appMode$: Observable<AppMode>;\r\n  public readonly showMapCenter$: Observable<boolean>;\r\n  public readonly appModeAndLanguage$: Observable<[AppMode, LangKey]>;\r\n  public readonly appModeLanguageAndCurrentGeoHazard$: Observable<\r\n    [AppMode, LangKey, GeoHazard[]]\r\n  >;\r\n  public readonly language$: Observable<LangKey>;\r\n  public readonly daysBack$: Observable<\r\n    { geoHazard: GeoHazard; daysBack: number }[]\r\n  >;\r\n  public readonly showObservations$: Observable<boolean>;\r\n  public readonly userSetting$: Observable<UserSetting>;\r\n\r\n  private userSettingInMemory = new BehaviorSubject<UserSetting>(null);\r\n  // private userSettingsReady = new BehaviorSubject(false);\r\n\r\n  // get userSettingsReady$() {\r\n  //   return this.userSettingsReady.asObservable();\r\n  // }\r\n\r\n  // get currentSettings() {\r\n  //   return this.userSettingInMemory.getValue();\r\n  // }\r\n\r\n  // set currentSettings(val: UserSetting) {\r\n  //   this.saveUserSettings(val);\r\n  // }\r\n\r\n  get supportTiles$() {\r\n    return this.userSetting$.pipe(map((us) => this.getSupportTilesOptions(us, true)));\r\n  }\r\n\r\n  get supportTilesWithSubTiles$() {\r\n    return this.userSetting$.pipe(map((us) => this.getSupportTilesOptions(us, false)));\r\n  }\r\n\r\n  constructor(\r\n    private translate: TranslateService,\r\n    private loggingService: LoggingService\r\n  ) {\r\n    super();\r\n    this.userSetting$ = this.userSettingInMemory.asObservable().pipe(\r\n      concatMap((val) =>\r\n        val ? of(val) : this.getUserSettingsFromDbOrDefaultSettings()\r\n      ),\r\n      tap((val) => {\r\n        this.loggingService?.debug('User settings is: ', DEBUG_TAG, val);\r\n      }),\r\n      shareReplay(1)\r\n    );\r\n    this.currentGeoHazard$ = this.userSetting$.pipe(\r\n      map((val) => val.currentGeoHazard),\r\n      distinctUntilChanged(equal),\r\n      tap((val) =>\r\n        this.loggingService?.debug(\r\n          `Current geohazard changed to: ${val.join(',')}`,\r\n          DEBUG_TAG\r\n        )\r\n      ),\r\n      shareReplay(1)\r\n    );\r\n\r\n    this.appMode$ = this.userSetting$.pipe(\r\n      map((val) => val.appMode),\r\n      distinctUntilChanged(),\r\n      tap((val) => {\r\n        this.loggingService?.debug('App mode is: ', DEBUG_TAG, val);\r\n      }),\r\n      shareReplay(1)\r\n    );\r\n\r\n    this.showMapCenter$ = this.userSetting$.pipe(\r\n      map((val) => val.showMapCenter),\r\n      distinctUntilChanged(),\r\n      shareReplay(1)\r\n    );\r\n\r\n    this.language$ = this.userSetting$.pipe(\r\n      map((val) => val.language),\r\n      distinctUntilChanged(),\r\n      shareReplay(1)\r\n    );\r\n\r\n    this.appModeAndLanguage$ = combineLatest([\r\n      this.appMode$,\r\n      this.language$\r\n    ]).pipe(shareReplay(1));\r\n\r\n    this.appModeLanguageAndCurrentGeoHazard$ = combineLatest([\r\n      this.appMode$,\r\n      this.language$,\r\n      this.currentGeoHazard$\r\n    ]).pipe(shareReplay(1));\r\n\r\n    this.daysBack$ = this.userSetting$.pipe(\r\n      map((val) => val.observationDaysBack),\r\n      distinctUntilChanged(equal),\r\n      tap((val) =>\r\n        this.loggingService?.debug('Days back changed to:', DEBUG_TAG, val)\r\n      ),\r\n      shareReplay(1)\r\n    );\r\n\r\n    this.showObservations$ = this.userSetting$.pipe(\r\n      map((val) => val.showObservations),\r\n      distinctUntilChanged(),\r\n      shareReplay(1)\r\n    );\r\n  }\r\n\r\n  public init() {\r\n    this.createLanguageChangeListener();\r\n    // this.updateInMemoryRegistrationsFromDb();\r\n    this.createSaveToDbOnChangeListener();\r\n  }\r\n\r\n  private createLanguageChangeListener() {\r\n    this.language$.pipe(takeUntil(this.ngDestroy$)).subscribe((langKey) => {\r\n      const lang = LangKey[langKey];\r\n      switch (langKey) {\r\n      case LangKey.nb:\r\n        registerLocaleData(nbData);\r\n        break;\r\n      case LangKey.en:\r\n        registerLocaleData(enData);\r\n        break;\r\n      case LangKey.de:\r\n        registerLocaleData(deData);\r\n        break;\r\n      case LangKey.sv:\r\n        registerLocaleData(svData);\r\n        break;\r\n      case LangKey.sl:\r\n        registerLocaleData(slData);\r\n        break;\r\n      case LangKey.nn:\r\n        registerLocaleData(nnData);\r\n        break;\r\n      //TODO: Ta med denne når API'et støtter fransk\r\n      // case LangKey.fr:\r\n      //   registerLocaleData(frData);\r\n      //   break;\r\n      }\r\n      this.translate.use(lang);\r\n    });\r\n  }\r\n\r\n  private createSaveToDbOnChangeListener() {\r\n    this.userSettingInMemory\r\n      .pipe(\r\n        filter((result) => !!result),\r\n        debounceTime(200),\r\n        tap((result) =>\r\n          this.loggingService?.debug(\r\n            'InMemory user settings changed. Saving to db: ',\r\n            DEBUG_TAG,\r\n            result\r\n          )\r\n        ),\r\n        switchMap((result) => this.saveUserSettingsToDb(result)),\r\n        takeUntil(this.ngDestroy$)\r\n      )\r\n      .subscribe();\r\n  }\r\n\r\n  saveUserSettings(userSetting: UserSetting) {\r\n    this.userSettingInMemory.next(userSetting);\r\n  }\r\n\r\n  getSupportTilesOptions(us: UserSetting, flat = true): SupportTile[] {\r\n    const supportTilesForCurrentGeoHazard: SupportTile[] = settings.map.tiles.supportTiles.filter(\r\n      (setting) => us.currentGeoHazard.indexOf(setting.geoHazardId) >= 0\r\n    ).map((tile) => {\r\n      const usSupportTile = us.supportTiles.find(\r\n        (usTiles) => usTiles.name === tile.name\r\n      );\r\n      let subTile = tile.subTile;\r\n      if (subTile && usSupportTile && usSupportTile.subTile) {\r\n        subTile = {...tile.subTile, ...usSupportTile.subTile};\r\n      }\r\n      return {\r\n        ...(usSupportTile ? {...tile, ...usSupportTile} : tile),\r\n        subTile: subTile,\r\n      };\r\n    });\r\n\r\n    if (flat) {\r\n      supportTilesForCurrentGeoHazard\r\n        .filter((tile) => tile.subTile)\r\n        .forEach((tile) => {\r\n          supportTilesForCurrentGeoHazard.push({\r\n            ...tile.subTile,\r\n            opacity: tile.opacity,\r\n            geoHazardId: tile.geoHazardId,\r\n          });\r\n          delete tile.subTile;\r\n        });\r\n    }\r\n\r\n    return supportTilesForCurrentGeoHazard;\r\n  }\r\n\r\n  private getUserSettingsFromDbOrDefaultSettings(): Observable<UserSetting> {\r\n    return this.getUserSettingsFromDb().pipe(\r\n      map((result) => (result ? result : DEFAULT_USER_SETTINGS(null)))\r\n    );\r\n  }\r\n\r\n  private getUserSettingsFromDb(): Observable<UserSetting> {\r\n    return from(\r\n      nSQL(NanoSql.TABLES.USER_SETTINGS.name).query('select').exec() as Promise<\r\n        UserSetting[]\r\n      >\r\n    ).pipe(map((result) => result[0]));\r\n  }\r\n\r\n  private saveUserSettingsToDb(\r\n    userSetting: UserSetting\r\n  ): Observable<UserSetting[]> {\r\n    return from(\r\n      nSQL(NanoSql.TABLES.USER_SETTINGS.name)\r\n        .query('upsert', { id: 'usersettings', ...userSetting })\r\n        .exec() as Promise<UserSetting[]>\r\n    ).pipe(\r\n      catchError((err) => {\r\n        this.loggingService?.log(\r\n          'Could not save user settings to offline db',\r\n          err,\r\n          LogLevel.Warning,\r\n          DEBUG_TAG\r\n        );\r\n        return of(null);\r\n      })\r\n    );\r\n  }\r\n\r\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n  appOnReset() {}\r\n\r\n  appOnResetComplete() {\r\n    this.loggingService.debug(\r\n      'App reset complete. Re-init observables.',\r\n      DEBUG_TAG\r\n    );\r\n    // const defaultSettings = DEFAULT_USER_SETTINGS(null);\r\n    // this.saveUserSettings(defaultSettings);\r\n    this.userSettingInMemory.next(null); // Reset in memory observable\r\n  }\r\n}\r\n","import { UserSetting } from '../../models/user-settings.model';\r\nimport { GeoHazard, LangKey, AppMode } from '@varsom-regobs-common/core';\r\nimport { settings } from '../../../../settings';\r\nimport { TopoMap } from '../../models/topo-map.enum';\r\n\r\nexport const DEFAULT_USER_SETTINGS: (langKey: LangKey) => UserSetting = (\r\n  langKey: LangKey\r\n) => ({\r\n  appMode: AppMode.Prod,\r\n  language: langKey || LangKey.nb,\r\n  currentGeoHazard: [GeoHazard.Snow],\r\n  observationDaysBack: [\r\n    { geoHazard: GeoHazard.Snow, daysBack: 2 },\r\n    { geoHazard: GeoHazard.Ice, daysBack: 7 },\r\n    { geoHazard: GeoHazard.Soil, daysBack: 3 },\r\n    { geoHazard: GeoHazard.Water, daysBack: 3 }\r\n  ],\r\n  completedStartWizard: false,\r\n  supportTiles: [],\r\n  showMapCenter: false,\r\n  tilesCacheSizev2: settings.map.tiles.cacheSize,\r\n  showObservations: true,\r\n  emailReceipt: true,\r\n  topoMap: TopoMap.default,\r\n  showGeoSelectInfo: true,\r\n  useRetinaMap: false,\r\n  consentForSendingAnalytics: true,\r\n  consentForSendingAnalyticsDialogCompleted: false,\r\n  featureToggeGpsDebug: false,\r\n  featureToggleDeveloperMode: false\r\n});\r\n","import { WarningGroupKey } from './warning-group-key.interface';\r\nimport moment from 'moment';\r\nimport { IWarningGroup } from './warning-group.interface';\r\n\r\nexport class WarningGroup {\r\n  private _warningGroup: IWarningGroup;\r\n\r\n  get key(): WarningGroupKey {\r\n    return {\r\n      geoHazard: this._warningGroup.geoHazard,\r\n      groupId: this._warningGroup.regionId,\r\n      groupName: this._warningGroup.regionName\r\n    };\r\n  }\r\n\r\n  get warnings() {\r\n    return this._warningGroup.warnings;\r\n  }\r\n\r\n  get groupType() {\r\n    return this._warningGroup.regionType;\r\n  }\r\n\r\n  get url() {\r\n    return this._warningGroup.url;\r\n  }\r\n\r\n  get counties() {\r\n    return this._warningGroup.counties;\r\n  }\r\n\r\n  get validFrom() {\r\n    return this._warningGroup.validFrom;\r\n  }\r\n\r\n  get validTo() {\r\n    return this._warningGroup.validTo;\r\n  }\r\n\r\n  get sortOrder() {\r\n    return this._warningGroup.sortOrder;\r\n  }\r\n\r\n  getWarningForDay(date: Date) {\r\n    const warningsForDay = this._warningGroup.warnings.filter((x) =>\r\n      moment(date).isBetween(x.validFrom, x.validTo, null, '[]')\r\n    );\r\n    if (warningsForDay.length > 0) {\r\n      return warningsForDay.reduce((pv, v) => {\r\n        if (pv && pv.warningLevel < v.warningLevel) {\r\n          return pv;\r\n        } else {\r\n          return v;\r\n        }\r\n      });\r\n    } else {\r\n      return warningsForDay[0];\r\n    }\r\n  }\r\n\r\n  getDayWarning(daysToAdd: number) {\r\n    const day = this.getMomentAtNoon(moment().add(daysToAdd, 'days'));\r\n    return this.getWarningForDay(day.toDate());\r\n  }\r\n\r\n  private getMomentAtNoon(m: moment.Moment) {\r\n    return m.clone().hours(12).minutes(0).seconds(0);\r\n  }\r\n\r\n  hasAnyWarnings(daysAhead = 2) {\r\n    return this.getMaxWarning(daysAhead).max > 0;\r\n  }\r\n\r\n  getMaxWarning(daysAhead = 2) {\r\n    let max = 0;\r\n    let hasWarning = false;\r\n    for (let i = 0; i <= daysAhead; i++) {\r\n      const dayWarning = this.getDayWarning(i);\r\n      if (dayWarning && dayWarning.warningLevel > max) {\r\n        max = dayWarning.warningLevel;\r\n        hasWarning = false;\r\n      }\r\n      if (\r\n        dayWarning &&\r\n        dayWarning.warningLevel === max &&\r\n        dayWarning.emergencyWarning\r\n      ) {\r\n        hasWarning = true;\r\n      }\r\n    }\r\n    return { max, hasWarning };\r\n  }\r\n\r\n  getKeyAsString() {\r\n    return `${this._warningGroup.geoHazard}_${this._warningGroup.regionId}_${this._warningGroup.regionName}`;\r\n  }\r\n\r\n  constructor(group: IWarningGroup) {\r\n    this._warningGroup = group;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { settings } from '../../../../settings';\r\nimport { UserSettingService } from '../user-setting/user-setting.service';\r\nimport moment, { lang } from 'moment';\r\nimport 'moment-timezone';\r\nimport { LangKey, GeoHazard } from '@varsom-regobs-common/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { NanoSql } from '../../../../nanosql';\r\nimport {\r\n  map,\r\n  tap,\r\n  switchMap,\r\n  shareReplay,\r\n  distinctUntilChanged,\r\n  take\r\n} from 'rxjs/operators';\r\nimport { IWarning } from './warning.interface';\r\nimport { WarningGroup } from './warning-group.model';\r\nimport { IWarningApiResult } from './warning-api-result.interface';\r\nimport { IAvalancheWarningApiResult } from './avalanche-warning-api-result.interface';\r\nimport { combineLatest, Observable, BehaviorSubject, of } from 'rxjs';\r\nimport { IWarningGroupInMapView } from './warninggroup-in-mapview.interface';\r\nimport { DataLoadService } from '../../../modules/data-load/services/data-load.service';\r\nimport { IWarningGroup } from './warning-group.interface';\r\nimport { IIceWarningApiResult } from './ice-warning-api-result.interface';\r\nimport { Platform } from '@ionic/angular';\r\nimport { HTTP } from '@ionic-native/http/ngx';\r\nimport { MapService } from '../../../modules/map/services/map/map.service';\r\nimport { IMapViewAndArea } from '../../../modules/map/services/map/map-view-and-area.interface';\r\nimport { toPromiseWithCancel } from '../../helpers/observable-helper';\r\nimport { IAvalancheWarningSimple } from './avalanche-warning-simple.interface';\r\nimport { LoggingService } from '../../../modules/shared/services/logging/logging.service';\r\nimport { DbHelperService } from '../db-helper/db-helper.service';\r\nimport { nSQL } from '@nano-sql/core';\r\nimport { LogLevel } from '../../../modules/shared/services/logging/log-level.model';\r\nimport { UserSetting } from '../../models/user-settings.model';\r\nimport { NSqlFullUpdateObservable } from '../../helpers/nano-sql/NSqlFullUpdateObservable';\r\n\r\nconst DEBUG_TAG = 'WarningService';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WarningService {\r\n  private _warningsObservable: Observable<WarningGroup[]>;\r\n  private _warningsForCurrentGeoHazardObservable: Observable<WarningGroup[]>;\r\n  private _warningGroupInMapViewObservable: Observable<IWarningGroupInMapView>;\r\n  private latestWarnings: BehaviorSubject<{ [key: string]: IWarningGroup[] }>;\r\n\r\n  get warningsObservable$() {\r\n    return this._warningsObservable;\r\n  }\r\n\r\n  get warningsForCurrentGeoHazardObservable$() {\r\n    return this._warningsForCurrentGeoHazardObservable;\r\n  }\r\n\r\n  get warningGroupInMapViewObservable$() {\r\n    return this._warningGroupInMapViewObservable;\r\n  }\r\n\r\n  constructor(\r\n    private httpClient: HttpClient,\r\n    private userSettingService: UserSettingService,\r\n    private mapService: MapService,\r\n    private dataLoadService: DataLoadService,\r\n    private platform: Platform,\r\n    private nativeHttp: HTTP,\r\n    private loggingService: LoggingService,\r\n    private dbHelperService: DbHelperService\r\n  ) {\r\n    this.latestWarnings = new BehaviorSubject({});\r\n    this._warningsObservable = this.getWarningsForCurrentLanguageAsObservable();\r\n    this._warningsForCurrentGeoHazardObservable = this.getWarningsForCurrentLanguageAndCurrentGeoHazard();\r\n    this._warningGroupInMapViewObservable = this.getWarningsForCurrentMapViewAsObservable();\r\n  }\r\n\r\n  private getDataLoadId(geoHazard: GeoHazard, language: LangKey) {\r\n    return `${NanoSql.TABLES.WARNING.name}_${this.getLatestWarningKey(\r\n      geoHazard,\r\n      language\r\n    )}`;\r\n  }\r\n\r\n  private getLatestWarningKey(geoHazard: GeoHazard, langKey: LangKey) {\r\n    return `${geoHazard}_${this.getSupportedLanguage(langKey)}`;\r\n  }\r\n\r\n  private updateLatestWarnings(\r\n    geoHazard: GeoHazard,\r\n    langKey: LangKey,\r\n    result: IWarningGroup[]\r\n  ) {\r\n    const currentValue = this.latestWarnings.getValue();\r\n    currentValue[this.getLatestWarningKey(geoHazard, langKey)] = result;\r\n    this.latestWarnings.next(currentValue);\r\n  }\r\n\r\n  async updateWarnings(cancel?: Promise<void>) {\r\n    let cancelled = false;\r\n    if (cancel) {\r\n      cancel.then(() => {\r\n        cancelled = true;\r\n      });\r\n    }\r\n    this.loggingService.debug('Updating warnings by priority', DEBUG_TAG);\r\n    const userSettings = await this.userSettingService.userSetting$\r\n      .pipe(take(1))\r\n      .toPromise();\r\n    const geoHazards = await this.getGeoHazardsToUpdate(userSettings);\r\n    for (const geoHazard of geoHazards) {\r\n      if (!cancelled) {\r\n        await this.checkLastUpdatedAndUpdateDataIfNeeded(\r\n          geoHazard,\r\n          this.getSupportedLanguage(userSettings.language),\r\n          cancel\r\n        );\r\n      }\r\n    }\r\n    this.loggingService.debug('Updating warnings completed', DEBUG_TAG);\r\n  }\r\n\r\n  async updateWarningsForCurrentGeoHazard(cancel?: Promise<void>) {\r\n    let cancelled = false;\r\n    if (cancel) {\r\n      cancel.then(() => {\r\n        cancelled = true;\r\n      });\r\n    }\r\n    const userSettings = await this.userSettingService.userSetting$\r\n      .pipe(take(1))\r\n      .toPromise();\r\n    const geoHazards = await this.getGeoHazardsToUpdate(userSettings);\r\n    for (const geoHazard of geoHazards) {\r\n      if (!cancelled) {\r\n        await this.updateWarningsForGeoHazard(\r\n          geoHazard,\r\n          this.getSupportedLanguage(userSettings.language),\r\n          cancel\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  private async getGeoHazardsToUpdate(userSetting: UserSetting) {\r\n    const favourites = await this.getFavouritesAsObservable()\r\n      .pipe(take(1))\r\n      .toPromise();\r\n    const currentGeoHazards = userSetting.currentGeoHazard;\r\n    const favouriteGeoHazards = favourites.reduce(\r\n      (acc: GeoHazard[], current: { groupId: string; geoHazard: GeoHazard }) =>\r\n        acc.indexOf(current.geoHazard) >= 0 ? acc : [...acc, current.geoHazard],\r\n      []\r\n    );\r\n    return Array.from(new Set([...currentGeoHazards, ...favouriteGeoHazards]));\r\n  }\r\n\r\n  private async checkLastUpdatedAndUpdateDataIfNeeded(\r\n    geoHazard: GeoHazard,\r\n    langKey: LangKey,\r\n    cancel?: Promise<void>\r\n  ) {\r\n    const dataLoad = await this.dataLoadService.getState(\r\n      this.getDataLoadId(geoHazard, langKey)\r\n    );\r\n    const isLoadingTimeout = moment().subtract(\r\n      settings.foregroundUpdateIntervalMs,\r\n      'milliseconds'\r\n    );\r\n    if (\r\n      dataLoad.isLoading &&\r\n      moment(dataLoad.startedDate).isAfter(isLoadingTimeout)\r\n    ) {\r\n      this.loggingService.debug(\r\n        'Warnings is allready being updated.',\r\n        DEBUG_TAG\r\n      );\r\n    } else {\r\n      const lastUpdateLimit = moment().subtract(1, 'hour');\r\n      if (\r\n        !dataLoad.lastUpdated ||\r\n        moment(dataLoad.lastUpdated).isBefore(lastUpdateLimit)\r\n      ) {\r\n        await this.updateWarningsForGeoHazard(geoHazard, langKey, cancel);\r\n      } else {\r\n        this.loggingService.debug(\r\n          `No need to update ${geoHazard}. Last updated is: ${dataLoad.lastUpdated}`,\r\n          DEBUG_TAG\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  updateWarningsForGeoHazard(\r\n    geoHazard: GeoHazard,\r\n    langKey: LangKey,\r\n    cancel?: Promise<void>\r\n  ) {\r\n    if (geoHazard === GeoHazard.Snow) {\r\n      return this.updateAvalancheWarnings(langKey, null, null, cancel);\r\n    } else if (geoHazard === GeoHazard.Ice) {\r\n      return this.updateIceWarnings(langKey);\r\n    } else {\r\n      return this.updateFloodAndLandslideWarnings(\r\n        geoHazard,\r\n        langKey,\r\n        null,\r\n        null,\r\n        cancel\r\n      );\r\n    }\r\n  }\r\n\r\n  addToFavourite(groupId: string, geoHazard: GeoHazard) {\r\n    const id = `${geoHazard}_${groupId}`;\r\n    return nSQL(NanoSql.TABLES.WARNING_FAVOURITE.name)\r\n      .query('upsert', { id, groupId, geoHazard })\r\n      .exec();\r\n  }\r\n\r\n  removeFromFavourite(groupId: string, geoHazard: GeoHazard) {\r\n    const id = `${geoHazard}_${groupId}`;\r\n    return nSQL(NanoSql.TABLES.WARNING_FAVOURITE.name)\r\n      .query('delete')\r\n      .where((g) => g.id === id)\r\n      .exec();\r\n  }\r\n\r\n  getIsFavouriteObservable(\r\n    groupId: string,\r\n    geoHazard: GeoHazard\r\n  ): Observable<boolean> {\r\n    const id = `${geoHazard}_${groupId}`;\r\n    return new NSqlFullUpdateObservable<\r\n      { id: string; groupId: string; geoHazard: GeoHazard }[]\r\n    >(\r\n      nSQL(NanoSql.TABLES.WARNING_FAVOURITE.name)\r\n        .query('select')\r\n        .where(['id', '=', id])\r\n        .listen()\r\n    ).pipe(\r\n      map((val) => (val.length > 0 ? true : false)),\r\n      distinctUntilChanged()\r\n    );\r\n  }\r\n\r\n  private getOfflineWarningsAsObservable(geoHazard: GeoHazard) {\r\n    return new NSqlFullUpdateObservable<IWarningGroup[]>(\r\n      nSQL(NanoSql.TABLES.WARNING.name).query('select').listen({\r\n        debounce: 200\r\n      })\r\n    ).pipe(\r\n      map((warningGroups) =>\r\n        warningGroups.filter((wg) => wg.geoHazard === geoHazard)\r\n      ),\r\n      map((warningGroups) =>\r\n        warningGroups.length === 0\r\n          ? this.getDefaultWarningGroups(geoHazard)\r\n          : warningGroups\r\n      )\r\n    );\r\n  }\r\n\r\n  private getWarningsAsObservable(): Observable<IWarningGroup[]> {\r\n    return combineLatest([\r\n      this.userSettingService.appModeLanguageAndCurrentGeoHazard$,\r\n      this.latestWarnings.asObservable()\r\n    ]).pipe(\r\n      switchMap(([[_, langKey, __], latestWarnings]) =>\r\n        combineLatest(\r\n          [\r\n            GeoHazard.Snow,\r\n            GeoHazard.Ice,\r\n            GeoHazard.Water,\r\n            GeoHazard.Soil\r\n          ].map((geoHazard) =>\r\n            this.getLatestWarningsOrFallbackToOffline(\r\n              latestWarnings,\r\n              geoHazard,\r\n              langKey\r\n            )\r\n          )\r\n        ).pipe(map((result) => [].concat(...result)))\r\n      ),\r\n      tap((result) =>\r\n        this.loggingService.debug(\r\n          'Warnings observable changed',\r\n          DEBUG_TAG,\r\n          result\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  private getLatestWarningsOrFallbackToOffline(\r\n    latestWarnings: { [key: string]: IWarningGroup[] },\r\n    geoHazard: GeoHazard,\r\n    langKey: LangKey\r\n  ) {\r\n    if (\r\n      latestWarnings[this.getLatestWarningKey(geoHazard, langKey)] !== undefined\r\n    ) {\r\n      return of(latestWarnings[this.getLatestWarningKey(geoHazard, langKey)]);\r\n    }\r\n    return this.getOfflineWarningsAsObservable(geoHazard);\r\n  }\r\n\r\n  private getDefaultWarningGroups(geoHazard: GeoHazard) {\r\n    switch (geoHazard) {\r\n    case GeoHazard.Snow:\r\n      return this.getDefaultAvalancheWarningGroups();\r\n    case GeoHazard.Ice:\r\n      return this.getDefaultIceWarningGroups();\r\n    default:\r\n      return this.getCountyWarningGroups(geoHazard);\r\n    }\r\n  }\r\n\r\n  private getDefaultIceWarningGroups() {\r\n    const iceRegionsDefaultJson = this.getDefaultIceForecastRegions();\r\n    const geoHazard = GeoHazard.Ice;\r\n    const regionGroups: IWarningGroup[] = iceRegionsDefaultJson.forecastRegions.map(\r\n      (region, index) => ({\r\n        id: `${region.name}_${geoHazard}`,\r\n        regionId: region.name,\r\n        regionName: region.name,\r\n        counties: region.counties,\r\n        url: region.url,\r\n        validFrom: null,\r\n        validTo: null,\r\n        geoHazard,\r\n        warnings: [],\r\n        sortOrder: index\r\n      })\r\n    );\r\n    return regionGroups;\r\n  }\r\n\r\n  private getCountyWarningGroups(geoHazard: GeoHazard) {\r\n    const regions = require('../../../../assets/json/regions.json');\r\n    const regionGroups: IWarningGroup[] = regions.map((region) => ({\r\n      id: `${region.Id}_${geoHazard}`,\r\n      regionId: region.Id,\r\n      regionName: region.Name,\r\n      counties: [region.Id],\r\n      geoHazard: geoHazard,\r\n      warnings: [],\r\n      sortOrder: this.convertCoutyToSortOrder(region.Id)\r\n    }));\r\n    return regionGroups;\r\n  }\r\n\r\n  private convertCoutyToSortOrder(countyId: string) {\r\n    const countyNr = parseInt(countyId, 10);\r\n    // Move Trøndelag to sort order 16 (Previous Sør-Trøndelag)\r\n    const regionFixedCountyNr = countyNr === 50 ? 16 : countyNr;\r\n    // Sort should be from north to south, so we have to reverse numbers\r\n    return regionFixedCountyNr * -1 + 22; // 22 is the max region nr (Jan Mayen)\r\n  }\r\n\r\n  private getDefaultAvalancheWarningGroups() {\r\n    const regions = require('../../../../assets/json/varslingsomraader.json');\r\n    const avalancheRegions: IWarningGroup[] = regions.features.map(\r\n      (region) => ({\r\n        id: `${region.properties.omradeID}_${GeoHazard.Snow}`,\r\n        regionId: `${region.properties.omradeID}`,\r\n        regionName: region.properties.omradeNavn,\r\n        regionType: region.properties.regionType,\r\n        counties: [],\r\n        geoHazard: GeoHazard.Snow,\r\n        warnings: [],\r\n        sortOrder: region.properties.sortID\r\n      })\r\n    );\r\n    return avalancheRegions;\r\n  }\r\n\r\n  private getFavouritesAsObservable() {\r\n    return new NSqlFullUpdateObservable<\r\n      { groupId: string; geoHazard: GeoHazard }[]\r\n    >(nSQL(NanoSql.TABLES.WARNING_FAVOURITE.name).query('select').listen());\r\n  }\r\n\r\n  getWarningGroupFavouritesObservable(): Observable<WarningGroup[]> {\r\n    return combineLatest([\r\n      this.getWarningsAsObservable(),\r\n      this.getFavouritesAsObservable()\r\n    ]).pipe(\r\n      map(([regions, favourites]) =>\r\n        this.mapAndSort(\r\n          regions.filter(\r\n            (region) =>\r\n              !!favourites.find(\r\n                (x) =>\r\n                  x.groupId === region.regionId &&\r\n                  x.geoHazard === region.geoHazard\r\n              )\r\n          )\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  private mapAndSort(waringGroup: IWarningGroup[]): WarningGroup[] {\r\n    return waringGroup\r\n      .map((group) => new WarningGroup(group))\r\n      .sort((a, b) => {\r\n        if (a.sortOrder === b.sortOrder) {\r\n          return a.key.geoHazard - b.key.geoHazard;\r\n        } else {\r\n          return a.sortOrder - b.sortOrder;\r\n        }\r\n      });\r\n  }\r\n\r\n  private getWarningsForCurrentLanguageAsObservable() {\r\n    return this.getWarningsAsObservable().pipe(\r\n      map((warningGroups) => this.mapAndSort(warningGroups)),\r\n      shareReplay(1)\r\n    );\r\n  }\r\n\r\n  private getWarningsForCurrentLanguageAndCurrentGeoHazard() {\r\n    return combineLatest([\r\n      this.getWarningsForCurrentLanguageAsObservable(),\r\n      this.userSettingService.currentGeoHazard$\r\n    ]).pipe(\r\n      map(([warningGroups, currentGeoHazard]) => {\r\n        return warningGroups.filter((wg) =>\r\n          currentGeoHazard.find((g) => g === wg.key.geoHazard)\r\n        );\r\n      }),\r\n      shareReplay(1)\r\n    );\r\n  }\r\n\r\n  private getWarningsForCurrentMapViewAsObservable() {\r\n    return combineLatest([\r\n      this.mapService.mapViewAndAreaObservable$,\r\n      this.getWarningsAsObservable()\r\n    ]).pipe(\r\n      switchMap(([mapViewArea, _]) =>\r\n        this.getWarningsForCurrentMapView(mapViewArea)\r\n      ),\r\n      map((result) => result),\r\n      tap((val) => {\r\n        this.loggingService.debug(\r\n          'getWarningsForCurrentMapViewAsObservable changed',\r\n          DEBUG_TAG,\r\n          val\r\n        );\r\n      }),\r\n      shareReplay(1)\r\n    );\r\n  }\r\n\r\n  private groupIsInRegion(warningGroup: WarningGroup, regionId: string) {\r\n    const arr = [warningGroup.key.groupId, ...warningGroup.counties];\r\n    return arr.indexOf(regionId) >= 0;\r\n  }\r\n\r\n  private isGroupInMapCenter(\r\n    mapViewArea: IMapViewAndArea,\r\n    warningGroup: WarningGroup\r\n  ) {\r\n    return this.groupIsInRegion(warningGroup, mapViewArea.regionInCenter);\r\n  }\r\n\r\n  private isGroupInViewBounds(\r\n    mapViewArea: IMapViewAndArea,\r\n    warningGroup: WarningGroup\r\n  ) {\r\n    return (\r\n      mapViewArea.regionsInViewBounds.filter((region) =>\r\n        this.groupIsInRegion(warningGroup, region)\r\n      ).length > 0\r\n    );\r\n  }\r\n\r\n  private isGroupInViewBuffer(\r\n    mapViewArea: IMapViewAndArea,\r\n    warningGroup: WarningGroup\r\n  ) {\r\n    return (\r\n      mapViewArea.regionsInViewBuffer.filter((region) =>\r\n        this.groupIsInRegion(warningGroup, region)\r\n      ).length > 0\r\n    );\r\n  }\r\n\r\n  private getWarningsForCurrentMapView(\r\n    mapViewArea: IMapViewAndArea\r\n  ): Observable<IWarningGroupInMapView> {\r\n    return this.warningsForCurrentGeoHazardObservable$.pipe(\r\n      map((warnings) => {\r\n        const center = warnings.filter((warningGroup) =>\r\n          this.isGroupInMapCenter(mapViewArea, warningGroup)\r\n        );\r\n        const viewBounds = warnings.filter(\r\n          (warningGroup) =>\r\n            this.isGroupInViewBounds(mapViewArea, warningGroup) &&\r\n            !this.isGroupInMapCenter(mapViewArea, warningGroup)\r\n        );\r\n        const buffer = warnings.filter(\r\n          (warningGroup) =>\r\n            this.isGroupInViewBuffer(mapViewArea, warningGroup) &&\r\n            !this.isGroupInViewBounds(mapViewArea, warningGroup) &&\r\n            !this.isGroupInMapCenter(mapViewArea, warningGroup)\r\n        );\r\n        return {\r\n          center,\r\n          viewBounds,\r\n          buffer\r\n        };\r\n      })\r\n    );\r\n  }\r\n\r\n  private async updateFloodAndLandslideWarnings(\r\n    geoHazard: GeoHazard,\r\n    language: LangKey,\r\n    fromDate?: Date,\r\n    toDate?: Date,\r\n    cancelPromise?: Promise<void>\r\n  ) {\r\n    this.loggingService.debug(\r\n      `Updating ${GeoHazard[geoHazard]} warnings`,\r\n      DEBUG_TAG\r\n    );\r\n    const dateRange = this.getDefaultDateRange(fromDate, toDate);\r\n    const dataLoadId = this.getDataLoadId(geoHazard, language);\r\n    await this.dataLoadService.startLoading(dataLoadId);\r\n    const url =\r\n      `${this.getBaseUrl(geoHazard)}` +\r\n      `/Warning/All/${language}` +\r\n      `/${dateRange.from.format(settings.services.warning.dateFormat)}` +\r\n      `/${dateRange.to.format(settings.services.warning.dateFormat)}`;\r\n    try {\r\n      const warningsresult = await toPromiseWithCancel(\r\n        this.httpClient.get<IWarningApiResult[]>(url),\r\n        cancelPromise,\r\n        30000\r\n      );\r\n      const regions = this.aggregateWarningRegions(\r\n        warningsresult,\r\n        geoHazard,\r\n        language,\r\n        moment()\r\n      );\r\n      this.updateLatestWarnings(geoHazard, language, regions);\r\n      await this.dataLoadService.loadingCompleted(\r\n        dataLoadId,\r\n        regions.length,\r\n        dateRange.from.toDate(),\r\n        new Date()\r\n      );\r\n      this.saveWarningResultsToDb(geoHazard, regions);\r\n    } catch (err) {\r\n      await this.dataLoadService.loadingError(dataLoadId, err.message);\r\n    }\r\n  }\r\n\r\n  shouldReplaceWarning(existing: IWarning, newWarning: IWarning) {\r\n    if (moment(newWarning.publishTime).isAfter(moment(existing.publishTime))) {\r\n      return true;\r\n    }\r\n    if (\r\n      moment(newWarning.publishTime).isSame(moment(existing.publishTime)) &&\r\n      newWarning.warningLevel > existing.warningLevel\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  getWarningByRegions(warningsresult: IWarningApiResult[]) {\r\n    const regionMap = new Map<string, IWarningApiResult[]>();\r\n    for (const item of warningsresult) {\r\n      const regionId = item.CountyList[0].Id;\r\n      const collection = regionMap.get(regionId);\r\n      if (!collection) {\r\n        regionMap.set(regionId, [item]);\r\n      } else {\r\n        collection.push(item);\r\n      }\r\n    }\r\n    return regionMap;\r\n  }\r\n\r\n  getWarningByDay(\r\n    warningsresult: { subRegionId: string; warning: IWarning }[]\r\n  ) {\r\n    const dayWarningMap = new Map<\r\n      string,\r\n      { subRegionId: string; warning: IWarning }[]\r\n    >();\r\n    for (const item of warningsresult) {\r\n      const key = moment(item.warning.validTo).startOf('day').toISOString();\r\n      const collection = dayWarningMap.get(key);\r\n      if (!collection) {\r\n        dayWarningMap.set(key, [item]);\r\n      } else {\r\n        collection.push(item);\r\n      }\r\n    }\r\n    return dayWarningMap;\r\n  }\r\n\r\n  getMostRelevantWarningForSubRegion(\r\n    warningsresult: { subRegionId: string; warning: IWarning }[]\r\n  ) {\r\n    const subRegionMap = new Map<string, IWarning>();\r\n    for (const item of warningsresult) {\r\n      const warning = subRegionMap.get(item.subRegionId);\r\n      if (!warning || this.shouldReplaceWarning(warning, item.warning)) {\r\n        subRegionMap.set(item.subRegionId, item.warning);\r\n      }\r\n    }\r\n    return subRegionMap;\r\n  }\r\n\r\n  filterWarningsForGroup(\r\n    warningsresult: { subRegionId: string; warning: IWarning }[]\r\n  ) {\r\n    return Array.from(this.getWarningByDay(warningsresult)).map(([_, value]) =>\r\n      this.getMostRelevantDayWarning(value)\r\n    );\r\n  }\r\n\r\n  getMostRelevantDayWarning(\r\n    warningsresult: { subRegionId: string; warning: IWarning }[]\r\n  ): IWarning {\r\n    const warningsForSubRegions = this.getMostRelevantWarningForSubRegion(\r\n      warningsresult\r\n    );\r\n    const warningsForSubRegionsArray = Array.from(warningsForSubRegions).map(\r\n      ([_, value]) => value\r\n    );\r\n    const max = Math.max(\r\n      ...warningsForSubRegionsArray.map((v) => v.warningLevel)\r\n    );\r\n    return warningsForSubRegionsArray.find((w) => w.warningLevel === max);\r\n  }\r\n\r\n  aggregateWarningRegions(\r\n    warningsresult: IWarningApiResult[],\r\n    geoHazard: GeoHazard,\r\n    language: LangKey,\r\n    now: moment.Moment\r\n  ) {\r\n    const regionGroups = this.getWarningByRegions(warningsresult);\r\n    return Array.from(regionGroups).map(([key, value]) => ({\r\n      id: `${key}_${geoHazard}`,\r\n      regionId: key,\r\n      regionName: value[0].CountyList[0].Name,\r\n      counties: [key],\r\n      geoHazard,\r\n      warnings: this.filterWarningsForGroup(\r\n        value.map((w) => ({\r\n          subRegionId: w.MunicipalityCsvString,\r\n          warning: {\r\n            language,\r\n            mainText: w.MainText,\r\n            validFrom: this.getDate(w.ValidFrom),\r\n            validTo: this.getDate(w.ValidTo),\r\n            publishTime: this.getDate(w.PublishTime),\r\n            warningLevel: parseInt(w.ActivityLevel, 10)\r\n          }\r\n        }))\r\n      ),\r\n      sortOrder: this.convertCoutyToSortOrder(key)\r\n    }));\r\n  }\r\n\r\n  private async saveWarningResultsToDb(\r\n    geoHazard: GeoHazard,\r\n    regionResult: IWarningGroup[]\r\n  ) {\r\n    try {\r\n      this.loggingService.debug(\r\n        `Saving new ${GeoHazard[geoHazard]} warnings`,\r\n        DEBUG_TAG,\r\n        regionResult\r\n      );\r\n      const now = new Date();\r\n      await this.dbHelperService.fastInsert(\r\n        NanoSql.TABLES.WARNING.name,\r\n        regionResult,\r\n        (data) => data.id\r\n      );\r\n      this.loggingService.debug(\r\n        `fastInsert took ${new Date().getTime() - now.getTime()} ms`,\r\n        DEBUG_TAG\r\n      );\r\n      await this.deleteRegionsNoLongerInResult(geoHazard, regionResult); // NOTE: This also trigger change\r\n    } catch (err) {\r\n      this.loggingService.log(\r\n        'Could not save new warnings to db',\r\n        err,\r\n        LogLevel.Warning,\r\n        DEBUG_TAG\r\n      );\r\n    }\r\n  }\r\n\r\n  private getSupportedLanguage(language: LangKey): LangKey {\r\n    return language === LangKey.nb ? LangKey.nb : LangKey.en;\r\n  }\r\n\r\n  private async updateAvalancheWarnings(\r\n    language: LangKey,\r\n    fromDate?: Date,\r\n    toDate?: Date,\r\n    cancelPromise?: Promise<void>\r\n  ) {\r\n    this.loggingService.debug('Updating avalanche warnings', DEBUG_TAG);\r\n    let cancelled = false;\r\n    if (cancelPromise) {\r\n      cancelPromise.then(() => {\r\n        cancelled = true;\r\n      });\r\n    }\r\n    const supportedLang = lang;\r\n    const dateRange = this.getDefaultDateRange(fromDate, toDate);\r\n    const dataLoadId = this.getDataLoadId(GeoHazard.Snow, language);\r\n    await this.dataLoadService.startLoading(dataLoadId);\r\n    const url =\r\n      `${this.getBaseUrl(GeoHazard.Snow)}` +\r\n      `/RegionSummary/Detail/${language}` +\r\n      `/${dateRange.from.format(settings.services.warning.dateFormat)}` +\r\n      `/${dateRange.to.format(settings.services.warning.dateFormat)}`;\r\n    try {\r\n      const warningsresult = await toPromiseWithCancel(\r\n        this.httpClient.get<IAvalancheWarningApiResult[]>(url),\r\n        cancelPromise,\r\n        30000\r\n      );\r\n      if (!cancelled) {\r\n        const regionResult: IWarningGroup[] = warningsresult.map(\r\n          (region, index) => ({\r\n            id: `${region.Id}_${GeoHazard.Snow}`,\r\n            regionId: region.Id.toString(),\r\n            regionName: region.Name,\r\n            regionType: region.TypeName,\r\n            geoHazard: GeoHazard.Snow,\r\n            counties: [],\r\n            warnings: region.AvalancheWarningList.map((simpleWarning) =>\r\n              this.convertSimpleWarningToAppWarning(language, simpleWarning)\r\n            ),\r\n            sortOrder: index\r\n          })\r\n        );\r\n        this.updateLatestWarnings(GeoHazard.Snow, language, regionResult);\r\n        await this.dataLoadService.loadingCompleted(\r\n          dataLoadId,\r\n          regionResult.length,\r\n          dateRange.from.toDate(),\r\n          new Date()\r\n        );\r\n        this.saveWarningResultsToDb(GeoHazard.Snow, regionResult);\r\n      } else {\r\n        await this.dataLoadService.loadingError(\r\n          dataLoadId,\r\n          'Operation cancelled'\r\n        );\r\n      }\r\n    } catch (err) {\r\n      await this.dataLoadService.loadingError(dataLoadId, err.message);\r\n    }\r\n  }\r\n\r\n  private convertSimpleWarningToAppWarning(\r\n    language: LangKey,\r\n    simpleWarning: IAvalancheWarningSimple\r\n  ): IWarning {\r\n    return {\r\n      warningLevel: parseInt(simpleWarning.DangerLevel, 10),\r\n      publishTime: this.getDate(simpleWarning.PublishTime),\r\n      validFrom: this.getDate(simpleWarning.ValidFrom),\r\n      validTo: this.getDate(simpleWarning.ValidTo),\r\n      mainText: simpleWarning.MainText,\r\n      language,\r\n      emergencyWarning:\r\n        simpleWarning.EmergencyWarning !==\r\n        (language === LangKey.en ? 'Not given' : 'Ikke gitt')\r\n          ? simpleWarning.EmergencyWarning\r\n          : null\r\n    };\r\n  }\r\n\r\n  private async deleteRegionsNoLongerInResult(\r\n    geoHazard: GeoHazard,\r\n    regions: IWarningGroup[]\r\n  ) {\r\n    if (regions.length > 0) {\r\n      const ids = regions.map((r) => r.id);\r\n      const deleteResult = await nSQL(NanoSql.TABLES.WARNING.name)\r\n        .query('delete')\r\n        .where(\r\n          (dbItem: IWarningGroup) =>\r\n            dbItem.geoHazard === geoHazard && ids.indexOf(dbItem.id) < 0\r\n        )\r\n        .exec();\r\n      this.loggingService.debug(\r\n        'Deleted regions no longer in result:',\r\n        DEBUG_TAG,\r\n        deleteResult\r\n      );\r\n    }\r\n  }\r\n\r\n  private async updateIceWarnings(language: LangKey) {\r\n    this.loggingService.debug('Updating ice warnings', DEBUG_TAG);\r\n    const geoHazard = GeoHazard.Ice;\r\n    const dataLoadId = this.getDataLoadId(geoHazard, language);\r\n    await this.dataLoadService.startLoading(dataLoadId);\r\n    try {\r\n      const url = this.getBaseUrl(geoHazard);\r\n      const result = await this.getIceWarningsFromApi(url);\r\n      const regionResult: IWarningGroup[] = result.forecastRegions.map(\r\n        (region, index) => ({\r\n          id: `${region.name}_${geoHazard}`,\r\n          regionId: region.name,\r\n          regionName: region.name,\r\n          counties: region.counties,\r\n          url: region.url,\r\n          validFrom: this.getDate(region.validFrom),\r\n          validTo: this.getDate(region.validTo),\r\n          geoHazard,\r\n          warnings: [],\r\n          sortOrder: index\r\n        })\r\n      );\r\n      this.loggingService.debug(\r\n        'New updates for ice warnings:',\r\n        DEBUG_TAG,\r\n        regionResult\r\n      );\r\n\r\n      this.updateLatestWarnings(geoHazard, language, regionResult);\r\n      await this.dataLoadService.loadingCompleted(\r\n        dataLoadId,\r\n        regionResult.length,\r\n        null,\r\n        null\r\n      );\r\n      this.saveWarningResultsToDb(geoHazard, regionResult);\r\n    } catch (err) {\r\n      await this.dataLoadService.loadingError(dataLoadId, err.message);\r\n    }\r\n  }\r\n\r\n  private getIceWarningsFromApi(url: string) {\r\n    if (\r\n      this.platform.is('hybrid') &&\r\n      (this.platform.is('android') || this.platform.is('ios'))\r\n    ) {\r\n      return this.getIceWarningsFromApiNative(url);\r\n    } else {\r\n      return Promise.resolve(this.getDefaultIceForecastRegions());\r\n    }\r\n  }\r\n\r\n  private async getIceWarningsFromApiNative(\r\n    url: string\r\n  ): Promise<IIceWarningApiResult> {\r\n    this.nativeHttp.setDataSerializer('json');\r\n    const result = await this.nativeHttp.get(\r\n      url,\r\n      {},\r\n      {\r\n        'Content-Type': 'application/json'\r\n      }\r\n    );\r\n    if (result.status === 200) {\r\n      return JSON.parse(result.data.trim());\r\n    } else {\r\n      throw Error(\r\n        `Could not download warnings from: ${url}. Status: ${result.status}. Message: ${result.error}`\r\n      );\r\n    }\r\n  }\r\n\r\n  private getDefaultIceForecastRegions(): IIceWarningApiResult {\r\n    // NOTE: Mocking ice warnings for web because of missing CORS headers in api (just a static file)\r\n    return require('../../../../assets/json/ice_forecast_regions.json');\r\n  }\r\n\r\n  private getDate(dateString: string) {\r\n    return moment.tz(dateString, settings.services.warning.timezone).toDate();\r\n  }\r\n\r\n  private getBaseUrl(geoHazard: GeoHazard) {\r\n    return settings.services.warning[GeoHazard[geoHazard]].apiUrl;\r\n  }\r\n\r\n  private getDefaultDateRange(fromDate?: Date, toDate?: Date) {\r\n    const fromMoment = fromDate ? moment(fromDate) : moment().startOf('day');\r\n    // const fromMoment = fromDate ? moment(fromDate) : moment().subtract(1, 'day');\r\n    const toMoment = toDate\r\n      ? moment(toDate)\r\n      : moment()\r\n        .endOf('day')\r\n        .add(settings.services.warning.defaultWarningDaysAhead, 'days');\r\n    return { from: fromMoment, to: toMoment };\r\n  }\r\n}\r\n","import { TranslateService } from '@ngx-translate/core';\r\nimport { settings } from '../settings';\r\nimport { UserSettingService } from './core/services/user-setting/user-setting.service';\r\n\r\nexport function initTranslateService(\r\n  translateService: TranslateService,\r\n  userSettingService: UserSettingService\r\n): () => void {\r\n  return () => {\r\n    translateService.addLangs(\r\n      settings.language.supportedLanguages.map((l) => l.lang)\r\n    );\r\n    translateService.setDefaultLang(settings.language.fallbackLang);\r\n    userSettingService.init();\r\n  };\r\n}\r\n","import {\r\n  NgModule,\r\n  ModuleWithProviders,\r\n  APP_INITIALIZER,\r\n  Injector\r\n} from '@angular/core';\r\nimport { AnalyticService } from './services/analytic.service';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [],\r\n  exports: [],\r\n  providers: [\r\n    AnalyticService,\r\n    {\r\n      provide: APP_INITIALIZER,\r\n      useFactory: initializeAnalyticService,\r\n      multi: true,\r\n      deps: [AnalyticService]\r\n    }\r\n  ]\r\n})\r\nexport class AnalyticsModule {\r\n  static forRoot(): ModuleWithProviders<AnalyticsModule> {\r\n    return {\r\n      ngModule: AnalyticsModule\r\n    };\r\n  }\r\n}\r\n\r\nexport function initializeAnalyticService(analyticService: AnalyticService) {\r\n  return () => analyticService.init();\r\n}\r\n","export enum AppCustomDimension {\r\n  appName = 'appName',\r\n  appVersion = 'appVersion',\r\n  language = 'dimension6',\r\n  appMode = 'dimension1',\r\n  geoHazard = 'dimension2',\r\n  supportMap = 'dimension3',\r\n  showMapCenter = 'dimension4',\r\n  topoMap = 'dimension5',\r\n  enabledAnalytics = 'dimension7'\r\n}\r\n","export enum AppEventAction {\r\n  Click = 'click',\r\n  Share = 'share'\r\n}\r\n","export enum AppEventCategory {\r\n  Observations = 'observations',\r\n  Warnings = 'warnings'\r\n}\r\n","import { Injectable, Injector } from '@angular/core';\r\nimport { Router, NavigationEnd } from '@angular/router';\r\nimport { filter, map, distinctUntilChanged } from 'rxjs/operators';\r\nimport { settings } from '../../../../settings';\r\nimport { LoggingService } from '../../../modules/shared/services/logging/logging.service';\r\nimport { LogLevel } from '../../../modules/shared/services/logging/log-level.model';\r\nimport { environment } from '../../../../environments/environment';\r\nimport { AppVersionService } from '../../../core/services/app-version/app-version.service';\r\nimport { AppCustomDimension } from '../enums/app-custom-dimension.enum';\r\nimport { AppEventAction } from '../enums/app-event-action.enum';\r\nimport { AppEventCategory } from '../enums/app-event-category.enum';\r\nimport { removeOauthTokenFromUrl } from '../../shared/services/logging/url-utils';\r\n\r\nconst DEBUG_TAG = 'AnalyticService';\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AnalyticService {\r\n  get router() {\r\n    return this.injector.get(Router);\r\n  }\r\n\r\n  constructor(\r\n    private injector: Injector,\r\n    private loggingService: LoggingService,\r\n    private appVersionService: AppVersionService\r\n  ) {}\r\n\r\n  trackView(url: string) {\r\n    if (ga) {\r\n      const safeUrl = removeOauthTokenFromUrl(url);\r\n      this.loggingService.debug(`Tracking pageview ${safeUrl}`, DEBUG_TAG);\r\n      ga('set', 'page', url);\r\n      ga('send', 'pageview');\r\n    }\r\n  }\r\n\r\n  trackDimension(\r\n    dimension: AppCustomDimension,\r\n    value: string | number | boolean\r\n  ) {\r\n    if (ga) {\r\n      this.loggingService.debug(\r\n        `Tracking dimension ${dimension}: ${value}`,\r\n        DEBUG_TAG\r\n      );\r\n      ga('set', dimension, value);\r\n      ga('send', 'pageview');\r\n    }\r\n  }\r\n\r\n  trackEvent(\r\n    eventCategory: AppEventCategory,\r\n    eventAction: AppEventAction,\r\n    eventLabel?: string,\r\n    eventValue?: number\r\n  ) {\r\n    if (ga) {\r\n      this.loggingService.debug(\r\n        `Tracking event eventCategory:${eventCategory}, eventAction:${eventAction},` +\r\n          ` eventLabel:${eventLabel || ''}, eventValue: ${eventValue || ''}`,\r\n        DEBUG_TAG\r\n      );\r\n      ga('send', 'event', {\r\n        eventCategory,\r\n        eventAction,\r\n        eventLabel,\r\n        eventValue\r\n      });\r\n    }\r\n  }\r\n\r\n  disable() {\r\n    this.loggingService.debug('Disable Google Analytics', DEBUG_TAG);\r\n    window[`ga-disable-${settings.googleAnalytics.trackerId}`] = true;\r\n  }\r\n\r\n  enable() {\r\n    this.loggingService.debug(\r\n      `Enable Google Analytics ${\r\n        environment.production\r\n          ? ''\r\n          : '(DEV-MODE! Analytics data is not sent to server!)'\r\n      }`,\r\n      DEBUG_TAG\r\n    );\r\n    if (environment.production) {\r\n      window[`ga-disable-${settings.googleAnalytics.trackerId}`] = false;\r\n    }\r\n  }\r\n\r\n  init() {\r\n    if (!ga) {\r\n      this.loggingService.log(\r\n        'Could not load Google Analytics script. Probably ad blocker installed.',\r\n        null,\r\n        LogLevel.Warning,\r\n        DEBUG_TAG\r\n      );\r\n      return;\r\n    }\r\n    this.loggingService.debug(\r\n      `Init Google Analytics ${\r\n        environment.production\r\n          ? ''\r\n          : '(DEV-MODE! Analytics data is not sent to server!)'\r\n      }`,\r\n      DEBUG_TAG\r\n    );\r\n    if (!environment.production) {\r\n      // Disable sending events unless production build\r\n      this.disable();\r\n    }\r\n\r\n    this.loggingService.debug('Setup google analytics', DEBUG_TAG);\r\n    if (window.localStorage) {\r\n      ga('create', settings.googleAnalytics.trackerId, 'auto', {\r\n        storage: 'none',\r\n        clientId: window.localStorage.getItem('ga_clientId')\r\n      });\r\n      ga('set', 'checkProtocolTask', null);\r\n      ga(function (tracker) {\r\n        window.localStorage.setItem('ga_clientId', tracker.get('clientId'));\r\n      });\r\n    } else {\r\n      ga('create', settings.googleAnalytics.trackerId, 'auto');\r\n    }\r\n\r\n    const appVersion = this.appVersionService.getAppVersion();\r\n    ga('set', 'appName', 'regObs4');\r\n    ga('set', 'anonymizeIp', settings.googleAnalytics.anonymizeIp);\r\n    ga('set', 'appVersion', appVersion.version);\r\n    ga('send', 'pageview');\r\n\r\n    this.startTrackingPageViews();\r\n    this.loggingService.debug('Google analytics setup completed', DEBUG_TAG);\r\n  }\r\n\r\n  private startTrackingPageViews() {\r\n    this.router.events\r\n      .pipe(filter((event) => event instanceof NavigationEnd))\r\n      .pipe(\r\n        map((val: NavigationEnd) => val.urlAfterRedirects),\r\n        distinctUntilChanged()\r\n      )\r\n      .subscribe((url: string) => {\r\n        const safeUrl = removeOauthTokenFromUrl(url);\r\n        this.trackView(safeUrl);\r\n      });\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'auth/callback',\r\n    loadChildren: () =>\r\n      import('./pages/auth-callback/auth-callback.module').then(\r\n        (m) => m.AuthCallbackPageModule\r\n      )\r\n  }\r\n  // { path: 'auth/endsession', loadChildren: () => import('./pages/auth-callback/auth-callback.module').then(m => m.AuthCallbackPageModule) },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule]\r\n})\r\nexport class AuthRoutingModule {}\r\n","import { NgModule, NgZone } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { Requestor, StorageBackend } from '@openid/appauth';\r\nimport { AuthRoutingModule } from './auth-routing.module';\r\nimport { AuthService, Browser } from 'ionic-appauth';\r\nimport { authFactory } from './factories/auth-factory';\r\nimport { Platform } from '@ionic/angular';\r\nimport { httpFactory } from './factories/http-factory';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { storageFactory } from './factories/storage-factory';\r\nimport { UserSettingService } from '../../core/services/user-setting/user-setting.service';\r\nimport { CapacitorBrowser } from 'ionic-appauth/lib/capacitor';\r\n\r\n@NgModule({\r\n  declarations: [],\r\n  imports: [CommonModule, AuthRoutingModule],\r\n  providers: [\r\n    {\r\n      provide: StorageBackend,\r\n      useFactory: storageFactory,\r\n      deps: [Platform]\r\n    },\r\n    {\r\n      provide: Requestor,\r\n      useFactory: httpFactory,\r\n      deps: [Platform, HttpClient]\r\n    },\r\n    {\r\n      provide: Browser,\r\n      useClass: CapacitorBrowser\r\n    },\r\n    {\r\n      provide: AuthService,\r\n      useFactory: authFactory,\r\n      deps: [\r\n        Platform,\r\n        NgZone,\r\n        Requestor,\r\n        Browser,\r\n        StorageBackend,\r\n        UserSettingService\r\n      ]\r\n    }\r\n  ]\r\n})\r\nexport class AuthModule {}\r\n","import { Platform } from '@ionic/angular';\r\nimport { StorageBackend, Requestor } from '@openid/appauth';\r\nimport { AuthService, Browser } from 'ionic-appauth';\r\nimport { NgZone } from '@angular/core';\r\nimport { UserSettingService } from '../../../core/services/user-setting/user-setting.service';\r\nimport { settings } from '../../../../settings';\r\nimport { AppMode } from '@varsom-regobs-common/core';\r\nimport { RegobsAuthServiceOverride } from '../services/regobs-auth-service-override';\r\n\r\nexport const AUTH_CALLBACK_PATH = 'auth/callback';\r\n\r\nexport const authFactory = (\r\n  platform: Platform,\r\n  ngZone: NgZone,\r\n  requestor: Requestor,\r\n  browser: Browser,\r\n  storage: StorageBackend,\r\n  userSettingService: UserSettingService\r\n): AuthService => {\r\n  const authService = new RegobsAuthServiceOverride(browser, storage, requestor);\r\n  userSettingService.appMode$.subscribe((appMode: AppMode) => {\r\n    authService.authConfig = settings.authConfig[appMode];\r\n    if (!platform.is('cordova')) {\r\n      const url = `${window.location.origin}/${AUTH_CALLBACK_PATH}`;\r\n      authService.authConfig.redirect_url = url;\r\n      authService.authConfig.end_session_redirect_url = url;\r\n    }\r\n  });\r\n  return authService;\r\n};\r\n","import { HttpClient } from '@angular/common/http';\r\nimport { Platform } from '@ionic/angular';\r\n// import { CordovaRequestor } from 'ionic-appauth/lib/cordova';\r\nimport { NgHttpService } from '../ng-http.service';\r\n\r\nexport const httpFactory = (platform: Platform, httpClient: HttpClient) => {\r\n  // return platform.is('cordova') ? new CordovaRequestor() : new NgHttpService(httpClient);\r\n  return new NgHttpService(httpClient); // NgHttpService works fine, no need to use advanced http\r\n};\r\n","import { Platform } from '@ionic/angular';\r\n// import { CordovaSecureStorage } from 'ionic-appauth/lib/cordova';\r\n// import { CapacitorStorage } from 'ionic-appauth/lib/capacitor';\r\nimport { LocalStorageBackend } from '@openid/appauth';\r\n\r\nexport const storageFactory = (platform: Platform) => {\r\n  return new LocalStorageBackend();\r\n  // return platform.is('cordova') ? new CordovaSecureStorage() : new CapacitorStorage();\r\n};\r\n","import { Injectable } from '@angular/core';\r\nimport { Requestor } from '@openid/appauth';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { XhrSettings } from 'ionic-appauth/lib/cordova';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class NgHttpService implements Requestor {\r\n  constructor(private http: HttpClient) {}\r\n\r\n  public async xhr<T>(settings: XhrSettings): Promise<T> {\r\n    if (!settings.method) {\r\n      settings.method = 'GET';\r\n    }\r\n\r\n    switch (settings.method) {\r\n    case 'GET':\r\n      return this.http\r\n        .get<T>(settings.url, { headers: this.getHeaders(settings.headers) })\r\n        .toPromise();\r\n    case 'POST':\r\n      return this.http\r\n        .post<T>(settings.url, settings.data, {\r\n          headers: this.getHeaders(settings.headers)\r\n        })\r\n        .toPromise();\r\n    case 'PUT':\r\n      return this.http\r\n        .put<T>(settings.url, settings.data, {\r\n          headers: this.getHeaders(settings.headers)\r\n        })\r\n        .toPromise();\r\n    case 'DELETE':\r\n      return this.http\r\n        .delete<T>(settings.url, {\r\n          headers: this.getHeaders(settings.headers)\r\n        })\r\n        .toPromise();\r\n    }\r\n  }\r\n\r\n  private getHeaders(headers: any): HttpHeaders {\r\n    let httpHeaders: HttpHeaders = new HttpHeaders();\r\n\r\n    if (headers !== undefined) {\r\n      Object.keys(headers).forEach((key) => {\r\n        httpHeaders = httpHeaders.append(key, headers[key]);\r\n      });\r\n    }\r\n\r\n    return httpHeaders;\r\n  }\r\n}\r\n","import { HttpErrorResponse } from '@angular/common/http';\r\nimport { JQueryRequestor, LocalStorageBackend, Requestor, StorageBackend } from '@openid/appauth';\r\nimport { AuthActionBuilder, AuthService, Browser, DefaultBrowser } from 'ionic-appauth';\r\nimport { TOKEN_RESPONSE_KEY, TOKEN_RESPONSE_FULL_KEY } from 'src/app/modules/auth/services/regobs-auth.service';\r\nimport { TokenResponseFull } from './token-response-full';\r\n\r\n/**\r\n * Class to wrap ionic-appauth AuthService to handle error coming from requestAccessToken when\r\n * the user is coming from \"Reset password flow\". The error returned from /token endpoint contains AADB2C90090\r\n * and must be handled special.\r\n */\r\nexport class RegobsAuthServiceOverride extends AuthService {\r\n  constructor(\r\n    protected browser: Browser = new DefaultBrowser(),\r\n    protected storage: StorageBackend = new LocalStorageBackend(),\r\n    protected requestor: Requestor = new JQueryRequestor()\r\n  ) {\r\n    super(browser, storage, requestor);\r\n  }\r\n\r\n  protected async requestAccessToken(code: string, codeVerifier?: string): Promise<void> {\r\n    try {\r\n      await super.requestAccessToken(code, codeVerifier);\r\n    } catch (err) {\r\n      if (err.error?.error_description?.indexOf('AADB2C90090') >= 0) {\r\n        this.notifyActionListers(AuthActionBuilder.RefreshFailed(new Error('AADB2C90090')));\r\n        // Error in action listeners is only a string (toString)\r\n        // and error_description is not included, so we have to pass this in as a custom Error.\r\n      } else {\r\n        this.notifyActionListers(AuthActionBuilder.RefreshFailed(err));\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refresh token. If refresh fails, you can just try again.\r\n   * Will only remove cached tokens if refresh token is expired\r\n   */\r\n  public async refreshToken() {\r\n    await super.requestTokenRefresh().catch((error) => {\r\n      this.clearTokensIfRefreshTokenIsExpired(error);\r\n    });\r\n  }\r\n\r\n  private async clearTokensIfRefreshTokenIsExpired(error: unknown) {\r\n    if (error && error instanceof HttpErrorResponse && error.status !== 401 && error.status !== 400) {\r\n      // Only check if refresh token is valid if not 401 - Unauthorized or 400 - Bad request is returned from token endpoint\r\n      const tokenResponseFullString: string | null = await this.storage.getItem(TOKEN_RESPONSE_FULL_KEY);\r\n      if (tokenResponseFullString != null) {\r\n        const tokenResponseFull = new TokenResponseFull(JSON.parse(tokenResponseFullString));\r\n        if (tokenResponseFull.isRefreshTokenValid()) {\r\n          return; // Do not clear token from storage if refresh token is still valid\r\n        }\r\n      }\r\n    }\r\n    await this.storage.removeItem(TOKEN_RESPONSE_KEY);\r\n    await this.storage.removeItem(TOKEN_RESPONSE_FULL_KEY);\r\n    this.notifyActionListers(AuthActionBuilder.RefreshFailed(error));\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { AlertController, NavController, Platform } from '@ionic/angular';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { AuthActions, AuthService } from 'ionic-appauth';\r\nimport { BehaviorSubject, firstValueFrom, from, lastValueFrom, Observable, of, ReplaySubject } from 'rxjs';\r\nimport { filter, map, shareReplay, skip, switchMap, tap, withLatestFrom } from 'rxjs/operators';\r\nimport { LangKey } from '@varsom-regobs-common/core';\r\nimport { UserSettingService } from '../../../core/services/user-setting/user-setting.service';\r\nimport { LoggedInUser } from '../../login/models/logged-in-user.model';\r\nimport { AccountService, MyPageData, ObserverResponseDto } from '@varsom-regobs-common/regobs-api';\r\nimport { LoggingService } from '../../shared/services/logging/logging.service';\r\nimport { Location } from '@angular/common';\r\nimport { nowInSeconds, StorageBackend } from '@openid/appauth';\r\nimport { isAndroidOrIos } from 'src/app/core/helpers/ionic/platform-helper';\r\n\r\nconst DEBUG_TAG = 'RegobsAuthService';\r\nexport const RETURN_URL_KEY = 'authreturnurl';\r\nexport const TOKEN_RESPONSE_KEY = 'token_response';\r\nexport const TOKEN_RESPONSE_FULL_KEY = 'token_response_full';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class RegobsAuthService {\r\n  private _isLoggingInSubject = new BehaviorSubject<boolean>(false);\r\n  private myPageDataSubject = new ReplaySubject<MyPageData>();\r\n\r\n  public readonly loggedInUser$: Observable<LoggedInUser>;\r\n  private readonly initComplete$: Observable<boolean>;\r\n  readonly myPageData$: Observable<MyPageData>;\r\n\r\n  get isLoggingIn$(): Observable<boolean> {\r\n    return this._isLoggingInSubject.asObservable();\r\n  }\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private userSettingService: UserSettingService,\r\n    private logger: LoggingService,\r\n    private translateService: TranslateService,\r\n    private alertController: AlertController,\r\n    private router: Router,\r\n    private navCtrl: NavController,\r\n    private location: Location,\r\n    private accountService: AccountService,\r\n    private storage: StorageBackend,\r\n    private platform: Platform,\r\n    private accountApi: AccountService\r\n  ) {\r\n    this.initComplete$ = this.authService.initComplete$.pipe(\r\n      filter((isComplete) => isComplete),\r\n      shareReplay(1)\r\n    );\r\n\r\n    this.loggedInUser$ = this.createLoggedInUser$();\r\n\r\n    const events$ = this.initComplete$.pipe(switchMap(() => this.authService.events$));\r\n\r\n    events$\r\n      .pipe(filter((action) => action.action === AuthActions.SignInFailed && action.error !== 'Handle Not Available'))\r\n      .subscribe((action) => this.showErrorMessage(500, action.error));\r\n\r\n    events$\r\n      .pipe(filter((action) => action.action === AuthActions.RefreshFailed && action.error === 'AADB2C90090'))\r\n      .subscribe(() => this.signIn(false)); // Hack to detect user is coming from reset password flow. Route user back to login.\r\n\r\n    events$.pipe(filter((action) => action.action === AuthActions.SignInSuccess)).subscribe(async () => {\r\n      await this.redirectToReturnUrl();\r\n      await this.checkAndSetNickIfNickIsNull();\r\n    });\r\n\r\n    this.userSettingService.appMode$.pipe(skip(1)).subscribe(() => {\r\n      this.logout(); // When user change app mode, just logout and force user to login again for the new environment.\r\n    });\r\n\r\n    // TODO: This could be saved in offline storage if we want to presist\r\n    // myPage data and the user start app when offline and want to edit registration\r\n    this.myPageData$ = this.loggedInUser$.pipe(\r\n      switchMap((loggedInUser) => {\r\n        if (loggedInUser.isLoggedIn) {\r\n          return this.accountApi.AccountGetMyPageData();\r\n        } else {\r\n          return of(undefined);\r\n        }\r\n      }),\r\n      shareReplay(1)\r\n    );\r\n\r\n    this.initRefreshTokenOnStartup();\r\n  }\r\n\r\n  private createLoggedInUser$(): Observable<LoggedInUser> {\r\n    const tokenWithClaims$ = this.createTokenWithClaims$();\r\n    return this.initComplete$.pipe(\r\n      switchMap(() => tokenWithClaims$),\r\n      tap((tokenResponseWithClaims) => {\r\n        const tokenResponse = tokenResponseWithClaims.tokenResponse;\r\n        const issuedAt = tokenResponseWithClaims.tokenResponse?.issuedAt;\r\n        const issuedAtNice = issuedAt ? new Date(issuedAt * 1000) : undefined;\r\n        const gotToken = tokenResponse?.idToken ? 'OK' : 'NO TOKEN';\r\n        this.logger.debug(`Token: ${gotToken}, issued at: ${issuedAtNice}`, DEBUG_TAG);\r\n      }),\r\n      map((tokenResponseWithClaims) => ({\r\n        isLoggedIn: tokenResponseWithClaims?.tokenResponse != null,\r\n        token: tokenResponseWithClaims?.tokenResponse?.idToken,\r\n        tokenIssuedAt: tokenResponseWithClaims?.tokenResponse?.issuedAt,\r\n        email: tokenResponseWithClaims?.claims?.email\r\n      })),\r\n      shareReplay(1)\r\n    );\r\n  }\r\n\r\n  private createTokenWithClaims$() {\r\n    return this.initComplete$.pipe(\r\n      switchMap(() =>\r\n        this.authService.token$.pipe(\r\n          map((tokenResponse) => ({\r\n            tokenResponse,\r\n            claims: tokenResponse?.idToken ? this.parseJwt(tokenResponse.idToken) : undefined\r\n          }))\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  private initRefreshTokenOnStartup() {\r\n    this.initComplete$\r\n      .pipe(\r\n        switchMap(() => (isAndroidOrIos(this.platform) ? this.platform.resume : from(this.platform.ready()))),\r\n        withLatestFrom(this.loggedInUser$)\r\n      )\r\n      .subscribe(([, user]) => {\r\n        if (user?.token && this.isTokenOlderThan(user?.tokenIssuedAt, 300)) {\r\n          //token is older than 5 minutes, so refresh\r\n          this.logger.debug('App resumed. Refresh token...', DEBUG_TAG);\r\n          this.refreshToken();\r\n        }\r\n      });\r\n  }\r\n\r\n  isTokenOlderThan(tokenIssuedAt: number, ageInSeconds: number): boolean {\r\n    return tokenIssuedAt && tokenIssuedAt < nowInSeconds() - ageInSeconds;\r\n  }\r\n\r\n  public refreshToken(): Promise<void> {\r\n    return this.authService.refreshToken();\r\n  }\r\n\r\n  public authorizationCallback(url: string): void {\r\n    try {\r\n      this.authService.authorizationCallback(url);\r\n    } catch (err) {\r\n      this.logger.error(err, DEBUG_TAG, 'Could not call authorizationCallback');\r\n    }\r\n  }\r\n\r\n  public async signIn(setReturnUrl = true): Promise<void> {\r\n    const currentLang = await firstValueFrom(this.userSettingService.language$);\r\n    if (setReturnUrl) {\r\n      const url = this.router.url;\r\n      this.logger.debug(`SignIn: ReturnUrl = '${url}'`, DEBUG_TAG);\r\n      localStorage.setItem(RETURN_URL_KEY, url);\r\n    }\r\n    try {\r\n      await this.authService.signIn({\r\n        ui_locales: this.getSupportedLoginLocales(currentLang),\r\n        prompt: 'login' // Force login screen\r\n      });\r\n    } catch (err) {\r\n      this.logger.error(err, DEBUG_TAG, 'Could not signIn');\r\n    }\r\n  }\r\n\r\n  public async logout(): Promise<void> {\r\n    await this.storage.removeItem(TOKEN_RESPONSE_KEY);\r\n    this.authService.endSessionCallback();\r\n  }\r\n\r\n  private async checkAndSetNickIfNickIsNull(): Promise<ObserverResponseDto> {\r\n    try {\r\n      const user = await lastValueFrom(this.accountService.AccountGetObserver());\r\n      if (user && user.Nick != null && user.Nick != '') {\r\n        return;\r\n      }\r\n      const nick = await this.showSetNickDialog();\r\n      await lastValueFrom(this.accountService.AccountUpdateObserver({ Nick: nick }));\r\n    } catch (err) {\r\n      this.logger.error(err, DEBUG_TAG, 'Could not save nick');\r\n    }\r\n  }\r\n\r\n  private async showSetNickDialog(): Promise<string> {\r\n    const headerTextKey = 'SET_NICK_ALERT.INPUT_TEXT';\r\n    const messageTextKey = 'SET_NICK_ALERT.HELP_TEXT';\r\n    const okTextKey = 'DIALOGS.OK';\r\n    const translations = await lastValueFrom(this.translateService.get([headerTextKey, messageTextKey, okTextKey]));\r\n    const alert = await this.alertController.create({\r\n      header: translations[headerTextKey],\r\n      message: translations[messageTextKey],\r\n      backdropDismiss: false,\r\n      inputs: [\r\n        {\r\n          name: 'nick',\r\n          type: 'text',\r\n          max: 24\r\n        }\r\n      ],\r\n      buttons: [\r\n        {\r\n          text: translations[okTextKey],\r\n          handler: (data: { nick: string }) => {\r\n            return data && data.nick != null && data.nick != '';\r\n          }\r\n        }\r\n      ]\r\n    });\r\n    alert.present();\r\n\r\n    const result = (await alert.onDidDismiss()) as {\r\n      data: { values: { nick: string } };\r\n    };\r\n    return result?.data?.values?.nick;\r\n  }\r\n\r\n  public getLoggedInUserAsPromise(): Promise<LoggedInUser> {\r\n    return firstValueFrom(this.loggedInUser$);\r\n  }\r\n\r\n  private async redirectToReturnUrl(): Promise<void> {\r\n    if (this.location.path().indexOf('auth/callback') >= 0) {\r\n      const returnUrl = localStorage.getItem(RETURN_URL_KEY);\r\n      this.logger.debug(`redirectToReturnUrl: returnUrl from localStorage = '${returnUrl}'`, DEBUG_TAG);\r\n      if (returnUrl) {\r\n        localStorage.removeItem(RETURN_URL_KEY);\r\n        this.location.replaceState(this.router.serializeUrl(this.router.createUrlTree([''])));\r\n        await this.navCtrl.navigateForward(returnUrl);\r\n      } else {\r\n        await this.navCtrl.navigateRoot('');\r\n      }\r\n    }\r\n  }\r\n\r\n  private async showErrorMessage(status: number, message: string) {\r\n    const text = status === 401 ? 'UNAUTHORIZED' : status <= 0 ? 'SERVICE_UNAVAILABLE' : 'UNKNOWN_ERROR';\r\n    const messageText = `LOGIN.${text}`;\r\n    const extraMessage = text === 'UNKNOWN_ERROR' ? ` ${message}` : '';\r\n    const translations = await lastValueFrom(this.translateService.get(['ALERT.DEFAULT_HEADER', 'ALERT.OK', messageText]));\r\n    const alert = await this.alertController.create({\r\n      header: translations['ALERT.DEFAULT_HEADER'],\r\n      message: `${translations[messageText]}${extraMessage}`,\r\n      buttons: [translations['ALERT.OK']]\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  private getSupportedLoginLocales(langKey: LangKey) {\r\n    if (langKey === LangKey.nb || langKey === LangKey.nn) {\r\n      return 'nb-NO';\r\n    }\r\n    return 'en';\r\n  }\r\n\r\n  private parseJwt(token: string) {\r\n    const base64Url = token.split('.')[1];\r\n    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\r\n    const jsonPayload = decodeURIComponent(\r\n      atob(base64)\r\n        .split('')\r\n        .map(function (c) {\r\n          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\r\n        })\r\n        .join('')\r\n    );\r\n    return JSON.parse(jsonPayload);\r\n  }\r\n}\r\n","import {\r\n  nowInSeconds,\r\n  TokenResponse,\r\n  TokenResponseJson\r\n} from '@openid/appauth';\r\n\r\nexport const AUTH_EXPIRY_BUFFER = 10 * 60 * -1; // 10 mins in seconds\r\n\r\nexport interface TokenResponseFullJson extends TokenResponseJson {\r\n  refresh_token_expires_in: string;\r\n}\r\n\r\nexport class TokenResponseFull extends TokenResponse {\r\n  // eslint-disable-next-line max-len\r\n  // id_token: \"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IjQ5SVcxMGI3bjVSVTJsNFNqem9VblpvekdkYWpna3Z0QjgyQUswVHFHTU0ifQ.eyJleHAiOjE2MzIxOTM2ODksIm5iZiI6MTYzMjE1MDQ4OSwidmVyIjoiMS4wIiwiaXNzIjoiaHR0cHM6Ly9udmViMmMwMXRlc3QuYjJjbG9naW4uY29tLzQ3YjM5ZTRkLTA2MmYtNDhkZi05YTVhLWFiY2Y4OWQ4N2E0YS92Mi4wLyIsInN1YiI6IjcxOWFjYjVjLTI4MTAtNDA2NS1iNGIxLWU5YjY4ZDNmYTc3ZiIsImF1ZCI6IjEzMjcwODE1LTdkZWYtNDgwMC04ZmM5LTE3OGRkNTE3ZjU3NCIsImlhdCI6MTYzMjE1MDQ4OSwiYXV0aF90aW1lIjoxNjMyMTUwNDg2LCJ1aWQiOiI3MTlhY2I1Yy0yODEwLTQwNjUtYjRiMS1lOWI2OGQzZmE3N2YiLCJlbWFpbCI6Im9teUBudmUubm8iLCJuYW1lIjoiVW5rbm93biIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJwaG9uZV92ZXJpZmllZCI6ZmFsc2UsImNvbnNlbnRfb3BlcmF0aW5nX2luZm8iOmZhbHNlLCJjb25zZW50X25ld3NsZXR0ZXIiOmZhbHNlLCJjb25zZW50X3VzZXJfc3VydmV5IjpmYWxzZSwicm9sZXMiOlsicmVnT2JzX2FkbWluIl0sInBpZCI6IkIyQ18xQV9zaWduX3VwX3NpZ25faW5fbnZlIn0.zgzFYDrhttICNlK7-ddn4RMqu-JnXTTniP-qsI1KR939geLvoj8hemvjc7Oi67VMPUOxVhD0hzaGZ0l22uvAFFVnUjAb3mAyvdCDnnb3JKuzBoc-sNzvsp4LH3Uavl-szD-aHvUJ5PM_MJmXPpERBloYf3HK57hSyCfmpl1wwkFuB6vElPudedBBwn8vri_v6mzbEFy2Xo9HXRsC0bLbdXxYA1BD70Rq_JK-6XgKj2jwXiPFB5Z6-gULb5oSt7izkPo-BnjDdSdR6dF2WQcFQ5N07h_lS9QmFrHRvU7ML7xc3Y6mBJ4syIGa5xWTOG3UdMWaF87TSc8G4TqZXbEkkA\"\r\n  // id_token_expires_in: 43200\r\n  // not_before: 1632150489 //samme som issued_at\r\n  // profile_info: \"eyJ2ZXIiOiIxLjAiLCJ0aWQiOiI0N2IzOWU0ZC0wNjJmLTQ4ZGYtOWE1YS1hYmNmODlkODdhNGEiLCJzdWIiOm51bGwsIm5hbWUiOiJVbmtub3duIiwicHJlZmVycmVkX3VzZXJuYW1lIjpudWxsLCJpZHAiOm51bGx9\"\r\n  // eslint-disable-next-line max-len\r\n  // refresh_token: \"eyJraWQiOiJlTzRSeHRyR1Q3cEhTX1lBMTFsQzZhaVpFS21oTlRfd3ppcU5KakFQaVZ3IiwidmVyIjoiMS4wIiwiemlwIjoiRGVmbGF0ZSIsInNlciI6IjEuMCJ9.aCB-s3tzaJpKdi4Jle-it5amN5r7gQu_oQH-jQ30smduADaYCLeUKBJR8qdQLw-1JjOmyZ9akgf0r06Gi7HKDm1ekp_MQnetiB5IesHAVQv__18lcrojVQaEb5q_ifIjR8bngXMNJ8j7vM53yVHNVfIyBzVPniA8MkTFYByEtACFg-3HhGNt89rG4303fpbAc2gu-vP3YFYGCsmCoBzpIerRssuqS0jApMhJxBgSVbWpB4_k4rTmde7uQJ5i2ooO55-YJaD1ZcMcfA00wmd394PbGg7yxPIt8Ss2js6f30-wNOcENt0mV0mTlB_6LFgQ4XWiAXgZzxkGLBlCLHmOwA.eqkMEie0UXNorSYP.4vNmYAgRuUEWyKqQ0imSBsYhM6vB9DUcCST6_31TE_biQPNXD05fpa0XIckkFCDXoLkPW7B76qFrzCYkGgqp4y8TRNu7mtK-xtt9N-OSn_9MNnfen4pmOXSrzfV5R2tZyWB4zmoySHabPe44nliSimiewFh3nvYNBy-m9ayVbk90KOnjhvW6H-yPw3lzwCY1FnfhEIAfvWIcmZaujhMGdl0jYlsz0YbYm7ex_1hpkVs60U6wN-Qih5hRR3nCZblcmGOUa8rby0e2_PcAz_caXCj1hifQ5Id_TRjNPylroEwG1_6d5scYsPgTLPPkcOVXSTTmaYBQ_fYv8oQHCme3w3DxGsn5gSI66Rllm9WdeUQ5CSYpFZgaaUs7VqEdZglTnGKS8N8gcREtlHIdwnjwIkylpASAfdhvpMPCrmi3xzFZQbziyUjUHNADyFGl_b37JegP64KybuO9D4CDiGxKVaqi_bmdH9VmjiGuv9TXsE5ugFDGfxw1EZhvOrUuXqZO2OsTUcK_AIT_MsvJJ2b12bq25QtCU0fd1B9CyUe6E9qt4oYheI4dwpF04ADQBVCOzqCbEQEdMeN6LL9bmoR2xhy4is2q4kuBbbxDOU_Gp3H3UsEF5__YofTsJ9UlO758bEhqZTKHh-ya_4w3Dc3s513mPXMnuiaE-7sgIrjrjjENlIfVdAhittxh49EBmwqzU-AkM1q180Yax_WCX-c.uqm4ebK3LfQMSgCV3TcCgg\"\r\n  // refresh_token_expires_in: 86400\r\n  // scope: \"offline_access openid\"\r\n  // token_type: \"Bearer\"\r\n\r\n  refreshTokenExpiresIn: number | undefined; /* lifetime in seconds. */\r\n\r\n  constructor(response: TokenResponseFullJson) {\r\n    super(response);\r\n    if (response.refresh_token_expires_in) {\r\n      this.refreshTokenExpiresIn = parseInt(\r\n        response.refresh_token_expires_in,\r\n        10\r\n      );\r\n    }\r\n  }\r\n\r\n  isRefreshTokenValid(buffer: number = AUTH_EXPIRY_BUFFER): boolean {\r\n    if (this.expiresIn) {\r\n      const now = nowInSeconds();\r\n      return now < this.issuedAt + this.expiresIn + buffer;\r\n    } else {\r\n      return true;\r\n    }\r\n  }\r\n}\r\n","import {\r\n  RxJsonSchema\r\n} from 'rxdb';\r\nexport const AttachmentMetaSchema : RxJsonSchema = {\r\n  title: 'Attachment Metadata schema',\r\n  description: 'Attachment Metadata',\r\n  version: 0,\r\n  keyCompression: false,\r\n  type: 'object',\r\n  properties: {\r\n    id: {\r\n      type: 'string',\r\n      primary: true,\r\n    },\r\n    GeoHazardTID: {\r\n      type: 'number',\r\n    },\r\n    RegistrationTID: {\r\n      type: 'number',\r\n    },\r\n    ref: {\r\n      type: 'string',\r\n    },\r\n    type: {\r\n      type: 'string',\r\n    },\r\n    error: {\r\n    },\r\n    fileSize: {\r\n      type: 'number'\r\n    },\r\n    AttachmentId: {\r\n      type: 'number'\r\n    },\r\n    AttachmentUploadId: {\r\n      type: 'string',\r\n    },\r\n    Photographer: {\r\n      type: 'string',\r\n    },\r\n    Copyright: {\r\n      type: 'string',\r\n    },\r\n    Aspect: {\r\n      type: 'number'\r\n    },\r\n    Comment: {\r\n      type: 'string',\r\n    },\r\n    AttachmentMimeType: {\r\n      type: 'string',\r\n    },\r\n    IsMainAttachment: {\r\n    }\r\n  },\r\n  required: ['id', 'GeoHazardTID', 'RegistrationTID'],\r\n};\r\n","import {\r\n  RxJsonSchema\r\n} from 'rxdb';\r\nexport const GenericSchema : RxJsonSchema = {\r\n  title: 'Generic schema',\r\n  description: 'Generic offline table with string id',\r\n  version: 0,\r\n  keyCompression: false,\r\n  type: 'object',\r\n  properties: {\r\n    id: {\r\n      type: 'string',\r\n      primary: true\r\n    },\r\n    lastUpdated: {\r\n      type: 'number'\r\n    },\r\n    data: {\r\n      type: ['object', 'array' ]\r\n    }\r\n  },\r\n};\r\n","import {\r\n  RxJsonSchema\r\n} from 'rxdb';\r\nexport const RegistrationSyncProgressSchema : RxJsonSchema = {\r\n  title: 'Registration sync progress schema',\r\n  description: 'Registration sync progress',\r\n  version: 0,\r\n  keyCompression: false,\r\n  type: 'object',\r\n  properties: {\r\n    id: {\r\n      type: 'string',\r\n      primary: true,\r\n    },\r\n    recordsLeft: {\r\n      type: 'array',\r\n      uniqueItems: true,\r\n      items: {\r\n        type: 'string'\r\n      }\r\n    },\r\n    totalRecords: {\r\n      type: 'number',\r\n    },\r\n    startedTimestamp: {\r\n      type: 'number',\r\n    },\r\n    errors: {\r\n      type: 'array',\r\n      items: {\r\n        type: 'object',\r\n        properties: {\r\n          id: {\r\n            type: 'string'\r\n          },\r\n          error: {\r\n            type: 'string'\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  required: ['id'],\r\n};\r\n","import { RxJsonSchema } from 'rxdb';\r\nexport const RegistrationSchema: RxJsonSchema = {\r\n  title: 'Registration schema',\r\n  description: 'Registrations',\r\n  version: 0,\r\n  keyCompression: false,\r\n  type: 'object',\r\n  properties: {\r\n    id: {\r\n      type: 'string',\r\n      primary: true\r\n    },\r\n    changed: {\r\n      type: 'number'\r\n    },\r\n    geoHazard: {\r\n      type: 'number'\r\n    },\r\n    syncStatus: {\r\n      type: 'string'\r\n    },\r\n    lastSync: {\r\n      type: 'number'\r\n    },\r\n    syncError: {\r\n      type: 'string'\r\n    },\r\n    syncStatusCode: {\r\n      type: 'number'\r\n    },\r\n    request: {\r\n      type: 'object',\r\n      properties: {}\r\n    },\r\n    response: {\r\n      type: 'object',\r\n      properties: {}\r\n    },\r\n    changedRegistrationTid: {\r\n      type: ['number', 'null']\r\n    }\r\n  },\r\n  required: ['id', 'changed', 'geoHazard', 'syncStatus'],\r\n  attachments: {\r\n    encrypted: false\r\n  }\r\n};\r\n","import {\r\n  RxJsonSchema\r\n} from 'rxdb';\r\nexport const UploadProgressSchema : RxJsonSchema = {\r\n  title: 'Upload progress schema',\r\n  description: 'Upload progress',\r\n  version: 0,\r\n  keyCompression: false,\r\n  type: 'object',\r\n  properties: {\r\n    id: {\r\n      type: 'string',\r\n      primary: true,\r\n    },\r\n    totalBytes: {\r\n      type: 'number',\r\n    },\r\n    complete: {\r\n      type: 'number',\r\n    }\r\n  },\r\n  required: ['id', 'totalBytes', 'complete'],\r\n};\r\n","export function getBlobFromUrl(url: string): Promise<Blob> {\r\n  return new Promise((resolve, reject) => {\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.open('GET', url, true);\r\n    xhr.responseType = 'blob';\r\n    xhr.onerror = ((err) => reject(err));\r\n    xhr.onload = () => {\r\n      if (xhr.status == 200) {\r\n        resolve(xhr.response);\r\n      }else{\r\n        reject(new Error('Not found'));\r\n      }\r\n    };\r\n    xhr.send();\r\n  });\r\n}","import { RegistrationTid } from '../models/registration-tid.enum';\r\nimport { IRegistration } from '../models/registration.interface';\r\nimport { isEmpty, GeoHazard } from '@varsom-regobs-common/core';\r\nimport { ValidRegistrationType } from '../models/valid-registration.type';\r\nimport { AttachmentEditModel, AttachmentViewModel, RegistrationEditModel, RegistrationViewModel } from '@varsom-regobs-common/regobs-api';\r\nimport { SyncStatus } from '../registration.models';\r\n\r\nexport function getAllAttachments(reg: IRegistration, registrationTid?: RegistrationTid):  AttachmentEditModel[] {\r\n  if(!reg) {\r\n    return [];\r\n  }\r\n  if(reg.syncStatus === SyncStatus.InSync && reg.response) {\r\n    return getAllAttachmentsFromResponse(reg, registrationTid);\r\n  }\r\n  return getAllAttachmentsFromRequest(reg, registrationTid);\r\n}\r\n\r\nexport function getAttachmentsFromRegistrationViewModel(viewModel: RegistrationEditModel | RegistrationViewModel, registrationTid?: RegistrationTid): AttachmentEditModel[] {\r\n  if(!viewModel || !viewModel.Attachments) {\r\n    return [];\r\n  }\r\n  return (viewModel.Attachments as AttachmentViewModel[])\r\n    .filter((a) => ((registrationTid > 0) ? a.RegistrationTID === registrationTid : true))\r\n    .map((a) => ({ ...a, type: 'Attachment'  }));\r\n}\r\n\r\nexport function getDamageObsAttachments(viewModel: RegistrationEditModel, registrationTid?: RegistrationTid):  AttachmentEditModel[] {\r\n  if(!viewModel || !viewModel.DamageObs) {\r\n    return [];\r\n  }\r\n  return [].concat(...viewModel.DamageObs.map((item) => item.Attachments || []))\r\n    .filter((a) => ((registrationTid > 0) ? a.RegistrationTID === registrationTid : true));\r\n}\r\n\r\nexport function getWaterLevelAttachments(viewModel: RegistrationEditModel, registrationTid?: RegistrationTid):  AttachmentEditModel[] {\r\n  if(!viewModel || !viewModel.WaterLevel2 || !viewModel.WaterLevel2.WaterLevelMeasurement) {\r\n    return [];\r\n  }\r\n  return [].concat(...viewModel.WaterLevel2.WaterLevelMeasurement.map((item) => item.Attachments || []))\r\n    .filter((a) => ((registrationTid > 0) ? a.RegistrationTID === registrationTid : true));\r\n}\r\n\r\nexport function getAllAttachmentsFromViewModel(viewModel: RegistrationEditModel, registrationTid?: RegistrationTid):  AttachmentEditModel[] {\r\n  const attachments = getAttachmentsFromRegistrationViewModel(viewModel, registrationTid);\r\n  const damageObsAttachments = getDamageObsAttachments(viewModel, registrationTid);\r\n  const waterLevelAttachmetns = getWaterLevelAttachments(viewModel, registrationTid);\r\n  return  [].concat(...attachments, ...damageObsAttachments, ...waterLevelAttachmetns);\r\n}\r\n\r\nexport function getAllAttachmentsFromRequest(reg: IRegistration, registrationTid?: RegistrationTid):  AttachmentEditModel[] {\r\n  return  getAllAttachmentsFromViewModel(reg.request, registrationTid);\r\n}\r\n\r\nexport function getAllAttachmentsFromResponse(reg: IRegistration, registrationTid?: RegistrationTid):  AttachmentEditModel[] {\r\n  return  getAllAttachmentsFromViewModel(reg.response, registrationTid);\r\n}\r\n\r\nexport function deleteExistingAttachmentById(reg: IRegistration, attachmentId: number): void {\r\n  if(reg && reg.request) {\r\n    if(reg.request.Attachments && reg.request.Attachments.length > 0) {\r\n      reg.request.Attachments = reg.request.Attachments.filter((a) => a.AttachmentId !== attachmentId);\r\n    }\r\n    if(reg.request.WaterLevel2 && reg.request.WaterLevel2.WaterLevelMeasurement) {\r\n      for(const wlm of reg.request.WaterLevel2.WaterLevelMeasurement) {\r\n        wlm.Attachments = wlm.Attachments.filter((a) => a.AttachmentId !== attachmentId);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function editExistingAttachmentById(reg: IRegistration, attachmentId: number, model: AttachmentEditModel): void {\r\n  if(reg && reg.request) {\r\n    if(reg.request.Attachments && reg.request.Attachments.length > 0) {\r\n      reg.request.Attachments = (reg.request.Attachments || []).map((a) => {\r\n        if(a.AttachmentId === attachmentId) {\r\n          return Object.assign(a, model);\r\n        }\r\n        return a;\r\n      });\r\n    }\r\n    if(reg.request.WaterLevel2 && reg.request.WaterLevel2.WaterLevelMeasurement) {\r\n      for(const wlm of reg.request.WaterLevel2.WaterLevelMeasurement) {\r\n        wlm.Attachments = (wlm.Attachments || []).map((a) => {\r\n          if(a.AttachmentId === attachmentId) {\r\n            return Object.assign(a, model);\r\n          }\r\n          return a;\r\n        });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function getPropertyName(registrationTid: RegistrationTid): string {\r\n  return RegistrationTid[registrationTid];\r\n}\r\n\r\nexport function getRegistationPropertyForModel(regModel: RegistrationEditModel | RegistrationViewModel, registrationTid: RegistrationTid): ValidRegistrationType {\r\n  if (regModel && registrationTid) {\r\n    return regModel[getPropertyName(registrationTid)];\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function getRegistationProperty(reg: IRegistration, registrationTid: RegistrationTid): ValidRegistrationType {\r\n  return getRegistationPropertyForModel(reg.request, registrationTid);\r\n}\r\n\r\nexport function getRegistrationTids(): RegistrationTid[] {\r\n  return Object.keys(RegistrationTid)\r\n    .map((key) => RegistrationTid[key]).filter((val: RegistrationTid) => typeof (val) !== 'string');\r\n}\r\n\r\nexport function isObservationModelEmptyForRegistrationTid(regModel: RegistrationEditModel | RegistrationViewModel, registrationTid: RegistrationTid): boolean {\r\n  if (regModel && registrationTid) {\r\n    return isEmpty(getRegistationPropertyForModel(regModel, registrationTid));\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function isObservationEmptyForRegistrationTid(reg: IRegistration, registrationTid: RegistrationTid): boolean {\r\n  return isObservationModelEmptyForRegistrationTid(reg.request, registrationTid);\r\n}\r\n\r\nexport function hasAnyObservations(reg: IRegistration): boolean {\r\n  if (reg === undefined || reg === null) {\r\n    return false;\r\n  }\r\n  const registrationTids = getRegistrationTids();\r\n  return registrationTids.some((x) => !isObservationEmptyForRegistrationTid(reg, x));\r\n}\r\n\r\nexport function isArrayType(tid: RegistrationTid): boolean {\r\n  return [\r\n    RegistrationTid.AvalancheActivityObs,\r\n    RegistrationTid.AvalancheActivityObs2,\r\n    RegistrationTid.AvalancheDangerObs,\r\n    RegistrationTid.AvalancheEvalProblem2,\r\n    RegistrationTid.CompressionTest,\r\n    RegistrationTid.DangerObs,\r\n    RegistrationTid.Picture,\r\n    RegistrationTid.DamageObs\r\n  ].indexOf(tid) >= 0;\r\n}\r\n\r\nexport function getRegistrationTidsForGeoHazard(geoHazard: GeoHazard): RegistrationTid[] {\r\n  const commonTypes = [RegistrationTid.GeneralObservation];\r\n  const geoHazardValidTypes = new Map<GeoHazard, RegistrationTid[]>([\r\n    [GeoHazard.Snow, [\r\n      RegistrationTid.DangerObs,\r\n      RegistrationTid.AvalancheObs,\r\n      RegistrationTid.AvalancheActivityObs2,\r\n      RegistrationTid.WeatherObservation,\r\n      RegistrationTid.SnowSurfaceObservation,\r\n      RegistrationTid.CompressionTest,\r\n      RegistrationTid.SnowProfile2,\r\n      RegistrationTid.AvalancheEvalProblem2,\r\n      RegistrationTid.AvalancheEvaluation3,\r\n      RegistrationTid.Incident\r\n    ]],\r\n    [GeoHazard.Ice, [\r\n      RegistrationTid.IceCoverObs,\r\n      RegistrationTid.IceThickness,\r\n      RegistrationTid.DangerObs,\r\n      RegistrationTid.Incident\r\n    ]],\r\n    [GeoHazard.Water, [\r\n      RegistrationTid.WaterLevel2,\r\n      RegistrationTid.DamageObs\r\n    ]],\r\n    [GeoHazard.Soil, [\r\n      RegistrationTid.DangerObs,\r\n      RegistrationTid.LandSlideObs\r\n    ]]\r\n  ]);\r\n  return geoHazardValidTypes.get(geoHazard).concat(commonTypes);\r\n}\r\n\r\nexport function getOrCreateNewRegistrationForm(reg: IRegistration, tid: RegistrationTid): ValidRegistrationType {\r\n  if (isObservationEmptyForRegistrationTid(reg, tid)) {\r\n    return isArrayType(tid) ? [] : {};\r\n  }\r\n  return getRegistationProperty(reg, tid);\r\n}\r\n\r\n","export enum RegistrationTid {\r\n    GeneralObservation = 10,\r\n    Incident = 11,\r\n    Picture = 12,\r\n    DangerObs = 13,\r\n    DamageObs = 14,\r\n    WeatherObservation = 21,\r\n    SnowSurfaceObservation = 22,\r\n    SnowCoverObs = 23,\r\n    AvalancheDangerObs = 24,\r\n    CompressionTest = 25,\r\n    AvalancheObs = 26,\r\n    AvalancheActivityObs = 27,\r\n    AvalancheEvaluation = 28,\r\n    AvalancheEvaluation2 = 30,\r\n    AvalancheEvaluation3 = 31,\r\n    AvalancheEvalProblem2 = 32,\r\n    AvalancheActivityObs2 = 33,\r\n    SnowTempObs = 34,\r\n    DensityProfile = 35,\r\n    SnowProfile2 = 36,\r\n    StratProfile = 37,\r\n    IceThickness = 50,\r\n    IceCoverObs = 51,\r\n    WaterLevel = 61,\r\n    WaterLevel2 = 62,\r\n    LandSlideObs = 71,\r\n}\r\n","export enum SummaryKind {\r\n    List = 0,\r\n    Text = 1,\r\n    Url = 2,\r\n}\r\n","import { RegObsGenericValue } from '@varsom-regobs-common/regobs-api';\r\nimport { SummaryKind } from './summary-kind.enum';\r\n\r\nexport class TextSummary implements RegObsGenericValue {\r\n    readonly Kind = SummaryKind.Text;\r\n    readonly KindType = 'Text';\r\n\r\n    private _header: string;\r\n    private _value: string;\r\n\r\n    get Header() {\r\n      return this._header;\r\n    }\r\n\r\n    set Header(header: string) {\r\n      this._header = header;\r\n    }\r\n\r\n    get Value() {\r\n      return this._value;\r\n    }\r\n\r\n    set Value(value: string) {\r\n      this._value = value;\r\n    }\r\n\r\n    constructor(header: string, value: string) {\r\n      this._header = header;\r\n      this._value = value;\r\n    }\r\n\r\n}\r\n","import { RegObsGenericValue } from '@varsom-regobs-common/regobs-api';\r\nimport { SummaryKind } from './summary-kind.enum';\r\n\r\nexport class UrlSummary implements RegObsGenericValue {\r\n    readonly Kind = SummaryKind.Url;\r\n    readonly KindType = 'Url';\r\n\r\n    private _header: string;\r\n    private _value: string;\r\n\r\n    get Header() {\r\n      return this._header;\r\n    }\r\n\r\n    set Header(header: string) {\r\n      this._header = header;\r\n    }\r\n\r\n    get Value() {\r\n      return this.ensureValidUrl(this._value);\r\n    }\r\n\r\n    set Value(value: string) {\r\n      this._value = value;\r\n    }\r\n\r\n    constructor(header: string, value: string) {\r\n      this._header = header;\r\n      this._value = value;\r\n    }\r\n\r\n    private ensureValidUrl(url: string) {\r\n      const validProtocols = ['http', 'https'];\r\n      if (url && url.length > 0 && !validProtocols.some((vp) => url.toLocaleLowerCase().startsWith(vp))) {\r\n        const pIndex = url.indexOf('://');\r\n        if (pIndex >= 0) {\r\n          return `http://${url.substr(pIndex + 3)}`;\r\n        }\r\n\r\n        return `http://${url}`;\r\n      }\r\n      return url;\r\n    }\r\n\r\n}\r\n","/**\r\n * If a registration is changed locally or not\r\n */\r\nexport enum SyncStatus {\r\n  /**\r\n   * New registration or changes made locally, which is not sent to server (yet)\r\n   */\r\n  Draft = 'draft',\r\n\r\n  /**\r\n   * Registration is on its way to the server, but we have not confirmed that it is received (yet)\r\n   */\r\n  Sync = 'sync',\r\n\r\n  /**\r\n   * Registration is not changed locally. Same version exists on server\r\n   */\r\n  InSync = 'in-sync'\r\n}\r\n","import { InjectionToken } from '@angular/core';\r\nimport { ISummaryProvider } from './services/summary-providers/summary-provider.interface';\r\n\r\nexport const FOR_ROOT_OPTIONS_TOKEN = new InjectionToken<IRegistrationModuleOptions>('forRoot() Module configuration');\r\nexport const SUMMARY_PROVIDER_TOKEN = new InjectionToken<ISummaryProvider>('Registration summary provider token');\r\n\r\nexport interface IRegistrationModuleOptions {\r\n  adapter?: string;\r\n  autoSync?: boolean;\r\n  attachmentsSupported?: boolean;\r\n}","import { Pipe, PipeTransform } from '@angular/core';\r\nimport { take } from 'rxjs/operators';\r\nimport { KdvService } from '../services/kdv/kdv.service';\r\nimport { KdvKey } from '../models/kdv-key.type';\r\n\r\n@Pipe({\r\n  name: 'kdvDescription'\r\n})\r\nexport class KdvDescriptionPipe implements PipeTransform {\r\n  constructor(private kdvService: KdvService) { }\r\n\r\n  async transform(value: number, kdvKey: KdvKey, returnDescription = false): Promise<string> {\r\n    const kdvelements = await this.kdvService.getKdvRepositoryByKeyObservable(kdvKey).pipe(take(1)).toPromise();\r\n    const kdvelement = kdvelements.find((x) => x.Id === value);\r\n    const result = kdvelement ? (returnDescription ? kdvelement.Description : kdvelement.Name) : '';\r\n    return result.trim();\r\n  }\r\n\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CoreModule } from '@varsom-regobs-common/core';\r\nimport { FakeItemSyncCallbackService } from './services/item-sync-callback/fake-item-sync-callback.service';\r\nimport { RegobsApiSyncCallbackService } from './services/item-sync-callback/regobs-api-sync-callback.service';\r\nimport { RegobsApiModuleWithConfig, KdvElementsService, HelptextService as HelpTextApiService } from '@varsom-regobs-common/regobs-api';\r\nimport { OfflineDbServiceOptions } from './services/offline-db/offline-db-service.options';\r\nimport { TranslateLoader, TranslateModule, TranslateService } from '@ngx-translate/core';\r\nimport { GeneralObservationSummaryProvider } from './services/summary-providers/general-observation/general-observation.summary-provider';\r\nimport { HttpClient, HTTP_INTERCEPTORS } from '@angular/common/http';\r\nimport { HttpConnectivityInterceptor } from 'ngx-connectivity';\r\nimport { NewAttachmentService } from './services/add-new-attachment/new-attachment.service';\r\nimport { throwError } from 'rxjs';\r\nimport { WeatherSummaryProvider } from './services/summary-providers/snow/weather/weather.summary-provider';\r\nimport { RegobsRegistrationPipesModule } from './registration.pipes';\r\nimport { OfflineDbNewAttachmentService } from './services/add-new-attachment/offline-db-new-attachment.service';\r\nimport { FOR_ROOT_OPTIONS_TOKEN, IRegistrationModuleOptions, SUMMARY_PROVIDER_TOKEN } from './module.options';\r\nimport { TranslateHttpLoader } from '@ngx-translate/http-loader';\r\nimport FileAttachmentService from './services/add-new-attachment/file-attachment.service';\r\n\r\nexport function offlineDbServiceOptionsFactory(options?: IRegistrationModuleOptions): OfflineDbServiceOptions {\r\n  const offlineDbServiceOptions = new OfflineDbServiceOptions();\r\n  // If the optional options were provided via the .forRoot() static method, then apply\r\n  // them to the MyServiceOptions Type provider.\r\n  if (options) {\r\n    if (options.adapter) {\r\n      offlineDbServiceOptions.adapter = options.adapter;\r\n    }\r\n  }\r\n  return offlineDbServiceOptions;\r\n}\r\n\r\nexport function getFakeKdvElementsService(): unknown {\r\n  const fakeService = { KdvElementsGetKdvs: () => throwError(Error('Fake service')) };\r\n  return fakeService;\r\n}\r\n\r\nexport function getFakeHelpTextApiService(): unknown {\r\n  const fakeService = { HelptextGet: () => throwError(Error('Fake service')) };\r\n  return fakeService;\r\n}\r\n\r\nexport function createTranslateLoader(http: HttpClient): TranslateHttpLoader {\r\n  return new TranslateHttpLoader(http, './assets/i18n/', '.json');\r\n}\r\n\r\nexport const translateModuleForRoot = TranslateModule.forRoot({\r\n  loader: {\r\n    provide: TranslateLoader,\r\n    useFactory: createTranslateLoader,\r\n    deps: [HttpClient]\r\n  }\r\n});\r\n\r\n@NgModule({\r\n  imports: [CoreModule, RegobsApiModuleWithConfig, translateModuleForRoot],\r\n  declarations: [],\r\n  exports: [RegobsRegistrationPipesModule]\r\n})\r\nexport class RegistrationModule {\r\n  static forRoot(options?: IRegistrationModuleOptions): ModuleWithProviders<RegistrationModule> {\r\n    return {\r\n      ngModule: RegistrationModule,\r\n      providers: [\r\n        {\r\n          provide: FOR_ROOT_OPTIONS_TOKEN,\r\n          useValue: options\r\n        },\r\n        {\r\n          provide: OfflineDbServiceOptions,\r\n          useFactory: offlineDbServiceOptionsFactory,\r\n          deps: [FOR_ROOT_OPTIONS_TOKEN]\r\n        },\r\n        {\r\n          provide: 'OfflineRegistrationSyncService',\r\n          useClass: RegobsApiSyncCallbackService\r\n        },\r\n        {\r\n          provide: SUMMARY_PROVIDER_TOKEN,\r\n          useClass: GeneralObservationSummaryProvider,\r\n          multi: true\r\n        },\r\n        {\r\n          provide: SUMMARY_PROVIDER_TOKEN,\r\n          useClass: WeatherSummaryProvider,\r\n          multi: true\r\n        },\r\n        {\r\n          provide: HTTP_INTERCEPTORS,\r\n          useClass: HttpConnectivityInterceptor,\r\n          multi: true\r\n        },\r\n        {\r\n          provide: NewAttachmentService,\r\n          useClass: window.hasOwnProperty('cordova') ? FileAttachmentService : OfflineDbNewAttachmentService\r\n        },\r\n        TranslateService\r\n      ]\r\n    };\r\n  }\r\n\r\n  static forChild(options?: IRegistrationModuleOptions): ModuleWithProviders<RegistrationModule> {\r\n    return RegistrationModule.forRoot(options);\r\n  }\r\n\r\n  static forTesting(): ModuleWithProviders<RegistrationModule> {\r\n    return {\r\n      ngModule: RegistrationModule,\r\n      providers: [\r\n        {\r\n          provide: FOR_ROOT_OPTIONS_TOKEN,\r\n          useValue: { adapter: 'memory' }\r\n        },\r\n        {\r\n          provide: OfflineDbServiceOptions,\r\n          useValue: { adapter: 'memory' }\r\n        },\r\n        {\r\n          provide: 'OfflineRegistrationSyncService',\r\n          useClass: FakeItemSyncCallbackService\r\n        },\r\n        {\r\n          provide: SUMMARY_PROVIDER_TOKEN,\r\n          useClass: GeneralObservationSummaryProvider,\r\n          multi: true\r\n        },\r\n        {\r\n          provide: SUMMARY_PROVIDER_TOKEN,\r\n          useClass: WeatherSummaryProvider,\r\n          multi: true\r\n        },\r\n        {\r\n          provide: NewAttachmentService,\r\n          useClass: OfflineDbNewAttachmentService\r\n        },\r\n        { provide: KdvElementsService, useFactory: getFakeKdvElementsService },\r\n        { provide: HelpTextApiService, useFactory: getFakeHelpTextApiService }\r\n      ]\r\n    };\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { KdvDescriptionPipe } from './pipes/kdvDescription.pipe';\r\n\r\nconst PIPES = [\r\n  KdvDescriptionPipe,\r\n];\r\n\r\n@NgModule({\r\n  declarations: PIPES,\r\n  imports: [],\r\n  exports: PIPES,\r\n})\r\nexport class RegobsRegistrationPipesModule {}\r\n\r\nexport { KdvDescriptionPipe } from './pipes/kdvDescription.pipe';\r\n","import { GeoHazard, uuidv4 } from '@varsom-regobs-common/core';\r\nimport { BehaviorSubject, firstValueFrom, from, Observable, switchMap, tap } from 'rxjs';\r\nimport { LoggingService } from 'src/app/modules/shared/services/logging/logging.service';\r\nimport { AttachmentType, AttachmentUploadEditModel } from '../../models/attachment-upload-edit.interface';\r\nimport { RegistrationTid } from '../../registration.models';\r\nimport { NewAttachmentService } from './new-attachment.service';\r\nimport { File } from '@ionic-native/file/ngx';\r\nimport { Injectable } from '@angular/core';\r\n\r\nconst DEBUG_TAG = 'FileAttachmentService';\r\nconst ROOT_DIR = 'attachments';\r\n\r\n/**\r\n * Provides attachments saved on local drive\r\n */\r\n@Injectable()\r\nexport default class FileAttachmentService implements NewAttachmentService {\r\n  private hasCreatedRootFolder = false;\r\n  private attachmentsChanged = new BehaviorSubject<void>(undefined); //get a tick each time a registration's attachment changes\r\n\r\n  constructor(private file: File, private loggingService: LoggingService) {\r\n    this.attachmentsChanged.pipe(tap(() => this.loggingService.debug('Attachments changed', DEBUG_TAG)));\r\n  }\r\n\r\n  async addAttachment(\r\n    registrationId: string,\r\n    data: Blob,\r\n    mimeType: string,\r\n    geoHazard: GeoHazard,\r\n    registrationTid: RegistrationTid,\r\n    type?: AttachmentType,\r\n    ref?: string\r\n  ): Promise<void> {\r\n    const rootDir = await this.getRootPath();\r\n    await this.file.createDir(rootDir, registrationId, true);\r\n    const attachmentId = uuidv4();\r\n\r\n    const attachmentFileName = `${attachmentId}.${this.getFileExtension(mimeType)}`;\r\n    await this.file.writeFile(`${rootDir}/${registrationId}`, attachmentFileName, data, { replace: true });\r\n\r\n    const metadata: AttachmentUploadEditModel = {\r\n      GeoHazardTID: geoHazard,\r\n      RegistrationTID: registrationTid,\r\n      AttachmentMimeType: mimeType,\r\n      id: attachmentId,\r\n      type,\r\n      fileSize: data.size,\r\n      fileName: attachmentFileName,\r\n      ref\r\n    };\r\n    this.loggingService.debug(`Attachment saved in ${rootDir}/${registrationId}/${attachmentFileName}`, DEBUG_TAG, metadata);\r\n    await firstValueFrom(this.saveAttachmentMeta$(registrationId, metadata));\r\n  }\r\n\r\n  saveAttachmentMeta$(registrationId: string, meta: AttachmentUploadEditModel): Observable<unknown> {\r\n    return from(\r\n      this.getRootPath().then((rootDir) =>\r\n        this.file.writeFile(`${rootDir}/${registrationId}`, `${meta.id}.json`, JSON.stringify(meta), { replace: true })\r\n      )\r\n    ).pipe(tap(() => this.attachmentsChanged.next()));\r\n  }\r\n\r\n  getAttachments(registrationId: string): Observable<AttachmentUploadEditModel[]> {\r\n    return this.attachmentsChanged.pipe(switchMap(() => from(this.getAttachmentsFromFile(registrationId))));\r\n  }\r\n\r\n  getBlob(registrationId: string, attachmentId: string): Observable<Blob> {\r\n    return from(this.getBlobInternal(registrationId, attachmentId));\r\n  }\r\n\r\n  removeAttachment$(registrationId: string, attachmentId: string): Observable<boolean> {\r\n    return from(this.removeAttachmentInternal(registrationId, attachmentId));\r\n  }\r\n\r\n  removeAttachment(registrationId: string, attachmentId: string): void {\r\n    this.removeAttachment$(registrationId, attachmentId).subscribe();\r\n  }\r\n\r\n  async removeAttachments(registrationId: string): Promise<void> {\r\n    const path = await this.getRootPath();\r\n    await this.file.removeDir(`${path}/`, registrationId);\r\n    this.attachmentsChanged.next();\r\n  }\r\n\r\n  removeAttachments$(registrationId: string): Observable<void> {\r\n    return from(this.removeAttachments(registrationId));\r\n  }\r\n\r\n  /**\r\n   * Get file url for data directory\r\n   * @returns file url as string, with trailing /\r\n   */\r\n  private getDataDirectoryFileUrl(): string {\r\n    if (this.file && this.file.dataDirectory) {\r\n      const fileUrl = this.file.dataDirectory;\r\n      return fileUrl;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * Get root directory folder path\r\n   * @returns directory path as string\r\n   */\r\n  private async getRootPath(): Promise<string> {\r\n    const dataFolder = this.getDataDirectoryFileUrl();\r\n    if (!this.hasCreatedRootFolder) {\r\n      await this.file.createDir(dataFolder, ROOT_DIR, true);\r\n      this.hasCreatedRootFolder = true;\r\n    }\r\n    return `${dataFolder}${ROOT_DIR}`;\r\n  }\r\n\r\n  private async getAttachmentsFromFile(registrationId: string): Promise<AttachmentUploadEditModel[]> {\r\n    const path = await this.getRootPath();\r\n    if (await this.directoryForRegistrationExists(registrationId)) {\r\n      const entries = await this.file.listDir(path, registrationId);\r\n      return await Promise.all(\r\n        entries\r\n          .filter((entry) => entry.isFile && entry.name.endsWith('.json'))\r\n          .map((entry) => this.readMetadataFile(registrationId, entry.name))\r\n      );\r\n    }\r\n    return [];\r\n  }\r\n\r\n  private async readMetadataFile(registrationId: string, filename: string): Promise<AttachmentUploadEditModel> {\r\n    const rootDir = await this.getRootPath();\r\n    if (!(await this.directoryForRegistrationExists(registrationId))) {\r\n      throw Error(`Directory for registration ${rootDir}/${registrationId} does not exist`);\r\n    }\r\n    const content = await this.file.readAsText(`${rootDir}/${registrationId}`, filename);\r\n    return JSON.parse(content);\r\n  }\r\n\r\n  private async getBlobInternal(registrationId: string, attachmentId: string): Promise<Blob> {\r\n    const rootDir = await this.getRootPath();\r\n    const metadata = await this.readMetadataFile(registrationId, `${attachmentId}.json`);\r\n    const buffer = await this.file.readAsArrayBuffer(`${rootDir}/${registrationId}`, metadata.fileName);\r\n    return new Blob([buffer], { type: metadata.AttachmentMimeType });\r\n  }\r\n\r\n  private async removeAttachmentInternal(registrationId: string, attachmentId: string): Promise<boolean> {\r\n    const rootPath = await this.getRootPath();\r\n    const path = `${rootPath}/${registrationId}/`;\r\n    const metadataFileName = this.getMetadataFileName(attachmentId);\r\n    const metadata = await this.readMetadataFile(registrationId, metadataFileName);\r\n    await this.file.removeFile(path, metadata.fileName);\r\n    await this.file.removeFile(path, metadataFileName);\r\n\r\n    const remainingEntries = await this.file.listDir(rootPath, registrationId);\r\n    if (remainingEntries.length === 0) {\r\n      await this.file.removeDir(rootPath, registrationId);\r\n    }\r\n    this.attachmentsChanged.next();\r\n    return true;\r\n  }\r\n\r\n  private getMetadataFileName(attachmentId: string): string {\r\n    return `${attachmentId}.json`;\r\n  }\r\n\r\n  private getFileExtension(mimeType: string): string {\r\n    switch (mimeType) {\r\n      case 'image/jpeg':\r\n        return 'jpg';\r\n      case 'image/png':\r\n        return 'png';\r\n    }\r\n    return 'jpg';\r\n  }\r\n\r\n  private async directoryForRegistrationExists(registrationId: string): Promise<boolean> {\r\n    const path = await this.getRootPath();\r\n    try {\r\n      await this.file.checkDir(`${path}/`, registrationId);\r\n      return true;\r\n    } catch (err) {\r\n      return false;\r\n    }\r\n  }\r\n}\r\n","import { Observable } from 'rxjs';\r\nimport { GeoHazard } from '@varsom-regobs-common/core';\r\nimport { AttachmentType, AttachmentUploadEditModel, RegistrationTid } from '../../registration.models';\r\n\r\n/**\r\n * Handle storage of new registration attachments on client before they are sent to server\r\n */\r\nexport abstract class NewAttachmentService {\r\n  abstract addAttachment(\r\n    registrationId: string,\r\n    data: Blob,\r\n    mimeType: string,\r\n    geoHazard: GeoHazard,\r\n    registrationTid: RegistrationTid,\r\n    type?: AttachmentType,\r\n    ref?: string\r\n  ): Promise<void>;\r\n  abstract saveAttachmentMeta$(registrationId: string, meta: AttachmentUploadEditModel): Observable<unknown>;\r\n\r\n  /**\r\n   * Get list of attachment metadata each time an attachment (or attachment metadata) changes on provided registration\r\n   */\r\n  abstract getAttachments(registrationId: string): Observable<AttachmentUploadEditModel[]>;\r\n\r\n  abstract getBlob(registrationId: string, attachmentId: string): Observable<Blob>;\r\n  abstract removeAttachment(registrationId: string, attachmentId: string): void;\r\n  abstract removeAttachment$(registrationId: string, attachmentId: string): Observable<boolean>;\r\n  abstract removeAttachments(registrationId: string): Promise<void>;\r\n  abstract removeAttachments$(registrationId: string): Observable<void>;\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { combineLatest, EMPTY, forkJoin, from, Observable, of } from 'rxjs';\r\nimport { AppMode, AppModeService, GeoHazard, LoggerService, uuidv4 } from '@varsom-regobs-common/core';\r\nimport { AttachmentType, AttachmentUploadEditModel } from '../../models/attachment-upload-edit.interface';\r\nimport { OfflineDbService, TABLE_NAMES } from '../offline-db/offline-db.service';\r\nimport { NewAttachmentService } from './new-attachment.service';\r\nimport { catchError, filter, map, startWith, switchMap, take } from 'rxjs/operators';\r\nimport { RxAttachmentMetaCollection, RxAttachmentMetaDocument, RxRegistrationCollection, RxRegistrationDocument } from '../../db/RxDB';\r\nimport { RegistrationTid } from '../../models/registration-tid.enum';\r\n\r\n@Injectable()\r\nexport class OfflineDbNewAttachmentService implements NewAttachmentService {\r\n  constructor(\r\n    private offlineDbService: OfflineDbService,\r\n    protected appModeService: AppModeService,\r\n    protected loggerService: LoggerService\r\n  ) {}\r\n\r\n  async addAttachment(\r\n    registrationId: string,\r\n    data: Blob,\r\n    mimeType: string,\r\n    geoHazard: GeoHazard,\r\n    registrationTid: RegistrationTid,\r\n    type?: AttachmentType,\r\n    ref?: string\r\n  ): Promise<void> {\r\n    const attachmentId = uuidv4();\r\n    this.getRegistrationOfflineDocumentById(registrationId)\r\n      .pipe(\r\n        take(1),\r\n        switchMap((doc) =>\r\n          this.saveAttachmentMeta$(registrationId, {\r\n            id: attachmentId,\r\n            AttachmentMimeType: mimeType,\r\n            GeoHazardTID: geoHazard,\r\n            RegistrationTID: registrationTid,\r\n            type,\r\n            ref,\r\n            fileSize: data.size\r\n          }).pipe(\r\n            switchMap(() =>\r\n              from(\r\n                doc.putAttachment({\r\n                  id: attachmentId,\r\n                  data,\r\n                  type: mimeType\r\n                })\r\n              )\r\n            )\r\n          )\r\n        ),\r\n        catchError((err) => {\r\n          this.loggerService.error(() => 'Could not add attachment', err);\r\n          return EMPTY;\r\n        })\r\n      )\r\n      .subscribe();\r\n  }\r\n\r\n  getAttachments(registrationId: string): Observable<AttachmentUploadEditModel[]> {\r\n    return combineLatest([this.getRegistrationOfflineDocumentById(registrationId), this.getAnyChangesToMetaData$()]).pipe(\r\n      switchMap(([doc]) => (doc && doc.allAttachments().length > 0 ? this.getAttachmentMetaFromDocument(doc) : of([])))\r\n    );\r\n  }\r\n\r\n  private getAnyChangesToMetaData$() {\r\n    return this.getAttachmentMetaDbCollectionForAppMode().pipe(\r\n      switchMap((collection) => collection.$),\r\n      startWith({})\r\n    );\r\n  }\r\n\r\n  getAttachment(registrationId: string, attachmentId: string): Observable<AttachmentUploadEditModel> {\r\n    return this.getAttachments(registrationId).pipe(map((result) => result.find((a) => a.id === attachmentId)));\r\n  }\r\n\r\n  getBlob(registrationId: string, attachmentId: string): Observable<Blob> {\r\n    return this.getRegistrationOfflineDocumentById(registrationId).pipe(\r\n      filter((doc) => !!doc),\r\n      switchMap((doc) => of(doc.getAttachment(attachmentId))),\r\n      filter((attachment) => !!attachment),\r\n      switchMap((attachment) => from(attachment.getData() as Promise<Blob>))\r\n    );\r\n  }\r\n\r\n  removeAttachment(registrationId: string, attachmentId: string): void {\r\n    this.removeAttachment$(registrationId, attachmentId).subscribe();\r\n  }\r\n\r\n  removeAttachments$(registrationId: string): Observable<void> {\r\n    return from(this.removeAttachments(registrationId));\r\n  }\r\n\r\n  removeAttachment$(registrationId: string, attachmentId: string): Observable<boolean> {\r\n    return this.getRegistrationAttachmentDocument(registrationId, attachmentId).pipe(\r\n      take(1),\r\n      switchMap((a) => from(a.remove())),\r\n      switchMap(() =>\r\n        this.getAttachmentMetaDocument(attachmentId).pipe(\r\n          take(1),\r\n          switchMap((metaDoc) => from(metaDoc.remove()))\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  async removeAttachments(registrationId: string): Promise<void> {\r\n    const regDoc = await this.getRegistrationOfflineDocumentById(registrationId).pipe(take(1)).toPromise();\r\n    if (!regDoc) {\r\n      this.loggerService.debug('No registration document found!');\r\n      return;\r\n    }\r\n    const metaDocs = await this.getAttachmentMetaDocumentsFromRegistrationDocument(regDoc).pipe(take(1)).toPromise();\r\n    for (const metaDoc of metaDocs) {\r\n      try {\r\n        await metaDoc.remove();\r\n      } catch (err) {\r\n        this.loggerService.debug('Could not remove attachment meta document from registration document', metaDoc, err);\r\n      }\r\n    }\r\n    const collection = await this.getRegistrationDbCollectionForAppMode().pipe(take(1)).toPromise();\r\n    await collection.atomicUpsert(regDoc.toJSON()); // Removes attachments\r\n  }\r\n\r\n  private getRegistrationAttachmentDocument(registrationId: string, attachmentId: string) {\r\n    return this.getRegistrationOfflineDocumentById(registrationId).pipe(\r\n      filter((doc) => !!doc),\r\n      map((doc) => doc.getAttachment(attachmentId))\r\n    );\r\n  }\r\n\r\n  private getAttachmentMetaFromDocument(doc: RxRegistrationDocument) {\r\n    return this.getAttachmentMetaDocumentsFromRegistrationDocument(doc).pipe(\r\n      map((attachmentMetaDocs: RxAttachmentMetaDocument[]) => attachmentMetaDocs.filter((doc) => !!doc).map((mdoc) => mdoc.toJSON()))\r\n    );\r\n  }\r\n\r\n  private getAttachmentMetaDocumentsFromRegistrationDocument(doc: RxRegistrationDocument): Observable<RxAttachmentMetaDocument[]> {\r\n    const attachments = doc.allAttachments();\r\n    if (attachments.length <= 0) {\r\n      return of([]);\r\n    }\r\n    return forkJoin(doc.allAttachments().map((attachment) => this.getAttachmentMetaDocument(attachment.id).pipe(take(1))));\r\n  }\r\n\r\n  private getAttachmentMetaDocument(id: string): Observable<RxAttachmentMetaDocument> {\r\n    return this.getAttachmentMetaDbCollectionForAppMode().pipe(\r\n      switchMap((collection) => collection.findByIds$([id]).pipe(map((result) => result.get(id))))\r\n    );\r\n  }\r\n\r\n  public saveAttachmentMeta$(registrationId: string, attachmentMetaData: AttachmentUploadEditModel): Observable<RxAttachmentMetaDocument> {\r\n    return this.getAttachmentMetaDbCollectionForAppMode().pipe(\r\n      take(1),\r\n      switchMap((dbCollection) => from(dbCollection.atomicUpsert(attachmentMetaData)))\r\n    );\r\n  }\r\n\r\n  private getAttachmentMetaDbCollectionForAppMode(): Observable<RxAttachmentMetaCollection> {\r\n    return this.appModeService.appMode$.pipe(map((appMode) => this.getAttachmentMetaDbCollection(appMode)));\r\n  }\r\n\r\n  private getAttachmentMetaDbCollection(appMode: AppMode): RxAttachmentMetaCollection {\r\n    return this.offlineDbService.getDbCollection<RxAttachmentMetaCollection>(appMode, TABLE_NAMES.ATTACHMENT_META);\r\n  }\r\n\r\n  protected getRegistrationOfflineDocumentById(id: string): Observable<RxRegistrationDocument> {\r\n    return this.getRegistrationDbCollectionForAppMode().pipe(\r\n      switchMap((dbCollection) => dbCollection.findByIds$([id])),\r\n      map((result) => result.get(id))\r\n    );\r\n  }\r\n\r\n  private getRegistrationDbCollectionForAppMode(): Observable<RxRegistrationCollection> {\r\n    return this.appModeService.appMode$.pipe(map((appMode) => this.getRegistrationsDbCollection(appMode)));\r\n  }\r\n\r\n  private getRegistrationsDbCollection(appMode: AppMode): RxRegistrationCollection {\r\n    return this.offlineDbService.getDbCollection<RxRegistrationCollection>(appMode, TABLE_NAMES.REGISTRATION);\r\n  }\r\n}\r\n","import { Injectable, Inject, InjectionToken } from '@angular/core';\r\nimport { Observable, combineLatest, from, of, BehaviorSubject } from 'rxjs';\r\nimport { LanguageService, LoggerService, AppMode, LangKey, AppModeService } from '@varsom-regobs-common/core';\r\nimport { map, switchMap, shareReplay, catchError, concatMap, take } from 'rxjs/operators';\r\nimport { OfflineSyncMeta } from '../../models/offline-sync-meta.interface';\r\nimport moment from 'moment';\r\nimport { OfflineDbService } from '../offline-db/offline-db.service';\r\nimport { RxKdvCollection } from '../../db/RxDB';\r\nimport { RxDocument } from 'rxdb';\r\n\r\nexport const API_SYNCE_OFFLINE_BASE_SERVICE_OPTIONS_CONFIG = new InjectionToken<ApiSyncOfflineBaseServiceOptions>('ApiSyncOfflineBaseServiceOptions.config');\r\nexport interface ApiSyncOfflineBaseServiceOptions {\r\n  useLangKeyAsDbKey: boolean;\r\n  validSeconds: number;\r\n  offlineTableKey?: string | number;\r\n}\r\n\r\n@Injectable()\r\nexport abstract class ApiSyncOfflineBaseService<T>  {\r\n\r\n  public readonly data$: Observable<T>;\r\n  private isUpdatingSubject = new BehaviorSubject<boolean>(false);\r\n\r\n  get isUpdating$(): Observable<boolean> {\r\n    return this.isUpdatingSubject.asObservable();\r\n  }\r\n\r\n  constructor(\r\n    @Inject(API_SYNCE_OFFLINE_BASE_SERVICE_OPTIONS_CONFIG) protected options: ApiSyncOfflineBaseServiceOptions,\r\n    protected offlineDbService: OfflineDbService,\r\n    protected languageService: LanguageService,\r\n    protected appModeService: AppModeService,\r\n    protected logger: LoggerService) {\r\n    this.data$ = this.getDataObservable().pipe(shareReplay(1));\r\n  }\r\n\r\n  public abstract getUpdatedData(appMode: AppMode, langKey: LangKey): Observable<T>;\r\n  public abstract getFallbackData(appMode: AppMode, langKey: LangKey): Observable<T>;\r\n  public abstract getTableName(appMode: AppMode): string;\r\n\r\n  /** Force update offline data */\r\n  public update(): void {\r\n    this.isUpdatingSubject.next(true);\r\n    combineLatest([this.languageService.language$, this.appModeService.appMode$]).pipe(\r\n      switchMap(([langKey, appMode]) => this.getUpdatedDataAndSaveResultIfSuccess(appMode, langKey)),\r\n      take(1)).subscribe(() => {\r\n      this.isUpdatingSubject.next(false);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Check if data is to old to use (cache time has expired)\r\n   * @param metaData cached offline data\r\n   */\r\n  protected isValid(metaData: RxDocument<OfflineSyncMeta<T>>): boolean {\r\n    const valid = metaData && (metaData.lastUpdated > this.getInvalidTime().unix());\r\n    this.logger.debug(`Offline data is ${valid ? 'valid -> returning offline data' : 'not valid -> Fetch new data'}`, metaData);\r\n    return valid;\r\n  }\r\n\r\n  /**\r\n   * Get limit for when data is invalid (cache time)\r\n   */\r\n  protected getInvalidTime(): moment.Moment {\r\n    return moment().subtract(this.options.validSeconds, 'seconds');\r\n  }\r\n\r\n  /**\r\n   * Get data observable\r\n   */\r\n  private getDataObservable(): Observable<T> {\r\n    return combineLatest([this.languageService.language$, this.appModeService.appMode$]).pipe(\r\n      switchMap(([langKey, appMode]) =>\r\n        this.getOfflineDataAndReturnIfDataIsUpToDate(appMode, langKey)\r\n          .pipe(take(1), switchMap((updatedData) =>\r\n            updatedData != null ? of(updatedData) : this.getUpdatedDataAndSaveResultIfSuccessOrFallbackToAssetsFolder(appMode, langKey)))));\r\n  }\r\n\r\n  /**\r\n   * Get data from offline storage and return if valid. If not, return null\r\n   * @param appMode App mode\r\n   * @param langKey Language\r\n   */\r\n  private getOfflineDataAndReturnIfDataIsUpToDate(appMode: AppMode, langKey: LangKey): Observable<T> {\r\n    return this.getOfflineData(appMode, langKey).pipe(map((offlineMeta) => {\r\n      // Check if offline data is newer than 24 hours\r\n      if(this.isValid(offlineMeta)) {\r\n        return offlineMeta.data;\r\n      }\r\n      return null;\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Get new data and save to offline storage if success. If update of data fails, fall back to old offline storage data or assets in worst case\r\n   * @param appMode App Mode\r\n   * @param langKey Language\r\n   */\r\n  private getUpdatedDataAndSaveResultIfSuccessOrFallbackToAssetsFolder(appMode: AppMode, langKey: LangKey) {\r\n    return this.getUpdatedDataAndSaveResultIfSuccess(appMode, langKey).pipe(\r\n      catchError((err) => {\r\n        this.logger.warn('Could not get kvd elements from API. Fallback to offline storage', err);\r\n        return this.getOfflineDataOrFallbackToAssets(appMode, langKey);\r\n      }));\r\n  }\r\n\r\n  /**\r\n   * Get updated data and save result to offline storage if successful\r\n   */\r\n  private getUpdatedDataAndSaveResultIfSuccess(appMode: AppMode, langKey: LangKey) {\r\n    return this.getUpdatedData(appMode, langKey).pipe(\r\n      switchMap((data) => this.saveDataToOfflineDb(appMode, langKey, data).pipe(catchError((err) => {\r\n        this.logger.error('Could not save data to offline storage', err);\r\n        return of(data);\r\n      }), map(() => data))));\r\n  }\r\n\r\n  /**\r\n   * Save data to offline db\r\n   * @param appMode App mode\r\n   * @param langKey Language\r\n   * @param data Data to save\r\n   */\r\n  private saveDataToOfflineDb(appMode: AppMode, langKey: LangKey, data: T) {\r\n    const meta: OfflineSyncMeta<T> = {\r\n      id: this.getOfflineStorageDbKey(langKey),\r\n      lastUpdated: moment().unix(),\r\n      data\r\n    };\r\n    return from(this.getDbCollection(appMode).atomicUpsert(meta));\r\n  }\r\n\r\n  /**\r\n   * Get offline db collection\r\n   * @param appMode App mode\r\n   */\r\n  private getDbCollection(appMode: AppMode): RxKdvCollection {\r\n    const collection = this.offlineDbService.db[this.getTableName(appMode)];\r\n    return collection as RxKdvCollection;\r\n  }\r\n\r\n  /**\r\n   * Get data from offline db\r\n   * @param appMode App mode\r\n   * @param langKey Language\r\n   */\r\n  private getOfflineData(appMode: AppMode, langKey: LangKey): Observable<RxDocument<OfflineSyncMeta<T>>> {\r\n    const collection =  this.getDbCollection(appMode);\r\n    const key = this.getOfflineStorageDbKey(langKey);\r\n    return collection.findByIds$([key]).pipe(map((val) => val.has(key) ? val.get(key) : null)) as Observable<RxDocument<OfflineSyncMeta<T>>>;\r\n  }\r\n\r\n  /**\r\n   * Get primary key for storing offline data\r\n   * @param langKey Language\r\n   */\r\n  private getOfflineStorageDbKey(langKey: LangKey) {\r\n    return  this.options.useLangKeyAsDbKey ? `${langKey}` : `${this.options.offlineTableKey}`;\r\n  }\r\n\r\n  /**\r\n   * Get offline data or fallback to something if no offline data\r\n   * @param appMode App mode\r\n   * @param langKey Language\r\n   */\r\n  private getOfflineDataOrFallbackToAssets(appMode: AppMode, langKey: LangKey) {\r\n    return this.getOfflineData(appMode, langKey).pipe(\r\n      concatMap((val) => {\r\n        if(!val) {\r\n          this.logger.warn('No kdv elements found in offline storage. Get fallback data');\r\n          return this.getFallbackData(appMode, langKey);\r\n        }\r\n        return of(val.data);\r\n      }));\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HelptextDto, HelptextService as HelpTextApiService } from '@varsom-regobs-common/regobs-api';\r\nimport {\r\n  AppMode,\r\n  LoggerService,\r\n  LangKey,\r\n  getLangKeyString,\r\n  LanguageService,\r\n  GeoHazard,\r\n  AppModeService } from '@varsom-regobs-common/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { catchError, map} from 'rxjs/operators';\r\nimport { Observable, of } from 'rxjs';\r\nimport { OfflineDbService } from '../offline-db/offline-db.service';\r\nimport { ApiSyncOfflineBaseService } from '../api-sync-offline-base/api-sync-offline-base.service';\r\n\r\nconst VALID_HELP_TEXT_SECONDS = 73200; // 12 hours\r\nconst HELP_TEXTS_ASSETS_FOLDER = '/assets/json';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class HelpTextService extends ApiSyncOfflineBaseService<HelptextDto[]> {\r\n\r\n  constructor(protected offlineDbService: OfflineDbService,\r\n    protected languageService: LanguageService,\r\n    protected appModeService: AppModeService,\r\n    protected logger: LoggerService,\r\n    private helpTextApiService: HelpTextApiService,\r\n    private httpClient: HttpClient) {\r\n    super({\r\n      useLangKeyAsDbKey: true,\r\n      validSeconds: VALID_HELP_TEXT_SECONDS\r\n    }, offlineDbService, languageService, appModeService, logger);\r\n  }\r\n\r\n  public getTableName(appMode: AppMode): string {\r\n    return `${appMode.toLocaleLowerCase()}/helptexts`;\r\n  }\r\n\r\n  public getUpdatedData(_: AppMode, langKey: LangKey): Observable<HelptextDto[]> {\r\n    return this.helpTextApiService.HelptextGet(langKey);\r\n  }\r\n\r\n  public getFallbackData(_: AppMode, langKey: LangKey): Observable<HelptextDto[]> {\r\n    return this.httpClient.get<HelptextDto[]>\r\n    (`${HELP_TEXTS_ASSETS_FOLDER}/helptexts.${getLangKeyString(langKey)}.json`)\r\n      .pipe(catchError((err) => {\r\n        this.logger.warn(`Helptexts for language ${getLangKeyString(langKey)} not found in assets/kdvelements folder`, err);\r\n        return of([]);\r\n      }));\r\n  }\r\n\r\n  public getHelpTextObservable(geoHazard: GeoHazard, registrationTid: number): Observable<string> {\r\n    return this.data$.pipe(map((helptexts: HelptextDto[]) =>\r\n      helptexts.find((data) => data.GeoHazardTID === geoHazard && data.RegistrationTID === registrationTid)),\r\n    map((helpText) => helpText ? helpText.Text : undefined));\r\n  }\r\n\r\n  public hasHelpTextObservable(geoHazard: GeoHazard, registrationTid: number): Observable<boolean> {\r\n    return this.getHelpTextObservable(geoHazard, registrationTid).pipe(map((val) => !!val));\r\n  }\r\n}\r\n","import { ItemSyncCallbackService } from './item-sync-callback.service';\r\nimport { Injectable } from '@angular/core';\r\nimport { timer, Observable, of } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { ItemSyncCompleteStatus } from '../../models/item-sync-complete-status.interface';\r\nimport { IRegistration } from '../../models/registration.interface';\r\n@Injectable()\r\nexport class FakeItemSyncCallbackService implements ItemSyncCallbackService<IRegistration> {\r\n  deleteItem(item: IRegistration): Observable<boolean> {\r\n    if(!item) {\r\n      return of(false);\r\n    }\r\n    return this.createRandomDelay().pipe(map(() => true));\r\n  }\r\n  syncItem(item: IRegistration): Observable<ItemSyncCompleteStatus<IRegistration>> {\r\n    return this.createRandomDelay().pipe(map(() => ({ item, success: true })));\r\n  }\r\n\r\n  private createRandomDelay() {\r\n    return timer(Math.floor(Math.random() * 10) * 1000);\r\n  }\r\n}\r\n","import { ItemSyncCompleteStatus } from '../../models/item-sync-complete-status.interface';\r\nimport { Observable } from 'rxjs';\r\n\r\nexport abstract class ItemSyncCallbackService<T> {\r\n  abstract syncItem(item: T, ignoreVersionCheck: boolean): Observable<ItemSyncCompleteStatus<T>>;\r\n  abstract deleteItem(item: T): Observable<boolean>;\r\n}\r\n","import { ItemSyncCallbackService } from './item-sync-callback.service';\r\nimport { IRegistration } from '../../models/registration.interface';\r\nimport { Observable, of, forkJoin } from 'rxjs';\r\nimport { Injectable } from '@angular/core';\r\nimport { ItemSyncCompleteStatus } from '../../models/item-sync-complete-status.interface';\r\nimport { RegistrationService, AttachmentService as ApiAttachmentService, AttachmentEditModel, RegistrationViewModel } from '@varsom-regobs-common/regobs-api';\r\nimport { map, catchError, switchMap, tap, filter, take } from 'rxjs/operators';\r\nimport { LanguageService, LangKey, LoggerService } from '@varsom-regobs-common/core';\r\nimport { AttachmentUploadEditModel } from '../../models/attachment-upload-edit.interface';\r\nimport { HttpClient, HttpEventType, HttpResponse, HttpErrorResponse } from '@angular/common/http';\r\nimport { ProgressService } from '../progress/progress.service';\r\nimport { NewAttachmentService } from '../add-new-attachment/new-attachment.service';\r\nimport { WaterLevelMeasurementUploadModel } from '../../models/water-level-measurement-upload-model';\r\nimport cloneDeep from 'clone-deep';\r\n\r\n@Injectable()\r\nexport class RegobsApiSyncCallbackService implements ItemSyncCallbackService<IRegistration> {\r\n  constructor(\r\n    private regobsApiRegistrationService: RegistrationService,\r\n    private languageService: LanguageService,\r\n    private apiAttachmentService: ApiAttachmentService,\r\n    private newAttachmentService: NewAttachmentService,\r\n    private loggerService: LoggerService,\r\n    private httpClient: HttpClient,\r\n    private progressService: ProgressService\r\n  ) {}\r\n\r\n  deleteItem(item: IRegistration): Observable<boolean> {\r\n    if (!item || !item.response || !(item.response.RegId > 0)) {\r\n      return of(false);\r\n    }\r\n    return this.regobsApiRegistrationService.RegistrationDelete(item.response.RegId).pipe(map(() => true));\r\n  }\r\n\r\n  syncItem(item: IRegistration, ignoreVersionCheck: boolean): Observable<ItemSyncCompleteStatus<IRegistration>> {\r\n    return this.languageService.language$.pipe(\r\n      take(1),\r\n      switchMap((langKey) => this.insertOrUpdate(item, langKey, ignoreVersionCheck))\r\n    );\r\n  }\r\n\r\n  insertOrUpdate(item: IRegistration, langKey: LangKey, ignoreVersionCheck: boolean): Observable<ItemSyncCompleteStatus<IRegistration>> {\r\n    this.loggerService.debug('Start insertOrUpdate: ', item, langKey);\r\n    return this.uploadAttachments(item).pipe(\r\n      switchMap((uploadAttachmentResult) => {\r\n        this.loggerService.debug('Result from attachment upload: ', uploadAttachmentResult);\r\n        this.loggerService.debug('Registration is now: ', item);\r\n        const uploadSuccess = !uploadAttachmentResult.some((a) => a.error);\r\n        let attachmentStatusCode: number = undefined;\r\n        if (!uploadSuccess) {\r\n          attachmentStatusCode = uploadAttachmentResult.map((a) => (a.error as HttpErrorResponse).status || 0).reduce((pv, cv) => (cv > pv ? cv : pv), 0);\r\n        }\r\n        // Set request attachments on temporary request item, so it will not be removed / invalid if failure\r\n        const clonedItem = cloneDeep(item);\r\n        this.setRequestAttachments(clonedItem, uploadAttachmentResult);\r\n        return (\r\n          this.callInsertOrUpdate(clonedItem, langKey, ignoreVersionCheck)\r\n            // TODO: Hvorfor removeAllNewAttachments her?\r\n            .pipe(\r\n              switchMap((result) => this.removeAllNewAttachments(clonedItem).pipe(map(() => result))),\r\n              map((result) => ({\r\n                success: uploadSuccess,\r\n                item: { ...cloneDeep(item), response: result },\r\n                statusCode: attachmentStatusCode,\r\n                error: uploadSuccess ? undefined : 'Could not upload attachments'\r\n              })),\r\n              catchError((err: HttpErrorResponse) => {\r\n                const errorMsg = this.getErrorModelStateMessageOrErrorMsg(err);\r\n                return of({ success: false, item: item, statusCode: err.status, error: errorMsg });\r\n              })\r\n            )\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  private getErrorModelStateMessageOrErrorMsg(err: HttpErrorResponse): string {\r\n    if (err && err.error) {\r\n      return JSON.stringify(err.error);\r\n    }\r\n    if (err && err.message) {\r\n      return err.message;\r\n    }\r\n    return 'Unknown error';\r\n  }\r\n\r\n  /**\r\n   * Add uploaded attachments with uploadId to request attachments\r\n   **/\r\n  private setRequestAttachments(reg: IRegistration, uploadedAttachments: AttachmentUploadEditModel[]) {\r\n    if (uploadedAttachments && uploadedAttachments.length > 0) {\r\n      for (const uploadedAttachment of uploadedAttachments) {\r\n        if (uploadedAttachment.AttachmentUploadId) {\r\n          // Only set request attachments with uploadId\r\n          this.addUploadedAttachmentToRequest(uploadedAttachment, reg);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private callInsertOrUpdate(item: IRegistration, langKey: LangKey, ignoreVersionCheck?: boolean): Observable<RegistrationViewModel> {\r\n    // TODO: Hvorfor trenger vi både RegistrationInsertOrUpdate og RegistrationInsert?\r\n    // Kunne vi bare brukt InsertOrUpdate hver gang?\r\n    return item.response\r\n      ? // PUT\r\n        this.regobsApiRegistrationService.RegistrationInsertOrUpdate({\r\n          registration: item.request,\r\n          id: item.response.RegId,\r\n          langKey,\r\n          externalReferenceId: item.id,\r\n          ignoreVersionCheck: ignoreVersionCheck\r\n        })\r\n      : // POST\r\n        this.regobsApiRegistrationService.RegistrationInsert({\r\n          registration: item.request,\r\n          langKey,\r\n          externalReferenceId: item.id\r\n        });\r\n  }\r\n\r\n  removeAllNewAttachments(item: IRegistration): Observable<IRegistration> {\r\n    return this.newAttachmentService.removeAttachments$(item.id).pipe(map(() => item));\r\n  }\r\n\r\n  uploadAttachments(item: IRegistration): Observable<AttachmentUploadEditModel[]> {\r\n    return this.getAttachmentsToUpload(item).pipe(\r\n      take(1),\r\n      switchMap((attachmentsToUpload) => {\r\n        if (attachmentsToUpload.length > 0) {\r\n          this.loggerService.debug('Attachments to upload: ', attachmentsToUpload);\r\n          return forkJoin(attachmentsToUpload.map((a) => this.uploadAttachmentAndSetAttachmentUploadId(item, a).pipe(take(1))));\r\n        }\r\n        this.loggerService.debug('No attachments to uplaod');\r\n        return of([]);\r\n      })\r\n    );\r\n  }\r\n\r\n  uploadAttachmentAndSetAttachmentUploadId(reg: IRegistration, attachmentUpload: AttachmentUploadEditModel): Observable<AttachmentUploadEditModel> {\r\n    attachmentUpload.error = undefined;\r\n    return this.newAttachmentService.getBlob(reg.id, attachmentUpload.id).pipe(\r\n      switchMap((blob) =>\r\n        this.uploadAttachmentWithProgress(attachmentUpload.id, blob).pipe(\r\n          switchMap((uploadId) => {\r\n            this.loggerService.debug('Attachment uploaded. Setting uploadId', attachmentUpload, uploadId);\r\n            // this.addAttachmentToRequest(uploadId, attachmentUpload, reg);\r\n            attachmentUpload.AttachmentUploadId = uploadId;\r\n            return this.newAttachmentService.saveAttachmentMeta$(reg.id, attachmentUpload).pipe(map(() => attachmentUpload));\r\n          })\r\n        )\r\n      ),\r\n      catchError((err: Error) => {\r\n        this.loggerService.debug('Could not upload attachment. Setting error.', err);\r\n        attachmentUpload.error = err;\r\n        return of(attachmentUpload);\r\n      })\r\n    );\r\n  }\r\n\r\n  private addUploadedAttachmentToRequest(attachmentUploadEditModel: AttachmentUploadEditModel, reg: IRegistration) {\r\n    const attachment = {\r\n      AttachmentUploadId: attachmentUploadEditModel.AttachmentUploadId,\r\n      Photographer: attachmentUploadEditModel.Photographer,\r\n      Copyright: attachmentUploadEditModel.Copyright,\r\n      Aspect: attachmentUploadEditModel.Aspect,\r\n      GeoHazardTID: attachmentUploadEditModel.GeoHazardTID,\r\n      RegistrationTID: attachmentUploadEditModel.RegistrationTID,\r\n      Comment: attachmentUploadEditModel.Comment,\r\n      AttachmentMimeType: attachmentUploadEditModel.AttachmentMimeType,\r\n      IsMainAttachment: attachmentUploadEditModel.IsMainAttachment\r\n    };\r\n    if (attachmentUploadEditModel.type === 'WaterLevelMeasurementAttachment') {\r\n      this.addWaterLevelAttachment(attachment, reg, attachmentUploadEditModel.ref);\r\n      return;\r\n    }\r\n    if (attachmentUploadEditModel.type === 'DamageObsAttachment') {\r\n      this.addDamageObsAttachment(attachment, reg, attachmentUploadEditModel.ref);\r\n      return;\r\n    }\r\n    if (!reg.request.Attachments) {\r\n      reg.request.Attachments = [];\r\n    }\r\n    reg.request.Attachments.push(attachment);\r\n  }\r\n\r\n  private addDamageObsAttachment(attachment: AttachmentEditModel, reg: IRegistration, ref: string) {\r\n    this.loggerService.error('Uploading of damage obs attachments not implemented', attachment, reg, ref);\r\n  }\r\n\r\n  private addWaterLevelAttachment(attachment: AttachmentEditModel, reg: IRegistration, ref: string) {\r\n    const predicate = (m: WaterLevelMeasurementUploadModel) => m.ref === ref;\r\n    const measurement = reg.request.WaterLevel2.WaterLevelMeasurement.find(predicate);\r\n    if (!measurement) {\r\n      this.loggerService.error(`Did not find measurement for attachment with ref ${ref}`, attachment, reg, ref);\r\n    }\r\n    if (!measurement.Attachments) {\r\n      measurement.Attachments = [];\r\n    }\r\n    measurement.Attachments.push(attachment);\r\n  }\r\n\r\n  getAttachmentsToUpload(item: IRegistration): Observable<AttachmentUploadEditModel[]> {\r\n    return this.newAttachmentService.getAttachments(item.id);\r\n  }\r\n\r\n  uploadAttachmentWithProgress(id: string, blob: Blob): Observable<string> {\r\n    const attachmentPostPath = `${this.apiAttachmentService.rootUrl}${ApiAttachmentService.AttachmentPostPath}`;\r\n    const formData = new FormData();\r\n    formData.append('file', blob);\r\n    return this.httpClient\r\n      .post(attachmentPostPath, formData, {\r\n        responseType: 'json',\r\n        reportProgress: true,\r\n        observe: 'events',\r\n        headers: { 'ngsw-bypass': '' }\r\n      })\r\n      .pipe(\r\n        tap((event) => {\r\n          this.loggerService.debug('uploadAttachmentWithProgress got event:', event);\r\n          if (event.type === HttpEventType.UploadProgress) {\r\n            this.progressService.setAttachmentProgress(id, event.total, event.loaded);\r\n          }\r\n        }),\r\n        filter((event) => event.type === HttpEventType.Response),\r\n        map((event: HttpResponse<string>) => {\r\n          if (!event.ok) {\r\n            throw Error(`Could not upload attachment: Status: ${event.statusText}`);\r\n          }\r\n          return event.body;\r\n        }),\r\n        tap((result) => this.loggerService.debug(`Attachment uploaded with attachment id: ${result} `))\r\n      );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { AppMode, LanguageService, LangKey, getLangKeyString, LoggerService, AppModeService } from '@varsom-regobs-common/core';\r\nimport { of, Observable } from 'rxjs';\r\nimport { map, catchError} from 'rxjs/operators';\r\nimport { KdvElementsResponseDto, KdvElementsService, KdvElement } from '@varsom-regobs-common/regobs-api';\r\nimport { OfflineDbService } from '../offline-db/offline-db.service';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { KdvKey } from '../../models/kdv-key.type';\r\nimport { KdvViewRepositoryKey } from '../../models/view-repository-key.type';\r\nimport { ApiSyncOfflineBaseService } from '../api-sync-offline-base/api-sync-offline-base.service';\r\n\r\nconst KDV_ASSETS_FOLDER = '/assets/json'; // TODO: Add this to module config?\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class KdvService extends ApiSyncOfflineBaseService<KdvElementsResponseDto> {\r\n\r\n  constructor(protected offlineDbService: OfflineDbService,\r\n    protected languageService: LanguageService,\r\n    protected logger: LoggerService,\r\n    protected appModeService: AppModeService,\r\n    private kdvElementsService: KdvElementsService,\r\n    private httpClient: HttpClient)  {\r\n    super({ useLangKeyAsDbKey: true, validSeconds: 12 * 60 * 60 }, offlineDbService, languageService, appModeService, logger);\r\n  }\r\n\r\n  public getKdvRepositoryByKeyObservable(key: KdvKey): Observable<KdvElement[]> {\r\n    return this.data$.pipe(map((val) => val.KdvRepositories[key]));\r\n  }\r\n\r\n  public getViewRepositoryByKeyObservable(key: KdvViewRepositoryKey): Observable<unknown> {\r\n    return this.data$.pipe(map((val) => val.ViewRepositories[key]));\r\n  }\r\n\r\n  public getUpdatedData(_: AppMode, langKey: LangKey): Observable<KdvElementsResponseDto> {\r\n    return this.kdvElementsService.KdvElementsGetKdvs({ langkey: langKey });\r\n  }\r\n\r\n  public getTableName(appMode: AppMode): string {\r\n    return `${appMode.toLocaleLowerCase()}/kdvelements`;\r\n  }\r\n\r\n  public getFallbackData(_: AppMode, langKey: LangKey): Observable<KdvElementsResponseDto> {\r\n    return this.httpClient.get<KdvElementsResponseDto>\r\n    (`${KDV_ASSETS_FOLDER}/kdvelements.${getLangKeyString(langKey)}.json`)\r\n      .pipe(catchError((err) => {\r\n        this.logger.warn(`Kdv elements for language ${getLangKeyString(langKey)} not found in assets/kdvelements folder`, err);\r\n        return of({\r\n          KdvRepositories: {},\r\n          ViewRepositories: {}\r\n        });\r\n      }));\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class OfflineDbServiceOptions {\r\n    public adapter = 'idb';\r\n}\r\n","import { Injectable, isDevMode } from '@angular/core';\r\nimport { AppModeService, LoggerService, AppMode } from '@varsom-regobs-common/core';\r\nimport { OfflineDbServiceOptions } from './offline-db-service.options';\r\nimport { RegistrationSchema } from '../../db/schemas/registration.schema';\r\nimport {\r\n  createRxDatabase,\r\n  addRxPlugin,\r\n  RxJsonSchema\r\n} from 'rxdb/plugins/core';\r\nimport { RxRegistrationDatabase, RxRegistrationCollections } from '../../db/RxDB';\r\nimport { GenericSchema } from '../../db/schemas/generic.schema';\r\nimport { from, Observable } from 'rxjs';\r\nimport { AttachmentMetaSchema } from '../../db/schemas/attachment-meta.schema';\r\nimport { RegistrationSyncProgressSchema } from '../../db/schemas/registration-sync-progress.schema';\r\nimport { UploadProgressSchema } from '../../db/schemas/upload-progress.schema';\r\nimport { RxDBAttachmentsPlugin } from 'rxdb/plugins/attachments';\r\nimport { RxDBLocalDocumentsPlugin } from 'rxdb/plugins/local-documents';\r\nimport { RxDBLeaderElectionPlugin } from 'rxdb/plugins/leader-election';\r\n\r\nexport const TABLE_NAMES =  {\r\n  REGISTRATION: 'registration',\r\n  KDV_ELEMENTS: 'kdvelements',\r\n  HELP_TEXTS: 'helptexts',\r\n  ATTACHMENT_META: 'attachmentmeta',\r\n  REGISTRATION_SYNC_PROGRESS: 'syncprogress',\r\n  UPLOAD_PROGRESS: 'uploadprogress'\r\n};\r\n\r\nconst collections: Array<{name: string, schema: RxJsonSchema, instancePerAppMode: boolean}> = [\r\n  {\r\n    name: TABLE_NAMES.REGISTRATION,\r\n    schema: RegistrationSchema,\r\n    instancePerAppMode: true,\r\n  },\r\n  {\r\n    name: TABLE_NAMES.KDV_ELEMENTS,\r\n    schema: GenericSchema,\r\n    instancePerAppMode: true,\r\n  },\r\n  {\r\n    name: TABLE_NAMES.HELP_TEXTS,\r\n    schema: GenericSchema,\r\n    instancePerAppMode: true,\r\n  },\r\n  {\r\n    name: TABLE_NAMES.ATTACHMENT_META,\r\n    schema: AttachmentMetaSchema,\r\n    instancePerAppMode: true,\r\n  },\r\n  {\r\n    name: TABLE_NAMES.REGISTRATION_SYNC_PROGRESS,\r\n    schema: RegistrationSyncProgressSchema,\r\n    instancePerAppMode: false,\r\n  },\r\n  {\r\n    name: TABLE_NAMES.UPLOAD_PROGRESS,\r\n    schema: UploadProgressSchema,\r\n    instancePerAppMode: false,\r\n  },\r\n];\r\n\r\nfunction loadRxDBPlugins(): void {\r\n  addRxPlugin(RxDBLocalDocumentsPlugin);\r\n  addRxPlugin(RxDBAttachmentsPlugin);\r\n  addRxPlugin(RxDBLeaderElectionPlugin);\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class OfflineDbService {\r\n\r\n  // public readonly appModeInitialized$: Observable<AppMode>;\r\n  private dbInstance: RxRegistrationDatabase;\r\n\r\n  constructor(private appModeService: AppModeService, private options: OfflineDbServiceOptions, private logger: LoggerService) {\r\n  }\r\n\r\n  async initDatabase(adapter: string): Promise<void> {\r\n    this.dbInstance = await this.create(adapter);\r\n  }\r\n\r\n  get db(): RxRegistrationDatabase {\r\n    return this.dbInstance;\r\n  }\r\n\r\n  public waitForLeadership(): Observable<boolean> {\r\n    return from(this.dbInstance.waitForLeadership());\r\n  }\r\n\r\n  public getDbCollection<T extends RxRegistrationCollections>(appMode: AppMode, tableName: string): T  {\r\n    return this.db[this.getDbCollectionName(appMode, tableName)] as T;\r\n  }\r\n\r\n  public getDbCollectionName(appMode: AppMode, tableName: string): string {\r\n    const c = collections.find((c) => c.name === tableName);\r\n    if(!c) {\r\n      throw new Error(`Table ${tableName} not found in collections`);\r\n    }\r\n\r\n    if(c.instancePerAppMode) {\r\n      return `${appMode.toLocaleLowerCase()}/${c.name}`;\r\n    }else{\r\n      return c.name;\r\n    }\r\n  }\r\n\r\n  private async create(adapter: string): Promise<RxRegistrationDatabase> {\r\n\r\n    loadRxDBPlugins();\r\n\r\n    const db = await createRxDatabase<{ [key: string]: RxRegistrationCollections}>({\r\n      name: 'rxdb_regobs_registration_v2',\r\n      adapter,\r\n      pouchSettings: {\r\n        revs_limit: 10, // Max 10 revisions to keep db small\r\n      },\r\n      ignoreDuplicate: true,\r\n    });\r\n\r\n    if (isDevMode()) {\r\n      (window as unknown)['db'] = db; // write to window for debugging\r\n    }\r\n\r\n    await Promise.all(this.getCollections().map(colData => db.collection(colData)));\r\n\r\n    return db;\r\n  }\r\n\r\n  private getCollections() {\r\n    const result: Array<{name: string, schema: RxJsonSchema}> = [];\r\n    for(const c of collections) {\r\n      if(c.instancePerAppMode) {\r\n        for(const appMode of Object.keys(AppMode)) {\r\n          result.push({ name: `${appMode.toLowerCase()}/${c.name}`, schema: c.schema });\r\n        }\r\n      }else{\r\n        result.push(c);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { LoggerService } from '@varsom-regobs-common/core';\r\nimport { debounceTime, distinctUntilChanged, map, shareReplay } from 'rxjs/operators';\r\nimport { ISyncProgress } from '../../models/sync-progress.interface';\r\nimport { OfflineDbService, TABLE_NAMES } from '../offline-db/offline-db.service';\r\nimport { RxRegistrationSyncProgressCollection, RxUploadProgressCollection } from '../../db/RxDB';\r\nimport moment from 'moment';\r\nimport { ISyncProgressRecord } from '../../models/sync-progress-record.interface';\r\nimport deepEqual from 'fast-deep-equal';\r\n\r\nconst SYNC_PROGRESS_ID = 'syncprogress';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ProgressService {\r\n  public readonly registrationSyncProgress$: Observable<ISyncProgress>;\r\n\r\n  constructor(private loggerService: LoggerService, private offlineDbService: OfflineDbService) {\r\n    this.registrationSyncProgress$ = this.getRegistrationSyncProgressCollection().find().$.pipe(\r\n      debounceTime(100),\r\n      map((records) => records[0]),\r\n      map((rec) => this.convertToSyncProgress(rec)),\r\n      distinctUntilChanged((a, b) => deepEqual(a, b)),\r\n      shareReplay(1)\r\n    );\r\n  }\r\n\r\n  async resetSyncProgress(records: Array<string> = null): Promise<void> {\r\n    await this.getRegistrationSyncProgressCollection().atomicUpsert({\r\n      id: SYNC_PROGRESS_ID,\r\n      recordsLeft: records || [],\r\n      startedTimestamp: moment().unix(),\r\n      totalRecords: (records || []).length,\r\n      errors: [],\r\n    });\r\n  }\r\n\r\n  async setSyncProgress(recordId: string, error?: string | unknown): Promise<void> {\r\n    this.loggerService.log('Sync record item complete', recordId);\r\n    const doc = await this.getSyncProgressDocument();\r\n    if(doc) {\r\n      const docJson = doc.toJSON();\r\n      const errors = [...docJson.errors];\r\n      if(error) {\r\n        errors.push({ id: recordId, error});\r\n      }\r\n      await this.getRegistrationSyncProgressCollection().atomicUpsert({\r\n        id: SYNC_PROGRESS_ID,\r\n        errors: errors,\r\n        recordsLeft: docJson.recordsLeft.filter((r) => r !== recordId)\r\n      });\r\n    }\r\n  }\r\n\r\n  getAttachmentProgress(imageId: string): Observable<{totalBytes: number; complete: number}> {\r\n    return this.getUploadProgressCollection().findByIds$([imageId]).pipe(\r\n      map((result) => result.get(imageId)), map((result) => result ? result.toJSON() : null));\r\n  }\r\n\r\n  async setAttachmentProgress(imageId: string, totalBytes: number, complete: number): Promise<void> {\r\n    this.loggerService.log(`Set attachment progress. Complete: ${complete}/${totalBytes}. ${imageId}`);\r\n    await this.getUploadProgressCollection().atomicUpsert({\r\n      id: imageId,\r\n      totalBytes,\r\n      complete\r\n    });\r\n  }\r\n\r\n  private async getSyncProgressDocument() {\r\n    const documents = await this.getRegistrationSyncProgressCollection().findByIds([SYNC_PROGRESS_ID]);\r\n    return documents?.get(SYNC_PROGRESS_ID);\r\n  }\r\n\r\n  private getRegistrationSyncProgressCollection(): RxRegistrationSyncProgressCollection {\r\n    return this.offlineDbService.db[TABLE_NAMES.REGISTRATION_SYNC_PROGRESS] as RxRegistrationSyncProgressCollection;\r\n  }\r\n\r\n  private getUploadProgressCollection(): RxUploadProgressCollection {\r\n    return this.offlineDbService.db[TABLE_NAMES.UPLOAD_PROGRESS] as RxUploadProgressCollection;\r\n  }\r\n\r\n  private getEmptySyncProgress() {\r\n    return {\r\n      errors: [],\r\n      estimatedTimeLeftMs: undefined,\r\n      hasError: false,\r\n      id: '',\r\n      inProgress: false,\r\n      isComplete: true,\r\n      itemsLeft: 0,\r\n      percentageComplete: undefined,\r\n      percentageCompleteFormatted: undefined,\r\n      recordsLeft: [],\r\n      startedTimestamp: undefined,\r\n      totalRecords: 0,\r\n    };\r\n  }\r\n\r\n  private convertToSyncProgress(rec: ISyncProgressRecord): ISyncProgress {\r\n    if(!rec) {\r\n      return this.getEmptySyncProgress();\r\n    }\r\n\r\n    const percentageComplete = this.calculatePercentageComplete(rec);\r\n    return {\r\n      ...rec,\r\n      estimatedTimeLeftMs: this.calculateTimeLeftMs(rec),\r\n      hasError: rec.errors && rec.errors.length > 0,\r\n      inProgress: rec.recordsLeft.length > 0,\r\n      isComplete: rec.recordsLeft.length === 0,\r\n      itemsLeft: rec.recordsLeft.length,\r\n      percentageComplete,\r\n      percentageCompleteFormatted: percentageComplete.toLocaleString(undefined, { style: 'percent', minimumFractionDigits: 2 })\r\n    };\r\n  }\r\n\r\n  private calculateTimeLeftMs(rec: ISyncProgressRecord): number {\r\n    const startedMoment = moment.unix(rec.startedTimestamp);\r\n    const ms = moment().diff(startedMoment, 'milliseconds');\r\n    const itemsLeft = rec.recordsLeft.length;\r\n    const completed = rec.totalRecords - itemsLeft;\r\n    if(completed > 0) {\r\n      const msPerCompleted = ms / completed;\r\n      return msPerCompleted * itemsLeft;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  private calculatePercentageComplete(rec: ISyncProgressRecord) {\r\n    const itemsLeft = rec.recordsLeft.length;\r\n    if (rec.totalRecords > 0 && itemsLeft > 0) {\r\n      return (rec.totalRecords - itemsLeft) / rec.totalRecords;\r\n    }\r\n    return 1;\r\n  }\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { Observable, from, Subscription, of, concat, forkJoin, timer, merge, combineLatest, firstValueFrom } from 'rxjs';\r\nimport { GeoHazard, AppMode, LoggerService, AppModeService, uuidv4 } from '@varsom-regobs-common/core';\r\nimport {\r\n  switchMap,\r\n  shareReplay,\r\n  map,\r\n  tap,\r\n  catchError,\r\n  mergeMap,\r\n  toArray,\r\n  take,\r\n  filter,\r\n  withLatestFrom,\r\n  distinctUntilChanged,\r\n  concatMap\r\n} from 'rxjs/operators';\r\nimport { IRegistration } from '../../models/registration.interface';\r\nimport { OfflineDbService, TABLE_NAMES } from '../offline-db/offline-db.service';\r\nimport { SyncStatus } from '../../models/sync-status.enum';\r\nimport { ItemSyncCompleteStatus } from '../../models/item-sync-complete-status.interface';\r\nimport { ItemSyncCallbackService } from '../item-sync-callback/item-sync-callback.service';\r\nimport moment from 'moment';\r\nimport { RegistrationTid } from '../../models/registration-tid.enum';\r\nimport { Summary, AttachmentViewModel, RegistrationViewModel, RegistrationEditModel } from '@varsom-regobs-common/regobs-api';\r\nimport {\r\n  getAllAttachments,\r\n  getPropertyName,\r\n  getRegistrationTidsForGeoHazard,\r\n  hasAnyObservations,\r\n  isArrayType,\r\n  isObservationEmptyForRegistrationTid,\r\n  isObservationModelEmptyForRegistrationTid\r\n} from '../../registration.helpers';\r\nimport { ProgressService } from '../progress/progress.service';\r\nimport { InternetConnectivity } from 'ngx-connectivity';\r\nimport { KdvService } from '../kdv/kdv.service';\r\nimport cloneDeep from 'clone-deep';\r\nimport { IRegistrationType } from '../../models/registration-type.interface';\r\nimport { FallbackSummaryProvider } from '../summary-providers/fallback-provider';\r\nimport { RxRegistrationCollection, RxRegistrationDocument } from '../../db/RxDB';\r\nimport { NewAttachmentService } from '../add-new-attachment/new-attachment.service';\r\nimport deepEqual from 'fast-deep-equal';\r\nimport { AttachmentUploadEditModel, ExistingOrNewAttachment } from '../../registration.models';\r\nimport { ExistingAttachmentType, NewAttachmentType } from '../../models/attachment-upload-edit.interface';\r\nimport { FOR_ROOT_OPTIONS_TOKEN, IRegistrationModuleOptions } from '../../module.options';\r\n\r\nconst SYNC_TIMER_TRIGGER_MS = 60 * 1000; // try to trigger sync every 60 seconds if nothing has changed to network conditions\r\nconst SYNC_BUFFER_MS = 3 * 1000; // Wait at least 3 seconds before next sync attempt\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class RegistrationService {\r\n  public readonly registrationStorage$: Observable<IRegistration[]>;\r\n  private _registrationSyncSubscription: Subscription;\r\n\r\n  constructor(\r\n    private offlineDbService: OfflineDbService,\r\n    private loggerService: LoggerService,\r\n    private progressService: ProgressService,\r\n    private kdvService: KdvService,\r\n    private internetConnectivity: InternetConnectivity,\r\n    private appModeService: AppModeService,\r\n    private newAttachmentService: NewAttachmentService,\r\n    @Inject('OfflineRegistrationSyncService') private offlineRegistrationSyncService: ItemSyncCallbackService<IRegistration>,\r\n    // @Inject(SUMMARY_PROVIDER_TOKEN) private summaryProviders: ISummaryProvider[],\r\n    private fallbackSummaryProvider: FallbackSummaryProvider,\r\n    @Inject(FOR_ROOT_OPTIONS_TOKEN) private options: IRegistrationModuleOptions\r\n  ) {\r\n    this.registrationStorage$ = this.getRegistrationObservable().pipe(\r\n      tap((reg) => {\r\n        this.loggerService.debug('Registrations changed', reg);\r\n      }),\r\n      shareReplay(1)\r\n    );\r\n    this.initAutoSync();\r\n  }\r\n\r\n  public saveAndSync(\r\n    reg: IRegistration,\r\n    changedRegistrationTid: RegistrationTid = undefined,\r\n    ignoreVersionCheck = false\r\n  ): Observable<boolean> {\r\n    reg.changedRegistrationTid = changedRegistrationTid;\r\n    reg.syncStatus = SyncStatus.Sync;\r\n    return this.saveRegistration(reg, ignoreVersionCheck);\r\n  }\r\n\r\n  public saveRegistration(reg: IRegistration, ignoreVersionCheck = false, updateChangedTimestamp = true): Observable<boolean> {\r\n    if (updateChangedTimestamp) {\r\n      reg.changed = moment().unix();\r\n    }\r\n    if (reg.syncStatus === SyncStatus.Sync) {\r\n      return this.saveAndSyncSingleRegistration(reg, ignoreVersionCheck);\r\n    } else {\r\n      return this.saveRegistrationToOfflineStorage(reg).pipe(map(() => true));\r\n    }\r\n  }\r\n\r\n  private saveAndSyncSingleRegistration(reg: IRegistration, ignoreVersionCheck: boolean) {\r\n    // Hvorfor kalles unsubscribe på denne?\r\n    if (this._registrationSyncSubscription) {\r\n      this._registrationSyncSubscription.unsubscribe();\r\n    }\r\n    return this.saveRegistrationToOfflineStorage(reg).pipe(\r\n      switchMap(() => this.syncSingleRegistration(reg, ignoreVersionCheck)),\r\n      tap(() => {\r\n        this.loggerService.debug('Single registration synced. Start autosync.');\r\n        this.initAutoSync();\r\n      })\r\n    );\r\n  }\r\n\r\n  private saveRegistrationToOfflineStorage(reg: IRegistration): Observable<RxRegistrationDocument> {\r\n    return this.getRegistrationDbCollectionForAppMode().pipe(\r\n      take(1),\r\n      switchMap((collection) => from(collection.atomicUpsert(reg)))\r\n    );\r\n  }\r\n\r\n  public deleteRegistration(id: string): Observable<boolean> {\r\n    return this.getRegistrationOfflineDocumentById(id).pipe(\r\n      take(1),\r\n      switchMap((doc) => (doc ? this.offlineRegistrationSyncService.deleteItem(doc.toJSON()).pipe(map(() => doc)) : of(undefined))),\r\n      switchMap((doc: RxRegistrationDocument) => (doc ? from(doc.remove()) : of(false)))\r\n    );\r\n  }\r\n\r\n  public deleteRegistrationFromOfflineStorage(id: string): Observable<unknown> {\r\n    return this.getRegistrationOfflineDocumentById(id).pipe(\r\n      take(1),\r\n      switchMap((doc) => (doc ? from(doc.remove()) : of(false)))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Shared change feed on getRegistrationById. Might have some delay when saving.\r\n   */\r\n  public getRegistrationByIdShared$(id: string): Observable<IRegistration> {\r\n    return this.registrationStorage$.pipe(\r\n      map((registrations) => registrations.find((r) => r.id === id)),\r\n      filter((reg) => reg != null)\r\n    );\r\n  }\r\n\r\n  public async getRegistrationById(id: string): Promise<IRegistration> {\r\n    const collection = await this.getRegistrationDbCollectionForAppMode().pipe(take(1)).toPromise();\r\n    const resultMap = await collection.findByIds([id]);\r\n    return resultMap.get(id)?.toJSON();\r\n  }\r\n\r\n  public async cancelSync(): Promise<void> {\r\n    await this.progressService.resetSyncProgress();\r\n    if (this._registrationSyncSubscription) {\r\n      this._registrationSyncSubscription.unsubscribe();\r\n    }\r\n    this.initAutoSync();\r\n  }\r\n\r\n  public initAutoSync(): void {\r\n    if (this.options.autoSync) {\r\n      this._registrationSyncSubscription = this.getAutoSyncObservable().subscribe();\r\n    }\r\n  }\r\n\r\n  public getFirstDraftForGeoHazard(geoHazard: GeoHazard, draftsOnly = true): Promise<IRegistration> {\r\n    return this.getDraftsForGeoHazardObservable(geoHazard, draftsOnly)\r\n      .pipe(\r\n        map((rows) => rows.sort((a, b) => b.changed - a.changed)[0]),\r\n        take(1)\r\n      )\r\n      .toPromise();\r\n  }\r\n\r\n  public getDraftsForGeoHazardObservable(geoHazard: GeoHazard, draftsOnly = true): Observable<IRegistration[]> {\r\n    return this.registrationStorage$.pipe(\r\n      map((records) =>\r\n        records.filter(\r\n          (reg) => reg.request.GeoHazardTID === geoHazard && (draftsOnly ? reg.syncStatus === SyncStatus.Draft : true)\r\n          //All items in registration storage is \"drafts\"/not complete until deleted from storage (when done)\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  public getAllRegistrations$(geoHazard?: GeoHazard): Observable<IRegistration[]> {\r\n    return this.getRegistrationDbCollectionForAppMode().pipe(\r\n      switchMap((collection) => collection.find().$),\r\n      map((docs) => docs.map((d) => d.toJSON())),\r\n      map((regs) => regs.filter((r) => (geoHazard ? r.geoHazard === geoHazard : true)))\r\n    );\r\n  }\r\n\r\n  public deleteAllRegistrationsFromOfflineStorage$(geoHazard?: GeoHazard): Observable<unknown> {\r\n    return this.getAllRegistrations$(geoHazard).pipe(\r\n      switchMap((regs) => (regs.length > 0 ? forkJoin(regs.map((reg) => this.deleteRegistrationFromOfflineStorage(reg.id))) : of({})))\r\n    );\r\n  }\r\n\r\n  public deleteAllRegistrationsFromOfflineStorage(geoHazard?: GeoHazard): void {\r\n    this.deleteAllRegistrationsFromOfflineStorage$(geoHazard).pipe(take(1)).subscribe();\r\n  }\r\n\r\n  public deleteForm(regId: string, registrationTid: RegistrationTid, index: number): Observable<unknown> {\r\n    return this.getRegistrationByIdShared$(regId).pipe(\r\n      take(1),\r\n      map((reg) => {\r\n        const regToEdit = cloneDeep(reg);\r\n        this.makeExistingRegistrationEditable(regToEdit);\r\n        if (isArrayType(registrationTid) && regToEdit.request[getPropertyName(registrationTid)].length > index) {\r\n          (regToEdit.request[getPropertyName(registrationTid)] as Array<unknown>).splice(index, 1);\r\n          // Deletes images if no forms left in array\r\n          if ((regToEdit.request[getPropertyName(registrationTid)] as Array<unknown>).length === 0) {\r\n            this.deleteExistingAttachmentsForRegistrationType(regToEdit, registrationTid);\r\n          }\r\n        } else if (!isArrayType(registrationTid)) {\r\n          delete regToEdit.request[getPropertyName(registrationTid)];\r\n          this.deleteExistingAttachmentsForRegistrationType(regToEdit, registrationTid);\r\n        }\r\n        return regToEdit;\r\n      }),\r\n      switchMap((reg) => this.saveAndSync(reg, registrationTid))\r\n    );\r\n  }\r\n\r\n  private deleteExistingAttachmentsForRegistrationType(reg: IRegistration, registrationTid: RegistrationTid): IRegistration {\r\n    if (reg && reg.request && reg.request.Attachments) {\r\n      reg.request.Attachments = reg.request.Attachments.filter((a) => a.RegistrationTID !== registrationTid);\r\n    }\r\n    return reg;\r\n  }\r\n\r\n  public createNewEmptyDraft(geoHazard: GeoHazard): IRegistration {\r\n    const id = uuidv4();\r\n    const draft: IRegistration = {\r\n      id,\r\n      geoHazard,\r\n      changed: moment().unix(),\r\n      syncStatus: SyncStatus.Draft,\r\n      request: {\r\n        GeoHazardTID: geoHazard,\r\n        DtObsTime: undefined,\r\n        ObsLocation: {},\r\n        Attachments: []\r\n      }\r\n    };\r\n    return draft;\r\n  }\r\n\r\n  public async editExistingRegistrationAndSave(registrationViewModel: RegistrationViewModel): Promise<IRegistration> {\r\n    const reg = this.createNewEmptyDraft(registrationViewModel.GeoHazardTID);\r\n    reg.id = registrationViewModel.ExternalReferenceId || reg.id; // Keep the same id as reference id\r\n    reg.request = cloneDeep(registrationViewModel);\r\n    reg.response = cloneDeep(registrationViewModel);\r\n    reg.syncStatus = SyncStatus.InSync;\r\n    await firstValueFrom(this.saveRegistration(reg));\r\n    return reg;\r\n  }\r\n\r\n  public makeExistingRegistrationEditable(reg: IRegistration): void {\r\n    if (reg && reg.syncStatus === SyncStatus.InSync) {\r\n      reg.request = cloneDeep(reg.response);\r\n    }\r\n  }\r\n\r\n  public syncRegistrations(): Observable<IRegistration[]> {\r\n    return this.getRegistrationsToSyncObservable().pipe(take(1), this.resetProgressAndSyncItems());\r\n  }\r\n\r\n  public syncSingleRegistration(reg: IRegistration, ignoreVersionCheck: boolean): Observable<boolean> {\r\n    if (!reg) {\r\n      return of(false);\r\n    }\r\n    return of([reg]).pipe(\r\n      this.resetProgressAndSyncItems(ignoreVersionCheck),\r\n      map((result) => result.length > 0 && !result[0].syncError)\r\n    );\r\n  }\r\n\r\n  private getAutoSyncObservable() {\r\n    return this.getAutosyncChangeTrigger().pipe(\r\n      tap((source) => this.loggerService.debug(`Auto sync triggered. Source: ${source}`)),\r\n      switchMap(() => this.offlineDbService.waitForLeadership()),\r\n      tap(() => this.loggerService.debug('Current tab is in leadership, so this tab is used for sync items')),\r\n      switchMap(() => this.getRegistrationsToSyncObservable()),\r\n      this.filterWhenProgressIsAllreadyRunning(),\r\n      this.resetProgressAndSyncItems()\r\n    );\r\n  }\r\n\r\n  private getAutosyncChangeTrigger() {\r\n    const networkOrTimerTrigger$ = merge(\r\n      this.getNetworkOnlineObservable().pipe(map(() => 'network status online trigger')),\r\n      timer(SYNC_TIMER_TRIGGER_MS, SYNC_TIMER_TRIGGER_MS).pipe(map(() => 'timer trigger'))\r\n    );\r\n    return this.getRegistrationsToSyncObservable(false).pipe(\r\n      map((records) => records.length > 0),\r\n      filter((hasRecords) => hasRecords),\r\n      switchMap(() => networkOrTimerTrigger$)\r\n    );\r\n  }\r\n\r\n  private resetProgressAndSyncItems(ignoreVersionCheck = false): (src: Observable<IRegistration[]>) => Observable<IRegistration[]> {\r\n    return (src: Observable<IRegistration[]>) =>\r\n      src.pipe(\r\n        // Reset sync status\r\n        concatMap((records) => from(this.progressService.resetSyncProgress(records.map((r) => r.id))).pipe(map(() => records))),\r\n\r\n        // Innsending skjer langt inni her\r\n        this.flattenRegistrationsToSync(ignoreVersionCheck),\r\n\r\n        tap((row) => this.progressService.setSyncProgress(row.item.id, row.error)),\r\n        this.updateRowAndReturnItem(),\r\n        toArray(),\r\n        catchError((error) => {\r\n          this.loggerService.warn('Could not sync registrations', error);\r\n          return of([]);\r\n        }),\r\n        tap(() => this.progressService.resetSyncProgress())\r\n      );\r\n  }\r\n\r\n  /***\r\n   * Check if registration has any data or attachments for registrationTid\r\n   */\r\n  public hasAnyDataToShowInRegistrationTypes(reg: IRegistration, registrationTid: RegistrationTid): Observable<boolean> {\r\n    const model = this.getRegistrationEditOrViewModel(reg);\r\n    return of(isObservationModelEmptyForRegistrationTid(model, registrationTid)).pipe(\r\n      switchMap((isEmpty) => {\r\n        if (!isEmpty) {\r\n          return of(true);\r\n        }\r\n        return this.hasAnyAttachmentsForRegistrationTid$(reg, registrationTid).pipe(take(1));\r\n      })\r\n    );\r\n  }\r\n\r\n  private getRegistrationEditOrViewModel(reg: IRegistration): RegistrationEditModel | RegistrationViewModel {\r\n    if (reg.syncStatus === SyncStatus.InSync && reg.response) {\r\n      return reg.response;\r\n    }\r\n    return reg.request;\r\n  }\r\n\r\n  hasAnyAttachmentsForRegistrationTid$(reg: IRegistration, registrationTid: RegistrationTid): Observable<boolean> {\r\n    return this.getAllAttachmentsForRegistrationTid$(reg.id, registrationTid).pipe(map((attachments) => attachments.length > 0));\r\n  }\r\n\r\n  hasAnyAttachmentsForRegistrationTid(reg: IRegistration, registrationTid: RegistrationTid): Promise<boolean> {\r\n    return this.hasAnyAttachmentsForRegistrationTid$(reg, registrationTid).pipe(take(1)).toPromise();\r\n  }\r\n\r\n  getRegistrationTypesWithAnyData(reg: IRegistration): Observable<IRegistrationType[]> {\r\n    return this.getRegistrationTypesForGeoHazard(reg.geoHazard).pipe(\r\n      switchMap((regTypes) =>\r\n        regTypes.length > 0\r\n          ? forkJoin(\r\n              regTypes.map((regType) =>\r\n                this.hasAnyDataToShowInRegistrationTypes(reg, regType.registrationTid).pipe(map((anyData) => ({ anyData, regType })))\r\n              )\r\n            )\r\n          : of([])\r\n      ),\r\n      map((result) => result.filter((r) => r.anyData).map((r) => r.regType))\r\n    );\r\n  }\r\n\r\n  public getSummaryForRegistrationTidById$(id: string, registrationTid: RegistrationTid): Observable<Summary[]> {\r\n    return this.getRegistrationByIdShared$(id).pipe(switchMap((reg) => this.getSummaryForRegistrationTid(reg, registrationTid)));\r\n  }\r\n\r\n  /**\r\n   * Converts a registration draft to summary as the same model as generated from the API\r\n   * @param reg Registration draft\r\n   * @param registrationTid Registration tid\r\n   */\r\n  public getDraftSummary(reg: IRegistration, registrationTid: RegistrationTid, addIfEmpty = true): Observable<Summary[]> {\r\n    if (!isObservationEmptyForRegistrationTid(reg, registrationTid)) {\r\n      // const provider = this.summaryProviders.find((p) => p.registrationTid === registrationTid);\r\n      // if (provider) {\r\n      //   return provider.generateSummary(reg);\r\n      // }\r\n      // TODO: Implement all providers to get summaries generated client side before synchronized to API...\r\n      return this.fallbackSummaryProvider\r\n        .generateSummary(reg, registrationTid)\r\n        .pipe(tap((genericSummary) => this.loggerService.debug('Generic fallback summary', genericSummary)));\r\n    }\r\n    return addIfEmpty ? this.generateEmptySummary(registrationTid).pipe(map((s) => [s])) : of([]);\r\n  }\r\n\r\n  public getSummaryForRegistrationTid(reg: IRegistration, registrationTid: RegistrationTid, addIfEmpty = true): Observable<Summary[]> {\r\n    if (reg.changedRegistrationTid === registrationTid && reg.syncStatus !== SyncStatus.InSync) {\r\n      return this.getDraftSummary(reg, registrationTid, addIfEmpty);\r\n    }\r\n    return this.getResponseSummaryForRegistrationTid(reg, registrationTid, addIfEmpty);\r\n  }\r\n\r\n  public getRegistrationName(registrationTid: RegistrationTid): Observable<string> {\r\n    return this.kdvService.getKdvRepositoryByKeyObservable('RegistrationKDV').pipe(\r\n      map((kdvElements) => kdvElements.find((kdv) => kdv.Id === registrationTid)),\r\n      map((val) => (val ? val.Name : ''))\r\n    );\r\n  }\r\n\r\n  private getResponseSummaryForRegistrationTid(\r\n    reg: IRegistration,\r\n    registrationTid: RegistrationTid,\r\n    addIfEmpty = true\r\n  ): Observable<Summary[]> {\r\n    if (reg && reg.response && reg.response.Summaries && reg.response.Summaries.length > 0) {\r\n      const summary = reg.response.Summaries.filter((x) => x.RegistrationTID === registrationTid);\r\n      if (summary) {\r\n        return of(summary);\r\n      }\r\n    }\r\n    return addIfEmpty ? this.generateEmptySummary(registrationTid).pipe(map((s) => [s])) : of([]);\r\n  }\r\n\r\n  private generateEmptySummary(registrationTid: RegistrationTid): Observable<Summary> {\r\n    return this.getRegistrationName(registrationTid).pipe(\r\n      map((registrationName) => ({\r\n        RegistrationTID: registrationTid,\r\n        RegistrationName: registrationName,\r\n        Summaries: []\r\n      }))\r\n    );\r\n  }\r\n\r\n  public getRegistrationTypesForGeoHazard(geoHazard: GeoHazard): Observable<IRegistrationType[]> {\r\n    const registrationTidsForGeoHazard = getRegistrationTidsForGeoHazard(geoHazard);\r\n\r\n    const flatViewrepository$ = this.kdvService.getViewRepositoryByKeyObservable('RegistrationTypesV').pipe(\r\n      map((val) => this.parseViewRepositoryType(val[`${geoHazard}`])),\r\n      map((result) => this.flattenRegistrationTypes(result)),\r\n      map((result) => result.filter((val) => registrationTidsForGeoHazard.indexOf(val.registrationTid) >= 0))\r\n    );\r\n\r\n    return of(registrationTidsForGeoHazard).pipe(\r\n      switchMap((registrationTids) =>\r\n        flatViewrepository$.pipe(\r\n          map(\r\n            (vr) => registrationTids.map((registrationTid) => vr.find((v) => v.registrationTid === registrationTid)),\r\n            filter((result) => !!result)\r\n          )\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  private flattenRegistrationTypes(types: IRegistrationType[]) {\r\n    const arr = types.map((t) => (t.subTypes && t.subTypes.length > 0 ? t.subTypes : [t]));\r\n    return arr.reduce((a, b) => a.concat(b), []);\r\n  }\r\n\r\n  private parseViewRepositoryType(val: unknown[]): IRegistrationType[] {\r\n    if (!val) {\r\n      return [];\r\n    }\r\n    return val.map((v) => {\r\n      const result: IRegistrationType = {\r\n        registrationTid: v['Id'],\r\n        name: v['Name'],\r\n        sortOrder: v['SortOrder'],\r\n        subTypes: this.parseViewRepositoryType(v['SubTypes'])\r\n      };\r\n      return result;\r\n    });\r\n  }\r\n\r\n  public saveRollbackState$(id: string): Observable<unknown> {\r\n    return combineLatest([this.getRegistrationDbCollectionForAppMode(), this.getRegistrationById(id)]).pipe(\r\n      take(1),\r\n      tap(([collection, reg]) => {\r\n        if (!collection) {\r\n          this.loggerService.warn('No db collection found for appMode when saveRollbackState');\r\n        }\r\n        if (!reg) {\r\n          this.loggerService.warn('No registration found by id when saveRollbackState: ', id);\r\n        }\r\n      }),\r\n      switchMap(([collection, reg]) => (reg && collection ? from(collection.upsertLocal(`undo_state_${id}`, { reg })) : of({})))\r\n    );\r\n  }\r\n\r\n  public saveRollbackState(id: string): void {\r\n    this.saveRollbackState$(id).subscribe(\r\n      () => null,\r\n      (err) => {\r\n        this.loggerService.warn('Could not save rollback state', err);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Rollback registration to last known undo state (as observable)\r\n   */\r\n  public rollbackChanges$(id: string): Observable<boolean> {\r\n    return this.getRegistrationDbCollectionForAppMode().pipe(\r\n      tap((collection) => {\r\n        if (!collection) {\r\n          this.loggerService.warn('No db collection found for appMode when saveRollbackState');\r\n        }\r\n      }),\r\n      switchMap((collection) =>\r\n        collection ? from(collection.getLocal(`undo_state_${id}`)).pipe(map((doc) => (doc ? doc.get('reg') : undefined))) : of(undefined)\r\n      ),\r\n      switchMap((reg: IRegistration) =>\r\n        reg\r\n          ? this.saveRegistrationToOfflineStorage(reg).pipe(\r\n              switchMap(() => this.newAttachmentService.removeAttachments$(id)),\r\n              map(() => true)\r\n            )\r\n          : of(false)\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Rollback registration to last known undo state\r\n   */\r\n  public rollbackChanges(id: string): void {\r\n    this.rollbackChanges$(id).subscribe();\r\n  }\r\n\r\n  public hasRegistrationAnyAttachment$(id: string): Observable<boolean> {\r\n    return this.getAllAttachmentsForRegistration$(id).pipe(map((result) => result.length > 0));\r\n  }\r\n\r\n  public getAllAttachmentsForRegistration$(id: string): Observable<ExistingOrNewAttachment[]> {\r\n    return combineLatest([\r\n      this.getRegistrationByIdShared$(id).pipe(map((reg) => getAllAttachments(reg))),\r\n      this.newAttachmentService.getAttachments(id)\r\n    ]).pipe(\r\n      map(([existingAttachments, newAttachments]) => [\r\n        ...existingAttachments.map((a) => ({ type: 'existing' as ExistingAttachmentType, attachment: a })),\r\n        ...newAttachments.map((a) => ({ type: 'new' as NewAttachmentType, attachment: a }))\r\n      ])\r\n    );\r\n  }\r\n\r\n  public getExistingAttachmentsForRegistrationTid$(id: string, registrationTid: RegistrationTid): Observable<AttachmentViewModel[]> {\r\n    return this.getRegistrationByIdShared$(id).pipe(map((reg) => getAllAttachments(reg, registrationTid)));\r\n  }\r\n\r\n  public getNewAttachmentsForRegistrationTid$(id: string, registrationTid: RegistrationTid): Observable<AttachmentUploadEditModel[]> {\r\n    return this.newAttachmentService\r\n      .getAttachments(id)\r\n      .pipe(map((attachments: AttachmentUploadEditModel[]) => attachments.filter((a) => a.RegistrationTID === registrationTid)));\r\n  }\r\n\r\n  public getAllAttachmentsForRegistrationTid$(id: string, registrationTid: RegistrationTid): Observable<ExistingOrNewAttachment[]> {\r\n    return combineLatest([\r\n      this.getExistingAttachmentsForRegistrationTid$(id, registrationTid),\r\n      this.getNewAttachmentsForRegistrationTid$(id, registrationTid)\r\n    ]).pipe(\r\n      map(([existingAttachments, newAttachments]) => [\r\n        ...existingAttachments.map((a) => ({ type: 'existing' as ExistingAttachmentType, attachment: a })),\r\n        ...newAttachments.map((a) => ({ type: 'new' as NewAttachmentType, attachment: a }))\r\n      ])\r\n    );\r\n  }\r\n\r\n  private getRegistrationOfflineDocumentById(id: string): Observable<RxRegistrationDocument> {\r\n    return this.getRegistrationDbCollectionForAppMode().pipe(\r\n      switchMap((dbCollection) => dbCollection.findByIds$([id])),\r\n      map((result) => result.get(id))\r\n    );\r\n  }\r\n\r\n  private getRegistrationObservable(): Observable<IRegistration[]> {\r\n    return this.getRegistrationDbCollectionForAppMode().pipe(\r\n      switchMap((dbCollection) => dbCollection.find().$.pipe(map((docs) => docs.map((doc) => doc.toJSON())))),\r\n      distinctUntilChanged((a, b) => deepEqual(a, b))\r\n    );\r\n  }\r\n\r\n  private getRegistrationsDbCollection(appMode: AppMode): RxRegistrationCollection {\r\n    return this.offlineDbService.getDbCollection<RxRegistrationCollection>(appMode, TABLE_NAMES.REGISTRATION);\r\n  }\r\n\r\n  private getRegistrationDbCollectionForAppMode(): Observable<RxRegistrationCollection> {\r\n    return this.appModeService.appMode$.pipe(map((appMode) => this.getRegistrationsDbCollection(appMode)));\r\n  }\r\n\r\n  private getNetworkOnlineObservable(): Observable<boolean> {\r\n    return this.internetConnectivity.isOnline$.pipe(\r\n      distinctUntilChanged(),\r\n      filter((online) => online),\r\n      tap(() => this.loggerService.debug('App is now online!'))\r\n    );\r\n  }\r\n\r\n  private filterWhenProgressIsAllreadyRunning() {\r\n    return (src: Observable<IRegistration[]>) =>\r\n      src.pipe(\r\n        withLatestFrom(this.progressService.registrationSyncProgress$),\r\n        filter(([, syncProgress]) => !syncProgress.inProgress),\r\n        map(([records]) => records)\r\n      );\r\n  }\r\n\r\n  private getRegistrationsToSyncObservable(includeThrottle = false) {\r\n    return this.registrationStorage$.pipe(\r\n      switchMap((records) =>\r\n        records.length > 0\r\n          ? from(Promise.all(records.map((reg) => this.shouldSync(reg, includeThrottle).then((shouldSync) => ({ reg, shouldSync })))))\r\n          : // forkJoin(records.map((reg) => this.shouldSync(reg, includeThrottle).pipe(map((shouldSync) => ({ reg, shouldSync })))))\r\n            of([])\r\n      ),\r\n      map((result) => result.filter((result) => result.shouldSync).map((result) => result.reg))\r\n    );\r\n  }\r\n\r\n  public async isEmpty(reg: IRegistration): Promise<boolean> {\r\n    const isNotEmpty = await this.isNotEmpty(reg);\r\n    return !isNotEmpty;\r\n  }\r\n\r\n  private isNotEmpty(reg: IRegistration): Promise<boolean> {\r\n    const notEmpty = hasAnyObservations(reg);\r\n    if (notEmpty) {\r\n      return Promise.resolve(true);\r\n    }\r\n    return this.hasRegistrationAnyAttachment$(reg.id).pipe(take(1)).toPromise();\r\n  }\r\n\r\n  private async shouldSync(reg: IRegistration, includeThrottle = false): Promise<boolean> {\r\n    if (reg.syncStatus === SyncStatus.Sync) {\r\n      if (includeThrottle && this.shouldThrottle(reg)) {\r\n        return false;\r\n      }\r\n      if (reg.response && reg.response.RegId > 0) {\r\n        return true; // Edit existing registration should sync even if empty (deleted observation)\r\n      }\r\n      return await this.isNotEmpty(reg);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private shouldThrottle(reg: IRegistration) {\r\n    if (!reg.lastSync) {\r\n      return false;\r\n    }\r\n    if (reg.changed > reg.lastSync) {\r\n      return false;\r\n    }\r\n    const msToNextSync = this.getMsUntilNextSync(reg.lastSync, SYNC_BUFFER_MS);\r\n    if (msToNextSync > 0) {\r\n      this.loggerService.debug(`Should throttle: ${msToNextSync / 1000}`, reg);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private getMsUntilNextSync(lastSyncTimeUnixTimestamp: number, timeout: number) {\r\n    const msSinceLastSync = (moment().unix() - lastSyncTimeUnixTimestamp) * 1000;\r\n    return timeout - msSinceLastSync;\r\n  }\r\n\r\n  private flattenRegistrationsToSync(ignoreVersionCheck: boolean) {\r\n    return (src: Observable<IRegistration[]>) =>\r\n      src.pipe(\r\n        mergeMap((rows) => concat(rows.map((row) => this.syncRecord(row, ignoreVersionCheck)))),\r\n        mergeMap((r) => r)\r\n      );\r\n  }\r\n\r\n  private syncRecord(item: IRegistration, ignoreVersionCheck: boolean): Observable<ItemSyncCompleteStatus<IRegistration>> {\r\n    return this.offlineRegistrationSyncService.syncItem(item, ignoreVersionCheck).pipe(\r\n      catchError((err) => of({ item, success: false, error: err })),\r\n      tap((result) => this.loggerService.log('Record sync complete', result))\r\n    );\r\n  }\r\n\r\n  private mapItemSyncCompleteStatusToRegistration(): (src: Observable<ItemSyncCompleteStatus<IRegistration>>) => Observable<IRegistration> {\r\n    return (src: Observable<ItemSyncCompleteStatus<IRegistration>>) =>\r\n      src.pipe(\r\n        map((r: ItemSyncCompleteStatus<IRegistration>) => ({\r\n          ...r.item,\r\n          lastSync: moment().unix(),\r\n          syncStatus: r.success ? SyncStatus.InSync : r.statusCode === 0 ? SyncStatus.Sync : SyncStatus.Draft,\r\n          request: r.success ? cloneDeep(r.item.response) : cloneDeep(r.item.request),\r\n          syncStatusCode: r.statusCode,\r\n          syncError: r.error\r\n        }))\r\n      );\r\n  }\r\n\r\n  private updateRowAndReturnItem(): (src: Observable<ItemSyncCompleteStatus<IRegistration>>) => Observable<IRegistration> {\r\n    return (src: Observable<ItemSyncCompleteStatus<IRegistration>>) =>\r\n      src.pipe(\r\n        this.mapItemSyncCompleteStatusToRegistration(),\r\n        switchMap((item: IRegistration) =>\r\n          this.saveRegistrationToOfflineStorage(item).pipe(\r\n            catchError((err) => {\r\n              this.loggerService.error('Could not update record in offline storage', err);\r\n              return of([]);\r\n            }),\r\n            map(() => item)\r\n          )\r\n        )\r\n      );\r\n  }\r\n}\r\n","import { Summary, UrlViewModel, RegObsGenericValue, KdvElement } from '@varsom-regobs-common/regobs-api';\r\nimport { RegistrationTid, IRegistration, KdvKey } from '../../registration.models';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { UrlSummary } from '../../models/summary/url-summary';\r\nimport { Observable, combineLatest, } from 'rxjs';\r\nimport { map, take, switchMap } from 'rxjs/operators';\r\nimport { SummaryKind } from '../../models/summary/summary-kind.enum';\r\nimport { KdvService } from '../kdv/kdv.service';\r\nimport { TextSummary } from '../../models/summary/text-summary';\r\nimport { ISummaryProvider } from './summary-provider.interface';\r\nimport { isArrayType } from '../../registration.helpers';\r\nimport { getRegistationProperty } from '../../helpers/registration.helper';\r\nimport { isEmpty } from '@varsom-regobs-common/core';\r\n\r\nexport abstract class BaseSummaryProvider<EditModel> implements ISummaryProvider {\r\n  abstract registrationTid: RegistrationTid;\r\n  abstract generateTypeSpesificSummaries(reg: IRegistration, registrationTid: RegistrationTid, registrationName: string, model: EditModel, summary: Summary): Observable<Summary>;\r\n\r\n  constructor(public translateService: TranslateService, public kdvService: KdvService) {\r\n  }\r\n\r\n  generateSummary(reg: IRegistration, registrationTid: RegistrationTid = this.registrationTid): Observable<Summary[]> {\r\n    return this.getRegistrationName(registrationTid).pipe(switchMap((registrationName) => combineLatest(this.generateSummaryForType(reg, registrationTid, registrationName))));\r\n  }\r\n\r\n  private generateSummaryForType(reg: IRegistration, registrationTid: RegistrationTid, registrationName: string): Observable<Summary>[] {\r\n    const registrationProp = getRegistationProperty(reg, registrationTid) as EditModel | Array<EditModel>;\r\n    if (isArrayType(registrationTid)) {\r\n      return ((registrationProp as Array<EditModel>) || []).map((registrationItem) =>\r\n        this.generateTypeSpesificSummaries(reg, registrationTid, registrationName, registrationItem, this.createSummary(registrationTid, registrationName)));\r\n    }\r\n    return [this.generateTypeSpesificSummaries(reg, registrationTid, registrationName, registrationProp as EditModel, this.createSummary(registrationTid, registrationName))];\r\n  }\r\n\r\n  private createSummary(registrationTid: RegistrationTid, registrationName: string): Summary {\r\n    return {\r\n      RegistrationTID: registrationTid,\r\n      RegistrationName: registrationName,\r\n      Summaries: [],\r\n    };\r\n  }\r\n\r\n  public getRegistrationName(registrationTid: RegistrationTid) {\r\n    return this.kdvService.getKdvRepositoryByKeyObservable('RegistrationKDV').pipe(take(1), map((registrationKdvs) => {\r\n      const registrationName = (registrationKdvs || [])\r\n        .find((x) => x.Id === registrationTid);\r\n      return registrationName ? registrationName.Name : '';\r\n    }));\r\n  }\r\n\r\n  getUrlSummary(urls: Array<UrlViewModel>): Observable<RegObsGenericValue> {\r\n    const translationKey = 'Observations.GeneralObservation.Urls';\r\n    return this.translateService.get([translationKey]).pipe(map((translations) => ({\r\n      Kind: SummaryKind.List,\r\n      KindType: 'List',\r\n      Header: translations[translationKey],\r\n      Value: urls.map((url) => new UrlSummary(url.UrlDescription || url.UrlLine, url.UrlLine)),\r\n    })));\r\n  }\r\n\r\n  getTextSummary(headerTranslationKey: string, value: string): Observable<TextSummary> {\r\n    return this.translateService.get([headerTranslationKey]).pipe(\r\n      map((translations) => new TextSummary(\r\n        translations[headerTranslationKey], value\r\n      )));\r\n  }\r\n\r\n  hasTID(tid: number) {\r\n    return !isEmpty(tid) && tid > 0;\r\n  }\r\n\r\n  getKdvSummary(headerTranslationKey: string, kdvKey: KdvKey, tid: number): Observable<TextSummary> {\r\n    return this.translateService.get(headerTranslationKey).pipe(\r\n      switchMap((translation) => this.kdvService.getKdvRepositoryByKeyObservable(kdvKey)\r\n        .pipe(\r\n          take(1),\r\n          map((kdvElements: KdvElement[]) => kdvElements.find((kdvElement: KdvElement) => kdvElement.Id === tid)),\r\n          map((kdvElement) => new TextSummary(\r\n            translation, kdvElement ? kdvElement.Name : ''\r\n          ))\r\n        )));\r\n  }\r\n}\r\n","import { IRegistration, RegistrationTid } from '../../registration.models';\r\nimport { RegObsGenericValue, Summary } from '@varsom-regobs-common/regobs-api';\r\nimport { BaseSummaryProvider } from './base.summary-provider';\r\nimport { Observable } from 'rxjs';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { KdvService } from '../kdv/kdv.service';\r\nimport { Injectable } from '@angular/core';\r\nimport { map, switchMap } from 'rxjs/operators';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FallbackSummaryProvider extends BaseSummaryProvider<unknown> {\r\n  registrationTid = undefined;\r\n\r\n  constructor(public translateService: TranslateService, public kdvService: KdvService) {\r\n    super(translateService, kdvService);\r\n  }\r\n\r\n  generateTypeSpesificSummaries(_reg: IRegistration,\r\n    _registrationTid: RegistrationTid,\r\n    _registrationName: string,\r\n    model: unknown,\r\n    summary: Summary): Observable<Summary> {\r\n    return this.generateGenericSummaries().pipe(map((result) => ({ ...summary, Summaries: result })));\r\n  }\r\n\r\n  generateGenericSummaries(): Observable<RegObsGenericValue[]> {\r\n    return this.translateService.get('Observations.Shared.UnsentDescription')\r\n      .pipe(switchMap((translation) => this.getTextSummary('Observations.Shared.UnsentSummaryTitle', translation)\r\n        .pipe(map((result) => [result]))));\r\n  }\r\n}\r\n","import { IRegistration, RegistrationTid } from '../../../registration.models';\r\nimport { RegObsGenericValue, GeneralObservationEditModel, Summary } from '@varsom-regobs-common/regobs-api';\r\nimport { BaseSummaryProvider } from '../base.summary-provider';\r\nimport { Observable, combineLatest } from 'rxjs';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { KdvService } from '../../kdv/kdv.service';\r\nimport { Injectable } from '@angular/core';\r\nimport { map } from 'rxjs/operators';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class GeneralObservationSummaryProvider extends BaseSummaryProvider<GeneralObservationEditModel> {\r\n  readonly registrationTid = RegistrationTid.GeneralObservation;\r\n\r\n  constructor(public translateService: TranslateService, public kdvService: KdvService) {\r\n    super(translateService, kdvService);\r\n  }\r\n\r\n  generateTypeSpesificSummaries(_reg: IRegistration,\r\n    _registrationTid: RegistrationTid,\r\n    _registrationName: string,\r\n    model: GeneralObservationEditModel,\r\n    summary: Summary): Observable<Summary> {\r\n    return this.generateGeneralObservationSummaries(model).pipe(map((result) => ({ ...summary, Summaries: result })));\r\n  }\r\n\r\n  generateGeneralObservationSummaries(model: GeneralObservationEditModel): Observable<RegObsGenericValue[]> {\r\n    const summaries: Observable<RegObsGenericValue>[] = [];\r\n    if(model) {\r\n      if (model.ObsComment) {\r\n        summaries.push(this.getTextSummary('Observations.GeneralObservation.Comment', model.ObsComment));\r\n      }\r\n      if (model.Comment) {\r\n        summaries.push(this.getTextSummary('Observations.GeneralObservation.Comment', model.Comment));\r\n      }\r\n      if (model.ObsHeader) {\r\n        summaries.push(this.getTextSummary('Observations.GeneralObservation.ObsHeader', model.ObsHeader));\r\n      }\r\n      if (model.Urls && model.Urls.length > 0) {\r\n        summaries.push(this.getUrlSummary(model.Urls));\r\n      }\r\n    }\r\n    return combineLatest(summaries);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { RegistrationTid, IRegistration } from '../../../../registration.models';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { BaseSummaryProvider } from '../../base.summary-provider';\r\nimport { Observable, forkJoin, of } from 'rxjs';\r\nimport { Summary, RegObsGenericValue, WeatherEditModel } from '@varsom-regobs-common/regobs-api';\r\nimport { KdvService } from '../../../kdv/kdv.service';\r\nimport { map, switchMap } from 'rxjs/operators';\r\nimport { isEmpty } from '@varsom-regobs-common/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WeatherSummaryProvider extends BaseSummaryProvider<WeatherEditModel> {\r\n\r\n  readonly registrationTid = RegistrationTid.WeatherObservation;\r\n\r\n  constructor(public translateService: TranslateService, public kdvService: KdvService) {\r\n    super(translateService, kdvService);\r\n  }\r\n\r\n  generateTypeSpesificSummaries(\r\n    _reg: IRegistration,\r\n    _registrationTid: RegistrationTid,\r\n    _registrationName: string,\r\n    model: WeatherEditModel,\r\n    summary: Summary): Observable<Summary> {\r\n    return this.generateWeatherObservationSummaries(model).pipe(map((result) => ({ ...summary, Summaries: result })));\r\n  }\r\n\r\n  generateWeatherObservationSummaries(model: WeatherEditModel): Observable<RegObsGenericValue[]> {\r\n    const summaries: Observable<RegObsGenericValue>[] = [];\r\n    if (model) {\r\n      if(this.hasTID(model.PrecipitationTID)) {\r\n        summaries.push(this.getKdvSummary('Observations.WeatherObservation.PrecipitationTID', 'Snow_PrecipitationKDV', model.PrecipitationTID));\r\n      }\r\n\r\n      if (!isEmpty(model.AirTemperature)) {\r\n        summaries.push(this.getTextSummary('Observations.WeatherObservation.AirTemperature', `${model.AirTemperature.toFixed(0)} °C`));\r\n      }\r\n\r\n      if(!isEmpty(model.WindDirection) || !isEmpty(model.WindSpeed)){\r\n        summaries.push(this.getWindDirectionValue(model).pipe(\r\n          switchMap((val) => this.getTextSummary('Observations.WeatherObservation.Wind', val))));\r\n      }\r\n\r\n      if (model.Comment) {\r\n        summaries.push(this.getTextSummary('Observations.GeneralObservation.Comment', model.Comment));\r\n      }\r\n\r\n      if(!isEmpty(model.CloudCover)) {\r\n        summaries.push(this.getTextSummary('Observations.WeatherObservation.CloudCover', `${model.CloudCover}%`));\r\n      }\r\n    }\r\n    return summaries.length > 0 ? forkJoin(summaries) : of([]);\r\n  }\r\n\r\n  private getWindDirectionValue(model: WeatherEditModel): Observable<string> {\r\n    const wdString$ = !isEmpty(model.WindDirection) ? this.translateService.get(this.getWindDirectionTranslationKey(model.WindDirection)) : of(null);\r\n    return wdString$.pipe(map((wdString) => {\r\n      const val = [];\r\n      if(!isEmpty(model.WindSpeed)) {\r\n        val.push(`${model.WindSpeed} m/s`);\r\n      }\r\n      if(wdString !== null && wdString !== undefined) {\r\n        val.push(wdString);\r\n      }\r\n      return val.join(' - ');\r\n    }));\r\n  }\r\n\r\n  private getWindDirectionTranslationKey(windDirection: number) {\r\n    if (windDirection >= 0 && windDirection < 45 || windDirection == 360)\r\n    {\r\n      return 'Observations.WeatherObservation.FromNorth';\r\n    }\r\n    else if (windDirection >= 45 && windDirection < 90)\r\n    {\r\n      return 'Observations.WeatherObservation.FromNorthEast';\r\n    }\r\n    else if (windDirection >= 90 && windDirection < 135)\r\n    {\r\n      return 'Observations.WeatherObservation.FromEast';\r\n    }\r\n    else if (windDirection >= 135 && windDirection < 180)\r\n    {\r\n      return 'Observations.WeatherObservation.FromSouthEast';\r\n    }\r\n    else if (windDirection >= 180 && windDirection < 225)\r\n    {\r\n      return 'Observations.WeatherObservation.FromSouth';\r\n    }\r\n    else if (windDirection >= 225 && windDirection < 270)\r\n    {\r\n      return 'Observations.WeatherObservation.FromSouthWest';\r\n    }\r\n    else if (windDirection >= 270 && windDirection < 315)\r\n    {\r\n      return 'Observations.WeatherObservation.FromWest';\r\n    }\r\n    else if (windDirection >= 315 && windDirection < 360)\r\n    {\r\n      return 'Observations.WeatherObservation.FromNorthWest';\r\n    }\r\n    return '';\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { NanoSql } from '../../../../nanosql';\r\nimport { Observable } from 'rxjs';\r\nimport { IDataLoad } from '../models/data-load.interface';\r\nimport { map, take } from 'rxjs/operators';\r\nimport moment from 'moment';\r\nimport { nSQL } from '@nano-sql/core';\r\nimport { NSqlFullUpdateObservable } from '../../../core/helpers/nano-sql/NSqlFullUpdateObservable';\r\n\r\n/**\r\n * Håndterer spinnere og status på når sist oppdatering har skjedd.\r\n * Trenger nye data og hentes? osv.\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DataLoadService {\r\n  constructor() {}\r\n\r\n  async startLoading(id: string, totalItems?: number) {\r\n    const existingItem = await this.getState(id);\r\n    existingItem.startedDate = moment().toISOString();\r\n    existingItem.isLoading = true;\r\n    existingItem.completedDate = null;\r\n    existingItem.progress = 0;\r\n    existingItem.itemsComplete = 0;\r\n    existingItem.totalItems = totalItems;\r\n    existingItem.error = null;\r\n    existingItem.errorMessage = null;\r\n    existingItem.status = '';\r\n    return this.saveDataLoadItem(existingItem);\r\n  }\r\n\r\n  async updateProgress(\r\n    id: string,\r\n    itemsComplete: number,\r\n    totalItems: number,\r\n    status?: string\r\n  ) {\r\n    const existingItem = await this.getState(id);\r\n    existingItem.itemsComplete = itemsComplete;\r\n    existingItem.totalItems = totalItems;\r\n    existingItem.status = status;\r\n    existingItem.progress = itemsComplete / totalItems;\r\n    return this.saveDataLoadItem(existingItem);\r\n  }\r\n\r\n  async loadingCompleted(\r\n    id: string,\r\n    totalItems?: number,\r\n    itemsFromDate?: Date,\r\n    itemsToDate?: Date\r\n  ) {\r\n    const existingItem = await this.getState(id);\r\n    existingItem.isLoading = false;\r\n    existingItem.completedDate = moment().toISOString();\r\n    existingItem.lastUpdated = moment().toISOString();\r\n    existingItem.progress = 1.0;\r\n    existingItem.totalItems = totalItems;\r\n    existingItem.itemsComplete = totalItems;\r\n    existingItem.itemsFromDate = moment(itemsFromDate).toISOString();\r\n    existingItem.itemsToDate = moment(itemsToDate).toISOString();\r\n    return this.saveDataLoadItem(existingItem);\r\n  }\r\n\r\n  async loadingError(id: string, errorMessage: string) {\r\n    const existingItem = await this.getState(id);\r\n    existingItem.isLoading = false;\r\n    existingItem.completedDate = moment().toISOString();\r\n    existingItem.progress = 1.0;\r\n    existingItem.status = 'Error';\r\n    existingItem.error = true;\r\n    existingItem.errorMessage = errorMessage;\r\n    return this.saveDataLoadItem(existingItem);\r\n  }\r\n\r\n  private async saveDataLoadItem(item: IDataLoad) {\r\n    return nSQL(NanoSql.TABLES.DATA_LOAD.name).query('upsert', item).exec();\r\n  }\r\n\r\n  getState(id: string): Promise<IDataLoad> {\r\n    return this.getStateAsObservable(id).pipe(take(1)).toPromise();\r\n  }\r\n\r\n  getStateAsObservable(id: string): Observable<IDataLoad> {\r\n    return new NSqlFullUpdateObservable<IDataLoad[]>(\r\n      nSQL(NanoSql.TABLES.DATA_LOAD.name)\r\n        .query('select')\r\n        .where((x) => x.id === id)\r\n        .listen()\r\n    ).pipe(\r\n      map((val: IDataLoad[]) =>\r\n        val.length > 0\r\n          ? val[0]\r\n          : {\r\n            id,\r\n            completed: null,\r\n            lastUpdated: null,\r\n            isLoading: false,\r\n            started: null\r\n          }\r\n      )\r\n    );\r\n  }\r\n}\r\n","<div *ngIf=\"showLog$ | async\">\r\n  <ion-fab vertical=\"bottom\" horizontal=\"end\" slot=\"fixed\" [ngClass]=\"{'open': isOpen }\">\r\n    <ion-fab-button (click)=\" toggle()\">\r\n      <ion-icon [name]=\"isOpen ? 'arrow-down-circle' : 'arrow-up-circle'\"></ion-icon>\r\n    </ion-fab-button>\r\n  </ion-fab>\r\n  <ion-content #GpsLogPanel class=\"gpsLogPanel\" [ngClass]=\"{'open': isOpen, 'tracking': isTracking }\">\r\n    <div *ngFor=\"let item of geoPositionLog\">\r\n      {{ timestampToString(item.timestamp) }} -\r\n      <span *ngIf=\"item.status !== 'PositionUpdate'\">&nbsp;{{item.status}}</span>\r\n      <span *ngIf=\"item.status === 'PositionUpdate'\">\r\n        <span *ngIf=\"item.pos else NoPosition\">&nbsp;\r\n          {{ item.pos.coords.latitude | number:'.5' }}&deg;{{'MAP_CENTER_INFO.NORTH_SHORT'|translate}},\r\n          {{ item.pos.coords.longitude | number:'.5' }}&deg;{{'MAP_CENTER_INFO.EAST_SHORT'|translate}},\r\n          {{ item.pos.coords.accuracy }}\r\n        </span>\r\n      </span>\r\n      <span *ngIf=\"item.status === 'PositionError'\">\r\n        &nbsp;{{getErrorCodeOrMessage(item.err)}}\r\n      </span>\r\n      <span *ngIf=\"item.highAccuracyEnabled\">&nbsp;(H)</span>\r\n    </div>\r\n  </ion-content>\r\n</div>\r\n<ng-template #NoPosition>\r\n  Empty\r\n</ng-template>","import { Component, OnInit, NgZone, ViewChild, OnDestroy } from '@angular/core';\r\nimport { Observable, Subject, of } from 'rxjs';\r\nimport {\r\n  map,\r\n  distinctUntilChanged,\r\n  scan,\r\n  filter,\r\n  throttleTime,\r\n  takeUntil,\r\n  switchMap\r\n} from 'rxjs/operators';\r\nimport { GeoPositionService } from '../../../../core/services/geo-position/geo-position.service';\r\nimport { UserSettingService } from '../../../../core/services/user-setting/user-setting.service';\r\nimport { enterZone } from '../../../../core/helpers/observable-helper';\r\nimport { IonContent } from '@ionic/angular';\r\nimport moment from 'moment';\r\nimport { GeoPositionLog, PositionError } from '../../../../core/services/geo-position/geo-position-log.interface';\r\nimport { GeoPositionErrorCode } from '../../../../core/services/geo-position/geo-position-error.enum';\r\n\r\n@Component({\r\n  selector: 'app-gps-debug',\r\n  templateUrl: './gps-debug.component.html',\r\n  styleUrls: ['./gps-debug.component.scss']\r\n})\r\nexport class GpsDebugComponent implements OnInit, OnDestroy {\r\n  showLog$: Observable<boolean>;\r\n  geoPositionLog: GeoPositionLog[];\r\n  isOpen: boolean;\r\n  isTracking: boolean;\r\n  private ngDestroy$ = new Subject<void>();\r\n\r\n  @ViewChild('GpsLogPanel') panel: IonContent;\r\n\r\n  constructor(\r\n    private userSettingService: UserSettingService,\r\n    private geoPositionService: GeoPositionService,\r\n    private ngZone: NgZone\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.isOpen = false;\r\n    this.isTracking = false;\r\n    this.showLog$ = this.userSettingService.userSetting$.pipe(\r\n      map((us) => us.featureToggeGpsDebug),\r\n      distinctUntilChanged(),\r\n      enterZone(this.ngZone)\r\n    );\r\n    this.showLog$\r\n      .pipe(\r\n        switchMap((show) =>\r\n          show\r\n            ? this.geoPositionService.log$.pipe(\r\n              scan((acc: GeoPositionLog[], val) => {\r\n                acc.push(val);\r\n                return acc.slice(-50);\r\n              }, []),\r\n              throttleTime(100)\r\n            )\r\n            : of([])\r\n        ),\r\n        takeUntil(this.ngDestroy$)\r\n      )\r\n      .subscribe((val) => {\r\n        this.ngZone.run(() => {\r\n          this.geoPositionLog = val;\r\n        });\r\n        this.ngZone.run(() => {\r\n          this.scrollToBottom();\r\n        });\r\n      });\r\n    this.geoPositionService.log$\r\n      .pipe(\r\n        filter(\r\n          (log) =>\r\n            log.status === 'StartGpsTracking' ||\r\n            log.status === 'StopGpsTracking'\r\n        ),\r\n        map((log) => (log.status === 'StartGpsTracking' ? true : false)),\r\n        distinctUntilChanged(),\r\n        takeUntil(this.ngDestroy$)\r\n      )\r\n      .subscribe((val) => {\r\n        setTimeout(() => {\r\n          this.isTracking = val;\r\n        });\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.ngDestroy$.next();\r\n    this.ngDestroy$.complete();\r\n  }\r\n\r\n  toggle() {\r\n    this.isOpen = !this.isOpen;\r\n  }\r\n\r\n  scrollToBottom() {\r\n    if (this.panel) {\r\n      this.panel.scrollToBottom();\r\n    }\r\n  }\r\n\r\n  timestampToString(timestamp: number) {\r\n    return moment.unix(timestamp).local().format('dd.MM HH:mm:ss.SSS');\r\n  }\r\n\r\n  getErrorCodeOrMessage(err: PositionError) {\r\n    if (!err) {\r\n      return 'Empty error';\r\n    }\r\n    switch (err.code) {\r\n    case GeoPositionErrorCode.PermissionDenied:\r\n      return 'Permission denied';\r\n    case GeoPositionErrorCode.PositionUnavailable:\r\n      return 'Position unavailable';\r\n    case GeoPositionErrorCode.Timeout:\r\n      return 'Timeout';\r\n    default:\r\n      return err.message;\r\n    }\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { GpsDebugComponent } from './components/gps-debug/gps-debug.component';\r\nimport { SharedModule } from '../shared/shared.module';\r\n\r\n@NgModule({\r\n  imports: [SharedModule],\r\n  declarations: [GpsDebugComponent],\r\n  exports: [GpsDebugComponent]\r\n})\r\nexport class GpsDebugModule {}\r\n","import {\r\n  Component,\r\n  OnInit,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  OnDestroy,\r\n  OnChanges,\r\n  SimpleChanges,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\nimport * as L from 'leaflet';\r\nimport { BehaviorSubject, Subject, timer } from 'rxjs';\r\nimport { takeUntil, takeWhile, tap } from 'rxjs/operators';\r\nimport { ImageLocation } from '../../components/img-swiper/image-location.model';\r\nimport { settings } from '../../../settings';\r\nimport { SmartChanges } from '../../core/helpers/simple-changes.helper';\r\nimport { BorderHelper } from '../../core/helpers/leaflet/border-helper';\r\nimport { RegobsGeoHazardMarker } from '../map/core/classes/regobs-geohazard-marker';\r\nimport { GeoHazard } from '@varsom-regobs-common/core';\r\n\r\nconst START_ICON = '/assets/icon/map/GPS_start.svg';\r\nconst END_ICON = '/assets/icon/map/GPS_stop.svg';\r\nconst DAMAGE_ICON = '/assets/icon/map/damage-location.svg';\r\n\r\n@Component({\r\n  selector: 'app-map-image',\r\n  templateUrl: './map-image.component.html',\r\n  styleUrls: ['./map-image.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MapImageComponent implements OnInit, OnDestroy, OnChanges {\r\n  @Input() location: ImageLocation;\r\n  @Input() allowZoom: boolean;\r\n\r\n  private map: L.Map;\r\n  private mapCenterSubject: BehaviorSubject<ImageLocation>;\r\n  private ngDestroy$: Subject<void>;\r\n\r\n  constructor(private cdr: ChangeDetectorRef) {}\r\n\r\n  options: L.MapOptions = {\r\n    zoom: settings.map.tiles.zoomLevelObservationList,\r\n    maxZoom: settings.map.tiles.maxZoom,\r\n    minZoom: 8,\r\n    bounceAtZoomLimits: false,\r\n    attributionControl: false,\r\n    zoomControl: false,\r\n    scrollWheelZoom: 'center', // zoom to center regardless where mouse is\r\n    touchZoom: 'center',\r\n    trackResize: false,\r\n    center: L.latLng(settings.map.unknownMapCenter as L.LatLngTuple)\r\n  };\r\n\r\n  private getStartStopIcon(start = false) {\r\n    return L.icon({\r\n      iconUrl: start ? START_ICON : END_ICON,\r\n      iconSize: [27, 42],\r\n      iconAnchor: [13.5, 41],\r\n      shadowUrl: 'leaflet/marker-shadow.png',\r\n      shadowSize: [41, 41]\r\n    });\r\n  }\r\n\r\n  private getDamageIcon() {\r\n    return L.icon({\r\n      iconUrl: DAMAGE_ICON,\r\n      iconSize: [25, 41],\r\n      iconAnchor: [12, 41],\r\n      shadowUrl: 'leaflet/marker-shadow.png',\r\n      shadowSize: [41, 41]\r\n    });\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.mapCenterSubject = new BehaviorSubject(this.location);\r\n    this.ngDestroy$ = new Subject();\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges & SmartChanges<this>): void {\r\n    if (!this.mapCenterSubject) {\r\n      this.mapCenterSubject = new BehaviorSubject(this.location);\r\n    }\r\n    this.mapCenterSubject.next(changes.location.currentValue);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.ngDestroy$.next();\r\n    this.ngDestroy$.complete();\r\n  }\r\n  onLeafletMapReady(map: L.Map) {\r\n    this.map = map;\r\n    this.mapCenterSubject.pipe(takeUntil(this.ngDestroy$)).subscribe((val) => {\r\n      if (this.map) {\r\n        this.map.eachLayer((layer) => layer.remove());\r\n      }\r\n      this.addTileLayers();\r\n      if (val && val.latLng) {\r\n        this.map.setView(val.latLng, this.options.zoom);\r\n        this.setMarker(val.latLng, val.geoHazard);\r\n      }\r\n      if (val && val.startStopLocation) {\r\n        this.setStartStopLocation(\r\n          val.startStopLocation.start,\r\n          val.startStopLocation.stop\r\n        );\r\n      }\r\n      if (val && val.damageLocations && val.damageLocations.length > 0) {\r\n        this.setDamageLocations(val.damageLocations);\r\n      }\r\n    });\r\n    if (!this.allowZoom) {\r\n      if (this.map.tap) {\r\n        this.map.tap.disable();\r\n      }\r\n      this.map.doubleClickZoom.disable();\r\n      this.map.dragging.disable();\r\n      this.map.keyboard.disable();\r\n      this.map.touchZoom.disable();\r\n      this.map.scrollWheelZoom.disable();\r\n      this.map.boxZoom.disable();\r\n    }\r\n    this.redrawMap();\r\n  }\r\n\r\n  redrawMap() {\r\n    let counter = 3;\r\n    timer(500, 50)\r\n      .pipe(\r\n        takeUntil(this.ngDestroy$),\r\n        takeWhile(() => counter > 0),\r\n        tap(() => counter--)\r\n      )\r\n      .subscribe(() => {\r\n        if (this.map) {\r\n          this.map.invalidateSize();\r\n        }\r\n      });\r\n  }\r\n\r\n  private isInNorway() {\r\n    if (this.location && this.location.latLng) {\r\n      return (\r\n        BorderHelper.isInNorway(this.location.latLng) ||\r\n        BorderHelper.isInSvalbard(this.location.latLng)\r\n      );\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private addTileLayers() {\r\n    const url = this.isInNorway()\r\n      ? settings.map.tiles.statensKartverkMapUrl\r\n      : settings.map.tiles.arcGisOnlineTopoMapUrl;\r\n    L.tileLayer(url, {\r\n      updateWhenIdle: true,\r\n      keepBuffer: 0\r\n    }).addTo(this.map);\r\n  }\r\n\r\n  private setMarker(latLng: L.LatLng, geoHazard: GeoHazard) {\r\n    L.marker(latLng, {\r\n      icon: new RegobsGeoHazardMarker(geoHazard),\r\n      interactive: false\r\n    }).addTo(this.map);\r\n  }\r\n\r\n  private setStartStopLocation(start: L.LatLng, stop: L.LatLng) {\r\n    if (start) {\r\n      L.marker(start, {\r\n        icon: this.getStartStopIcon(true),\r\n        interactive: false\r\n      }).addTo(this.map);\r\n    }\r\n    if (stop) {\r\n      L.marker(stop, {\r\n        icon: this.getStartStopIcon(false),\r\n        interactive: false\r\n      }).addTo(this.map);\r\n    }\r\n    if (start && stop) {\r\n      L.polyline([start, stop], {\r\n        color: 'red',\r\n        weight: 6,\r\n        opacity: 0.9\r\n      }).addTo(this.map);\r\n    }\r\n  }\r\n\r\n  private setDamageLocations(locations: L.LatLng[]) {\r\n    if (locations && locations.length > 0) {\r\n      for (const location of locations) {\r\n        L.marker(location, {\r\n          icon: this.getDamageIcon(),\r\n          interactive: false\r\n        }).addTo(this.map);\r\n      }\r\n    }\r\n  }\r\n}\r\n","<div leaflet [leafletOptions]=\"options\" (leafletMapReady)=\"onLeafletMapReady($event)\">\r\n</div>","import { MapImageComponent } from './map-image.component';\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { LeafletModule } from '@asymmetrik/ngx-leaflet';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    TranslateModule,\r\n    LeafletModule\r\n  ],\r\n  declarations: [MapImageComponent],\r\n  exports: [MapImageComponent]\r\n})\r\nexport class MapImageModule {}\r\n","<!-- \r\n  NB! Root elements in this view has positon: absolute..\r\n -->\r\n\r\n<!-- Crosshair displayed in map center -->\r\n<img class=\"center-icon\" src=\"../../../assets/icon/center.png\">\r\n\r\n<!-- Map center info box displayed in bottom left corner -->\r\n<div\r\n  #infoBoxElement\r\n  class=\"map-center-info ion-text-nowrap\"\r\n  (click)=\"copyToClipboard()\"\r\n>\r\n  <ion-grid class=\"ion-no-padding\">\r\n\r\n    <ng-container *ngIf=\"!loading; else loadingSpinner\">\r\n\r\n      <!-- Location name -->\r\n      <ion-row name=\"map-center-info-row\" *ngIf=\"location\">\r\n        <span\r\n          *ngIf=\"location.name !== location.adminName\">{{ location.name }},&nbsp;</span>{{location.adminName}}\r\n      </ion-row>\r\n\r\n      <!-- Height (masl) and steepness -->\r\n      <ion-row name=\"map-center-info-row\" *ngIf=\"elevation != null || steepness != null\">\r\n        <ng-container *ngIf=\"elevation != null\">\r\n          {{ elevation }} {{'MAP_CENTER_INFO.ABOVE_SEA_LEVEL'|translate}}\r\n        </ng-container>\r\n        <ng-container *ngIf=\"steepness != null\">\r\n          <span *ngIf=\"elevation !== null\">,&nbsp;</span>\r\n          <span class=\"steepness-triangle\">\r\n            <span class=\"steepness-value\" [ngStyle]=\"{ 'transform': 'rotate(' +steepness +'deg)'}\">\r\n            </span>\r\n          </span>\r\n          {{ steepness }}&deg;\r\n        </ng-container>\r\n      </ion-row>\r\n\r\n    </ng-container>\r\n\r\n    <!-- Coordinates -->\r\n    <ion-row name=\"map-center-info-row\" *ngIf=\"mapCenter\">\r\n      {{ mapCenter.lat | number:'.3' }}&deg;{{ 'MAP_CENTER_INFO.NORTH_SHORT' | translate }}, \r\n      {{ mapCenter.lng | number:'.3' }}&deg;{{ 'MAP_CENTER_INFO.EAST_SHORT' | translate }}\r\n    </ion-row>\r\n\r\n    <!-- Distance and height difference to gps position -->\r\n    <ion-row name=\"map-center-info-row\" *ngIf=\"distance != null && distance > 0\">\r\n        {{ getHorizontalDifferenceText(distance) }} {{ 'MAP_CENTER_INFO.AWAY_FROM' | translate }}\r\n        <ng-container *ngIf=\"!loading && heightDifference != null\">\r\n          <ion-icon *ngIf=\"heightDifference > 0\" name=\"arrow-up\" class=\"height-difference-icon\"></ion-icon>\r\n          <ion-icon *ngIf=\"heightDifference < 0\" name=\"arrow-down\" class=\"height-difference-icon\"></ion-icon>\r\n          {{ heightDifference | abs | number: '1.0-0' }} m\r\n        </ng-container>\r\n    </ion-row>\r\n\r\n  </ion-grid>\r\n</div>\r\n\r\n<ng-template #loadingSpinner>\r\n  <ion-spinner name=\"map-center-info-spinner\" color=\"light\" name=\"dots\"></ion-spinner>\r\n</ng-template>","import { Component, ChangeDetectionStrategy, ChangeDetectorRef, ViewChild, ElementRef } from '@angular/core';\r\nimport { ToastController, Platform } from '@ionic/angular';\r\nimport { Clipboard } from '@ionic-native/clipboard/ngx';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { combineLatest, firstValueFrom, of } from 'rxjs';\r\nimport { catchError, takeUntil, timeout } from 'rxjs/operators';\r\nimport { MapSearchService } from '../../services/map-search/map-search.service';\r\nimport { MapService } from '../../services/map/map.service';\r\nimport { GeoPositionService } from 'src/app/core/services/geo-position/geo-position.service';\r\nimport { HelperService } from 'src/app/core/services/helpers/helper.service';\r\nimport { NgDestoryBase } from 'src/app/core/helpers/observable-helper';\r\nimport { Position } from '@capacitor/geolocation';\r\nimport { LocationName } from '../../services/map-search/location-name.model';\r\nimport * as L from 'leaflet';\r\nimport { ViewInfo } from '../../services/map-search/view-info.model';\r\nimport { IMapView } from '../../services/map/map-view.interface';\r\n\r\nconst LOCATION_INFO_REQUEST_TIMEOUT = 10_000;\r\nlet requestCounter = 0;\r\n\r\n@Component({\r\n  selector: 'app-map-center-info',\r\n  templateUrl: './map-center-info.component.html',\r\n  styleUrls: ['./map-center-info.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MapCenterInfoComponent extends NgDestoryBase {\r\n  private userPos: Position;  // Caches the gps position for distance and height diff computation\r\n\r\n  // For accessing the info box element from parent views\r\n  @ViewChild('infoBoxElement') private infoBoxElement: ElementRef;\r\n\r\n  get nativeElement(): HTMLElement | null {\r\n    return this.infoBoxElement?.nativeElement;\r\n  }\r\n\r\n  // Public props we can see in the map center info box\r\n  mapCenter: L.LatLng;\r\n  elevation: number;\r\n  location: LocationName;\r\n  steepness: number;\r\n  loading = false;\r\n\r\n  get distance(): number {\r\n    if (this.userPos?.coords && this.mapCenter != null) {\r\n      return this.mapCenter.distanceTo({\r\n        lat: this.userPos.coords.latitude,\r\n        lng: this.userPos.coords.longitude\r\n      });\r\n    }\r\n  }\r\n\r\n  get heightDifference(): number {\r\n    if (this.userPos?.coords?.altitude != null && this.elevation) {\r\n      return this.elevation - this.userPos.coords.altitude;\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    mapService: MapService,\r\n    private mapSearchService: MapSearchService,\r\n    private clipboard: Clipboard,\r\n    private toastController: ToastController,\r\n    private translateService: TranslateService,\r\n    private platform: Platform,\r\n    geoPositionService: GeoPositionService,\r\n    private helperService: HelperService,\r\n    private cdr: ChangeDetectorRef,\r\n  ) {\r\n    super();\r\n\r\n    // When we get a new gps position, update cached position.\r\n    // If followMode is on, we do not need to show distance and relative height.\r\n    combineLatest([\r\n      geoPositionService.currentPosition$,\r\n      mapService.followMode$\r\n    ])\r\n      .pipe(takeUntil(this.ngDestroy$))\r\n      .subscribe(([newPos, followMode]) => {\r\n        this.userPos = followMode ? null : newPos;\r\n        this.cdr.markForCheck();\r\n      });\r\n\r\n    mapService.relevantMapChangeWithInitialView$\r\n      .pipe(takeUntil(this.ngDestroy$))\r\n      .subscribe((newMapView) => {\r\n        this.mapCenter = newMapView.center;\r\n        this.location = null;\r\n        this.elevation = null;\r\n        this.steepness = null;\r\n        this.fetchNewLocationInfo(newMapView);\r\n        this.cdr.markForCheck();\r\n      });\r\n  }\r\n\r\n  getHorizontalDifferenceText(value: number): string {\r\n    return this.helperService.getDistanceText(value);\r\n  }\r\n\r\n  private fetchNewLocationInfo(mapView: IMapView) {\r\n    this.loading = true;\r\n\r\n    const locationInfoRequest = this.mapSearchService\r\n      .getViewInfo(mapView)\r\n      .pipe(\r\n        timeout(LOCATION_INFO_REQUEST_TIMEOUT),\r\n        catchError(() => of({} as ViewInfo)),\r\n      );\r\n\r\n    // Track request number, so we only update the view\r\n    // after the last observable completes.\r\n    requestCounter++;\r\n    const requestIndex = requestCounter;\r\n\r\n    firstValueFrom(locationInfoRequest)\r\n      .then(viewInfo => {\r\n        if (requestIndex < requestCounter) return;\r\n\r\n        this.location = viewInfo.location;\r\n        this.elevation = viewInfo.elevation;\r\n        this.steepness = viewInfo.steepness;\r\n        this.loading = false;\r\n        this.cdr.markForCheck();\r\n      });\r\n  }\r\n\r\n  private useNativeClipboardPlugin() {\r\n    return (\r\n      this.platform.is('hybrid') &&\r\n      (this.platform.is('android') || this.platform.is('ios'))\r\n    );\r\n  }\r\n\r\n  async copyToClipboard(): Promise<void> {\r\n    const textToCopy = `${this.mapCenter.lat}, ${this.mapCenter.lng}`;\r\n    if (this.useNativeClipboardPlugin()) {\r\n      await this.clipboard.copy(textToCopy);\r\n    } else {\r\n      this.copyToClipBoardWeb(textToCopy);\r\n    }\r\n    const toastText = await firstValueFrom(this.translateService.get('MAP_CENTER_INFO.COPIED_TO_CLIPBOARD'));\r\n    const toast = await this.toastController.create({\r\n      message: toastText,\r\n      mode: 'md',\r\n      duration: 2000\r\n    });\r\n    toast.present();\r\n  }\r\n\r\n  private copyToClipBoardWeb(val: string) {\r\n    const selBox = document.createElement('textarea');\r\n    selBox.style.position = 'fixed';\r\n    selBox.style.left = '0';\r\n    selBox.style.top = '0';\r\n    selBox.style.opacity = '0';\r\n    selBox.value = val;\r\n    document.body.appendChild(selBox);\r\n    selBox.focus();\r\n    selBox.select();\r\n    document.execCommand('copy');\r\n    document.body.removeChild(selBox);\r\n  }\r\n}\r\n","import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { FullscreenService } from '../../../../../core/services/fullscreen/fullscreen.service';\r\nimport { Observable } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-fullscreen-toggle',\r\n  templateUrl: './fullscreen-toggle.component.html',\r\n  styleUrls: ['./fullscreen-toggle.component.scss']\r\n})\r\nexport class FullscreenToggleComponent {\r\n  isFullscreen$: Observable<boolean>;\r\n\r\n  constructor(private fullscreenService: FullscreenService) {\r\n    this.isFullscreen$ = this.fullscreenService.isFullscreen$;\r\n  }\r\n\r\n  toggleFullscreen() {\r\n    this.fullscreenService.toggleFullscreen();\r\n  }\r\n\r\n  getSrc(isFullscreen: boolean) {\r\n    return `/assets/icon/${isFullscreen ? 'collapse' : 'expand'}.svg`;\r\n  }\r\n}\r\n","<ion-fab>\r\n  <ion-fab-button color=\"varsom-dark-blue\" class=\"map-control-fab\" (click)=\"toggleFullscreen()\">\r\n    <svg-icon [src]=\"getSrc(isFullscreen$ | async)\"></svg-icon>\r\n  </ion-fab-button>\r\n</ion-fab>","import {\r\n  Component,\r\n  OnInit,\r\n  OnDestroy,\r\n  AfterContentInit,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\nimport { MapService } from '../../../services/map/map.service';\r\nimport { Subscription } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-gps-center',\r\n  templateUrl: './gps-center.component.html',\r\n  styleUrls: ['./gps-center.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class GpsCenterComponent implements OnInit, OnDestroy, AfterContentInit {\r\n  followMode: boolean;\r\n\r\n  private subscription: Subscription;\r\n\r\n  constructor(\r\n    private mapService: MapService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  ngAfterContentInit(): void {\r\n    this.subscription = this.mapService.followMode$.subscribe((val) => {\r\n      this.followMode = val;\r\n      this.cdRef.detectChanges();\r\n    });\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  ngOnInit() {}\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.subscription) {\r\n      this.subscription.unsubscribe();\r\n    }\r\n  }\r\n\r\n  centerMapToUser() {\r\n    this.mapService.centerMapToUser();\r\n  }\r\n}\r\n","<ion-fab>\r\n  <ion-fab-button color=\"varsom-dark-blue\" class=\"map-control-fab\" [ngClass]=\"{'active': followMode}\"\r\n    (click)=\"centerMapToUser()\">\r\n    <ion-icon name=\"locate\"></ion-icon>\r\n  </ion-fab-button>\r\n</ion-fab>","<div class=\"map-controls\" [ngClass]=\"{'fullscreen': (fullscreen$ | async) }\">\r\n  <app-map-search *ngIf=\"showMapSearch\"></app-map-search>\r\n  <app-fullscreen-toggle *ngIf=\"showFullscreenToggle\"></app-fullscreen-toggle>\r\n  <app-gps-center *ngIf=\"showGpsCenter\"></app-gps-center>\r\n</div>","import { Component, OnInit, Input } from '@angular/core';\r\nimport { FullscreenService } from '../../../../core/services/fullscreen/fullscreen.service';\r\nimport { Observable } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-map-controls',\r\n  templateUrl: './map-controls.component.html',\r\n  styleUrls: ['./map-controls.component.scss']\r\n})\r\nexport class MapControlsComponent implements OnInit {\r\n  @Input() showMapSearch = true;\r\n  @Input() showFullscreenToggle = true;\r\n  @Input() showGpsCenter = true;\r\n  fullscreen$: Observable<boolean>;\r\n\r\n  constructor(private fullscreenService: FullscreenService) {\r\n    this.fullscreen$ = fullscreenService.isFullscreen$;\r\n  }\r\n\r\n  ngOnInit() {}\r\n}\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { ModalController } from '@ionic/angular';\r\nimport { CustomAnimation } from '../../../../../core/animations/custom.animation';\r\nimport { ModalSearchPage } from '../../../pages/modal-search/modal-search.page';\r\n\r\n@Component({\r\n  selector: 'app-map-search',\r\n  templateUrl: './map-search.component.html',\r\n  styleUrls: ['./map-search.component.scss']\r\n})\r\nexport class MapSearchComponent implements OnInit {\r\n  constructor(private modalController: ModalController) {}\r\n\r\n  ngOnInit() {}\r\n\r\n  async presentModal() {\r\n    const modal = await this.modalController.create({\r\n      component: ModalSearchPage,\r\n      keyboardClose: true,\r\n      enterAnimation: CustomAnimation.slideInFromRight,\r\n      leaveAnimation: CustomAnimation.slideOutToRight\r\n    });\r\n    return await modal.present();\r\n  }\r\n}\r\n","<ion-fab>\r\n  <ion-fab-button color=\"varsom-dark-blue\" class=\"map-control-fab\" (click)=\"presentModal()\">\r\n    <ion-icon name=\"search\"></ion-icon>\r\n  </ion-fab-button>\r\n</ion-fab>","<div *ngIf=\"loaded\" leaflet [leafletOptions]=\"options\" (leafletMapReady)=\"onLeafletMapReady($event)\">\r\n</div>\r\n<app-map-controls\r\n  [showMapSearch]=\"showMapSearch\"\r\n  [showFullscreenToggle]=\"showFullscreenToggle\"\r\n  [showGpsCenter]=\"showGpsCenter\"\r\n></app-map-controls>","import {\r\n  Component,\r\n  OnInit,\r\n  Input,\r\n  NgZone,\r\n  OnDestroy,\r\n  AfterViewInit,\r\n  Output,\r\n  EventEmitter,\r\n  Injector\r\n} from '@angular/core';\r\nimport * as L from 'leaflet';\r\nimport { UserSettingService } from '../../../../core/services/user-setting/user-setting.service';\r\nimport { timer, Subject, from, BehaviorSubject, combineLatest } from 'rxjs';\r\nimport { UserSetting } from '../../../../core/models/user-settings.model';\r\nimport { settings } from '../../../../../settings';\r\nimport { Position } from '@capacitor/geolocation';\r\nimport { UserMarker } from '../../../../core/helpers/leaflet/user-marker/user-marker';\r\nimport { MapService } from '../../services/map/map.service';\r\nimport {\r\n  take,\r\n  takeUntil,\r\n  switchMap,\r\n  distinctUntilChanged,\r\n  withLatestFrom,\r\n  filter\r\n} from 'rxjs/operators';\r\nimport { FullscreenService } from '../../../../core/services/fullscreen/fullscreen.service';\r\nimport { LoggingService } from '../../../shared/services/logging/logging.service';\r\nimport { MapSearchService } from '../../services/map-search/map-search.service';\r\nimport { TopoMap } from '../../../../core/models/topo-map.enum';\r\nimport {\r\n  RegObsTileLayer,\r\n  IRegObsTileLayerOptions,\r\n  RegObsOfflineAwareTileLayer,\r\n} from '../../core/classes/regobs-tile-layer';\r\nimport { NORWEGIAN_BOUNDS } from '../../../../core/helpers/leaflet/border-helper';\r\nimport { OfflineMapService } from '../../../../core/services/offline-map/offline-map.service';\r\nimport { GeoPositionService } from '../../../../core/services/geo-position/geo-position.service';\r\nimport { LangKey } from '@varsom-regobs-common/core';\r\nimport { File } from '@ionic-native/file/ngx';\r\nimport { isAndroidOrIos } from 'src/app/core/helpers/ionic/platform-helper';\r\nimport { Platform } from '@ionic/angular';\r\nimport { OfflineMapPackage, OfflineTilesMetadata } from 'src/app/core/services/offline-map/offline-map.model';\r\nimport { BBox } from 'geojson';\r\n\r\nconst DEBUG_TAG = 'MapComponent';\r\n\r\ntype CreateTileLayer = (options: IRegObsTileLayerOptions) => L.TileLayer;\r\n\r\nconst isTopoLayer = (mapId: string) => (<string[]>Object.values(TopoMap)).includes(mapId);\r\nconst redrawLayersInLayerGroup = (layerGroup: L.LayerGroup) => {\r\n  layerGroup.eachLayer((layer) => {\r\n    if (layer instanceof L.TileLayer) {\r\n      layer.redraw();\r\n    }\r\n  });\r\n};\r\n\r\n// Bug in leaflet? When using detectRetina, we need to offset native zooms.\r\nconst getNativeZoomOptions = (map: OfflineTilesMetadata, detectRetina: boolean): L.TileLayerOptions => {\r\n  if (detectRetina) {\r\n    return {\r\n      minNativeZoom: Math.max(0, map.rootTile.z - 1),\r\n      maxNativeZoom: Math.max(0, map.zMax - 1)\r\n    };\r\n  } else {\r\n    return {\r\n      minNativeZoom: map.rootTile.z,\r\n      maxNativeZoom: map.zMax\r\n    };\r\n  }\r\n};\r\n\r\nenum MapLayerZIndex {\r\n  OnlineMixedBackgroundLayer = 0,\r\n  OfflineBackgroundLayer = 10,\r\n  OnlineBackgroundLayer = 20,\r\n  OfflineSupportLayer = 30,\r\n  OnlineSupportLayer = 40,\r\n  Top = 50\r\n}\r\n\r\n@Component({\r\n  selector: 'app-map',\r\n  templateUrl: './map.component.html',\r\n  styleUrls: ['./map.component.scss']\r\n})\r\nexport class MapComponent implements OnInit, OnDestroy, AfterViewInit {\r\n  @Input() showMapSearch = true;\r\n  @Input() showFullscreenToggle = true;\r\n  @Input() showGpsCenter = true;\r\n  @Input() showUserLocation = true;\r\n  @Input() showScale = true;\r\n  @Input() showSupportMaps = true;\r\n  @Input() center: L.LatLng;\r\n  @Input() zoom: number;\r\n  @Output() mapReady: EventEmitter<L.Map> = new EventEmitter();\r\n  @Input() autoActivate = true;\r\n  @Input() geoTag = DEBUG_TAG;\r\n  @Input() offlinePackageMode = false;\r\n\r\n  loaded = false;\r\n  private map: L.Map;\r\n  private layerGroup = L.layerGroup();\r\n  private offlineTopoLayerGroup = L.layerGroup();\r\n  private offlineSupportMapLayerGroup = L.layerGroup();\r\n  private userMarker: UserMarker;\r\n  private firstPositionUpdate = true;\r\n  private ngDestroy$ = new Subject<void>();\r\n  private followMode = true;\r\n  private isDoingMoveAction = false;\r\n  private firstClickOnZoomToUser = true;\r\n  private isActive: BehaviorSubject<boolean>;\r\n  private offlineMapService: OfflineMapService;\r\n\r\n  constructor(\r\n    private userSettingService: UserSettingService,\r\n    private mapService: MapService,\r\n    private mapSearchService: MapSearchService,\r\n    private zone: NgZone,\r\n    private fullscreenService: FullscreenService,\r\n    private loggingService: LoggingService,\r\n    private geoPositionService: GeoPositionService,\r\n    private file: File,\r\n    private platform: Platform,\r\n    injector: Injector\r\n  ) {\r\n    if (isAndroidOrIos(this.platform)) {\r\n      this.offlineMapService = injector.get(OfflineMapService);\r\n    }\r\n\r\n    // Hack to make sure map pane is set before getPosition\r\n    L.Map.include({\r\n      _getMapPanePos: function () {\r\n        if (this._mapPane === undefined) {\r\n          return new L.Point(0, 0);\r\n        }\r\n        return L.DomUtil.getPosition(this._mapPane) || new L.Point(0, 0);\r\n      },\r\n      _rawPanBy: function (offset) {\r\n        if (this._mapPane) {\r\n          L.DomUtil.setPosition(\r\n            this._mapPane,\r\n            this._getMapPanePos().subtract(offset)\r\n          );\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  options: L.MapOptions;\r\n\r\n  async ngOnInit() {\r\n    this.options = {\r\n      zoom:\r\n        this.zoom !== undefined ? this.zoom : settings.map.tiles.defaultZoom,\r\n      maxZoom: settings.map.tiles.maxZoom,\r\n      minZoom: settings.map.tiles.minZoom,\r\n      center:\r\n        this.center || L.latLng(settings.map.unknownMapCenter as L.LatLngTuple),\r\n      bounceAtZoomLimits: false,\r\n      attributionControl: false,\r\n      zoomControl: false,\r\n      maxBounds: new L.LatLngBounds(\r\n        new L.LatLng(90.0, -180.0),\r\n        new L.LatLng(-90, 180.0)\r\n      ),\r\n      maxBoundsViscosity: 1.0\r\n    };\r\n    this.isActive = new BehaviorSubject(this.autoActivate);\r\n    try {\r\n      if (this.center === undefined || this.zoom === undefined) {\r\n        const currentView = await this.mapService.mapView$\r\n          .pipe(take(1))\r\n          .toPromise();\r\n        if (currentView && currentView.center) {\r\n          this.firstPositionUpdate = false;\r\n          if (this.center === undefined) {\r\n            this.options.center = currentView.center;\r\n          }\r\n          if (this.zoom === undefined) {\r\n            this.options.zoom = currentView.zoom;\r\n          }\r\n        }\r\n      }\r\n    } finally {\r\n      this.loaded = true;\r\n    }\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.geoPositionService.stopTrackingComponent(DEBUG_TAG);\r\n    this.ngDestroy$.next();\r\n    this.ngDestroy$.complete();\r\n  }\r\n\r\n  componentIsActive(isActive: boolean) {\r\n    this.isActive.next(isActive);\r\n  }\r\n\r\n  onLeafletMapReady(map: L.Map) {\r\n    //TODO: Denne metoden er altfor lang, splitte opp i flere funksjoner!\r\n    this.map = map;\r\n    if (this.showScale) {\r\n      L.control.scale({ imperial: false }).addTo(map);\r\n    }\r\n\r\n    this.offlineTopoLayerGroup.addTo(this.map);\r\n    this.layerGroup.addTo(this.map);\r\n    this.offlineSupportMapLayerGroup.addTo(this.map);\r\n\r\n    if (this.offlinePackageMode) {\r\n      // Style all online maps grayscale.\r\n      // We need the dom element that contains the layer to use css and add a grayscale filter.\r\n      // After the load event, getContainer returns the container, earlier, it may return null or undefined.\r\n      this.map.on('load layeradd', () => {\r\n        this.layerGroup.eachLayer((l: L.TileLayer) => {\r\n          if (l instanceof L.TileLayer) {\r\n            l.getContainer().style.filter = 'grayscale(100%)';\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    this.userSettingService.userSetting$\r\n      .pipe(takeUntil(this.ngDestroy$))\r\n      .subscribe((userSetting) => {\r\n        this.configureTileLayers(userSetting);\r\n        if (userSetting.showMapCenter) {\r\n          this.updateMapView();\r\n        }\r\n      });\r\n\r\n    this.mapService.followMode$\r\n      .pipe(takeUntil(this.ngDestroy$))\r\n      .subscribe((val) => {\r\n        this.followMode = val;\r\n        this.loggingService.debug(\r\n          `Follow mode changed to: ${this.followMode}`,\r\n          DEBUG_TAG\r\n        );\r\n      });\r\n\r\n    this.mapService.centerMapToUser$\r\n      .pipe(\r\n        takeUntil(this.ngDestroy$),\r\n        switchMap(() =>\r\n          from(this.geoPositionService.startTrackingComponent(DEBUG_TAG, true))\r\n        )\r\n      )\r\n      .subscribe();\r\n\r\n    this.mapSearchService.mapSearchClick$\r\n      .pipe(takeUntil(this.ngDestroy$))\r\n      .subscribe((item) => {\r\n        this.disableFollowMode();\r\n        this.zone.runOutsideAngular(() => {\r\n          const latLng = item instanceof L.LatLng ? item : item.latlng;\r\n          this.flyTo(latLng, settings.map.mapSearchZoomToLevel);\r\n        });\r\n      });\r\n\r\n    this.mapService.centerMapToUser$\r\n      .pipe(takeUntil(this.ngDestroy$))\r\n      .subscribe(() => {\r\n        this.zone.runOutsideAngular(() => {\r\n          if (this.userMarker) {\r\n            const currentPosition = this.userMarker.getPosition();\r\n            const latLng = L.latLng(\r\n              currentPosition.coords.latitude,\r\n              currentPosition.coords.longitude\r\n            );\r\n            if (this.followMode || this.firstClickOnZoomToUser) {\r\n              // Follow mode is allready true or first click, zoom in\r\n              this.flyToMaxZoom(latLng);\r\n            } else {\r\n              // Use existing zoom\r\n              this.flyTo(latLng, this.map.getZoom(), true);\r\n            }\r\n            this.firstClickOnZoomToUser = false;\r\n          }\r\n        });\r\n      });\r\n\r\n    this.zone.runOutsideAngular(() => {\r\n      this.map.on('movestart', () => this.onMapMove());\r\n      this.map.on('zoomstart', () => this.onMapMove());\r\n    });\r\n\r\n    this.zone.runOutsideAngular(() => {\r\n      this.map.on('moveend', () => this.onMapMoveEnd());\r\n    });\r\n\r\n    this.fullscreenService.isFullscreen$\r\n      .pipe(takeUntil(this.ngDestroy$))\r\n      .subscribe(() => {\r\n        this.redrawMap();\r\n      });\r\n\r\n    if (this.showUserLocation) {\r\n      this.geoPositionService.currentPosition$\r\n        .pipe(takeUntil(this.ngDestroy$))\r\n        .subscribe((pos) => this.onPositionUpdate(pos));\r\n\r\n      this.geoPositionService.currentHeading$\r\n        .pipe(takeUntil(this.ngDestroy$))\r\n        .subscribe((heading) => {\r\n          if (this.userMarker) {\r\n            this.userMarker.setHeading(heading);\r\n          }\r\n        });\r\n\r\n      this.startActiveSubscriptions();\r\n    }\r\n\r\n    this.startInvalidateSizeMapTimer();\r\n\r\n    this.map.on('resize', () => this.updateMapView());\r\n\r\n    if (isAndroidOrIos(this.platform)) {\r\n      this.initOfflineMaps();\r\n    }\r\n\r\n    this.mapReady.emit(this.map);\r\n  }\r\n\r\n  private async initOfflineMaps() {\r\n    this.loggingService.debug('initOfflineMaps()... ', DEBUG_TAG);\r\n\r\n    combineLatest([\r\n      this.offlineMapService.packages$,\r\n      this.userSettingService.userSetting$\r\n    ])\r\n      .pipe(takeUntil(this.ngDestroy$))\r\n      .subscribe(([packages, userSettings]) => {\r\n        this.zone.runOutsideAngular(() => {\r\n          this.createOfflineLayers(packages, userSettings);\r\n\r\n          // When starting offline, offline map packages are\r\n          // registered after the map initially loads.\r\n          // By redrawing here, we can see offline tiles without\r\n          // zooming in/out etc.\r\n          redrawLayersInLayerGroup(this.offlineTopoLayerGroup);\r\n          redrawLayersInLayerGroup(this.offlineSupportMapLayerGroup);\r\n        });\r\n      });\r\n  }\r\n\r\n  private tileCoordsToBounds({ x, y, z }: { x: number, y: number, z: number }): L.LatLngBounds {\r\n    const tileSize = new L.Point(256, 256);\r\n    const coords = new L.Point(x, y);\r\n\r\n    const nwPoint = coords.scaleBy(tileSize);\r\n    const sePoint = nwPoint.add(tileSize);\r\n    const nw = this.map.unproject(nwPoint, z);\r\n    const se = this.map.unproject(sePoint, z);\r\n    return new L.LatLngBounds(nw, se);\r\n  }\r\n\r\n  private createOfflineLayers(packages: OfflineMapPackage[], userSettings: UserSetting) {\r\n    this.offlineTopoLayerGroup.clearLayers();\r\n    this.offlineSupportMapLayerGroup.clearLayers();\r\n\r\n    // Create a map of enabled support tiles\r\n    const enabledSupportMaps = this.userSettingService\r\n      .getSupportTilesOptions(userSettings)\r\n      .filter(supportMap => supportMap.enabled)\r\n      .reduce((map, supportMap) => {\r\n        map.set(supportMap.name, supportMap);\r\n        return map;\r\n      }, new Map());\r\n\r\n    // Create offline tile map layers\r\n    for (const offlinePackage of packages) {\r\n      for (const map of Object.values(offlinePackage.maps)) {\r\n        if (isTopoLayer(map.mapId)) {\r\n          this.createTopoMapOfflineLayer(map, userSettings.useRetinaMap);\r\n        } else if (enabledSupportMaps.has(map.mapId)) {\r\n          const { opacity } = enabledSupportMaps.get(map.mapId);\r\n          this.createSupportMapOfflineLayer(map, opacity, userSettings.useRetinaMap);\r\n        } else {\r\n          this.loggingService.debug(`'${map.mapId}' is currently disabled or undefined in map config, no layer created for ${map.url}`, DEBUG_TAG);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private createTopoMapOfflineLayer(map: OfflineTilesMetadata, detectRetina: boolean) {\r\n    const bounds = this.tileCoordsToBounds(map.rootTile);\r\n    const url = `${map.url}/{z}/{x}/{y}.png`;\r\n    const nativeZoomOptions = getNativeZoomOptions(map, detectRetina);\r\n\r\n    const layer = new L.TileLayer(url, {\r\n      ...nativeZoomOptions,\r\n      bounds,\r\n      // When in offlinePackageMode / on offline-map.page.ts,\r\n      // always put offline packages on top so they display above\r\n      // the grayscale background-map\r\n      zIndex: this.offlinePackageMode ? MapLayerZIndex.Top : MapLayerZIndex.OfflineBackgroundLayer,\r\n      detectRetina\r\n    });\r\n    this.offlineTopoLayerGroup.addLayer(layer);\r\n  }\r\n\r\n  private createSupportMapOfflineLayer(map: OfflineTilesMetadata, opacity: number, detectRetina: boolean) {\r\n    const bounds = this.tileCoordsToBounds(map.rootTile);\r\n    const url = `${map.url}/{z}/{x}/{y}.png`;\r\n    const nativeZoomOptions = getNativeZoomOptions(map, detectRetina);\r\n    const layer = new L.TileLayer(url, {\r\n      ...nativeZoomOptions,\r\n      bounds,\r\n      opacity,\r\n      // When in offlinePackageMode / on offline-map.page.ts,\r\n      // always put offline packages on top so they display above\r\n      // the grayscale background-map\r\n      zIndex: this.offlinePackageMode ? MapLayerZIndex.Top + 1 : MapLayerZIndex.OfflineSupportLayer,\r\n      detectRetina\r\n    });\r\n    this.offlineSupportMapLayerGroup.addLayer(layer);\r\n  }\r\n\r\n\r\n  private startActiveSubscriptions() {\r\n    this.isActive\r\n      .pipe(distinctUntilChanged(), takeUntil(this.ngDestroy$))\r\n      .subscribe((active) => {\r\n        if (active) {\r\n          this.geoPositionService.startTrackingComponent(this.geoTag);\r\n          this.redrawMap();\r\n        } else {\r\n          this.geoPositionService.stopTrackingComponent(this.geoTag);\r\n        }\r\n      });\r\n  }\r\n\r\n  private onMapMove() {\r\n    this.disableFollowMode();\r\n    this.mapService.sendMapMoveStart();\r\n  }\r\n\r\n  private onMapMoveEnd() {\r\n    this.updateMapView();\r\n  }\r\n\r\n  private disableFollowMode() {\r\n    if (!this.isDoingMoveAction) {\r\n      this.loggingService.debug('Disable follow mode!', DEBUG_TAG);\r\n      this.mapService.followMode = false;\r\n    } else {\r\n      this.loggingService.debug(\r\n        'Did not disable follow mode, because isDoingMoveAction',\r\n        DEBUG_TAG\r\n      );\r\n    }\r\n  }\r\n\r\n  private updateMapView() {\r\n    if (this.map) {\r\n      this.mapService.updateMapView({\r\n        bounds: this.map.getBounds(),\r\n        center: this.map.getCenter(),\r\n        zoom: this.map.getZoom()\r\n      });\r\n    }\r\n  }\r\n\r\n  private getTileLayerDefaultOptions(\r\n    useRetinaMap = false\r\n  ): IRegObsTileLayerOptions {\r\n    return {\r\n      minZoom: settings.map.tiles.minZoom,\r\n      maxZoom: this.getMaxZoom(useRetinaMap),\r\n      maxNativeZoom: settings.map.tiles.maxZoom,\r\n      detectRetina: useRetinaMap,\r\n      updateWhenIdle: settings.map.tiles.updateWhenIdle,\r\n      edgeBufferTiles: settings.map.tiles.edgeBufferTiles,\r\n    };\r\n  }\r\n\r\n  private configureTileLayers(userSetting: UserSetting) {\r\n    this.zone.runOutsideAngular(() => {\r\n      this.layerGroup.clearLayers();\r\n      this.map.setMaxZoom(this.getMaxZoom(userSetting.useRetinaMap));\r\n\r\n      const createTileLayerFactory = this.getTileLayerFactory(\r\n        userSetting.topoMap\r\n      );\r\n\r\n      for (const createTileLayer of createTileLayerFactory) {\r\n        const options = {\r\n          ...this.getTileLayerDefaultOptions(userSetting.useRetinaMap),\r\n          zIndex: MapLayerZIndex.OnlineBackgroundLayer\r\n        };\r\n        const layer = createTileLayer(options);\r\n        layer.addTo(this.layerGroup);\r\n      }\r\n\r\n      for (const supportMaps of this.userSettingService.getSupportTilesOptions(\r\n        userSetting\r\n      )) {\r\n        if (!supportMaps.enabled) {\r\n          continue;\r\n        }\r\n\r\n        const options = {\r\n          ...this.getTileLayerDefaultOptions(userSetting.useRetinaMap),\r\n          zIndex: MapLayerZIndex.OnlineSupportLayer,\r\n          updateInterval: 600,\r\n          keepBuffer: 0,\r\n          updateWhenIdle: true,\r\n          minZoom: settings.map.tiles.minZoomSupportMaps,\r\n          bounds: <any>settings.map.tiles.supportTilesBounds\r\n        };\r\n\r\n        const layer = this.createSupportMapTileLayer(supportMaps.name, supportMaps.url, options);\r\n        layer.setOpacity(supportMaps.opacity);\r\n        layer.addTo(this.layerGroup);\r\n      }\r\n    });\r\n  }\r\n\r\n  private createSupportMapTileLayer(name: string, url: string, options: L.TileLayerOptions): RegObsTileLayer {\r\n    if (isAndroidOrIos(this.platform)) {\r\n      return new RegObsOfflineAwareTileLayer(\r\n        name,\r\n        url,\r\n        options,\r\n        this.offlineMapService.offlineTilesRegistry,\r\n        this.loggingService\r\n      );\r\n    } else {\r\n      return new RegObsTileLayer(url, options);\r\n    }\r\n  }\r\n\r\n  private getMaxZoom(detectRetina: boolean) {\r\n    return detectRetina && L.Browser.retina\r\n      ? settings.map.tiles.maxZoom + 2\r\n      : settings.map.tiles.maxZoom;\r\n  }\r\n\r\n  private getTileLayerFactory(topoMap: TopoMap): CreateTileLayer[] {\r\n    let createNorwegianMixedMap: CreateTileLayer;\r\n    let createStatensKartverk: CreateTileLayer;\r\n\r\n    if (isAndroidOrIos(this.platform)) {\r\n      createNorwegianMixedMap = (options) => new RegObsOfflineAwareTileLayer(\r\n        TopoMap.statensKartverk,\r\n        settings.map.tiles.statensKartverkMapUrl,\r\n        {\r\n          ...options,\r\n          bounds: settings.map.tiles.supportTilesBounds as L.LatLngBoundsLiteral\r\n        },\r\n        this.offlineMapService.offlineTilesRegistry,\r\n        this.loggingService,\r\n      );\r\n\r\n      createStatensKartverk = (options) => new RegObsOfflineAwareTileLayer(\r\n        TopoMap.statensKartverk,\r\n        settings.map.tiles.statensKartverkMapUrl,\r\n        options,\r\n        this.offlineMapService.offlineTilesRegistry,\r\n        this.loggingService,\r\n      );\r\n    } else {\r\n      createNorwegianMixedMap = (options) => new RegObsTileLayer(\r\n        settings.map.tiles.statensKartverkMapUrl,\r\n        {\r\n          ...options,\r\n          bounds: settings.map.tiles.supportTilesBounds as L.LatLngBoundsLiteral\r\n        }\r\n      );\r\n\r\n      createStatensKartverk = (options) => new RegObsTileLayer(\r\n        settings.map.tiles.statensKartverkMapUrl,\r\n        options\r\n      );\r\n    }\r\n\r\n\r\n    const createOpenTopoMap: CreateTileLayer = (options) => new L.TileLayer(settings.map.tiles.openTopoMapUrl, options);\r\n    const createArcGisOnlineMap: CreateTileLayer = (options) => new L.TileLayer(settings.map.tiles.arcGisOnlineTopoMapUrl, options);\r\n    const createGeoDataLandskapMap: CreateTileLayer = (options) => new L.TileLayer(settings.map.tiles.geoDataLandskapMapUrl, options);\r\n    const createArGisOnlineMixMap: CreateTileLayer[] = [\r\n      (options) => new RegObsTileLayer(\r\n        settings.map.tiles.arcGisOnlineTopoMapUrl,\r\n        {\r\n          ...options,\r\n          zIndex: MapLayerZIndex.OnlineMixedBackgroundLayer,\r\n          excludeBounds: NORWEGIAN_BOUNDS\r\n        },\r\n      ),\r\n      createNorwegianMixedMap\r\n    ];\r\n\r\n    switch (topoMap) {\r\n    case TopoMap.statensKartverk:\r\n      return [createStatensKartverk];\r\n    case TopoMap.openTopo:\r\n      return [createOpenTopoMap];\r\n    case TopoMap.arcGisOnline:\r\n      return [createArcGisOnlineMap];\r\n    case TopoMap.geoDataLandskap:\r\n      return [createGeoDataLandskapMap];\r\n    case TopoMap.mixOpenTopo:\r\n      return [\r\n        (options) => new RegObsTileLayer(settings.map.tiles.openTopoMapUrl, {\r\n          ...options,\r\n          zIndex: MapLayerZIndex.OnlineMixedBackgroundLayer,\r\n          excludeBounds: NORWEGIAN_BOUNDS\r\n        }),\r\n        createNorwegianMixedMap\r\n      ];\r\n    case TopoMap.mixArcGisOnline:\r\n    default:\r\n      return createArGisOnlineMixMap;\r\n    }\r\n  }\r\n\r\n  // Force redraw map size on interval to make sure tiles are displayed\r\n  private startInvalidateSizeMapTimer() {\r\n    timer(2000, 5000)\r\n      .pipe(\r\n        withLatestFrom(this.isActive),\r\n        filter(([timer, active]) => active),\r\n        takeUntil(this.ngDestroy$)\r\n      )\r\n      .subscribe(() => this.redrawMap());\r\n  }\r\n\r\n  redrawMap() {\r\n    if (this.map) {\r\n      this.map.invalidateSize();\r\n    }\r\n    window.dispatchEvent(new Event('resize'));\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    this.redrawMap();\r\n  }\r\n\r\n  private onPositionUpdate(data: Position) {\r\n    this.zone.runOutsideAngular(() => {\r\n      if (this.map) {\r\n        const latLng = L.latLng({\r\n          lat: data.coords.latitude,\r\n          lng: data.coords.longitude\r\n        });\r\n        if (!this.userMarker) {\r\n          this.userMarker = new UserMarker(this.map, data);\r\n        } else {\r\n          this.userMarker.updatePosition(data);\r\n        }\r\n        if (this.followMode && !this.isDoingMoveAction) {\r\n          this.flyToMaxZoom(latLng, !this.firstPositionUpdate);\r\n          this.firstPositionUpdate = false;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private flyToMaxZoom(latLng: L.LatLng, usePan = false) {\r\n    this.flyTo(\r\n      latLng,\r\n      Math.max(settings.map.flyToOnGpsZoom, this.map.getZoom()),\r\n      usePan\r\n    );\r\n  }\r\n\r\n  private flyTo(latLng: L.LatLng, zoom: number, usePan = false) {\r\n    this.isDoingMoveAction = true;\r\n    // if (usePan) {\r\n    //   this.map.panTo(latLng);\r\n    // } else {\r\n    //   this.map.flyTo(latLng, zoom);\r\n    // }\r\n    // Note: Poor performance on flyTo effect, so using setView without animate instead.\r\n    this.map.setView(latLng, zoom, { animate: false });\r\n    this.isDoingMoveAction = false;\r\n  }\r\n}\r\n","import * as L from 'leaflet';\r\nimport { GeoHazard } from '@varsom-regobs-common/core';\r\n\r\nexport class RegobsGeoHazardMarker extends L.DivIcon {\r\n  private _selected: boolean;\r\n  private _geoHazard: GeoHazard;\r\n\r\n  constructor(geoHazard: GeoHazard, isSelected = false) {\r\n    super({\r\n      html: RegobsGeoHazardMarker.getIconSvg(geoHazard, isSelected),\r\n      className: 'obs-marker',\r\n      iconSize: [30, 40],\r\n      iconAnchor: [15, 40]\r\n    });\r\n    this._selected = isSelected;\r\n    this._geoHazard = geoHazard;\r\n  }\r\n\r\n  static getIconSvg(geoHazard: GeoHazard, isSelected: boolean) {\r\n    switch (geoHazard) {\r\n    case GeoHazard.Snow:\r\n      return this.getSnowSvg(isSelected);\r\n    case GeoHazard.Water:\r\n      return this.getWaterSvg(isSelected);\r\n    case GeoHazard.Soil:\r\n      return this.getDirtSvg(isSelected);\r\n    case GeoHazard.Ice:\r\n      return this.getIceSvg(isSelected);\r\n    default:\r\n      return '';\r\n    }\r\n  }\r\n\r\n  static getDirtSvg(isSelected: boolean) {\r\n    return `<svg width=\"44\" height=\"49\" viewBox=\"0 0 44 49\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n        <g filter=\"url(#filter0_f)\">\r\n        <ellipse cx=\"22.6509\" cy=\"30.7147\" rx=\"11.7128\" ry=\"5.55783\" transform=\"rotate(-22 22.6509 30.7147)\"\r\n        fill=\"#222222\" fill-opacity=\"0.5\"/>\r\n        </g>\r\n        <path d=\"M16.2064 36.6548L16.2167 36.6438L16.2264 36.6322C17.0774 35.6109 18.1068 34.2426 19.313 32.5314C20.5211\r\n        30.8176 21.7424 28.9786 22.977 27.0144C24.2251 25.0289 25.2879 22.9028 26.1659 20.637C27.0471 18.3628 27.5 16.3143\r\n        27.5 14.5C27.5 10.901 26.2317 7.82326 23.7042 5.29578C21.1767 2.76829 18.099 1.5 14.5 1.5C10.901 1.5 7.82326 2.76829\r\n        5.29578 5.29578C2.76829 7.82326 1.5 10.901 1.5 14.5C1.5 16.3162 1.96777 18.3934 2.87649 20.722C3.77997 23.0372 4.78458\r\n        25.1184 5.89172 26.9636C6.99252 28.7983 8.27499 30.6864 9.73828 32.6281C11.1911 34.5559 12.2079 35.8559 12.7804\r\n        36.5143C13.3394 37.1571 13.7859 37.6734 14.1204 38.0636L14.4826 38.4863L14.8641 38.0809L16.2064 36.6548Z\"\r\n        fill=\"white\" stroke=\"#6996A3\" ${isSelected ? 'stroke-width=\"2\"' : ''}/>\r\n        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M14.4393 8.97889L13.2781 8.36161V7.60109L13.5285 7.14778C13.5285\r\n        7.14778 13.3626 6.7814 13.6667 6.47276C13.9707 6.16412 14.4393 6.2233 14.4393 6.2233L15.5811 6.59498L16.0331\r\n        7.60109L15.5811 8.36161L14.4393 8.97889ZM9.21558 18.0642L11.7039 16.6533V14.915L11.1672 13.8789C11.1672 13.8789\r\n        11.5227 13.0414 10.8712 12.3359C10.2196 11.6305 9.21558 11.7657 9.21558 11.7657L6.76875 12.6153L5.80029\r\n        14.915L6.76875 16.6533L9.21558 18.0642ZM15.4051 13.4481L13.6964 14.114L12.2349 13.142C12.2349 13.142 11.9599\r\n        12.35 12.2349 11.5708C12.51 10.7917 13.2123 10.5891 13.6964 10.5891C13.8491 10.5891 13.9824 10.5799 14.1016\r\n        10.5716H14.1016C14.4851 10.545 14.7226 10.5285 14.9923 10.8625C15.3459 11.3003 15.6396 11.9625 15.6396\r\n        12.3516C15.6396 12.6999 15.4051 13.4481 15.4051 13.4481ZM18.9523 7.79359L21.2305 8.75553C21.2305 8.75553 21.5432\r\n        9.83629 21.5432 10.3394C21.5432 10.9014 21.1516 11.8578 20.6802 12.4902C20.3206 12.9726 20.0039 12.9488 19.4926\r\n        12.9104C19.3337 12.8985 19.1559 12.8851 18.9523 12.8851C18.3068 12.8851 17.3704 12.5926 17.0037 11.4671C16.637\r\n        10.3417 17.0037 9.19758 17.0037 9.19758L18.9523 7.79359ZM19.4509 21.8207L15.9016 23.1995L12.8284 21.8207L11.7039\r\n        18.52L13.409 17.3211C13.409 17.3211 13.8988 16.0489 14.5026 15.5251C15.1064 15.0014 16.6509 14.5091 16.6509\r\n        14.5091L19.7238 15.7208L21.1496 18.8961L19.9429 20.2002L19.4509 21.8207Z\" fill=\"#735E2F\"/>\r\n        <defs>\r\n        <filter id=\"filter0_f\" x=\"1.70898\" y=\"13.1738\" width=\"41.8838\" height=\"35.0816\" filterUnits=\"userSpaceOnUse\"\r\n        color-interpolation-filters=\"sRGB\">\r\n        <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\"/>\r\n        <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\"/>\r\n        <feGaussianBlur stdDeviation=\"4\" result=\"effect1_foregroundBlur\"/>\r\n        </filter>\r\n        </defs>\r\n        </svg>\r\n        `;\r\n  }\r\n\r\n  static getIceSvg(isSelected: boolean) {\r\n    return `<svg width=\"44\" height=\"49\" viewBox=\"0 0 44 49\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n        <g filter=\"url(#filter0_f)\">\r\n        <ellipse cx=\"22.6509\" cy=\"30.7147\" rx=\"11.7128\" ry=\"5.55783\" transform=\"rotate(-22 22.6509 30.7147)\"\r\n        fill=\"#222222\" fill-opacity=\"0.5\"/>\r\n        </g>\r\n        <path d=\"M16.2064 36.6548L16.2167 36.6438L16.2264 36.6322C17.0774 35.6109 18.1068 34.2426 19.313 32.5314C20.5211\r\n        30.8176 21.7424 28.9786 22.977 27.0144C24.2251 25.0289 25.2879 22.9028 26.1659 20.637C27.0471 18.3628 27.5 16.3143\r\n        27.5 14.5C27.5 10.901 26.2317 7.82326 23.7042 5.29578C21.1767 2.76829 18.099 1.5 14.5 1.5C10.901 1.5 7.82326 2.76829\r\n        5.29578 5.29578C2.76829 7.82326 1.5 10.901 1.5 14.5C1.5 16.3162 1.96777 18.3934 2.87649 20.722C3.77997 23.0372\r\n        4.78458 25.1184 5.89172 26.9636C6.99252 28.7983 8.27499 30.6864 9.73828 32.6281C11.1911 34.5559 12.2079 35.8559\r\n        12.7804 36.5143C13.3394 37.1571 13.7859 37.6734 14.1204 38.0636L14.4826 38.4863L14.8641 38.0809L16.2064 36.6548Z\"\r\n        fill=\"white\" stroke=\"#6996A3\" ${isSelected ? 'stroke-width=\"2\"' : ''}/>\r\n        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M9.47844 15.9942L10.6624 10.906L12.3033 22.1253L13.8669\r\n        11.4343L16.0693 27.0301L18.3694 10.7425L19.8358 15.9942L21.7189\r\n        9.25H18.5801H17.9526H14.1864H13.5585H11.0477H10.4202H7.90918L9.47844 15.9942Z\" fill=\"#009FD4\"/>\r\n        <defs>\r\n        <filter id=\"filter0_f\" x=\"1.70898\" y=\"13.1738\" width=\"41.8838\" height=\"35.0816\" filterUnits=\"userSpaceOnUse\"\r\n        color-interpolation-filters=\"sRGB\">\r\n        <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\"/>\r\n        <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\"/>\r\n        <feGaussianBlur stdDeviation=\"4\" result=\"effect1_foregroundBlur\"/>\r\n        </filter>\r\n        </defs>\r\n        </svg>\r\n        `;\r\n  }\r\n\r\n  static getWaterSvg(isSelected: boolean) {\r\n    return `<svg width=\"44\" height=\"49\" viewBox=\"0 0 44 49\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n        <g filter=\"url(#filter0_f)\">\r\n        <ellipse cx=\"22.6509\" cy=\"30.7147\" rx=\"11.7128\" ry=\"5.55783\" transform=\"rotate(-22 22.6509 30.7147)\"\r\n         fill=\"#222222\" fill-opacity=\"0.5\"/>\r\n        </g>\r\n        <path d=\"M16.2064 36.6548L16.2167 36.6438L16.2264 36.6322C17.0774 35.6109 18.1068 34.2426 19.313\r\n        32.5314C20.5211 30.8176 21.7424 28.9786 22.977 27.0144C24.2251 25.0289 25.2879 22.9028 26.1659 20.637C27.0471\r\n        18.3628 27.5 16.3143 27.5 14.5C27.5 10.901 26.2317 7.82326 23.7042 5.29578C21.1767 2.76829 18.099 1.5 14.5 1.5C10.901\r\n        1.5 7.82326 2.76829 5.29578 5.29578C2.76829 7.82326 1.5 10.901 1.5 14.5C1.5 16.3162 1.96777 18.3934 2.87649\r\n        20.722C3.77997 23.0372 4.78458 25.1184 5.89172 26.9636C6.99252 28.7983 8.27499 30.6864 9.73828 32.6281C11.1911\r\n        34.5559 12.2079 35.8559 12.7804 36.5143C13.3394 37.1571 13.7859 37.6734 14.1204 38.0636L14.4826 38.4863L14.8641\r\n        38.0809L16.2064 36.6548Z\" fill=\"white\" stroke=\"#6996A3\" ${\r\n  isSelected ? 'stroke-width=\"2\"' : ''\r\n}/>\r\n        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M21.8746 12.8977C21.8901 12.9116 21.9057 12.9257 21.9216\r\n        12.94C22.4737 13.435 23.2353 14.0483 24.4158 14.0483V12.1652C23.8256 12.1652 23.4353 11.8854 22.9688\r\n        11.4658C22.9505 11.4493 22.932 11.4328 22.9135 11.4161C22.3736 10.9307 21.7358 10.3574 20.4841 10.3574C19.1894\r\n        10.3574 18.5039 10.9708 17.9613 11.4658C17.5043 11.8854 17.1902 12.1652 16.4857 12.1652C15.7874 12.1652 15.482\r\n        11.8904 15.0225 11.4769L15.0101 11.4658C14.4674 10.9708 13.7915 10.3574 12.4968 10.3574C11.2116 10.3574 10.5262\r\n        10.9708 9.98352 11.4658C9.52656 11.8854 9.22192 12.1652 8.51744 12.1652C7.82826 12.1652 7.53085 11.8975 7.08151\r\n        11.4929C7.07154 11.4839 7.06149 11.4749 7.05137 11.4658C6.50873 10.9708 5.72809 10.3574 4.55713\r\n        10.3574V12.2405C5.13785 12.2405 5.54721 12.5203 6.01369 12.94C6.02002 12.9458 6.02638 12.9516 6.03275\r\n        12.9574C6.57176 13.4492 7.22833 14.0483 8.50792 14.0483C9.79312 14.0483 10.4786 13.435 11.0212 12.94L11.0336\r\n        12.9288C11.4931 12.5154 11.7986 12.2405 12.4968 12.2405C13.195 12.2405 13.5005 12.5154 13.96 12.9288L13.9724\r\n        12.94C14.515 13.435 15.191 14.0483 16.4857 14.0483C17.7627 14.0483 18.4382 13.4427 18.9884 12.9494L18.999\r\n        12.94C19.4559 12.5203 19.7606 12.2405 20.465 12.2405C21.1456 12.2405 21.4352 12.5016 21.8746 12.8977ZM21.9216\r\n        17.2901C22.4737 17.7851 23.2353 18.3985 24.4063 18.3985H24.4158V16.5153C23.8256 16.5153 23.4353 16.2356\r\n        22.9688 15.8159C22.9505 15.7995 22.932 15.7829 22.9135 15.7662C22.3736 15.2809 21.7358 14.7076 20.4841\r\n        14.7076C19.1894 14.7076 18.5039 15.3209 17.9613 15.8159C17.5043 16.2356 17.1902 16.5153 16.4857 16.5153C15.7874\r\n        16.5153 15.482 16.2405 15.0225 15.827L15.0101 15.8159C14.4674 15.3209 13.7915 14.7076 12.4968 14.7076C11.2116\r\n        14.7076 10.5262 15.3209 9.98352 15.8159C9.52656 16.2356 9.22192 16.5153 8.51744 16.5153C7.82826 16.5153 7.53085\r\n        16.2476 7.08151 15.843C7.07154 15.8341 7.06149 15.825 7.05137 15.8159C6.50873 15.3209 5.72809 14.7076 4.55713\r\n        14.7076V16.5907C5.13785 16.5907 5.54721 16.8704 6.01369 17.2901C6.02002 17.2959 6.02638 17.3017 6.03274\r\n        17.3075C6.57175 17.7993 7.22832 18.3985 8.50792 18.3985C9.79312 18.3985 10.4786 17.7851 11.0212 17.2901L11.0336\r\n        17.279C11.4931 16.8655 11.7986 16.5907 12.4968 16.5907C13.195 16.5907 13.5005 16.8655 13.96 17.279L13.9724\r\n        17.2901C14.515 17.7851 15.191 18.3985 16.4857 18.3985C17.7627 18.3985 18.4382 17.7929 18.9884 17.2996L18.999\r\n        17.2901C19.4559 16.8704 19.7606 16.5907 20.465 16.5907C21.1455 16.5907 21.4352 16.8517 21.8746 17.2478C21.8901\r\n        17.2617 21.9057 17.2758 21.9216 17.2901Z\" fill=\"#009FD4\"/>\r\n        <defs>\r\n        <filter id=\"filter0_f\" x=\"1.70898\" y=\"13.1738\" width=\"41.8838\" height=\"35.0816\" filterUnits=\"userSpaceOnUse\"\r\n        color-interpolation-filters=\"sRGB\">\r\n        <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\"/>\r\n        <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\"/>\r\n        <feGaussianBlur stdDeviation=\"4\" result=\"effect1_foregroundBlur\"/>\r\n        </filter>\r\n        </defs>\r\n        </svg>\r\n        `;\r\n  }\r\n\r\n  static getSnowSvg(isSelected: boolean) {\r\n    return `<svg width=\"44\" height=\"49\" viewBox=\"0 0 44 49\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n        <g filter=\"url(#filter0_f)\">\r\n        <ellipse cx=\"22.6509\" cy=\"30.7147\" rx=\"11.7128\" ry=\"5.55783\" transform=\"rotate(-22 22.6509 30.7147)\"\r\n        fill=\"#222222\" fill-opacity=\"0.5\"/>\r\n        </g>\r\n        <path d=\"M16.2064 36.6548L16.2167 36.6438L16.2264 36.6322C17.0774 35.6109 18.1068 34.2426 19.313 32.5314C20.5211\r\n        30.8176 21.7424 28.9786 22.977 27.0144C24.2251 25.0289 25.2879 22.9028 26.1659 20.637C27.0471 18.3628 27.5 16.3143\r\n        27.5 14.5C27.5 10.901 26.2317 7.82326 23.7042 5.29578C21.1767 2.76829 18.099 1.5 14.5 1.5C10.901 1.5 7.82326 2.76829\r\n        5.29578 5.29578C2.76829 7.82326 1.5 10.901 1.5 14.5C1.5 16.3162 1.96777 18.3934 2.87649 20.722C3.77997 23.0372\r\n        4.78458 25.1184 5.89172 26.9636C6.99252 28.7983 8.27499 30.6864 9.73828 32.6281C11.1911 34.5559 12.2079 35.8559\r\n        12.7804 36.5143C13.3394 37.1571 13.7859 37.6734 14.1204 38.0636L14.4826 38.4863L14.8641 38.0809L16.2064 36.6548Z\"\r\n        fill=\"white\" stroke=\"#6996A3\" ${isSelected ? 'stroke-width=\"2\"' : ''}/>\r\n        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M21.2733 16.4665L19.7322 16.7602L21.4486 17.7126C21.5901 17.7897\r\n        21.6809 17.9039 21.7209 18.0552C21.7609 18.2065 21.7409 18.3504 21.6609 18.4869C21.5748 18.6234 21.4548 18.7109\r\n        21.301 18.7495C21.1472 18.7881 20.9996 18.7688 20.8581 18.6916L19.1417 17.7482L19.6492 19.1723C19.7292 19.3978\r\n        19.6923 19.5861 19.5385 19.7375C19.3847 19.8888 19.1986 19.9496 18.9802 19.9199C18.7618 19.8903 18.6126 19.7656\r\n        18.5326 19.5461L17.5914 16.8759L15.0906 15.4874V18.2733L17.01 20.3917C17.1084 20.4985 17.1607 20.6142 17.1669\r\n        20.7388C17.173 20.8634 17.1392 20.9717 17.0654 21.0637C16.9915 21.1556 16.9039 21.2298 16.8024 21.2862C16.7009\r\n        21.3425 16.5871 21.3589 16.4609 21.3351C16.3348 21.3114 16.2226 21.2461 16.1241 21.1393L15.0906 20V21.9048C15.0906\r\n        22.0591 15.0321 22.1926 14.9153 22.3053C14.7984 22.418 14.66 22.4744 14.5 22.4744C14.34 22.4744 14.2016 22.418\r\n        14.0847 22.3053C13.9679 22.1926 13.9094 22.0591 13.9094 21.9048V20L12.8759 21.1393C12.7775 21.2461 12.6652 21.3114\r\n        12.5391 21.3351C12.4129 21.3589 12.2991 21.3425 12.1976 21.2862C12.0961 21.2298 12.0085 21.1556 11.9346\r\n        21.0637C11.8608 20.9717 11.827 20.8634 11.8331 20.7388C11.8393 20.6142 11.8916 20.4985 11.99 20.3917L13.9094\r\n        18.2733V15.4874L11.4086 16.8759L10.4674 19.5461C10.3874 19.7656 10.2382 19.8903 10.0198 19.9199C9.80144 19.9496\r\n        9.61534 19.8888 9.46154 19.7375C9.30774 19.5861 9.27083 19.3978 9.35081 19.1723L9.85835 17.7482L8.14195\r\n        18.6916C8.00045 18.7688 7.85281 18.7881 7.69901 18.7495C7.54521 18.7109 7.42524 18.6234 7.33912 18.4869C7.25914\r\n        18.3504 7.23915 18.2065 7.27913 18.0552C7.31912 17.9039 7.40986 17.7897 7.55136 17.7126L9.26776 16.7602L7.72669\r\n        16.4665C7.54828 16.4309 7.41909 16.3448 7.33912 16.2083C7.25914 16.0719 7.23299 15.9339 7.26068 15.7945C7.28836\r\n        15.655 7.3668 15.5363 7.49599 15.4384C7.62518 15.3405 7.77898 15.3094 7.95739 15.345L10.8181 15.8968L13.3188\r\n        14.4994L10.8181 13.102L7.95739 13.6539C7.93278 13.6598 7.89279 13.6628 7.83742 13.6628C7.67132 13.6628 7.53598\r\n        13.6093 7.4314 13.5025C7.32681 13.3957 7.26837 13.2771 7.25606 13.1465C7.24376 13.016 7.2776 12.8884 7.35757\r\n        12.7638C7.43755 12.6392 7.56059 12.562 7.72669 12.5324L9.26776 12.2386L7.55136 11.2863C7.40986 11.2091 7.31912\r\n        11.0949 7.27913 10.9436C7.23915 10.7923 7.25914 10.6484 7.33912 10.5119C7.41909 10.3754 7.53905 10.2864 7.69901\r\n        10.2449C7.85896 10.2034 8.0066 10.2241 8.14195 10.3072L9.85835 11.2507L9.35081 9.82656C9.27083 9.60108 9.30774\r\n        9.41268 9.46154 9.26137C9.61534 9.11006 9.80144 9.04924 10.0198 9.07891C10.2382 9.10858 10.3874 9.23318 10.4674\r\n        9.45273L11.4086 12.1229L13.9094 13.5114V10.7255L11.99 8.60717C11.8916 8.50036 11.8393 8.38465 11.8331\r\n        8.26005C11.827 8.13543 11.8608 8.02714 11.9346 7.93517C12.0085 7.8432 12.0961 7.76902 12.1976 7.71265C12.2991\r\n        7.65628 12.4129 7.63997 12.5391 7.6637C12.6652 7.68743 12.7775 7.75271 12.8759 7.85951L13.9094 8.9988V7.09406C13.9094\r\n        6.93978 13.9679 6.80627 14.0847 6.69353C14.2016 6.58079 14.34 6.52441 14.5 6.52441C14.66 6.52441 14.7984 6.58079\r\n        14.9153 6.69353C15.0321 6.80627 15.0906 6.93978 15.0906 7.09406V8.9988L16.1241 7.85951C16.2226 7.75271\r\n        16.3348 7.68743 16.4609 7.6637C16.5871 7.63997 16.7009 7.65628 16.8024 7.71265C16.9039 7.76902 16.9915\r\n        7.8432 17.0654 7.93517C17.1392 8.02714 17.173 8.13543 17.1669 8.26005C17.1607 8.38465 17.1084 8.50036\r\n        17.01 8.60717L15.0906 10.7255V13.5114L17.5914 12.1229L18.5326 9.45273C18.6126 9.23318 18.7618 9.10858\r\n        18.9802 9.07891C19.1986 9.04924 19.3847 9.11006 19.5385 9.26137C19.6923 9.41268 19.7292 9.60108 19.6492\r\n        9.82656L19.1417 11.2507L20.8581 10.3072C20.9996 10.2301 21.1472 10.2108 21.301 10.2493C21.4548 10.2879\r\n        21.5748 10.3754 21.6609 10.5119C21.7409 10.6484 21.7609 10.7923 21.7209 10.9436C21.6809 11.0949 21.5901\r\n        11.2091 21.4486 11.2863L19.7322 12.2386L21.2733 12.5324C21.4394 12.562 21.5625 12.6392 21.6424 12.7638C21.7224\r\n        12.8884 21.7562 13.016 21.7439 13.1465C21.7316 13.2771 21.6732 13.3957 21.5686 13.5025C21.464 13.6093 21.3287\r\n        13.6628 21.1626 13.6628C21.1072 13.6628 21.0672 13.6598 21.0426 13.6539L18.1819 13.102L15.6812 14.4994L18.1819\r\n        15.8968L21.0426 15.345C21.221 15.3094 21.3748 15.3405 21.504 15.4384C21.6332 15.5363 21.7116 15.655 21.7393\r\n        15.7945C21.767 15.9339 21.7409 16.0719 21.6609 16.2083C21.5809 16.3448 21.4517 16.4309 21.2733 16.4665Z\"\r\n        fill=\"#009FD4\"/>\r\n        <defs>\r\n        <filter id=\"filter0_f\" x=\"1.70898\" y=\"13.1738\" width=\"41.8838\" height=\"35.0816\" filterUnits=\"userSpaceOnUse\"\r\n        color-interpolation-filters=\"sRGB\">\r\n        <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\"/>\r\n        <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\"/>\r\n        <feGaussianBlur stdDeviation=\"4\" result=\"effect1_foregroundBlur\"/>\r\n        </filter>\r\n        </defs>\r\n        </svg>\r\n        `;\r\n  }\r\n\r\n  redraw() {\r\n    this.options.html = RegobsGeoHazardMarker.getIconSvg(\r\n      this._geoHazard,\r\n      this._selected\r\n    );\r\n  }\r\n\r\n  setGeoHazard(geoHazard: GeoHazard) {\r\n    this._geoHazard = geoHazard;\r\n    this.redraw();\r\n  }\r\n\r\n  setSelected(selected: boolean) {\r\n    this._selected = selected;\r\n    this.redraw();\r\n  }\r\n}\r\n","import * as L from 'leaflet';\r\nimport { BorderHelper } from '../../../../core/helpers/leaflet/border-helper';\r\nimport { Feature, GeometryObject } from '@turf/turf';\r\nimport { OfflineTilesRegistry } from 'src/app/core/services/offline-map/offline-tiles-registry';\r\nimport { LoggingService } from 'src/app/modules/shared/services/logging/logging.service';\r\n\r\nconst DEBUG_TAG = 'RegObsOfflineAwareTileLayer';\r\n\r\nexport interface IRegObsTileLayerOptions extends L.TileLayerOptions {\r\n  edgeBufferTiles?: number;\r\n  excludeBounds?: Feature<GeometryObject>;\r\n}\r\n\r\nexport class RegObsTileLayer extends L.TileLayer {\r\n\r\n  constructor(\r\n    url: string,\r\n    options: IRegObsTileLayerOptions\r\n  ) {\r\n    super(url, options);\r\n  }\r\n\r\n  _isValidTile(coords: L.Coords) {\r\n    const valid = (<any>L.GridLayer.prototype)._isValidTile.call(this, coords);\r\n    if (!valid) {\r\n      return false;\r\n    }\r\n    if ((<IRegObsTileLayerOptions>this.options).excludeBounds) {\r\n      const tileBounds = (<any>L.GridLayer.prototype)._tileCoordsToBounds.call(\r\n        this,\r\n        coords\r\n      );\r\n      return !BorderHelper.isInside(\r\n        tileBounds,\r\n        (<IRegObsTileLayerOptions>this.options).excludeBounds\r\n      );\r\n    }\r\n    return true;\r\n  }\r\n}\r\n\r\nexport class RegObsOfflineAwareTileLayer extends RegObsTileLayer {\r\n  constructor(\r\n    private mapType: string,\r\n    url: string,\r\n    options: IRegObsTileLayerOptions,\r\n    private offlineTilesRegistry: OfflineTilesRegistry,\r\n    private loggingService: LoggingService\r\n  ) {\r\n    super(url, options);\r\n  }\r\n\r\n  canUseOfflineTiles(coords: L.Coords) {\r\n    const offlineTiles = this.offlineTilesRegistry.findRegisteredPackage(this.mapType, coords.x, coords.y, coords.z);\r\n    if (offlineTiles != null) {\r\n      if (offlineTiles.zMin <= coords.z && coords.z <= offlineTiles.zMax) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  _isValidTile(coords: L.Coords) {\r\n    const valid = super._isValidTile(coords);\r\n    if (valid && this.canUseOfflineTiles(coords)) {\r\n      this.loggingService.debug(`Using offline tiles for ${this.mapType} - ${coords.x},${coords.y},${coords.z}`, DEBUG_TAG);\r\n      return false;\r\n    }\r\n    return valid;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { MapComponent } from './components/map/map.component';\r\nimport { LeafletModule } from '@asymmetrik/ngx-leaflet';\r\nimport { MapControlsComponent } from './components/map-controls/map-controls.component';\r\nimport { MapSearchComponent } from './components/map-controls/map-search/map-search.component';\r\nimport { FullscreenToggleComponent } from './components/map-controls/fullscreen-toggle/fullscreen-toggle.component';\r\nimport { GpsCenterComponent } from './components/map-controls/gps-center/gps-center.component';\r\nimport { MapCenterInfoComponent } from './components/map-center-info/map-center-info.component';\r\nimport { ModalSearchPageModule } from './pages/modal-search/modal-search.module';\r\nimport { LeafletEdgeBufferModule } from 'ngx-leaflet-edgebuffer';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { AngularSvgIconModule } from 'angular-svg-icon';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { RouterModule } from '@angular/router';\r\nimport { ModalMapImagePageModule } from './pages/modal-map-image/modal-map-image.module';\r\nimport { SupportMapInfoPageModule } from './pages/support-map-info/support-map-info.module';\r\nimport { MapImageModule } from '../map-image/map-image.module';\r\nimport { SharedModule } from '../shared/shared.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    IonicModule,\r\n    AngularSvgIconModule,\r\n    TranslateModule,\r\n    RouterModule,\r\n    LeafletModule,\r\n    LeafletEdgeBufferModule,\r\n    ModalSearchPageModule,\r\n    ModalMapImagePageModule,\r\n    SupportMapInfoPageModule,\r\n    MapImageModule,\r\n    SharedModule\r\n  ],\r\n  declarations: [\r\n    MapComponent,\r\n    MapControlsComponent,\r\n    MapSearchComponent,\r\n    FullscreenToggleComponent,\r\n    GpsCenterComponent,\r\n    MapCenterInfoComponent\r\n  ],\r\n  exports: [\r\n    MapComponent,\r\n    MapControlsComponent,\r\n    MapSearchComponent,\r\n    FullscreenToggleComponent,\r\n    GpsCenterComponent,\r\n    MapCenterInfoComponent,\r\n    ModalSearchPageModule,\r\n    ModalMapImagePageModule,\r\n    SupportMapInfoPageModule\r\n  ]\r\n})\r\nexport class MapModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { ModalMapImagePage } from './modal-map-image.page';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { LeafletModule } from '@asymmetrik/ngx-leaflet';\r\nimport { MapImageModule } from '../../../map-image/map-image.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    TranslateModule,\r\n    LeafletModule,\r\n    MapImageModule\r\n  ],\r\n  declarations: [ModalMapImagePage],\r\n  entryComponents: [ModalMapImagePage]\r\n})\r\nexport class ModalMapImagePageModule {}\r\n","import { Component, OnInit, Input } from '@angular/core';\r\nimport { GeoHazard } from '@varsom-regobs-common/core';\r\nimport { ModalController } from '@ionic/angular';\r\n\r\n@Component({\r\n  selector: 'app-modal-map-image',\r\n  templateUrl: './modal-map-image.page.html',\r\n  styleUrls: ['./modal-map-image.page.scss']\r\n})\r\nexport class ModalMapImagePage implements OnInit {\r\n  @Input() location: { latLng: L.LatLng; geoHazard: GeoHazard };\r\n\r\n  constructor(private modalController: ModalController) {}\r\n\r\n  ngOnInit() {}\r\n\r\n  close() {\r\n    this.modalController.dismiss();\r\n  }\r\n}\r\n","<ion-content (click)=\"close()\">\r\n  <app-map-image [location]=\"location\" [allowZoom]=\"true\"></app-map-image>\r\n</ion-content>","import { NgModule } from '@angular/core';\r\nimport { ModalSearchPage } from './modal-search.page';\r\nimport { ReactiveFormsModule, FormsModule } from '@angular/forms';\r\nimport { CommonModule } from '@angular/common';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { StartsWithHighlightPipe } from '../../pipes/starts-with-highlight.pipe';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    IonicModule,\r\n    TranslateModule\r\n  ],\r\n  declarations: [ModalSearchPage, StartsWithHighlightPipe],\r\n  entryComponents: [ModalSearchPage]\r\n})\r\nexport class ModalSearchPageModule {}\r\n","<ion-header>\r\n  <ion-toolbar mode=\"ios\">\r\n    <form (ngSubmit)=\"doSearch()\">\r\n      <ion-list lines=\"none\" class=\"ion-no-padding ion-no-margin\">\r\n        <ion-item>\r\n          <ion-icon slot=\"start\" name=\"search\"></ion-icon>\r\n          <ion-input placeholder=\"{{'MAP_SEARCH.SEARCH_TEXT'|translate}}\" [formControl]=\"searchField\"\r\n            (ionInputDidLoad)=\"focusInput($event)\" (ionBlur)=\"doSearch()\"></ion-input>\r\n          <ion-icon slot=\"end\" name=\"close\" (click)=\"closeModal()\"></ion-icon>\r\n        </ion-item>\r\n      </ion-list>\r\n    </form>\r\n  </ion-toolbar>\r\n</ion-header>\r\n<ion-content>\r\n  <ion-list *ngIf=\"searchResult$ | async as searchResults\" lines=\"full\" class=\"search-result\">\r\n    <ion-item *ngFor=\"let item of searchResults\" (click)=\"searchItemClicked(item)\">\r\n      <ion-label>\r\n        <ion-text class=\"search-result-name\" [innerHTML]=\"item.name | startsWithHighlight:searchText\"></ion-text>\r\n        <ion-text color=\"medium\" class=\"search-description\">{{item.description}}</ion-text>\r\n      </ion-label>\r\n    </ion-item>\r\n  </ion-list>\r\n  <ng-container *ngIf=\"searchHistory$ | async as searchHistory\">\r\n    <ion-list *ngIf=\"!hasResults && !loading && searchHistory.length > 0\" lines=\"full\" class=\"search-result\">\r\n      <ion-list-header class=\"ion-text-uppercase\">\r\n        <ion-label>{{'MAP_SEARCH.SEARCH_HISTORY_HEADER' | translate}}</ion-label>\r\n      </ion-list-header>\r\n      <ion-item *ngFor=\"let item of searchHistory\" (click)=\"searchItemClicked(item)\">\r\n        <ion-icon slot=\"start\" mode=\"md\" name=\"time\"></ion-icon>\r\n        <ion-label>\r\n          <ion-text class=\"search-result-name\">{{item.name}}</ion-text>\r\n          <ion-text color=\"medium\" class=\"search-description\">{{item.description}}</ion-text>\r\n        </ion-label>\r\n      </ion-item>\r\n    </ion-list>\r\n  </ng-container>\r\n</ion-content>","import { Component, OnInit, NgZone, Renderer2, OnDestroy } from '@angular/core';\r\nimport { ModalController, IonInput, DomController } from '@ionic/angular';\r\nimport { MapSearchService } from '../../services/map-search/map-search.service';\r\nimport { Observable } from 'rxjs';\r\nimport { MapSearchResponse } from '../../services/map-search/map-search-response.model';\r\nimport { FormControl } from '@angular/forms';\r\nimport {\r\n  debounceTime,\r\n  distinctUntilChanged,\r\n  switchMap,\r\n  tap\r\n} from 'rxjs/operators';\r\nimport * as L from 'leaflet';\r\nimport { NumberHelper } from '../../../../core/helpers/number-helper';\r\nimport { createGesture, GestureDetail, Gesture } from '@ionic/core';\r\n\r\nconst SWIPE_BOUNDRY = 0.3; // More than 30% swipe to right will close modal\r\n\r\n@Component({\r\n  selector: 'app-modal-search',\r\n  templateUrl: './modal-search.page.html',\r\n  styleUrls: ['./modal-search.page.scss']\r\n})\r\nexport class ModalSearchPage implements OnInit, OnDestroy {\r\n  searchText: string;\r\n  searchResult$: Observable<MapSearchResponse[]>;\r\n  searchField: FormControl;\r\n  loading: boolean;\r\n  hasResults: boolean;\r\n  searchHistory$: Observable<MapSearchResponse[]>;\r\n\r\n  private modalPageWrapper: Element;\r\n  private modalTop: HTMLIonModalElement;\r\n  private swipeOffset = 0;\r\n  private swipePercentage = 0;\r\n  private gesture: Gesture;\r\n\r\n  constructor(\r\n    private modalController: ModalController,\r\n    private mapSearchService: MapSearchService,\r\n    private ngZone: NgZone,\r\n    private renderer: Renderer2,\r\n    private domCtrl: DomController\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.searchField = new FormControl();\r\n    this.searchHistory$ = this.mapSearchService.getSearchHistoryAsObservable();\r\n    const searchTextObservable = this.searchField.valueChanges.pipe(\r\n      debounceTime(400),\r\n      distinctUntilChanged()\r\n    );\r\n\r\n    this.searchResult$ = searchTextObservable.pipe(\r\n      tap((val) => {\r\n        this.ngZone.run(() => {\r\n          this.loading = true;\r\n          this.hasResults = false;\r\n          this.searchText = val;\r\n        });\r\n      }),\r\n      switchMap((searchValue: string) =>\r\n        this.mapSearchService.searchAll(searchValue)\r\n      ),\r\n      tap((values) => {\r\n        this.ngZone.run(() => {\r\n          this.hasResults = values.length > 0;\r\n          this.loading = false;\r\n        });\r\n      })\r\n    );\r\n\r\n    this.createGesture();\r\n  }\r\n\r\n  doSearch() {\r\n    const validLatLng = this.isValidLatLng(this.searchText);\r\n    if (validLatLng) {\r\n      this.mapSearchService.mapSearchItemSelected = validLatLng;\r\n      this.closeModal();\r\n    }\r\n  }\r\n\r\n  private async createGesture() {\r\n    this.modalTop = await this.modalController.getTop();\r\n    this.gesture = createGesture({\r\n      el: this.modalTop,\r\n      gestureName: 'swipe-to-close',\r\n      direction: 'x',\r\n      disableScroll: true,\r\n      onMove: (ev) => this.onMoveHandler(ev),\r\n      onEnd: (ev) => this.onPanend()\r\n    });\r\n\r\n    this.gesture.enable();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.gesture.destroy();\r\n  }\r\n\r\n  isValidLatLng(searchValue: string) {\r\n    if (searchValue && searchValue.length > 0) {\r\n      const separators = [',', ' '];\r\n      for (const sep of separators) {\r\n        const isValidLatLng = this.isValidLatLngArray(searchValue.split(sep));\r\n        if (isValidLatLng) {\r\n          return isValidLatLng;\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  isValidLatLngArray(searchValue: string[]) {\r\n    if (searchValue && searchValue.length === 2) {\r\n      const trimmedLatString = this.trimAndReplaceString(searchValue[0]);\r\n      const trimmedLngString = this.trimAndReplaceString(searchValue[1]);\r\n      if (\r\n        trimmedLatString &&\r\n        trimmedLatString.length > 0 &&\r\n        trimmedLngString &&\r\n        trimmedLngString.length > 0 &&\r\n        NumberHelper.isNumeric(trimmedLatString) &&\r\n        NumberHelper.isNumeric(trimmedLngString)\r\n      ) {\r\n        const lat = parseFloat(trimmedLatString);\r\n        const lng = parseFloat(trimmedLngString);\r\n        if (lat > -90 && lat < 90 && lng > -180 && lng < 180) {\r\n          return L.latLng(lat, lng);\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private trimAndReplaceString(input: string) {\r\n    if (input === undefined || input === null) {\r\n      return input;\r\n    }\r\n    return input.trim().replace(/,/g, '.');\r\n  }\r\n\r\n  focusInput(event: Event) {\r\n    const input: IonInput = <any>event.target;\r\n    setTimeout(() => {\r\n      (<any>input).setFocus();\r\n    }, 1000);\r\n  }\r\n\r\n  closeModal() {\r\n    this.modalController.dismiss();\r\n  }\r\n\r\n  searchItemClicked(item: MapSearchResponse) {\r\n    this.mapSearchService.mapSearchItemSelected = item;\r\n    this.closeModal();\r\n  }\r\n\r\n  onMoveHandler(ev: GestureDetail): boolean | void {\r\n    const width = this.modalTop.offsetWidth;\r\n    if (width > 0) {\r\n      this.swipeOffset = Math.max(ev.deltaX, 0);\r\n      this.swipePercentage = this.swipeOffset / width;\r\n      if (this.swipePercentage < SWIPE_BOUNDRY) {\r\n        this.setPageSwipeAttributes();\r\n      } else {\r\n        this.closeModal();\r\n      }\r\n    }\r\n  }\r\n\r\n  setPageSwipeAttributes() {\r\n    if (this.modalTop) {\r\n      this.domCtrl.write(() => {\r\n        const opacity = 1.0 - this.swipePercentage;\r\n        this.renderer.setAttribute(\r\n          this.modalTop,\r\n          'data-offset-x',\r\n          this.swipeOffset.toString()\r\n        );\r\n        this.renderer.setAttribute(this.modalTop, 'data-opacity', `${opacity}`);\r\n        this.renderer.setStyle(\r\n          this.modalTop,\r\n          'transform',\r\n          `translateX(${this.swipeOffset}px)`\r\n        );\r\n        this.renderer.setStyle(this.modalTop, 'opacity', `${opacity}`);\r\n      });\r\n    }\r\n  }\r\n\r\n  onPanend() {\r\n    if (this.swipePercentage < SWIPE_BOUNDRY) {\r\n      this.swipeOffset = 0;\r\n      this.swipePercentage = 0;\r\n      this.setPageSwipeAttributes();\r\n    }\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { SupportMapInfoPage } from './support-map-info.page';\r\nimport { SharedModule } from '../../../shared/shared.module';\r\n\r\n@NgModule({\r\n  imports: [SharedModule],\r\n  declarations: [SupportMapInfoPage],\r\n  entryComponents: [SupportMapInfoPage],\r\n  exports: [SupportMapInfoPage]\r\n})\r\nexport class SupportMapInfoPageModule {}\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { ModalController } from '@ionic/angular';\r\n\r\n@Component({\r\n  selector: 'app-support-map-info',\r\n  templateUrl: './support-map-info.page.html',\r\n  styleUrls: ['./support-map-info.page.scss']\r\n})\r\nexport class SupportMapInfoPage implements OnInit {\r\n  constructor(private modalController: ModalController) {}\r\n\r\n  ngOnInit() {}\r\n\r\n  close() {\r\n    this.modalController.dismiss();\r\n  }\r\n}\r\n","<ion-header>\r\n  <ion-toolbar appHeaderColor mode=\"ios\">\r\n    <ion-buttons slot=\"end\">\r\n      <ion-button (click)=\"close()\">{{ 'DIALOGS.OK' | translate }}</ion-button>\r\n    </ion-buttons>\r\n    <ion-title>\r\n      {{ 'SUPPORT_MAP.ABOUT' | translate }}\r\n    </ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n<ion-content class=\"ion-padding\" [innerHTML]=\"'SUPPORT_MAP.INFO_PAGE' | translate\">\r\n\r\n</ion-content>","import { Pipe, PipeTransform } from '@angular/core';\r\nimport { DomSanitizer, SafeHtml } from '@angular/platform-browser';\r\n\r\n@Pipe({\r\n  name: 'startsWithHighlight'\r\n})\r\nexport class StartsWithHighlightPipe implements PipeTransform {\r\n  constructor(private sanitizer: DomSanitizer) {}\r\n\r\n  transform(value: string, args?: string): SafeHtml {\r\n    const result = args\r\n      ? value.replace(new RegExp('(' + args + ')', 'gi'), '<strong>$1</strong>')\r\n      : value;\r\n    return this.sanitizer.bypassSecurityTrustHtml(result);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { settings } from '../../../../../settings';\r\nimport { MapSearchResponse } from './map-search-response.model';\r\nimport * as L from 'leaflet';\r\nimport { map, switchMap, catchError, take } from 'rxjs/operators';\r\nimport { Observable, forkJoin, of, Subject } from 'rxjs';\r\nimport { ViewInfo } from './view-info.model';\r\nimport { UserSettingService } from '../../../../core/services/user-setting/user-setting.service';\r\nimport { LangKey, GeoHazard } from '@varsom-regobs-common/core';\r\nimport { GeoCodeService } from '@varsom-regobs-common/regobs-api';\r\nimport { NanoSql } from '../../../../../nanosql';\r\nimport { MapSearchHistory } from './map-search-history.model';\r\nimport moment from 'moment';\r\nimport { IMapView } from '../map/map-view.interface';\r\nimport { Navn, ReturSkrivemate } from './norwegian-search-result.model';\r\nimport { WorldSearchResultModel } from './world-search-result.model';\r\nimport { nSQL } from '@nano-sql/core';\r\nimport { NSqlFullUpdateObservable } from '../../../../core/helpers/nano-sql/NSqlFullUpdateObservable';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MapSearchService {\r\n  private _mapSearchItemClickSubject: Subject<MapSearchResponse | L.LatLng>;\r\n  private _mapSearchItemClickObservable: Observable<MapSearchResponse | L.LatLng>;\r\n\r\n  get mapSearchClick$(): Observable<MapSearchResponse | L.LatLng> {\r\n    return this._mapSearchItemClickObservable;\r\n  }\r\n\r\n  set mapSearchItemSelected(item: MapSearchResponse | L.LatLng) {\r\n    this._mapSearchItemClickSubject.next(item);\r\n  }\r\n\r\n  constructor(\r\n    private httpClient: HttpClient,\r\n    private userSettingService: UserSettingService,\r\n    private geoCodeService: GeoCodeService\r\n  ) {\r\n    this._mapSearchItemClickSubject = new Subject<\r\n      MapSearchResponse | L.LatLng\r\n    >();\r\n    this._mapSearchItemClickObservable = this._mapSearchItemClickSubject.asObservable();\r\n    this._mapSearchItemClickObservable.subscribe((item) => {\r\n      if (!(item instanceof L.LatLng)) {\r\n        this.saveSearchHistoryToDb(item as MapSearchResponse);\r\n      }\r\n    });\r\n  }\r\n\r\n  searchAll(text: string): Observable<MapSearchResponse[]> {\r\n    return this.userSettingService.language$.pipe(\r\n      switchMap((language) =>\r\n        forkJoin([\r\n          this.searchNorwegianPlaces(text, language),\r\n          this.searchWorld(text, language)\r\n        ]).pipe(map(([s1, s2]) => [...s1, ...s2]))\r\n      )\r\n    );\r\n  }\r\n\r\n  searchNorwegianPlaces(\r\n    text: string,\r\n    lang: LangKey\r\n  ): Observable<MapSearchResponse[]> {\r\n    return this.httpClient\r\n      .get(\r\n        `${settings.map.search.no.url}?sok=${text.trim()}*&treffPerSide=${settings.map.search.no.maxResults}`\r\n        + `&utkoordsys=${settings.map.search.no.coordinateSystem}&filtrer=${settings.map.search.no.resultFields}`\r\n      )\r\n      .pipe(\r\n        map((returSted: ReturSkrivemate) => {\r\n          const hits = returSted.metadata.totaltAntallTreff;\r\n          const resultList =\r\n            hits === 0\r\n              ? []\r\n              : hits === 1\r\n                ? [returSted.navn[0] as Navn]\r\n                : (returSted.navn as Array<Navn>);\r\n\r\n          return this.removeDuplicates(resultList).map((item) => {\r\n            const resp: MapSearchResponse = {\r\n              name: item.skrivemåte,\r\n              description: this.formatLocationDescription(item, lang),\r\n              type: item.navneobjekttype,\r\n              latlng: L.latLng(item.representasjonspunkt.nord, item.representasjonspunkt.øst)\r\n            };\r\n            return resp;\r\n          });\r\n        }),\r\n        catchError(() => of([]))\r\n      );\r\n  }\r\n\r\n  formatLocationDescription(item: Navn, lang: LangKey): string {\r\n    const nameType = item.navneobjekttype;\r\n    const norwegian = lang === LangKey.nb || lang === LangKey.nn;\r\n    const county = item.fylker[0]?.fylkesnavn;\r\n    if (item.kommuner.length !== 1 || nameType === 'Kommune') {\r\n      if (norwegian) {\r\n        return `${nameType}, ${county}`;\r\n      }\r\n      return county;\r\n    }\r\n    if (item.fylker.length !== 1 || nameType === 'Fylke') {\r\n      if (norwegian) {\r\n        return `${nameType}`;\r\n      }\r\n      return '';\r\n    }\r\n    const municipality = item.kommuner[0]?.kommunenavn;\r\n    if (norwegian) {\r\n      return `${nameType}, ${municipality} (${county})`;\r\n    }\r\n    return `${municipality} (${county})`;\r\n  }\r\n\r\n  private removeDuplicates(data: Navn[]): Navn[] {\r\n    return (data || []).reduce((acc, currentValue) => {\r\n      if (\r\n        acc.filter((item) => item.stedsnummer === currentValue.stedsnummer)\r\n          .length === 0\r\n      ) {\r\n        acc.push(currentValue);\r\n      }\r\n      return acc;\r\n    }, []);\r\n  }\r\n\r\n  searchWorld(text: string, lang: LangKey): Observable<MapSearchResponse[]> {\r\n    return this.httpClient\r\n      .get(\r\n        `${settings.map.search.geonames.url}/searchJSON?` +\r\n          `name_startsWith=${text}&maxRows=${settings.map.search.geonames.maxResults}` +\r\n          `&lang=${LangKey[lang]}` +\r\n          `&username=${settings.map.search.geonames.username}`\r\n      )\r\n      .pipe(\r\n        map((data: WorldSearchResultModel) => {\r\n          const geoData = data.geonames || [];\r\n          return geoData\r\n            .filter((item) => item.countryCode !== 'NO')\r\n            .map((item) => {\r\n              const resp: MapSearchResponse = {\r\n                name: item.name,\r\n                description:\r\n                  (item.fcodeName ? item.fcodeName + ', ' : '') +\r\n                  (item.adminName1 || '') +\r\n                  (item.countryName ? ' (' + item.countryName + ')' : ''),\r\n                type: '',\r\n                latlng: L.latLng(parseFloat(item.lat), parseFloat(item.lng))\r\n              };\r\n              return resp;\r\n            });\r\n        }),\r\n        catchError(() => of([]))\r\n      );\r\n  }\r\n\r\n  getViewInfo(\r\n    mapView: IMapView,\r\n    geoHazard = GeoHazard.Soil\r\n  ): Observable<ViewInfo> {\r\n    const latLng = mapView.center;\r\n    return this.geoCodeService\r\n      .GeoCodeLocationInfo({\r\n        latitude: latLng.lat,\r\n        longitude: latLng.lng,\r\n        geoHazardId: geoHazard\r\n      })\r\n      .pipe(\r\n        map((result) => ({\r\n          location: {\r\n            name: result.Name,\r\n            adminName: result.WarningRegionName || result.AdminAreaName\r\n          },\r\n          elevation: result.Masl,\r\n          steepness: result.Steepness,\r\n          latLng: latLng\r\n        })),\r\n        catchError(() => of(null))\r\n      );\r\n  }\r\n\r\n  private async saveSearchHistoryToDb(searchResult: MapSearchResponse) {\r\n    const existingHistory = (\r\n      await this.getSearchHistoryAsObservable().pipe(take(1)).toPromise()\r\n    ).filter(\r\n      (item) =>\r\n        !(\r\n          item.latlng.lat === searchResult.latlng.lat &&\r\n          item.latlng.lng === searchResult.latlng.lng\r\n        )\r\n    );\r\n    existingHistory.splice(0, 0, {\r\n      timestamp: moment().unix(),\r\n      ...searchResult\r\n    }); // Insert new search item at index 0\r\n    const items = existingHistory.slice(\r\n      0,\r\n      settings.map.search.searchHistorySize\r\n    ); // Keep only last 5 items\r\n    await nSQL(NanoSql.TABLES.MAP_SEARCH_HISTORY.name)\r\n      .query('upsert', { id: 'searchresults', items })\r\n      .exec();\r\n  }\r\n\r\n  getSearchHistoryAsObservable(): Observable<MapSearchHistory[]> {\r\n    return new NSqlFullUpdateObservable<\r\n      { id: string; items: MapSearchHistory[] }[]\r\n    >(\r\n      nSQL(NanoSql.TABLES.MAP_SEARCH_HISTORY.name).query('select').listen()\r\n    ).pipe(map((val) => (val.length > 0 ? val[0].items : [])));\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { IMapView } from './map-view.interface';\r\nimport { Observable, combineLatest, BehaviorSubject, Subject, of, concat } from 'rxjs';\r\nimport {\r\n  switchMap,\r\n  shareReplay,\r\n  debounceTime,\r\n  distinctUntilChanged,\r\n  tap,\r\n  pairwise,\r\n  map,\r\n  bufferWhen,\r\n  scan,\r\n  skipWhile,\r\n  take,\r\n  filter\r\n} from 'rxjs/operators';\r\nimport { IMapViewAndArea } from './map-view-and-area.interface';\r\nimport { UserSettingService } from '../../../../core/services/user-setting/user-setting.service';\r\nimport { LoggingService } from '../../../shared/services/logging/logging.service';\r\nimport { fromWorker } from 'observable-webworker';\r\nimport {\r\n  IRegionInViewInput,\r\n  IRegionInViewOutput\r\n} from '../../web-workers/region-in-view-models';\r\n\r\nconst DEBUG_TAG = 'MapService';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MapService {\r\n  private _mapViewAndAreaObservable: Observable<IMapViewAndArea>;\r\n  private _followModeSubject: BehaviorSubject<boolean>;\r\n  private _followModeObservable: Observable<boolean>;\r\n  private _centerMapToUserSubject: Subject<void>;\r\n  private _centerMapToUserObservable: Observable<void>;\r\n  private _mapViewSubject: Subject<IMapView>;\r\n  private _mapView$: Observable<IMapView>;\r\n  private _mapMoveStartSubject: any;\r\n  private _mapMoveStart$: Observable<IMapView>;\r\n  private _relevantMapChange$: Observable<IMapView>;\r\n\r\n  get mapView$(): Observable<IMapView> {\r\n    return this._mapView$;\r\n  }\r\n\r\n  get mapViewAndAreaObservable$(): Observable<IMapViewAndArea> {\r\n    return this._mapViewAndAreaObservable;\r\n  }\r\n\r\n  get relevantMapChange$(): Observable<IMapView> {\r\n    return this._relevantMapChange$;\r\n  }\r\n\r\n  get mapMoveStart$(): Observable<IMapView> {\r\n    return this._mapMoveStart$;\r\n  }\r\n\r\n  /**\r\n   * @return as relevantMapChange$, but starts with current mapView\r\n   */\r\n  get relevantMapChangeWithInitialView$(): Observable<IMapView> {\r\n    return concat(\r\n      this._mapView$.pipe(\r\n        filter((mapView) => mapView !== null),\r\n        take(1)\r\n      ),\r\n      this._relevantMapChange$\r\n    );\r\n  }\r\n\r\n  get followMode$(): Observable<boolean> {\r\n    return this._followModeObservable;\r\n  }\r\n\r\n  get centerMapToUser$(): Observable<void> {\r\n    return this._centerMapToUserObservable;\r\n  }\r\n\r\n  set followMode(val: boolean) {\r\n    this._followModeSubject.next(val);\r\n  }\r\n\r\n  constructor(\r\n    private userSettingService: UserSettingService,\r\n    private loggingService: LoggingService\r\n  ) {\r\n    this._followModeSubject = new BehaviorSubject<boolean>(true);\r\n    this._followModeObservable = this._followModeSubject\r\n      .asObservable()\r\n      .pipe(distinctUntilChanged(), shareReplay(1));\r\n    this._centerMapToUserSubject = new Subject<void>();\r\n    this._centerMapToUserObservable = this._centerMapToUserSubject\r\n      .asObservable()\r\n      .pipe(shareReplay(1));\r\n    this._mapViewSubject = new BehaviorSubject<IMapView>(null);\r\n    this._mapView$ = this._mapViewSubject.asObservable().pipe(\r\n      debounceTime(200),\r\n      tap((val) =>\r\n        this.loggingService.debug('MapView updated', DEBUG_TAG, val)\r\n      ),\r\n      shareReplay(1)\r\n    );\r\n    this._relevantMapChange$ = this.getMapViewThatHasRelevantChange();\r\n    this._mapMoveStartSubject = new BehaviorSubject<void>(null);\r\n    this._mapMoveStart$ = this._mapMoveStartSubject.asObservable();\r\n    this._mapViewAndAreaObservable = this.getMapViewAreaObservable();\r\n  }\r\n\r\n  centerMapToUser(): void {\r\n    this.followMode = true;\r\n    this._centerMapToUserSubject.next();\r\n  }\r\n\r\n  updateMapView(mapView: IMapView): void {\r\n    if (mapView) {\r\n      this._mapViewSubject.next(mapView);\r\n    }\r\n  }\r\n\r\n  sendMapMoveStart(): void {\r\n    this._mapMoveStartSubject.next(null);\r\n  }\r\n\r\n  private getMapMetersChanged() {\r\n    return this.mapView$.pipe(\r\n      debounceTime(500),\r\n      pairwise(),\r\n      map(([prev, next]) => {\r\n        if (!prev) {\r\n          return 9999;\r\n        }\r\n        return prev.center.distanceTo(next.center);\r\n      }),\r\n      scan((acc, val) => acc + val, 0)\r\n    );\r\n  }\r\n\r\n  private triggerWhenMetersReached(metersBuffer = 10) {\r\n    return this.getMapMetersChanged().pipe(\r\n      skipWhile((val) => {\r\n        return val < metersBuffer;\r\n      })\r\n    );\r\n  }\r\n\r\n  private getMapViewThatHasRelevantChange(metersBuffer = 10) {\r\n    return this.mapView$.pipe(\r\n      bufferWhen(() => this.triggerWhenMetersReached(metersBuffer)),\r\n      switchMap((buffer) =>\r\n        buffer.length > 0 && !!buffer[buffer.length - 1]\r\n          ? of(buffer[buffer.length - 1])\r\n          : this.mapView$.pipe(take(1))\r\n      ),\r\n      tap((val) =>\r\n        this.loggingService.debug(\r\n          'MapView has relevant change!',\r\n          DEBUG_TAG,\r\n          val\r\n        )\r\n      ),\r\n      shareReplay(1)\r\n    );\r\n  }\r\n\r\n  private getMapViewAreaObservable(): Observable<IMapViewAndArea> {\r\n    const currenteMapViewAndGeoHazards = combineLatest([\r\n      this.relevantMapChange$,\r\n      this.userSettingService.currentGeoHazard$\r\n    ]).pipe(\r\n      map(([mapView, geoHazards]) => ({\r\n        mapView,\r\n        bounds: [\r\n          mapView.bounds.getSouthWest().lng, // minx\r\n          mapView.bounds.getSouthWest().lat, // miny\r\n          mapView.bounds.getNorthEast().lng, // maxx\r\n          mapView.bounds.getNorthEast().lat // maxy\r\n        ],\r\n        center: { lat: mapView.center.lat, lng: mapView.center.lng },\r\n        geoHazards\r\n      }))\r\n    );\r\n\r\n    return currenteMapViewAndGeoHazards.pipe(\r\n      switchMap((cvg) =>\r\n        fromWorker<IRegionInViewInput, IRegionInViewOutput>(\r\n          () =>\r\n            new Worker(new URL('../../web-workers/region-in-view.worker', import.meta.url), {\r\n              type: 'module'\r\n            }),\r\n          currenteMapViewAndGeoHazards\r\n        ).pipe(\r\n          map((result) => ({\r\n            ...cvg.mapView,\r\n            ...result\r\n          }))\r\n        )\r\n      ),\r\n      tap((val) =>\r\n        this.loggingService.debug('MapViewArea changed', DEBUG_TAG, val)\r\n      ),\r\n      shareReplay(1)\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { CanDeactivate } from '@angular/router';\r\nimport { BasePage } from './base.page';\r\n\r\n@Injectable()\r\nexport class CanDeactivateRouteGuard implements CanDeactivate<BasePage> {\r\n  async canDeactivate(component: BasePage): Promise<boolean> {\r\n    return component.canLeave();\r\n  }\r\n}\r\n","import {\r\n  CanDeactivate,\r\n  ActivatedRouteSnapshot,\r\n  RouterStateSnapshot\r\n} from '@angular/router';\r\nimport { Injectable } from '@angular/core';\r\nimport { OverviewPage } from './overview/overview.page';\r\nimport { AlertController } from '@ionic/angular';\r\n// import { RegistrationService } from '../services/registration.service';\r\nimport { UserSettingService } from '../../../core/services/user-setting/user-setting.service';\r\nimport { ObsLocationPage } from './obs-location/obs-location.page';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { take } from 'rxjs/operators';\r\nimport { SyncStatus } from 'src/app/modules/common-registration/registration.models';\r\nimport { RegistrationService as CommonRegistrationService } from 'src/app/modules/common-registration/registration.services';\r\n\r\n@Injectable()\r\nexport class SaveAsDraftRouteGuard\r\nimplements CanDeactivate<OverviewPage | ObsLocationPage> {\r\n  constructor(\r\n    private alertController: AlertController,\r\n    private registrationService: CommonRegistrationService,\r\n    private userSettingService: UserSettingService,\r\n    private translateService: TranslateService\r\n  ) {}\r\n\r\n  async canDeactivate(\r\n    component: OverviewPage,\r\n    _: ActivatedRouteSnapshot,\r\n    __: RouterStateSnapshot,\r\n    nextState?: RouterStateSnapshot\r\n  ) {\r\n    if (\r\n      nextState &&\r\n      !this.isInWhitelist(nextState.url) &&\r\n      component.registration\r\n    ) {\r\n      const reg = await this.registrationService.getRegistrationById(\r\n        component.registration.id\r\n      );\r\n      if (reg && reg.syncStatus === SyncStatus.Draft) {\r\n        const save = await this.createAlert();\r\n        if (!save) {\r\n          await this.registrationService.deleteRegistrationFromOfflineStorage(\r\n            component.registration.id\r\n          );\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  isInWhitelist(url: string) {\r\n    const whiteList = ['registration/', 'my-observations'];\r\n    return whiteList.some((w) => url.indexOf(w) >= 0);\r\n  }\r\n\r\n  async createAlert() {\r\n    const translations = await this.translateService\r\n      .get([\r\n        'REGISTRATION.SAVE_ALERT.HEADER',\r\n        'REGISTRATION.SAVE_ALERT.MESSAGE',\r\n        'REGISTRATION.SAVE_ALERT.NO',\r\n        'REGISTRATION.SAVE_ALERT.YES'\r\n      ])\r\n      .toPromise();\r\n    const alert = await this.alertController.create({\r\n      header: translations['REGISTRATION.SAVE_ALERT.HEADER'],\r\n      message: translations['REGISTRATION.SAVE_ALERT.MESSAGE'],\r\n      buttons: [\r\n        {\r\n          text: translations['REGISTRATION.SAVE_ALERT.NO'],\r\n          role: 'cancel'\r\n        },\r\n        {\r\n          text: translations['REGISTRATION.SAVE_ALERT.YES']\r\n        }\r\n      ]\r\n    });\r\n    alert.present();\r\n    const result = await alert.onDidDismiss();\r\n    return result.role !== 'cancel';\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'registration/edit/:id',\r\n    loadChildren: () =>\r\n      import('./pages/overview/overview.module').then(\r\n        (m) => m.OverviewPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/set-time/:id',\r\n    loadChildren: () =>\r\n      import('./pages/set-time/set-time.module').then(\r\n        (m) => m.SetTimePageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/new/:geoHazard',\r\n    loadChildren: () =>\r\n      import('./pages/obs-location/obs-location.module').then(\r\n        (m) => m.ObsLocationPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/obs-location/:id',\r\n    loadChildren: () =>\r\n      import('./pages/obs-location/obs-location.module').then(\r\n        (m) => m.ObsLocationPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/group/:id',\r\n    loadChildren: () =>\r\n      import('./pages/group/group.module').then((m) => m.GroupPageModule)\r\n  },\r\n  {\r\n    path: 'registration/general-comment/:id',\r\n    loadChildren: () =>\r\n      import('./pages/general-comment/general-comment.module').then(\r\n        (m) => m.GeneralCommentPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/water/water-level/:id',\r\n    loadChildren: () =>\r\n      import('./pages/water/water-level/water-level.module').then(\r\n        (m) => m.WaterLevelPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/water/damage/:id',\r\n    loadChildren: () =>\r\n      import('./pages/water/damage/damage.module').then(\r\n        (m) => m.DamagePageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/ice/ice-cover/:id',\r\n    loadChildren: () =>\r\n      import('./pages/ice/ice-cover/ice-cover.module').then(\r\n        (m) => m.IceCoverPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/ice/ice-thickness/:id',\r\n    loadChildren: () =>\r\n      import('./pages/ice/ice-thickness/ice-thickness.module').then(\r\n        (m) => m.IceThicknessPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/dirt/landslide-obs/:id',\r\n    loadChildren: () =>\r\n      import('./pages/dirt/landslide-obs/landslide-obs.module').then(\r\n        (m) => m.LandslideObsPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/danger-obs/:id',\r\n    loadChildren: () =>\r\n      import('./pages/danger-obs/danger-obs.module').then(\r\n        (m) => m.DangerObsPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/incident/:id',\r\n    loadChildren: () =>\r\n      import('./pages/incident/incident.module').then(\r\n        (m) => m.IncidentPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/snow/avalanche-obs/:id',\r\n    loadChildren: () =>\r\n      import('./pages/snow/avalanche-obs/avalanche-obs.module').then(\r\n        (m) => m.AvalancheObsPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/snow/avalanche-activity/:id',\r\n    loadChildren: () =>\r\n      import('./pages/snow/avalanche-activity/avalanche-activity.module').then(\r\n        (m) => m.AvalancheActivityPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/snow/weather/:id',\r\n    loadChildren: () =>\r\n      import('./pages/snow/weather/weather.module').then(\r\n        (m) => m.WeatherPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/snow/snow-surface/:id',\r\n    loadChildren: () =>\r\n      import('./pages/snow/snow-surface/snow-surface.module').then(\r\n        (m) => m.SnowSurfacePageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/snow/snow-profile/:id',\r\n    loadChildren: () =>\r\n      import('./pages/snow/snow-profile/snow-profile.module').then(\r\n        (m) => m.SnowProfilePageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/snow/compression-test/:id',\r\n    loadChildren: () =>\r\n      import('./pages/snow/compression-test/compression-test.module').then(\r\n        (m) => m.CompressionTestPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/snow/avalanche-problem/:id',\r\n    loadChildren: () =>\r\n      import('./pages/snow/avalanche-problem/avalanche-problem.module').then(\r\n        (m) => m.AvalancheProblemPageModule\r\n      )\r\n  },\r\n  {\r\n    path: 'registration/snow/avalanche-evaluation/:id',\r\n    loadChildren: () =>\r\n      import(\r\n        './pages/snow/avalanche-evaluation/avalanche-evaluation.module'\r\n      ).then((m) => m.AvalancheEvaluationPageModule)\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule]\r\n})\r\nexport class RegistrationRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { RegistrationRoutingModule } from './registration-routing.module';\r\nimport { SharedModule } from '../shared/shared.module';\r\nimport { CanDeactivateRouteGuard } from './pages/can-deactivate-route.guard';\r\nimport { SaveAsDraftRouteGuard } from './pages/save-as-draft.guard';\r\nimport { RegobsApiModule } from '@varsom-regobs-common/regobs-api';\r\n\r\n@NgModule({\r\n  imports: [RegistrationRoutingModule, RegobsApiModule, SharedModule],\r\n  exports: [],\r\n  declarations: [],\r\n  providers: [CanDeactivateRouteGuard, SaveAsDraftRouteGuard]\r\n})\r\nexport class RegistrationModule {}\r\n","import { Injectable } from '@angular/core';\r\nimport moment from 'moment';\r\nimport { UserSettingService } from '../../../../core/services/user-setting/user-setting.service';\r\nimport { DataLoadService } from '../../../data-load/services/data-load.service';\r\nimport { NanoSql } from '../../../../../nanosql';\r\nimport { toPromiseWithCancel } from '../../../../core/helpers/observable-helper';\r\nimport { GeoHazard, LangKey, AppMode } from '@varsom-regobs-common/core';\r\nimport { settings } from '../../../../../settings';\r\nimport { HelptextService, HelptextDto } from '@varsom-regobs-common/regobs-api';\r\nimport { LoggingService } from '../../../shared/services/logging/logging.service';\r\nimport { take } from 'rxjs/operators';\r\n\r\nconst DEBUG_TAG = 'HelpTextService';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class HelpTextService {\r\n  constructor(\r\n    private helptextApiService: HelptextService,\r\n    private userSettingService: UserSettingService,\r\n    private dataLoadService: DataLoadService,\r\n    private loggingService: LoggingService\r\n  ) {}\r\n\r\n  async updateHelpTexts(cancel?: Promise<void>) {\r\n    const userSetting = await this.userSettingService.userSetting$\r\n      .pipe(take(1))\r\n      .toPromise();\r\n    await this.checkLastUpdatedAndUpdateDataIfNeeded(\r\n      userSetting.appMode,\r\n      userSetting.language,\r\n      cancel\r\n    );\r\n  }\r\n\r\n  private getDataLoadId(appMode: AppMode, language: LangKey) {\r\n    return `${NanoSql.TABLES.HELP_TEXTS.name}_${appMode}_${language}`;\r\n  }\r\n\r\n  private async checkLastUpdatedAndUpdateDataIfNeeded(\r\n    appMode: AppMode,\r\n    language: LangKey,\r\n    cancel?: Promise<void>\r\n  ) {\r\n    const dataLoad = await this.dataLoadService.getState(\r\n      this.getDataLoadId(appMode, language)\r\n    );\r\n    const isLoadingTimeout = moment().subtract(\r\n      settings.foregroundUpdateIntervalMs,\r\n      'milliseconds'\r\n    );\r\n    if (\r\n      dataLoad.isLoading &&\r\n      moment(dataLoad.startedDate).isAfter(isLoadingTimeout)\r\n    ) {\r\n      this.loggingService.debug(\r\n        'Kdv elements is allready being updated.',\r\n        DEBUG_TAG\r\n      );\r\n    } else {\r\n      const lastUpdateLimit = moment().subtract(\r\n        settings.helpTexts.daysBeforeUpdate,\r\n        'day'\r\n      );\r\n      if (\r\n        !dataLoad.lastUpdated ||\r\n        moment(dataLoad.lastUpdated).isBefore(lastUpdateLimit)\r\n      ) {\r\n        await this.updateHelpTextsForLanguage(appMode, language, cancel);\r\n      }\r\n    }\r\n  }\r\n\r\n  async updateHelpTextsForLanguage(\r\n    appMode: AppMode,\r\n    language: LangKey,\r\n    cancel?: Promise<void>\r\n  ) {\r\n    const dataLoadId = this.getDataLoadId(appMode, language);\r\n    await this.dataLoadService.startLoading(dataLoadId);\r\n    try {\r\n      const helpTexts = await toPromiseWithCancel(\r\n        this.helptextApiService.HelptextGet(language),\r\n        cancel,\r\n        20000\r\n      );\r\n      await NanoSql.getInstance(NanoSql.TABLES.HELP_TEXTS.name, appMode)\r\n        .query('upsert', { langKey: language, helpTexts: helpTexts })\r\n        .exec();\r\n      await this.dataLoadService.loadingCompleted(dataLoadId);\r\n    } catch (err) {\r\n      await this.dataLoadService.loadingError(dataLoadId, err.message);\r\n    }\r\n  }\r\n\r\n  async getHelpTextByKey(\r\n    langKey: LangKey,\r\n    appMode: AppMode,\r\n    geoHazard: GeoHazard,\r\n    registrationTid: number\r\n  ) {\r\n    const helpTexts = await this.getHelpTexts(langKey, appMode);\r\n    return helpTexts.find(\r\n      (x) =>\r\n        !!x &&\r\n        x.GeoHazardTID === geoHazard &&\r\n        x.RegistrationTID === registrationTid\r\n    );\r\n  }\r\n\r\n  async getHelpTexts(langKey: LangKey, appMode: AppMode) {\r\n    const resultFromDb = await this.getHelpTextsFromDb(langKey, appMode);\r\n    if (resultFromDb) {\r\n      return resultFromDb;\r\n    } else {\r\n      const langKeyName = LangKey[langKey];\r\n      const defaultHelptexts: HelptextDto[] = require(`../../../../../assets/json/helptexts.${langKeyName}.json`);\r\n      return defaultHelptexts;\r\n    }\r\n  }\r\n\r\n  private async getHelpTextsFromDb(\r\n    langKey: LangKey,\r\n    appMode: AppMode\r\n  ): Promise<HelptextDto[]> {\r\n    const result = await NanoSql.getInstance(\r\n      NanoSql.TABLES.HELP_TEXTS.name,\r\n      appMode\r\n    )\r\n      .query('select')\r\n      .where(['langKey', '=', langKey])\r\n      .exec();\r\n    if (result.length > 0) {\r\n      return result[0].helpTexts as HelptextDto[];\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { map, take } from 'rxjs/operators';\r\nimport { UserSettingService } from '../../../core/services/user-setting/user-setting.service';\r\nimport moment from 'moment';\r\nimport { DataLoadService } from '../../data-load/services/data-load.service';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { toPromiseWithCancel } from '../../../core/helpers/observable-helper';\r\nimport { NavController } from '@ionic/angular';\r\nimport { ObservationService } from '../../../core/services/observation/observation.service';\r\nimport * as utils from '@nano-sql/core/lib/utilities';\r\nimport { File } from '@ionic-native/file/ngx';\r\nimport { LoggingService } from '../../shared/services/logging/logging.service';\r\nimport { RegobsAuthService } from '../../auth/services/regobs-auth.service';\r\nimport { IRegistration, SyncStatus } from 'src/app/modules/common-registration/registration.models';\r\nimport { RegistrationService as CommonRegistrationService } from 'src/app/modules/common-registration/registration.services';\r\nimport { GeoHazard, AppMode } from '@varsom-regobs-common/core';\r\n\r\nconst DEBUG_TAG = 'RegistrationService';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class RegistrationService {\r\n  public readonly drafts$: Observable<IRegistration[]>;\r\n  public readonly registrations$: Observable<IRegistration[]>;\r\n\r\n  constructor(\r\n    private regobsAuthService: RegobsAuthService,\r\n    private userSettingService: UserSettingService,\r\n    // private registrationApiService: RegobsApi.RegistrationService,\r\n    private navController: NavController,\r\n    private dataLoadService: DataLoadService,\r\n    private loggingService: LoggingService,\r\n    private observationService: ObservationService,\r\n    // private registrationRepositoryService: RegistrationRepositoryService,\r\n    private commonRegistrationService: CommonRegistrationService,\r\n    private httpClient: HttpClient,\r\n    private file: File\r\n  ) {\r\n    // this.registrations$ = this.registrationRepositoryService.registrations$;\r\n    this.registrations$ = this.commonRegistrationService.registrationStorage$;\r\n    this.drafts$ = this.registrations$.pipe(map((val) => val.filter((item) => item.syncStatus === SyncStatus.Draft)));\r\n  }\r\n\r\n  // saveRegistration(appMode: AppMode, registration: IRegistration) {\r\n  //   this.loggingService.debug('Save registration', DEBUG_TAG, registration);\r\n  //   if (!registration) {\r\n  //     return;\r\n  //   }\r\n  //   registration.changed = moment().unix();\r\n  //   this.registrationRepositoryService.saveRegistration(appMode, registration);\r\n  //   this.commonRegistrationService.saveRegistration(registration);\r\n  // }\r\n\r\n  async saveRegistrationAsync(registration: IRegistration, clean = false) {\r\n    // const appMode = await this.userSettingService.appMode$\r\n    //   .pipe(take(1))\r\n    //   .toPromise();\r\n    // if (clean) {\r\n    //   await this.cleanupRegistration(registration);\r\n    // }\r\n    // this.saveRegistration(appMode, registration);\r\n    await this.commonRegistrationService.saveRegistration(registration).pipe(take(1)).toPromise();\r\n  }\r\n\r\n  createNewRegistration(geoHazard: GeoHazard) {\r\n    const newId = utils.uuid();\r\n    const reg: IRegistration = {\r\n      id: newId,\r\n      geoHazard,\r\n      changed: moment().unix(),\r\n      syncStatus: SyncStatus.Draft,\r\n      request: {\r\n        DtObsTime: null,\r\n        GeoHazardTID: geoHazard\r\n      }\r\n    };\r\n    return reg;\r\n  }\r\n\r\n  // private getRegistrationTids(): RegistrationTid[] {\r\n  //   return Object.keys(RegistrationTid)\r\n  //     .map((key) => RegistrationTid[key])\r\n  //     .filter((val: RegistrationTid) => typeof val !== 'string');\r\n  // }\r\n\r\n  // private async cleanupRegistration(reg: IRegistration) {\r\n  //   if (reg && reg.request) {\r\n  //     const registrationTids = this.getRegistrationTids();\r\n  //     for (const registrationTid of registrationTids) {\r\n  //       const key = RegistrationTid[registrationTid];\r\n  //       if (reg.request[key] && this.isEmpty(reg, registrationTid)) {\r\n  //         reg.request[key] = undefined;\r\n  //       }\r\n  //       if (\r\n  //         reg.request[key] !== undefined &&\r\n  //         registrationTid === RegistrationTid.WaterLevel2\r\n  //       ) {\r\n  //         this.cleanupWaterLevelMeasurements(reg);\r\n  //       }\r\n  //     }\r\n  //     if (!reg.request.DtObsTime) {\r\n  //       reg.request.DtObsTime = moment().toISOString(true);\r\n  //     }\r\n  //     await this.cleanupImages(reg.request);\r\n  //   }\r\n  //   return reg;\r\n  // }\r\n\r\n  // private cleanupWaterLevelMeasurements(reg: IRegistration) {\r\n  //   if (\r\n  //     reg &&\r\n  //     reg.request &&\r\n  //     reg.request.WaterLevel2 &&\r\n  //     reg.request.WaterLevel2.WaterLevelMeasurement\r\n  //   ) {\r\n  //     for (const measurement of reg.request.WaterLevel2.WaterLevelMeasurement) {\r\n  //       if (\r\n  //         !IsEmptyHelper.isEmpty(measurement) &&\r\n  //         !measurement.DtMeasurementTime\r\n  //       ) {\r\n  //         // Setting to now if DtMeasurementTime is empty\r\n  //         measurement.DtMeasurementTime = moment().toISOString(true);\r\n  //       }\r\n  //     }\r\n  //     // Remove array if no elements\r\n  //     if (\r\n  //       IsEmptyHelper.isEmpty(reg.request.WaterLevel2.WaterLevelMeasurement)\r\n  //     ) {\r\n  //       reg.request.WaterLevel2.WaterLevelMeasurement = undefined;\r\n  //     }\r\n  //   }\r\n  // }\r\n\r\n  // private async cleanupImages(\r\n  //   request: RegistrationEditModel\r\n  // ) {\r\n  //   try {\r\n  //     if (!request) {\r\n  //       return;\r\n  //     }\r\n  //     if (request.Attachments && request.Attachments.length > 0) {\r\n  //       request.Attachments = await asyncFilter(request.Attachments, (p) =>\r\n  //         this.isValidPicture(p)\r\n  //       );\r\n  //     }\r\n  //     if (request.DamageObs && request.DamageObs.length > 0) {\r\n  //       request.DamageObs = await Promise.all(\r\n  //         request.DamageObs.map(async (dto) => ({\r\n  //           ...dto,\r\n  //           Pictures: await asyncFilter(dto.Attachments, (p) =>\r\n  //             this.isValidPicture(p)\r\n  //           )\r\n  //         }))\r\n  //       );\r\n  //     }\r\n  //     if (\r\n  //       request.WaterLevel2 &&\r\n  //       request.WaterLevel2.WaterLevelMeasurement &&\r\n  //       request.WaterLevel2.WaterLevelMeasurement.length > 0\r\n  //     ) {\r\n  //       request.WaterLevel2.WaterLevelMeasurement = await Promise.all(\r\n  //         request.WaterLevel2.WaterLevelMeasurement.map(async (dto) => ({\r\n  //           ...dto,\r\n  //           Pictures: await asyncFilter(dto.Attachments, (p) =>\r\n  //             this.isValidPicture(p)\r\n  //           )\r\n  //         }))\r\n  //       );\r\n  //     }\r\n  //   } catch (err) {\r\n  //     this.loggingService.error(err, DEBUG_TAG, 'Could not cleanup images');\r\n  //   }\r\n  // }\r\n\r\n  // isEmpty(reg: IRegistration, registrationTid: RegistrationTid) {\r\n  //   if (reg && registrationTid) {\r\n  //     const isRegistrationEmpty = IsEmptyHelper.isEmpty(\r\n  //       this.getRegistationProperty(reg, registrationTid)\r\n  //     );\r\n  //     const hasImages = this.hasImages(reg, registrationTid);\r\n  //     if (isRegistrationEmpty && !hasImages) {\r\n  //       return true;\r\n  //     } else {\r\n  //       return false;\r\n  //     }\r\n  //   }\r\n  //   return true;\r\n  // }\r\n\r\n  // isRegistrationEmpty(reg: IRegistration) {\r\n  //   const registrationTids = this.getRegistrationTids();\r\n  //   const hasAnyValues = registrationTids.some((x) => !this.isEmpty(reg, x));\r\n  //   return !hasAnyValues;\r\n  // }\r\n\r\n  // hasImages(reg: IRegistration, registrationTid: RegistrationTid) {\r\n  //   return this.getImages(reg, registrationTid).length > 0;\r\n  // }\r\n\r\n  // getImages(reg: IRegistration, registrationTid: RegistrationTid) {\r\n  //   if (!reg) {\r\n  //     return [];\r\n  //   }\r\n  //   return this.getAllPictures(reg.request).filter(\r\n  //     (p) => p.RegistrationTID === registrationTid\r\n  //   );\r\n  // }\r\n\r\n  // getRegistationProperty(reg: IRegistration, registrationTid: RegistrationTid) {\r\n  //   if (reg && reg.request && registrationTid) {\r\n  //     return reg.request[this.getPropertyName(registrationTid)];\r\n  //   }\r\n  //   return null;\r\n  // }\r\n\r\n  // getPropertyName(registrationTid: RegistrationTid) {\r\n  //   return RegistrationTid[registrationTid];\r\n  // }\r\n\r\n  // getType(registrationTid: RegistrationTid): 'array' | 'object' {\r\n  //   const arrays = [\r\n  //     RegistrationTid.DangerObs,\r\n  //     RegistrationTid.AvalancheActivityObs,\r\n  //     RegistrationTid.AvalancheActivityObs2,\r\n  //     RegistrationTid.AvalancheDangerObs,\r\n  //     RegistrationTid.AvalancheEvalProblem2,\r\n  //     RegistrationTid.CompressionTest,\r\n  //     RegistrationTid.Picture,\r\n  //     RegistrationTid.DamageObs\r\n  //   ];\r\n  //   return arrays.indexOf(registrationTid) >= 0 ? 'array' : 'object';\r\n  // }\r\n\r\n  async sendRegistration(appMode: AppMode, reg: IRegistration) {\r\n    const loggedInUser = await this.regobsAuthService.getLoggedInUserAsPromise();\r\n    if (!loggedInUser.isLoggedIn) {\r\n      this.regobsAuthService.signIn();\r\n      return;\r\n    }\r\n    reg.syncStatus = SyncStatus.Sync;\r\n    this.commonRegistrationService.saveAndSync(reg, null, true).subscribe();\r\n    // TODO: Ignore version check is set to true for now\r\n    this.navController.navigateRoot('my-observations');\r\n  }\r\n\r\n  // private getDataLoadId(appMode: AppMode) {\r\n  //   return `registration_${appMode}`;\r\n  // }\r\n\r\n  // getDataLoadState() {\r\n  //   return this.userSettingService.userSetting$.pipe(\r\n  //     switchMap((userSetting) =>\r\n  //       this.dataLoadService.getStateAsObservable(\r\n  //         this.getDataLoadId(userSetting.appMode)\r\n  //       )\r\n  //     )\r\n  //   );\r\n  // }\r\n\r\n  async syncRegistrations(cancel?: Promise<any>): Promise<IRegistration[]> {\r\n    return toPromiseWithCancel(this.commonRegistrationService.syncRegistrations(), cancel);\r\n  }\r\n\r\n  // async syncRegistrations(cancel?: Promise<any>) {\r\n  //   let cancelled = false;\r\n  //   if (cancel) {\r\n  //     cancel.then(() => {\r\n  //       cancelled = true;\r\n  //     });\r\n  //   }\r\n  //   const userSettings = await this.userSettingService.userSetting$\r\n  //     .pipe(take(1))\r\n  //     .toPromise();\r\n  //   const dataLoadId = this.getDataLoadId(userSettings.appMode);\r\n  //   const dataLoad = await this.dataLoadService.getState(dataLoadId);\r\n  //   const isLoadingTimeout = moment().subtract(30, 'seconds');\r\n  //   if (\r\n  //     dataLoad.isLoading &&\r\n  //     moment(dataLoad.startedDate).isAfter(isLoadingTimeout)\r\n  //   ) {\r\n  //     // Is allready syncing, return\r\n  //     return;\r\n  //   }\r\n\r\n  //   const registrationsToSync = await this.getRegistrationsToSync()\r\n  //     .pipe(take(1))\r\n  //     .toPromise();\r\n  //   if (registrationsToSync.length > 0) {\r\n  //     try {\r\n  //       await this.dataLoadService.startLoading(\r\n  //         dataLoadId,\r\n  //         registrationsToSync.length\r\n  //       );\r\n  //       let itemCompleted = 0;\r\n  //       for (const registration of registrationsToSync) {\r\n  //         if (!cancelled) {\r\n  //           await this.syncRegistration(registration, userSettings, cancel);\r\n  //           itemCompleted++;\r\n  //           await this.dataLoadService.updateProgress(\r\n  //             dataLoadId,\r\n  //             itemCompleted,\r\n  //             registrationsToSync.length\r\n  //           );\r\n  //         } else {\r\n  //           throw Error('Operation cancelled');\r\n  //         }\r\n  //       }\r\n  //       await this.dataLoadService.loadingCompleted(dataLoadId);\r\n  //     } catch (err) {\r\n  //       await this.dataLoadService.loadingError(dataLoadId, err.message);\r\n  //     }\r\n  //   }\r\n  // }\r\n\r\n  // private async syncRegistration(\r\n  //   registration: IRegistration,\r\n  //   userSetting: UserSetting,\r\n  //   cancel?: Promise<void>\r\n  // ) {\r\n  //   try {\r\n  //     if (registration.request) {\r\n  //       await this.cleanupRegistration(registration);\r\n  //       registration.request.Email = userSetting.emailReceipt;\r\n  //       const createRegistrationResult = await this.postRegistration(\r\n  //         userSetting.appMode,\r\n  //         registration,\r\n  //         cancel\r\n  //       );\r\n  //       await this.observationService.updateObservationById(\r\n  //         createRegistrationResult.RegId,\r\n  //         userSetting.appMode,\r\n  //         userSetting.language,\r\n  //         userSetting.currentGeoHazard\r\n  //       );\r\n  //     }\r\n  //     await this.deleteRegistrationById(userSetting.appMode, registration.id);\r\n  //   } catch (ex) {\r\n  //     if (ex instanceof HttpErrorResponse) {\r\n  //       const httpError: HttpErrorResponse = ex;\r\n  //       this.loggingService.debug(\r\n  //         'Could not sync registration',\r\n  //         DEBUG_TAG,\r\n  //         registration,\r\n  //         ex\r\n  //       );\r\n  //       if (httpError.status === 409) {\r\n  //         // Duplicate, remove\r\n  //         await this.deleteRegistrationById(\r\n  //           userSetting.appMode,\r\n  //           registration.id\r\n  //         );\r\n  //         // Updating latest user registration since we don't have an ID for the duplicate\r\n  //         // await this.updateLatestUserRegistrations(cancel);\r\n  //       } else if (httpError.status === 400) {\r\n  //         // Model error, something is not correct from app. Please review ModelState error!\r\n  //         this.loggingService.error(\r\n  //           ex,\r\n  //           'Got 400 BadRequest when sending registration',\r\n  //           DEBUG_TAG,\r\n  //           registration\r\n  //         );\r\n  //         registration.error = {\r\n  //           status: httpError.status,\r\n  //           message: this.getErrorsFromBadRequest(httpError)\r\n  //         };\r\n  //         this.saveRegistration(userSetting.appMode, registration);\r\n  //       } else {\r\n  //         this.loggingService.error(\r\n  //           ex,\r\n  //           'Got ${httpError.status} when sending registration',\r\n  //           DEBUG_TAG,\r\n  //           registration\r\n  //         );\r\n  //         registration.error = {\r\n  //           status: httpError.status,\r\n  //           message: httpError.statusText\r\n  //         };\r\n  //         this.saveRegistration(userSetting.appMode, registration);\r\n  //       }\r\n  //     } else {\r\n  //       // Another unknown error\r\n  //       this.loggingService.error(\r\n  //         ex,\r\n  //         'Error when sending registration',\r\n  //         DEBUG_TAG,\r\n  //         registration\r\n  //       );\r\n  //       registration.error = { status: 500, message: ex.message || '' };\r\n  //       this.saveRegistration(userSetting.appMode, registration);\r\n  //     }\r\n  //   }\r\n  // }\r\n\r\n  // private getErrorsFromBadRequest(httpError: HttpErrorResponse) {\r\n  //   const errors: Array<string> = [];\r\n  //   if (httpError && httpError.error && httpError.error.ModelState) {\r\n  //     Object.keys(httpError.error.ModelState).forEach((key) => {\r\n  //       const err: Array<string> = httpError.error.ModelState[key];\r\n  //       errors.push(...err);\r\n  //     });\r\n  //   } else if (\r\n  //     httpError &&\r\n  //     httpError.error &&\r\n  //     httpError.error.ExceptionMessage\r\n  //   ) {\r\n  //     errors.push(httpError.error.ExceptionMessage);\r\n  //   }\r\n  //   return errors.join(', ');\r\n  // }\r\n\r\n  // deleteRegistrationById(appMode: AppMode, id: string) {\r\n  //   return this.registrationRepositoryService.deleteRegistrationById(\r\n  //     appMode,\r\n  //     id\r\n  //   );\r\n  // }\r\n\r\n  getRegistrationsToSync() {\r\n    return this.registrations$.pipe(\r\n      // TODO: Why drafts?\r\n      map((items) => items.filter((x) => x.syncStatus === SyncStatus.Draft))\r\n    );\r\n  }\r\n\r\n  getSavedRegistrationById(id: string): Promise<IRegistration> {\r\n    return this.commonRegistrationService.getRegistrationById(id);\r\n  }\r\n\r\n  // getSavedRegistrationByIdObservable(id: string) {\r\n  //   return this.registrations$.pipe(\r\n  //     map((items) => items.find((x) => x.id === id))\r\n  //   );\r\n  // }\r\n\r\n  // private postRegistration(\r\n  //   appMode: AppMode,\r\n  //   registration: IRegistration,\r\n  //   cancel?: Promise<void>\r\n  // ) {\r\n  //   const uploadProcess$ = this.uploadAttachments(registration.request).pipe(\r\n  //     tap(() =>\r\n  //       this.loggingService.debug(\r\n  //         'Upload attachments complete. Registration is:',\r\n  //         DEBUG_TAG,\r\n  //         registration\r\n  //       )\r\n  //     ),\r\n  //     concatMap(() => of(this.saveRegistration(appMode, registration))), // Save updated picture dtos with attachment id\r\n  //     concatMap(() =>\r\n  //       this.registrationApiService.RegistrationInsert(registration.request)\r\n  //     )\r\n  //   );\r\n  //   return toPromiseWithCancel(uploadProcess$, cancel);\r\n  // }\r\n\r\n  // private uploadAttachments(\r\n  //   registration: RegobsApiModels.CreateRegistrationRequestDto\r\n  // ): Observable<RegobsApiModels.PictureRequestDto[]> {\r\n  //   this.loggingService.debug(\r\n  //     'Start upload attachments',\r\n  //     DEBUG_TAG,\r\n  //     registration\r\n  //   );\r\n  //   const attachments = this.getAllPictures(registration);\r\n  //   if (attachments.length === 0) {\r\n  //     return of([]);\r\n  //   }\r\n  //   return combineLatest(attachments.map((p) => this.uploadAttachment(p)));\r\n  // }\r\n\r\n  // getAllPictures(registration: RegobsApiModels.CreateRegistrationRequestDto) {\r\n  //   let pictures = registration.Picture || [];\r\n  //   if (registration.DamageObs && registration.DamageObs.length > 0) {\r\n  //     const damageObsPictures = registration.DamageObs.map(\r\n  //       (val) => val.Pictures || []\r\n  //     );\r\n  //     pictures = pictures.concat(...damageObsPictures);\r\n  //   }\r\n  //   if (\r\n  //     registration.WaterLevel2 &&\r\n  //     registration.WaterLevel2.WaterLevelMeasurement &&\r\n  //     registration.WaterLevel2.WaterLevelMeasurement.length > 0\r\n  //   ) {\r\n  //     const waterLevelPictures = registration.WaterLevel2.WaterLevelMeasurement.map(\r\n  //       (val) => val.Pictures || []\r\n  //     );\r\n  //     pictures = pictures.concat(...waterLevelPictures);\r\n  //   }\r\n  //   return pictures;\r\n  // }\r\n\r\n  // private async getFile(fileUrl: string): Promise<IFile> {\r\n  //   const entry = await this.file.resolveLocalFilesystemUrl(fileUrl);\r\n  //   if (!entry.isFile) {\r\n  //     throw Error(`${fileUrl} is not a file!`);\r\n  //   }\r\n  //   const fileEntry: FileEntry = entry as FileEntry;\r\n  //   return new Promise((resolve, reject) =>\r\n  //     fileEntry.file(\r\n  //       (success) => resolve(success),\r\n  //       (error) => reject(error)\r\n  //     )\r\n  //   );\r\n  // }\r\n\r\n  // private isBase64Picture(pictureRequest: RegobsApiModels.PictureRequestDto) {\r\n  //   return (\r\n  //     pictureRequest &&\r\n  //     pictureRequest.PictureImageBase64 &&\r\n  //     pictureRequest.PictureImageBase64.startsWith('data:')\r\n  //   );\r\n  // }\r\n\r\n  // private async isValidPicture(\r\n  //   pictureRequest: AttachmentEditModel\r\n  // ): Promise<boolean> {\r\n  //   if (pictureRequest) {\r\n  //     if (\r\n  //       pictureRequest.AttachmentUploadId ||\r\n  //       this.isBase64Picture(pictureRequest)\r\n  //     ) {\r\n  //       return true;\r\n  //     }\r\n  //     try {\r\n  //       const file = await this.getFile(pictureRequest.);\r\n  //       return !!file;\r\n  //     } catch (err) {\r\n  //       this.loggingService.log(\r\n  //         'Picture request has a file that is missing. Skip this picture.',\r\n  //         err,\r\n  //         LogLevel.Error,\r\n  //         DEBUG_TAG\r\n  //       );\r\n  //     }\r\n  //   }\r\n  //   return false;\r\n  // }\r\n\r\n  // private uploadAttachment(\r\n  //   pictureRequest: RegobsApiModels.PictureRequestDto\r\n  // ): Observable<RegobsApiModels.PictureRequestDto> {\r\n  //   const shouldUploadAttachment =\r\n  //     !pictureRequest.AttachmentUploadId &&\r\n  //     pictureRequest.PictureImageBase64 &&\r\n  //     !this.isBase64Picture(pictureRequest);\r\n\r\n  //   if (shouldUploadAttachment) {\r\n  //     const file$ = from(this.getFile(pictureRequest.PictureImageBase64));\r\n  //     return file$.pipe(\r\n  //       tap((file) =>\r\n  //         this.loggingService.debug('Found image file blob', DEBUG_TAG, file)\r\n  //       ),\r\n  //       concatMap((file) => this.getFormDataAndUploadToApi(file)),\r\n  //       map((attachmentId) => {\r\n  //         this.loggingService.debug(\r\n  //           `Result from upload attachment: ${attachmentId}`,\r\n  //           DEBUG_TAG\r\n  //         );\r\n  //         pictureRequest.AttachmentUploadId = attachmentId;\r\n  //         this.loggingService.debug(\r\n  //           `Updated attachment id ${attachmentId} for picture request`,\r\n  //           DEBUG_TAG,\r\n  //           pictureRequest\r\n  //         );\r\n  //         return pictureRequest;\r\n  //       }),\r\n  //       concatMap(() =>\r\n  //         from(this.deleteFile(pictureRequest.PictureImageBase64))\r\n  //       ),\r\n  //       map(() => {\r\n  //         pictureRequest.PictureImageBase64 = undefined; // Attachment upload ok. Clear local file.\r\n  //         return pictureRequest;\r\n  //       })\r\n  //     );\r\n  //   }\r\n  //   return of(pictureRequest);\r\n  // }\r\n\r\n  // private async deleteFile(src: string) {\r\n  //   try {\r\n  //     const entry = await this.file.resolveLocalFilesystemUrl(src);\r\n  //     await new Promise<void>((resolve, reject) =>\r\n  //       entry.remove(resolve, reject)\r\n  //     );\r\n  //     this.loggingService.debug(\r\n  //       `Observation image deleted from presistant app storage: ${src}`,\r\n  //       DEBUG_TAG\r\n  //     );\r\n  //   } catch (err) {\r\n  //     this.loggingService.log(\r\n  //       'Could not delete image',\r\n  //       err,\r\n  //       LogLevel.Warning,\r\n  //       DEBUG_TAG\r\n  //     );\r\n  //   }\r\n  // }\r\n\r\n  // private getFormDataFromFile(file: IFile) {\r\n  //   return from(this.fileToBlob(file)).pipe(\r\n  //     map((blob) => {\r\n  //       const formData = new FormData();\r\n  //       formData.append('file', blob, file.name);\r\n  //       return formData;\r\n  //     })\r\n  //   );\r\n  // }\r\n\r\n  // private fileToBlob(file: IFile): Promise<Blob> {\r\n  //   return new Promise<Blob>((resolve, reject) => {\r\n  //     const reader = new FileReader();\r\n  //     reader.onloadend = () =>\r\n  //       resolve(new Blob([reader.result], { type: file.type }));\r\n  //     reader.onerror = (e) => reject(e);\r\n  //     reader.readAsArrayBuffer(file);\r\n  //   });\r\n  // }\r\n\r\n  // private getFormDataAndUploadToApi(file: IFile): Observable<string> {\r\n  //   const formData$ = this.getFormDataFromFile(file);\r\n  //   return combineLatest([this.userSettingService.appMode$, formData$]).pipe(\r\n  //     tap(([appMode, formData]) =>\r\n  //       this.loggingService.debug('Got form data', DEBUG_TAG, appMode, formData)\r\n  //     ),\r\n  //     concatMap(([appMode, formData]) =>\r\n  //       this.uploadAttachmentToApi(appMode, formData)\r\n  //     )\r\n  //   );\r\n  // }\r\n\r\n  // private uploadAttachmentToApi(appMode: AppMode, data: FormData) {\r\n  //   const rootUrl = settings.services.regObs.apiUrl[appMode];\r\n  //   return this.httpClient.post<string>(`${rootUrl}/Attachment/Upload`, data);\r\n  // }\r\n}\r\n","<ion-fab #menuFab vertical=\"bottom\" horizontal=\"end\" slot=\"fixed\" *ngIf=\"(geoHazardInfo$ | async) as geoHazardInfo \">\r\n  <ion-fab-button>\r\n    <ion-icon name=\"add\"></ion-icon>\r\n  </ion-fab-button>\r\n  <ion-fab-list side=\"top\">\r\n    <ion-list lines=\"full\" class=\"ion-no-padding ion-no-margin\">\r\n\r\n      <!-- New observation button -->\r\n      <ion-item (click)=\"createRegistration(geoHazard)\" *ngFor=\"let geoHazard of geoHazardInfo.geoHazards\">\r\n        <app-geo-icon slot=\"start\" [useGeoColors]=\"false\" [geoHazards]=\"[geoHazard]\"></app-geo-icon>\r\n        <ion-label>{{ 'ADD_MENU.NEW_' + getName(geoHazard) + '_OBSERVATION' | uppercase | translate }}</ion-label>\r\n      </ion-item>\r\n\r\n      <!-- Drafts -->\r\n      <ion-item *ngFor=\"let draft of drafts$ | async\" (click)=\"editRegistration(draft.id)\">\r\n        <ion-icon slot=\"start\" name=\"create\"></ion-icon>\r\n        <ion-label>\r\n          {{'ADD_MENU.DRAFT_TITLE_' + getName(draft.geoHazard) | uppercase | translate}}\r\n          <p>{{ draft.date }}</p>\r\n        </ion-label>\r\n      </ion-item>\r\n\r\n      <!-- Start / stop trip -->\r\n      <ng-container *ngIf=\"geoHazardInfo.showTrip\">\r\n        <ion-item *ngIf=\"tripStarted$ | async else startTrip\" (click)=\"startOrStopTrip(true)\">\r\n          <ion-icon slot=\"start\" src=\"/assets/icon/man.svg\"></ion-icon>\r\n          <ion-label>{{'TRIP.STOP_TRIP' | translate }}</ion-label>\r\n        </ion-item>\r\n      </ng-container>\r\n\r\n    </ion-list>\r\n    <div class=\"backdrop\" click=\"closeMenu()\"></div>\r\n  </ion-fab-list>\r\n</ion-fab>\r\n\r\n<ng-template #startTrip>\r\n  <ion-item (click)=\"startOrStopTrip(false)\">\r\n    <ion-icon slot=\"start\" src=\"/assets/icon/man.svg\"></ion-icon>\r\n    <ion-label>{{'TRIP.START_TRIP' | translate }}</ion-label>\r\n  </ion-item>\r\n</ng-template>","import { Component, OnInit, ViewChild } from '@angular/core';\r\nimport { IonFab, NavController } from '@ionic/angular';\r\nimport { Observable, from, combineLatest, of } from 'rxjs';\r\nimport moment from 'moment';\r\nimport { DateHelperService } from '../../services/date-helper/date-helper.service';\r\nimport { TripLoggerService } from '../../../../core/services/trip-logger/trip-logger.service';\r\nimport { UserSettingService } from '../../../../core/services/user-setting/user-setting.service';\r\nimport { GeoHelperService } from '../../services/geo-helper/geo-helper.service';\r\nimport { IRegistration } from 'src/app/modules/common-registration/registration.models';\r\nimport { GeoHazard, LangKey } from '@varsom-regobs-common/core';\r\nimport { RegistrationService } from '../../../registration/services/registration.service';\r\nimport { map, tap, switchMap } from 'rxjs/operators';\r\nimport { setObservableTimeout } from '../../../../core/helpers/observable-helper';\r\nimport { LoggingService } from '../../services/logging/logging.service';\r\n\r\nconst DEBUG_TAG = 'AddMenuComponent';\r\n\r\n@Component({\r\n  selector: 'app-add-menu',\r\n  templateUrl: './add-menu.component.html',\r\n  styleUrls: ['./add-menu.component.scss']\r\n})\r\nexport class AddMenuComponent implements OnInit {\r\n  @ViewChild('menuFab') menuFab: IonFab;\r\n\r\n  drafts$: Observable<{ id: string; geoHazard: GeoHazard; date: string }[]>;\r\n  geoHazardInfo$: Observable<{\r\n    geoHazards: GeoHazard[];\r\n    showTrip: boolean;\r\n  }>;\r\n  tripStarted$: Observable<boolean>;\r\n  showSpace$: Observable<boolean>;\r\n\r\n  constructor(\r\n    private registrationService: RegistrationService,\r\n    private navController: NavController,\r\n    private dateHelperService: DateHelperService,\r\n    private tripLoggerService: TripLoggerService,\r\n    private userSettingService: UserSettingService,\r\n    private geoHelperService: GeoHelperService,\r\n    private loggingService: LoggingService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.geoHazardInfo$ = this.userSettingService.userSetting$.pipe(\r\n      map((us) => ({\r\n        geoHazards: us.currentGeoHazard,\r\n        showTrip: us.currentGeoHazard.indexOf(GeoHazard.Snow) >= 0\r\n      })),\r\n      setObservableTimeout()\r\n    );\r\n    this.drafts$ = this.registrationService.drafts$.pipe(\r\n      tap((drafts) =>\r\n        this.loggingService.debug('Drafts has changed to', DEBUG_TAG, drafts)\r\n      ),\r\n      switchMap((drafts) =>\r\n        drafts.length > 0\r\n          ? combineLatest(drafts.map((draft) => this.convertDraftToDate(draft)))\r\n          : of([])\r\n      ),\r\n      tap((drafts) =>\r\n        this.loggingService.debug(\r\n          'Converted drafts has changed to',\r\n          DEBUG_TAG,\r\n          drafts\r\n        )\r\n      ),\r\n      setObservableTimeout()\r\n    );\r\n    this.tripStarted$ = this.tripLoggerService.isTripRunning$;\r\n  }\r\n\r\n  private convertDraftToDate(\r\n    draft: IRegistration\r\n  ): Observable<{ id: string; geoHazard: GeoHazard; date: string }> {\r\n    return from(this.getDate(draft.changed)).pipe(\r\n      map((date) => ({ id: draft.id, geoHazard: draft.geoHazard, date }))\r\n    );\r\n  }\r\n\r\n  getName(geoHazard: GeoHazard): string {\r\n    return GeoHazard[geoHazard];\r\n  }\r\n\r\n  getDate(timestamp: number): Promise<string> {\r\n    return this.dateHelperService.formatDate(moment.unix(timestamp));\r\n  }\r\n\r\n  closeAndNavigate(url: string): void {\r\n    setTimeout(() => {\r\n      if (this.menuFab) {\r\n        this.menuFab.close();\r\n      }\r\n    }, 0);\r\n    this.navController.navigateForward(url);\r\n  }\r\n\r\n  createRegistration(geoHazard: GeoHazard): void {\r\n    this.closeAndNavigate(`registration/new/${geoHazard}`);\r\n  }\r\n\r\n  editRegistration(id: string): void {\r\n    this.closeAndNavigate(`registration/edit/${id}`);\r\n  }\r\n\r\n  closeMenu(): void {\r\n    this.menuFab.close();\r\n  }\r\n\r\n  startOrStopTrip(tripStarted: boolean): void {\r\n    return tripStarted\r\n      ? this.tripLoggerService.stopLegacyTrip()\r\n      : this.closeAndNavigate('legacy-trip');\r\n  }\r\n}\r\n","import { Component, OnInit, Input } from '@angular/core';\r\nimport { ExternalLinkService } from '../../../../core/services/external-link/external-link.service';\r\n\r\n@Component({\r\n  selector: 'app-external-link',\r\n  templateUrl: './external-link.component.html',\r\n  styleUrls: ['./external-link.component.scss']\r\n})\r\nexport class ExternalLinkComponent implements OnInit {\r\n  @Input() src: string;\r\n\r\n  constructor(private externalLinkService: ExternalLinkService) {}\r\n\r\n  ngOnInit() {}\r\n\r\n  openLink(event: Event) {\r\n    event.preventDefault();\r\n    this.externalLinkService.openExternalLink(this.src);\r\n  }\r\n}\r\n","<a href=\"#\" (click)=\"openLink($event)\">\r\n  <ng-content></ng-content>\r\n</a>","<ion-fab mode=\"ios\" *ngIf=\"(currentGeoHazard$ | async) as currentGeoHazard\" vertical=\"top\" horizontal=\"start\"\r\n  slot=\"fixed\" [ngClass]=\"{ 'fullscreen': fullscreen$ | async }\" [@enterAnimationFab]=\"animateOnEnterState\">\r\n  <ion-item (click)=\"toggle()\">\r\n    <ion-fab-button class=\"ion-margin-end\" slot=\"start\" [color]=\"color\">\r\n      <app-geo-icon [geoHazards]=\"currentGeoHazard\"></app-geo-icon>\r\n    </ion-fab-button>\r\n    <ion-label *ngIf=\"isOpen && showLabels\" @enterAnimation>\r\n      <app-geo-name [geoHazards]=\"currentGeoHazard\"></app-geo-name>\r\n    </ion-label>\r\n  </ion-item>\r\n  <ng-container *ngIf=\"(selectableGeoHazards$ | async) as selectableGeoHazards\">\r\n    <ion-list [@listAnimate]=\"selectableGeoHazards.length\" *ngIf=\"isOpen\" lines=\"none\">\r\n      <ion-item class=\"list-item\" *ngFor=\"let geoHazards of selectableGeoHazards\"\r\n        (click)=\"setCurrentGeoHazard(geoHazards)\">\r\n        <ion-fab-button class=\"ion-margin-end\" slot=\"start\" [color]=\"color\">\r\n          <app-geo-icon [geoHazards]=\"geoHazards\"></app-geo-icon>\r\n        </ion-fab-button>\r\n        <ion-label *ngIf=\"showLabels\">\r\n          <app-geo-name [geoHazards]=\"geoHazards\"></app-geo-name>\r\n        </ion-label>\r\n      </ion-item>\r\n    </ion-list>\r\n  </ng-container>\r\n</ion-fab>\r\n<div *ngIf=\"isOpen\" class=\"wrapper\" (click)=\"toggle()\"></div>","import {\r\n  Component,\r\n  OnInit,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnDestroy,\r\n  NgZone\r\n} from '@angular/core';\r\nimport {\r\n  state,\r\n  trigger,\r\n  style,\r\n  transition,\r\n  animate,\r\n  stagger,\r\n  query\r\n} from '@angular/animations';\r\nimport { FullscreenService } from '../../../../core/services/fullscreen/fullscreen.service';\r\nimport { Observable, Subject } from 'rxjs';\r\nimport { GeoHazard } from '@varsom-regobs-common/core';\r\nimport { UserSettingService } from '../../../../core/services/user-setting/user-setting.service';\r\nimport {\r\n  CustomAnimation,\r\n  EASE_IN_OUT_BACK,\r\n  EASE_IN_OUT\r\n} from '../../../../core/animations/custom.animation';\r\nimport { map, take } from 'rxjs/operators';\r\n\r\nconst GEOHAZARD_TYPES = [\r\n  [GeoHazard.Snow],\r\n  [GeoHazard.Ice],\r\n  [GeoHazard.Water, GeoHazard.Soil]\r\n];\r\n@Component({\r\n  selector: 'app-geo-fab',\r\n  templateUrl: './geo-fab.component.html',\r\n  styleUrls: ['./geo-fab.component.scss'],\r\n  animations: [\r\n    trigger('enterAnimationFab', [\r\n      state('x', style({ transform: 'scale3d(0,0,1)', opacity: 0 })),\r\n      state('visible', style({ transform: 'scale3d(1,1,1)', opacity: 1 })),\r\n      transition(\r\n        'x => startAnimated',\r\n        CustomAnimation.createScaleInTransition(200, 500, EASE_IN_OUT_BACK)\r\n      )\r\n    ]),\r\n    trigger(\r\n      'enterAnimation',\r\n      CustomAnimation.createEnterScaleInAnimation(0, 200, EASE_IN_OUT)\r\n    ),\r\n    trigger('listAnimate', [\r\n      transition('* => *', [\r\n        query(\r\n          ':enter',\r\n          [\r\n            style({\r\n              transform: 'translate3d(0, -30px, 0) scale3d(0, 0, 1)',\r\n              opacity: 0\r\n            }), // initial\r\n            stagger(\r\n              100,\r\n              animate(\r\n                `200ms 0ms ${EASE_IN_OUT}`,\r\n                style({\r\n                  transform: 'translate3d(0, 0, 0) scale3d(1,1,1)',\r\n                  opacity: 1\r\n                })\r\n              )\r\n            )\r\n          ],\r\n          { optional: true }\r\n        )\r\n      ])\r\n    ])\r\n  ]\r\n})\r\nexport class GeoFabComponent implements OnInit, OnDestroy {\r\n  fullscreen$: Observable<boolean>;\r\n  currentGeoHazard$: Observable<GeoHazard[]>;\r\n  selectableGeoHazards$: Observable<GeoHazard[][]>;\r\n\r\n  @Input() color = 'light';\r\n  @Input() isOpen = false;\r\n  @Input() showLabels = true;\r\n  @Output() isOpenChange = new EventEmitter();\r\n  @Input() animateOnEnter = false;\r\n\r\n  private ngDestroy$ = new Subject<void>();\r\n  private animationTimout: NodeJS.Timeout;\r\n\r\n  animateOnEnterState = 'x';\r\n\r\n  // get selectableGeoHazards() {\r\n  //   return this.geoHazardTypes.filter((x) => !(this.currentGeoHazard && this.currentGeoHazard.some((c) => x.some((z) => z === c))));\r\n  // }\r\n\r\n  constructor(\r\n    private fullscreenService: FullscreenService,\r\n    private userSettingService: UserSettingService,\r\n    private ngZone: NgZone\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.currentGeoHazard$ = this.userSettingService.currentGeoHazard$;\r\n    this.selectableGeoHazards$ = this.currentGeoHazard$.pipe(\r\n      map((currentGeoHazard) =>\r\n        GEOHAZARD_TYPES.filter(\r\n          (t) => !currentGeoHazard.some((c) => t.some((z) => z === c))\r\n        )\r\n      )\r\n    );\r\n    this.fullscreen$ = this.fullscreenService.isFullscreen$;\r\n    if (this.animateOnEnter) {\r\n      this.animationTimout = setTimeout(() => {\r\n        this.animateOnEnterState = 'startAnimated';\r\n      }, 500);\r\n    } else {\r\n      this.animateOnEnterState = 'visible';\r\n    }\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.animationTimout) {\r\n      clearTimeout(this.animationTimout);\r\n    }\r\n    this.ngDestroy$.next();\r\n    this.ngDestroy$.complete();\r\n  }\r\n\r\n  toggle() {\r\n    this.triggerOpenClose(!this.isOpen);\r\n  }\r\n\r\n  open() {\r\n    this.triggerOpenClose(true);\r\n  }\r\n\r\n  close() {\r\n    this.triggerOpenClose(false);\r\n  }\r\n\r\n  triggerOpenClose(open: boolean) {\r\n    const changed = this.isOpen !== open;\r\n    if (changed) {\r\n      this.isOpen = open;\r\n      this.isOpenChange.emit(this.isOpen);\r\n    }\r\n  }\r\n\r\n  async setCurrentGeoHazard(geoHazards: GeoHazard[]) {\r\n    this.close();\r\n    const currentSettings = await this.userSettingService.userSetting$\r\n      .pipe(take(1))\r\n      .toPromise();\r\n    this.userSettingService.saveUserSettings({\r\n      ...currentSettings,\r\n      currentGeoHazard: geoHazards\r\n    });\r\n  }\r\n}\r\n","import { Component, OnInit, Input } from '@angular/core';\r\nimport { GeoHazard } from '@varsom-regobs-common/core';\r\n\r\n@Component({\r\n  selector: 'app-geo-icon',\r\n  templateUrl: './geo-icon.component.html',\r\n  styleUrls: ['./geo-icon.component.scss']\r\n})\r\nexport class GeoIconComponent implements OnInit {\r\n  constructor() {}\r\n\r\n  @Input() geoHazards: GeoHazard[];\r\n  @Input() useGeoColors = true;\r\n\r\n  get geoClass() {\r\n    if (this.geoHazards && this.geoHazards.length > 0) {\r\n      return this.geoHazards\r\n        .map((geoHazard) => geoHazard !== GeoHazard.Soil ? (<string>GeoHazard[geoHazard]).toLowerCase() : 'dirt')\r\n        .join('-');\r\n    }\r\n    return '';\r\n  }\r\n\r\n  get iconSrc() {\r\n    return `/assets/icon/${this.geoClass.replace(/-/, '_')}.svg`;\r\n  }\r\n\r\n  ngOnInit() {}\r\n}\r\n","<ion-icon [src]=\"iconSrc\" [ngClass]=\"[useGeoColors ? 'geo-color' : '', geoClass]\"></ion-icon>","import { Component, OnInit, Input } from '@angular/core';\r\nimport { GeoHazard } from '@varsom-regobs-common/core';\r\nimport { Observable } from 'rxjs';\r\nimport { GeoHelperService } from '../../services/geo-helper/geo-helper.service';\r\n\r\n@Component({\r\n  selector: 'app-geo-name',\r\n  templateUrl: './geo-name.component.html',\r\n  styleUrls: ['./geo-name.component.scss']\r\n})\r\nexport class GeoNameComponent implements OnInit {\r\n  @Input() geoHazards: GeoHazard[];\r\n\r\n  name$: Observable<string>;\r\n\r\n  constructor(private geoHelperService: GeoHelperService) {}\r\n\r\n  ngOnInit() {\r\n    this.name$ = this.geoHelperService.getName(this.geoHazards);\r\n  }\r\n}\r\n","{{ name$ | async }}","<ion-fab *ngIf=\"(userSettings$ | async) as userSettings\" #geoSelectorFab vertical=\"top\" horizontal=\"start\" slot=\"fixed\">\r\n  <ion-fab-button class=\"toggle-button\" *ngIf=\"!isOpen\" color=\"light\" (click)=\"toggle()\">\r\n    <app-geo-icon [geoHazards]=\"userSettings.currentGeoHazard\"></app-geo-icon>\r\n  </ion-fab-button>\r\n  <div class=\"geo-selector-items\" *ngIf=\"isOpen\">\r\n    <div class=\"geo-selector-wrapper\" (click)=\"toggle()\"></div>\r\n    <ion-list lines=\"none\" class=\"ion-no-margin\">\r\n      <ion-item (click)=\"toggle()\">\r\n        <ion-fab-button slot=\"start\" color=\"light\">\r\n          <app-geo-icon [geoHazards]=\"userSettings.currentGeoHazard\"></app-geo-icon>\r\n        </ion-fab-button>\r\n        <ion-label>\r\n          <app-geo-name [geoHazards]=\"userSettings.currentGeoHazard\"></app-geo-name>\r\n        </ion-label>\r\n      </ion-item>\r\n      <ng-container *ngFor=\"let geoHazards of geoHazardTypes\">\r\n        <ion-item *ngIf=\"(geoHazards.join('-') !== userSettings.currentGeoHazard.join('-'))\"\r\n          (click)=\"changeGeoHazard(geoHazards)\">\r\n          <ion-fab-button slot=\"start\" color=\"light\">\r\n            <app-geo-icon [geoHazards]=\"geoHazards\"></app-geo-icon>\r\n          </ion-fab-button>\r\n          <ion-label>\r\n            <app-geo-name [geoHazards]=\"geoHazards\"></app-geo-name>\r\n          </ion-label>\r\n        </ion-item>\r\n      </ng-container>\r\n    </ion-list>\r\n  </div>\r\n</ion-fab>","import { Component, OnInit } from '@angular/core';\r\nimport { UserSettingService } from '../../../../core/services/user-setting/user-setting.service';\r\nimport { UserSetting } from '../../../../core/models/user-settings.model';\r\nimport { GeoHazard } from '@varsom-regobs-common/core';\r\nimport { Observable } from 'rxjs';\r\nimport { take } from 'rxjs/operators';\r\n\r\n@Component({\r\n  selector: 'app-geo-select',\r\n  templateUrl: './geo-select.component.html',\r\n  styleUrls: ['./geo-select.component.scss']\r\n})\r\nexport class GeoSelectComponent implements OnInit {\r\n  geoHazardTypes: Array<GeoHazard[]>;\r\n  isOpen = false;\r\n  userSettings$: Observable<UserSetting>;\r\n\r\n  constructor(private userSettingService: UserSettingService) {}\r\n\r\n  ngOnInit(): void {\r\n    this.geoHazardTypes = [\r\n      [GeoHazard.Snow],\r\n      [GeoHazard.Ice],\r\n      [GeoHazard.Water, GeoHazard.Soil]\r\n    ];\r\n    this.userSettings$ = this.userSettingService.userSetting$;\r\n  }\r\n\r\n  toggle(): void {\r\n    this.isOpen = !this.isOpen;\r\n  }\r\n\r\n  async changeGeoHazard(geoHazards: GeoHazard[]): Promise<void> {\r\n    this.isOpen = false;\r\n    const currentSettings = await this.userSettingService.userSetting$\r\n      .pipe(take(1))\r\n      .toPromise();\r\n    this.userSettingService.saveUserSettings({\r\n      ...currentSettings,\r\n      currentGeoHazard: geoHazards\r\n    });\r\n  }\r\n}\r\n","<ion-header mode=\"ios\" *ngIf=\"!fullscreenSupport || !(isFullscreen$ | async)\">\r\n  <ion-toolbar class=\"app-header-color\" [ngClass]=\"headerColor\" mode=\"ios\">\r\n    <ion-buttons slot=\"start\" *ngIf=\"!showMenuButton\">\r\n      <ion-back-button text=\"\" [defaultHref]=\"defaultHref\"></ion-back-button>\r\n    </ion-buttons>\r\n    <ion-buttons slot=\"end\" *ngIf=\"showMenuButton\">\r\n      <ion-menu-button color=\"light\" mode=\"ios\"></ion-menu-button>\r\n    </ion-buttons>\r\n    <ion-title *ngIf=\"!tripRunning\">\r\n      {{ title | translate }}\r\n    </ion-title>\r\n    <ion-title *ngIf=\"tripRunning\">\r\n      <ion-button class=\"stop-trip\" size=\"small\" color=\"success\" (click)=\"endTrip()\">\r\n        {{ 'TRIP.STOP_TRIP' | translate }}\r\n      </ion-button>\r\n    </ion-title>\r\n  </ion-toolbar>\r\n</ion-header>","import { Component, OnInit, Input, NgZone, OnDestroy } from '@angular/core';\r\nimport { Observable, Subscription } from 'rxjs';\r\nimport { FullscreenService } from '../../../../core/services/fullscreen/fullscreen.service';\r\nimport { TripLoggerService } from '../../../../core/services/trip-logger/trip-logger.service';\r\nimport { UserSettingService } from '../../../../core/services/user-setting/user-setting.service';\r\nimport { AppMode } from '@varsom-regobs-common/core';\r\n\r\n@Component({\r\n  selector: 'app-header',\r\n  templateUrl: './header.component.html',\r\n  styleUrls: ['./header.component.scss']\r\n})\r\nexport class HeaderComponent implements OnInit, OnDestroy {\r\n  @Input() showMenuButton = true;\r\n  @Input() fullscreenSupport = false;\r\n  @Input() title: string;\r\n  @Input() defaultHref = '/';\r\n\r\n  tripRunning = false;\r\n  private appMode = AppMode.Prod;\r\n\r\n  isFullscreen$: Observable<boolean>;\r\n  private subscriptions: Subscription[] = [];\r\n\r\n  get tripRunning$() {\r\n    return this.tripLoggerService.getLegacyTripAsObservable();\r\n  }\r\n\r\n  get headerColor() {\r\n    if (this.tripRunning) {\r\n      return 'trip-running';\r\n    } else {\r\n      return this.appMode.toLowerCase();\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    private fullscreenService: FullscreenService,\r\n    private tripLoggerService: TripLoggerService,\r\n    private userSettingService: UserSettingService,\r\n    private ngZone: NgZone\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.isFullscreen$ = this.fullscreenService.isFullscreen$;\r\n    this.subscriptions.push(\r\n      this.tripLoggerService.isTripRunning$.subscribe((val) => {\r\n        this.ngZone.run(() => {\r\n          this.tripRunning = val;\r\n        });\r\n      })\r\n    );\r\n    this.subscriptions.push(\r\n      this.userSettingService.appMode$.subscribe((appMode) => {\r\n        this.ngZone.run(() => {\r\n          this.appMode = appMode;\r\n        });\r\n      })\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    for (const subscription of this.subscriptions) {\r\n      subscription.unsubscribe();\r\n    }\r\n  }\r\n\r\n  endTrip() {\r\n    this.tripLoggerService.stopLegacyTrip();\r\n  }\r\n}\r\n","<ion-button role=\"combobox\" aria-expanded=\"false\" aria-haspopup=\"dialog\" expand=\"full\" type=\"button\" fill=\"clear\"\r\n  (click)=\"openSelect()\">\r\n</ion-button>\r\n<ion-icon class=\"value-icon\" *ngIf=\"valueIcon\" [name]=\"valueIcon\"></ion-icon>\r\n<ion-text>\r\n  {{ valueText | translate }}\r\n</ion-text>\r\n<ion-icon class=\"select-icon\" slot=\"end\" name=\"caret-down-sharp\"></ion-icon>","import { Component, OnInit, Input, EventEmitter, Output } from '@angular/core';\r\nimport { ActionSheetController } from '@ionic/angular';\r\nimport { ActionSheetButton } from '@ionic/core';\r\nimport { SelectOption } from './select-option.model';\r\nimport { TranslateService } from '@ngx-translate/core';\r\n\r\nconst TRANSLATION_KEY_CANCEL = 'DIALOGS.CANCEL';\r\nconst TRANSLATION_KEY_RESET = 'DIALOGS.RESET';\r\n\r\n@Component({\r\n  selector: 'app-select',\r\n  templateUrl: './select.component.html',\r\n  styleUrls: ['./select.component.scss']\r\n})\r\nexport class SelectComponent implements OnInit {\r\n  @Input() title: string;\r\n  @Input() subTitle: string;\r\n  @Input() selectedValue: number | string;\r\n  @Output() selectedValueChange = new EventEmitter();\r\n  @Input() options: Array<SelectOption> = [];\r\n  @Input() showReset = true;\r\n  @Input() disabled = false;\r\n\r\n  get valueText() {\r\n    const item = (this.options || []).find((x) => x.id === this.selectedValue);\r\n    if (item) {\r\n      return item.text;\r\n    }\r\n    return '';\r\n  }\r\n\r\n  get valueIcon() {\r\n    const item = (this.options || []).find((x) => x.id === this.selectedValue);\r\n    if (item) {\r\n      return item.icon;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  constructor(\r\n    private actionSheetController: ActionSheetController,\r\n    private translateService: TranslateService\r\n  ) {}\r\n\r\n  ngOnInit() {}\r\n\r\n  private async getActionSheetButtons() {\r\n    const buttons: ActionSheetButton[] = [];\r\n    for (const option of (this.options || []).filter((x) => !x.disabled)) {\r\n      const translatedText = await this.translateService\r\n        .get(option.text)\r\n        .toPromise();\r\n      buttons.push({\r\n        text: translatedText,\r\n        icon: option.icon,\r\n        role: option.id === this.selectedValue ? 'selected' : undefined,\r\n        handler: () => this.setSelectedValue(option.id)\r\n      });\r\n    }\r\n    if (this.selectedValue !== undefined && this.showReset) {\r\n      const resetTextTranslated = await this.translateService\r\n        .get(TRANSLATION_KEY_RESET)\r\n        .toPromise();\r\n      buttons.splice(0, 0, {\r\n        text: resetTextTranslated,\r\n        handler: () => this.setSelectedValue(undefined),\r\n        role: 'destructive'\r\n      });\r\n    }\r\n    const cancelTextTranslated = await this.translateService\r\n      .get(TRANSLATION_KEY_CANCEL)\r\n      .toPromise();\r\n    buttons.push({\r\n      text: cancelTextTranslated,\r\n      role: 'cancel'\r\n    });\r\n    return buttons;\r\n  }\r\n\r\n  async getTitleTranslations() {\r\n    let titleTextTranslated: string;\r\n    if (this.title) {\r\n      titleTextTranslated = await this.translateService\r\n        .get(this.title)\r\n        .toPromise();\r\n    }\r\n    let subTitleTextTranslated: string;\r\n    if (this.subTitle) {\r\n      subTitleTextTranslated = await this.translateService\r\n        .get(this.subTitle)\r\n        .toPromise();\r\n    }\r\n    return {\r\n      titleTextTranslated,\r\n      subTitleTextTranslated\r\n    };\r\n  }\r\n\r\n  async openSelect() {\r\n    if (!this.disabled) {\r\n      const translations = await this.getTitleTranslations();\r\n      const buttons = await this.getActionSheetButtons();\r\n      const actionSheet = await this.actionSheetController.create({\r\n        header: translations.titleTextTranslated,\r\n        subHeader: translations.subTitleTextTranslated,\r\n        buttons\r\n      });\r\n      await actionSheet.present();\r\n    }\r\n  }\r\n\r\n  private setSelectedValue(id: number | string) {\r\n    this.selectedValue = id;\r\n    this.selectedValueChange.emit(id);\r\n  }\r\n}\r\n","import { Component, OnInit, Input } from '@angular/core';\r\n@Component({\r\n  selector: 'app-offline-image',\r\n  templateUrl: './offline-image.component.html',\r\n  styleUrls: ['./offline-image.component.scss']\r\n})\r\nexport class OfflineImageComponent implements OnInit {\r\n  @Input() src: string;\r\n\r\n  loaded = false;\r\n  hasError = false;\r\n  _srcInternal: string;\r\n  private hasTriedFallback = false;\r\n\r\n  ngOnInit(): void {\r\n    this._srcInternal = this.src;\r\n  }\r\n\r\n  onLoaded(): void {\r\n    this.loaded = true;\r\n  }\r\n\r\n  onError(): void {\r\n    if (this.hasTriedFallback) {\r\n      this.loaded = true;\r\n      this.hasError = true;\r\n    } else {\r\n      this.tryFallbackImage();\r\n    }\r\n  }\r\n\r\n  private tryFallbackImage() {\r\n    if (this.src && this.src.indexOf('regobs.no/Attachment') > 0) {\r\n      this._srcInternal = this.src\r\n        .replace(/large/g, 'raw')\r\n        .replace(/medium/g, 'raw');\r\n    } else {\r\n      this.loaded = true;\r\n      this.hasError = true;\r\n    }\r\n    this.hasTriedFallback = true;\r\n  }\r\n}\r\n","<div class=\"offline-image-wrapper\">\r\n  <ion-img class=\"real-image\" [ngClass]=\"{ 'loaded': loaded, 'error': hasError }\" [src]=\"_srcInternal\"\r\n    (ionImgDidLoad)=\"onLoaded()\" (ionError)=\"onError()\"></ion-img>\r\n  <div class=\"animated-background\" [ngClass]=\"{ 'loaded': loaded, 'error': hasError }\">\r\n    <ion-icon name=\"flash-off\"></ion-icon>\r\n  </div>\r\n</div>","<ion-refresher slot=\"fixed\" (ionRefresh)=\"doRefresh()\" [disabled]=\"disabled\">\r\n  <ion-refresher-content pullingIcon=\"arrow-down-circle\" [refreshingSpinner]=\"spinner\" pullingText=\"\">\r\n  </ion-refresher-content>\r\n  <ion-grid *ngIf=\"showCancel\">\r\n    <ion-row>\r\n      <ion-col class=\"ion-text-center\">\r\n        <ion-button fill=\"clear\" size=\"small\" (click)=\"cancel()\">{{ 'DIALOGS.CANCEL' | translate }}</ion-button>\r\n      </ion-col>\r\n    </ion-row>\r\n  </ion-grid>\r\n</ion-refresher>","import { Component, OnInit, NgZone, ViewChild, Input } from '@angular/core';\r\nimport { Subject } from 'rxjs';\r\nimport { take } from 'rxjs/operators';\r\nimport { IonRefresher, Platform } from '@ionic/angular';\r\n\r\n@Component({\r\n  selector: 'app-refresh-with-cancel',\r\n  templateUrl: './refresh-with-cancel.component.html',\r\n  styleUrls: ['./refresh-with-cancel.component.scss']\r\n})\r\nexport class RefreshWithCancelComponent implements OnInit {\r\n  showCancel = false;\r\n\r\n  // @Output() refresh: EventEmitter<Promise<boolean>> = new EventEmitter();\r\n  @ViewChild(IonRefresher) refresher: IonRefresher;\r\n  @Input() refreshFunc: (cancelPromise: Promise<boolean>) => Promise<any>;\r\n  @Input() cancelSubject: Subject<any>;\r\n  @Input() disabled = false;\r\n\r\n  spinner: string;\r\n\r\n  constructor(private ngZone: NgZone, private platform: Platform) {}\r\n\r\n  ngOnInit(): void {\r\n    this.spinner = this.platform.is('android') ? 'crescent' : 'lines';\r\n    if (!this.cancelSubject) {\r\n      this.cancelSubject = new Subject<boolean>();\r\n    }\r\n  }\r\n\r\n  cancel(): void {\r\n    this.cancelSubject.next(true);\r\n  }\r\n\r\n  private getCancelPromise() {\r\n    return this.cancelSubject.asObservable().pipe(take(1)).toPromise();\r\n  }\r\n\r\n  async doRefresh(): Promise<void> {\r\n    if (this.refreshFunc) {\r\n      const cancelPromise = this.getCancelPromise();\r\n      cancelPromise.then(() => this.complete());\r\n      // It takes to long to wait for function to complete (even when cancelled), so hide refresher on cancel.\r\n      this.ngZone.run(() => {\r\n        this.showCancel = true;\r\n      });\r\n      try {\r\n        await this.refreshFunc(cancelPromise);\r\n      } finally {\r\n        this.complete();\r\n      }\r\n    }\r\n  }\r\n\r\n  private complete() {\r\n    this.ngZone.run(() => {\r\n      this.refresher.complete();\r\n    });\r\n    this.ngZone.run(() => {\r\n      this.showCancel = false;\r\n    });\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  OnInit,\r\n  OnDestroy,\r\n  HostBinding,\r\n  NgZone\r\n} from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\nimport { AppMode } from '@varsom-regobs-common/core';\r\nimport { UserSettingService } from '../../../../core/services/user-setting/user-setting.service';\r\n\r\n@Directive({\r\n  selector: '[appHeaderColor]'\r\n})\r\nexport class HeaderColorDirective implements OnInit, OnDestroy {\r\n  private appMode: AppMode;\r\n  private subscription: Subscription;\r\n\r\n  @HostBinding('class')\r\n  get elementClass(): string {\r\n    return `hydrated app-header-color ${\r\n      this.appMode ? this.appMode.toLowerCase() : ''\r\n    }`;\r\n  }\r\n\r\n  constructor(\r\n    private userSettingService: UserSettingService,\r\n    private ngZone: NgZone\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.subscription = this.userSettingService.appMode$.subscribe(\r\n      (appMode) => {\r\n        this.ngZone.run(() => {\r\n          this.appMode = appMode;\r\n        });\r\n      }\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.subscription) {\r\n      this.subscription.unsubscribe();\r\n    }\r\n  }\r\n}\r\n","import { Directive, ElementRef, Input, OnChanges } from '@angular/core';\r\n@Directive({\r\n  selector: '[appShadowCss]'\r\n})\r\nexport class ShadowCssDirective implements OnChanges {\r\n  @Input() shadowCustomCss: string;\r\n\r\n  ngOnChanges(): void {\r\n    const shadow =\r\n      this.el.nativeElement.shadowRoot ||\r\n      this.el.nativeElement.attachShadow({ mode: 'open' });\r\n    if (shadow) {\r\n      let innerHTML = '';\r\n      innerHTML += '<style>';\r\n      innerHTML += this.shadowCustomCss;\r\n      innerHTML += '</style>';\r\n      shadow.innerHTML += innerHTML;\r\n    }\r\n  }\r\n  constructor(private el: ElementRef) {}\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\n\r\n@Pipe({\r\n  name: 'abs'\r\n})\r\nexport class AbsPipe implements PipeTransform {\r\n  transform(value: unknown): number | null {\r\n    try {\r\n      return Math.abs(value as number);\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\nimport moment from 'moment';\r\nimport { DateHelperService } from '../../services/date-helper/date-helper.service';\r\n\r\n@Pipe({\r\n  name: 'formatDate'\r\n})\r\nexport class FormatDatePipe implements PipeTransform {\r\n  constructor(private dateHelperService: DateHelperService) {}\r\n\r\n  transform(\r\n    value: string | Date,\r\n    showMonthNames = true,\r\n    showYear = true,\r\n    showTime = true\r\n  ) {\r\n    return this.dateHelperService.formatDateString(\r\n      typeof value === 'string' ? value : value ? value.toISOString() : '',\r\n      showMonthNames,\r\n      showYear,\r\n      showTime\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport moment from 'moment';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DateHelperService {\r\n  constructor(private translateService: TranslateService) {}\r\n\r\n  formatDateString(\r\n    dateString: string,\r\n    showMonthNames = true,\r\n    showYear = true,\r\n    showTime = true,\r\n    currentTimeZone: string = null\r\n  ) {\r\n    return this.formatDate(\r\n      moment.parseZone(dateString),\r\n      showMonthNames,\r\n      showYear,\r\n      showTime,\r\n      currentTimeZone\r\n    );\r\n  }\r\n\r\n  async formatDate(\r\n    date: moment.Moment,\r\n    showMonthNames = true,\r\n    showYear = true,\r\n    showTime = true,\r\n    currentTimeZone: string = null\r\n  ) {\r\n    const timezone = currentTimeZone || moment().format('Z');\r\n    if (!date.isValid()) {\r\n      return '';\r\n    }\r\n    const parts = [];\r\n    let dateAndMonth = date.format('DD/MM');\r\n    if (showMonthNames) {\r\n      const monthNames = await this.translateService\r\n        .get('MONTHS.SHORT_LIST')\r\n        .toPromise();\r\n      const monthName = monthNames.split(',')[date.month()].trim();\r\n      dateAndMonth = `${date.format('D')}. ${monthName}`;\r\n    }\r\n    parts.push(dateAndMonth);\r\n    if (showYear) {\r\n      parts.push(date.format('YYYY'));\r\n    }\r\n    if (showTime) {\r\n      parts.push(date.format('HH:mm'));\r\n      if (date.format('Z') !== timezone) {\r\n        parts.push(`(${date.format('Z')})`);\r\n      }\r\n    }\r\n    return parts.join(' ');\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { GeoHazard } from '@varsom-regobs-common/core';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class GeoHelperService {\r\n  constructor(private translateService: TranslateService) {}\r\n\r\n  getTranslationKey(geoHazard: GeoHazard) {\r\n    const geoHazardKey = geoHazard !== GeoHazard.Soil ? GeoHazard[geoHazard] : 'Dirt';\r\n    return `GEO_HAZARDS.${geoHazardKey}`.toUpperCase();\r\n  }\r\n\r\n  getTranslationKeys(geoHazards: GeoHazard[]) {\r\n    if (geoHazards && geoHazards.length > 0) {\r\n      return geoHazards.map((geoHazard) => this.getTranslationKey(geoHazard));\r\n    }\r\n    return [];\r\n  }\r\n\r\n  getName(geoHazards: GeoHazard[]): Observable<string> {\r\n    const keys = this.getTranslationKeys(geoHazards);\r\n    return this.translateService\r\n      .get(keys)\r\n      .pipe(map((val) => keys.map((k) => val[k]).join(' / ')));\r\n  }\r\n\r\n  getAllGeoHazards(): GeoHazard[] {\r\n    return Object.keys(GeoHazard)\r\n      .filter((key) => typeof GeoHazard[key] === 'number')\r\n      .map((key) => GeoHazard[key]);\r\n  }\r\n}\r\n","/* eslint-disable @typescript-eslint/no-explicit-any */\r\n/* eslint-disable @typescript-eslint/explicit-module-boundary-types */\r\n/* eslint-disable @typescript-eslint/no-empty-function */\r\n/* eslint-disable @typescript-eslint/no-unused-vars */\r\n/* eslint-disable no-console */\r\nimport { Injectable, Optional } from '@angular/core';\r\nimport { LogLevel } from './log-level.model';\r\nimport { LoggingService } from './logging.service';\r\nimport { AppMode } from '@varsom-regobs-common/core';\r\nimport { LoggedInUser } from '../../../login/models/logged-in-user.model';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ConsoleLoggingService implements LoggingService {\r\n\r\n  constructor() {}\r\n\r\n  enable(): void {}\r\n\r\n  disable(): void {}\r\n\r\n  configureLogging(appMode: AppMode): void {}\r\n\r\n  setUser(user: LoggedInUser): void {}\r\n\r\n  error(\r\n    error: Error,\r\n    tag?: string,\r\n    message?: string,\r\n    ...optionalParams: any[]\r\n  ) {\r\n    this.log(message, error, LogLevel.Error, tag, ...optionalParams);\r\n  }\r\n\r\n  debug(message: string, tag?: string, ...optionalParams: any[]) {\r\n    this.log(message, null, LogLevel.Debug, tag, ...optionalParams);\r\n  }\r\n\r\n  log(\r\n    message?: string,\r\n    error?: Error,\r\n    level?: LogLevel,\r\n    tag?: string,\r\n    ...optionalParams: any[]\r\n  ) {\r\n    const msg = `[${level.toUpperCase()}]${\r\n      tag ? '[' + tag + ']' : ''\r\n    } ${message}`;\r\n    optionalParams.length > 0\r\n      ? console.log(msg, optionalParams)\r\n      : console.log(msg);\r\n    if (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Based on https://github.com/SmartMoveSystems/ionicLogFileAppender\r\n * SmartMove Ionic rolling log file appender\r\n * CellTrack Systems Pty Ltd 2018\r\n *\r\n * MIT License\r\n *\r\n * Copyright (c) 2019 SmartMove Systems\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n *\r\n */\r\n\r\nimport {formatDate} from '@angular/common';\r\nimport {Entry, File} from '@ionic-native/file/ngx';\r\nimport {Injectable} from '@angular/core';\r\nimport {Platform} from '@ionic/angular';\r\nimport * as _ from 'lodash';\r\nimport {ILogProviderConfig} from './file-logging.config';\r\nimport { EmailComposer, EmailComposerOptions } from '@ionic-native/email-composer/ngx';\r\nimport { settings } from 'src/settings';\r\nimport { LogLevel } from './log-level.model';\r\n\r\n @Injectable({\r\n   providedIn: 'root'\r\n })\r\nexport class FileLoggingService {\r\n\r\n    private fileLoggerReady = false;\r\n    private initFailed = false;\r\n    private currentFile: Entry;\r\n    private lines: 0;\r\n    private queue: string[] = [];\r\n    private processing = false;\r\n\r\n    private readonly defaultConfig: LogProviderConfig;\r\n\r\n    private config: LogProviderConfig;\r\n\r\n    constructor(private file: File,\r\n                private platform: Platform,\r\n                private emailComposer: EmailComposer\r\n    ) {\r\n      this.defaultConfig = new LogProviderConfig({\r\n        enableMetaLogging: false,\r\n        logToConsole: false,\r\n        logDateFormat: 'yyyy-MM-dd HH:mm:ss.SSS',\r\n        fileDateFormat: 'yyyy-MM-dd_HH-mm-ss',\r\n        fileMaxLines: 2000,\r\n        fileMaxSize: 1000000,\r\n        totalLogSize: 5000000,\r\n        baseDir: file.cacheDirectory,\r\n        logDir: 'logs',\r\n        logPrefix: 'regobs',\r\n        devMode: false\r\n      });\r\n      this.config = this.defaultConfig;\r\n    }\r\n\r\n    /**\r\n     * Initializes the file logger\r\n     */\r\n    init(configuration: ILogProviderConfig): Promise<any> {\r\n      return this.platform.ready()\r\n        .then(() => {\r\n          this.config = new LogProviderConfig(configuration);\r\n          // Any configuration not specified will take the defaults\r\n          this.config.merge(this.defaultConfig);\r\n          if (!this.config.baseDir) {\r\n            if (this.platform.is('hybrid')) {\r\n              // Can only initialize this after platform is ready\r\n              this.config.baseDir = this.file.dataDirectory;\r\n            } else {\r\n              this.debug_metaLog('FileLoggingService: No baseDirectory set');\r\n            }\r\n          }\r\n          this.debug_metaLog('LogProvider initialized with configuration: ' + JSON.stringify(this.config));\r\n          this.fileLoggerReady = false;\r\n          this.debug_metaLog('Initializing file logger');\r\n          this.log('Initializing file logger');\r\n          if (!this.platform.is('hybrid'))\r\n          {\r\n            this.debug_metaLog('Not initialising file logger as the it is not supported by the platform ' + this.platform.url());\r\n            this.initFailed = true;\r\n            return Promise.resolve();\r\n          }\r\n          this.debug_metaLog('Data directory: ' + this.config.baseDir);\r\n          return this.file.checkDir(this.config.baseDir, this.config.logDir)\r\n            .then(() => {\r\n              this.debug_metaLog('Found logging directory');\r\n              return this.initLogFile();\r\n            })\r\n            .catch(err => {\r\n              this.debug_metaLog('Could not find logging directory: ' + JSON.stringify(err));\r\n              return this.createLogDir();\r\n            });\r\n        });\r\n    }\r\n\r\n    isReady(): boolean {\r\n      return this.fileLoggerReady;\r\n    }\r\n\r\n    /**\r\n     * Attempts to create the logging directory\r\n     */\r\n    private createLogDir(): Promise<any> {\r\n      this.debug_metaLog('Attempting to create logging directory');\r\n      return this.file.createDir(this.config.baseDir, this.config.logDir, false)\r\n        .then(() => {\r\n          this.debug_metaLog('Successfully created logging directory');\r\n          return this.initLogFile();\r\n        })\r\n        .catch(err => {\r\n          this.initFailed = true;\r\n          this.debug_metaLog('Failed to create logging directory: ' + JSON.stringify(err));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Attempts to initialize the current log file\r\n     * @returns a promise upon completion or failure\r\n     */\r\n    private initLogFile(): Promise<any> {\r\n      this.debug_metaLog('Attempting to initialize log file');\r\n      return this.file.listDir(this.config.baseDir, this.config.logDir)\r\n        .then((entries: Entry[]) => {\r\n          if (entries && entries.length > 0) {\r\n            this.debug_metaLog(entries.length + ' existing log files found.');\r\n            return this.cleanupFiles(entries);\r\n          } else {\r\n            this.debug_metaLog('No existing log files found.');\r\n            return this.cleanupCompleted(null, 0, null);\r\n          }\r\n        })\r\n        .catch(err => {\r\n          this.debug_metaLog('Failed to get file list: ' + JSON.stringify(err, Object.getOwnPropertyNames(err)));\r\n          throw err;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Checks the total size of log files against the configured maximum size and deletes oldest if necessary\r\n     * @param entries the files found in the logging directory\r\n     */\r\n    private async cleanupFiles(entries: Entry[]): Promise<any> {\r\n      this.debug_metaLog('Starting cleanup of ' + entries.length + ' log files');\r\n      entries = _.filter(entries, (entry: Entry) => entry.isFile && entry.name && entry.name.startsWith(this.config.logPrefix));\r\n      if (entries.length === 0) {\r\n        return this.cleanupCompleted(null, 0, null)\r\n          .catch(err => {\r\n            // Now we're well and truly buggered\r\n            this.initFailed = true;\r\n            throw err;\r\n          });\r\n      }\r\n      entries = _.orderBy(entries, ['name'],['asc']);\r\n      const total = entries.length;\r\n      let calculated = 0;\r\n      let sizeTotal = 0;\r\n      try {\r\n        // Loop over entries\r\n        for (const entry of entries) {\r\n          const size = await this.getFileSize(entry);\r\n          // Calculate total size of log files\r\n          calculated++;\r\n          sizeTotal += size;\r\n          this.debug_metaLog('After ' + calculated + ' files, total size is ' + sizeTotal);\r\n          if (sizeTotal > this.config.totalLogSize) {\r\n            this.debug_metaLog('Total log file size exceeds limit: ' + sizeTotal);\r\n            return this.maxSizeExceeded(entries, size)\r\n              .catch(err => {\r\n                // Now we're well and truly buggered\r\n                this.initFailed = true;\r\n                throw err;\r\n              });\r\n          } else if (calculated === total) {\r\n            this.debug_metaLog('Total log file size is ok: ' + sizeTotal);\r\n            // Below max size, so we're ready to go\r\n            const lastEntry = entries.length > 0 ? entries[entries.length - 1] : null;\r\n            return this.cleanupCompleted(lastEntry, size, null)\r\n              .catch(err => {\r\n                // Now we're well and truly buggered\r\n                this.initFailed = true;\r\n                throw err;\r\n              });\r\n          }\r\n        }\r\n      } catch(failure) {\r\n        const lastEntry = entries.length > 0 ? entries[entries.length - 1] : null;\r\n        // Not much we can do except try to continue\r\n        return this.cleanupCompleted(lastEntry, 0, failure)\r\n          .catch(err => {\r\n            // Now we're in real trouble\r\n            this.initFailed = true;\r\n            throw err;\r\n          });\r\n      }\r\n    }\r\n\r\n    /**\r\n   * Wraps getMetadata in a Promise\r\n   * @param entry\r\n   * @returns a promise\r\n   */\r\n    private async getFileSize(entry: Entry): Promise<number> {\r\n      return new Promise((resolve: ((number) => void), reject) => {\r\n        entry.getMetadata(metadata => {\r\n          resolve(metadata.size);\r\n        }, failure => {\r\n          reject('SEVERE ERROR: could not retrieve metadata. ' + JSON.stringify(failure));\r\n        });\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Attempts to remove one file and recursively check total size again\r\n     * @param entries\r\n     * @param lastEntrySize\r\n     * @param resolve\r\n     * @param reject\r\n     */\r\n    private maxSizeExceeded(entries: Entry[], lastEntrySize: number): Promise<any> {\r\n      return this.removeFile(entries[0])\r\n        .then(() => {\r\n          this.debug_metaLog('Entry successfully removed');\r\n          // Remove oldest entry\r\n          entries.shift();\r\n          // Check again\r\n          return this.cleanupFiles(entries);\r\n        })\r\n        .catch(err => {\r\n          const lastEntry = entries.length > 0 ? entries[entries.length - 1] : null;\r\n          // Not much we can do except try to continue\r\n          return this.cleanupCompleted(lastEntry, lastEntrySize, 'SEVERE ERROR: could not clean up old files. ' + err);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * When file cleanup is completed, attempts to initialize config to point to current log file\r\n     * @param lastEntry The most recent existing log file\r\n     * @param lastEntrySize The size of the most recent existing log file\r\n     * @param error Any error to be logged after initialization\r\n     */\r\n    private cleanupCompleted(lastEntry: Entry, lastEntrySize: number, error: string): Promise<any> {\r\n      this.debug_metaLog('Log file cleanup done');\r\n      if (lastEntry && lastEntrySize < this.config.fileMaxSize) {\r\n        this.currentFile = lastEntry;\r\n        this.fileLoggerReady = true;\r\n        if (error) {\r\n          this.log(error);\r\n        }\r\n        this.debug_metaLog('File logger initialized at existing file: ' + this.currentFile.fullPath);\r\n        this.log('File logger initialized at existing file: ' + this.currentFile.name);\r\n        return Promise.resolve();\r\n      } else {\r\n        this.debug_metaLog('Last file nonexistent or too large. Creating new log file');\r\n        return this.createNextFile()\r\n          .then(() => {\r\n            this.fileLoggerReady = true;\r\n            if (error) {\r\n              this.log(error);\r\n            }\r\n            this.debug_metaLog('File logger initialized at new file: ' + this.currentFile.fullPath);\r\n            this.log('File logger initialized at new file: ' + this.currentFile.name);\r\n            return Promise.resolve();\r\n          });\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Attempts to remove a file\r\n     * @param entry\r\n     */\r\n    private removeFile(entry: Entry): Promise<any> {\r\n      this.debug_metaLog('Removing file: ' + entry.fullPath);\r\n      const fullPath = entry.fullPath;\r\n      const path = fullPath.replace(entry.name, '');\r\n      return this.file.removeFile(this.config.baseDir + path, entry.name);\r\n    }\r\n\r\n    /**\r\n     * Puts the message on the queue for writing to file\r\n     * @param message\r\n     * @param err. If true, logging is at error level\r\n     */\r\n    private logInternal(message: string, err?: boolean): void {\r\n      const date = new Date();\r\n      const dateString = formatDate(date, this.config.logDateFormat, 'en-US');\r\n      const logMessage = '[' + dateString + '] ' + message + '\\r\\n';\r\n      if (this.config.logToConsole) {\r\n        if (err) {\r\n          console.error(logMessage);\r\n        } else {\r\n          console.log(logMessage);\r\n        }\r\n      }\r\n      if (this.initFailed) {\r\n        this.debug_metaLog('File logger init has failed! Message discarded');\r\n        return;\r\n      } else {\r\n        // Put the message on the queue\r\n        this.queue.push(logMessage);\r\n        if (this.fileLoggerReady) {\r\n          if (this.queue.length > 0 && !this.processing) {\r\n            this.processing = true;\r\n            this.doProcess();\r\n          }\r\n        } else {\r\n          this.debug_metaLog('File logger is not ready! Message left on queue');\r\n        }\r\n      }\r\n    }\r\n\r\n    log(\r\n      message?: string,\r\n      error?: Error,\r\n      level?: LogLevel,\r\n      tag?: string,\r\n      ...optionalParams: any[]\r\n    ): void {\r\n      let msg = `[${level?.toUpperCase()}]${\r\n        tag ? '[' + tag + ']' : ''\r\n      } ${message}`;\r\n      if (optionalParams) {\r\n        msg += `. Params: ${this.stringify(optionalParams)}`;\r\n      }\r\n      if (error || (level && level == LogLevel.Error)) {\r\n        this.err(msg, error);\r\n      } else {\r\n        this.logInternal(msg, false);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Developer-level logging\r\n     * @param message\r\n     */\r\n    logDev(message: string): void {\r\n      if (this.config.devMode) {\r\n        this.log('*DEBUG* ' + message);\r\n      }\r\n    }\r\n\r\n    /**\r\n   * Error-level logging with optional error object\r\n   * @param message\r\n   * @param error\r\n   */\r\n    err(message: string, error?: any): void {\r\n      let logMessage = 'ERROR! ' + message;\r\n      if (error) {\r\n        logMessage += ': ' + this.stringify(error);\r\n      }\r\n      this.logInternal(logMessage, true);\r\n    }\r\n\r\n    private stringify(objects: any[]): string {\r\n      if (objects && objects.length > 0) {\r\n        return JSON.stringify(objects);\r\n      }\r\n      return '';\r\n    }\r\n\r\n    /**\r\n     * Writes the current logging queue to file\r\n     */\r\n    private doProcess(): void {\r\n      this.debug_metaLog('Beginning processing loop');\r\n      this.processQueue()\r\n        .then(() => {\r\n          if (this.queue.length > 0) {\r\n            this.doProcess();\r\n          } else {\r\n            this.checkFileLength()\r\n              .then(() => {\r\n                this.processing = false;\r\n              })\r\n              .catch(err => {\r\n                this.debug_metaLog('Error checking file length: ' + JSON.stringify(err));\r\n                this.processing = false;\r\n              });\r\n          }\r\n        })\r\n        .catch(err => {\r\n          this.debug_metaLog('Error processing queue: ' + err);\r\n          this.processing = false;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Writes the oldest entry in the queue to file, then checks if file rollover is required\r\n     */\r\n    private processQueue(): Promise<any> {\r\n      this.debug_metaLog('Processing queue of length ' + this.queue.length);\r\n      if (this.queue.length > 0) {\r\n        const message = this.queue.shift();\r\n        return this.file.writeFile(this.config.baseDir + '/' + this.config.logDir, this.currentFile.name, message, {\r\n          append: true,\r\n          replace: false\r\n        })\r\n          .then(() => {\r\n            this.lines++;\r\n            return this.checkFileLength();\r\n          })\r\n          .catch(err => {\r\n            this.debug_metaLog('Error writing to file: ' + err);\r\n          });\r\n      } else {\r\n        return Promise.resolve();\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Checks the file length and creates a new file if required\r\n     */\r\n    private checkFileLength(): Promise<any> {\r\n      if (this.lines >= this.config.fileMaxLines) {\r\n        this.debug_metaLog('Creating new file as max number of log entries exceeded');\r\n        return this.createNextFile();\r\n      } else {\r\n        return Promise.resolve();\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Generates a log file name from the current time\r\n     */\r\n    private createLogFileName(): string {\r\n      const date = new Date();\r\n      const dateString = formatDate(date, this.config.fileDateFormat, 'en-US');\r\n      return this.config.logPrefix + '.' + dateString + '.log';\r\n    }\r\n\r\n    /**\r\n     * Creates the next log file and updates the local reference\r\n     */\r\n    private createNextFile(): Promise<any> {\r\n      const fileName = this.createLogFileName();\r\n      this.debug_metaLog('Attempting to create file at: ' + this.config.baseDir + this.config.logDir + '/' + fileName);\r\n      return this.file.createFile(this.config.baseDir + '/' + this.config.logDir, fileName, false)\r\n        .then(newFile => {\r\n          this.lines = 0;\r\n          this.currentFile = newFile;\r\n          this.debug_metaLog('Created new file: ' + this.currentFile.fullPath);\r\n        })\r\n        .catch(err => {\r\n          this.debug_metaLog('Failed to create new file: ' + JSON.stringify(err));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Retrieves the current list of log files in the logging directory\r\n     */\r\n    getLogFiles(): Promise<Entry[]> {\r\n      this.debug_metaLog('Attempting to retrieve log files');\r\n      if (this.initFailed) {\r\n        this.debug_metaLog('Log never initialized so can\\'t retrieve files');\r\n        return Promise.resolve([]);\r\n      } else {\r\n        return this.file.listDir(this.config.baseDir, this.config.logDir);\r\n      }\r\n    }\r\n\r\n    private debug_metaLog(message: string): void {\r\n      if (this.config.enableMetaLogging) {\r\n        console.log('**LOGGER_META**: ' + message);\r\n      }\r\n    }\r\n\r\n    async sendLogsByEmail(): Promise<void> {\r\n      const fileEntries = await this.getLogFiles();\r\n      const filePaths: string[] = fileEntries.map(entry => entry.toURL());\r\n      const attachments = filePaths;\r\n      const email: EmailComposerOptions = {\r\n        to: settings.errorEmailAddress,\r\n        attachments,\r\n        subject: 'Regobs-app-logger',\r\n        body: '',\r\n        isHtml: true\r\n      };\r\n      this.emailComposer.open(email);\r\n    }\r\n}\r\n\r\nclass LogProviderConfig implements ILogProviderConfig {\r\n    // If true, logs verbose details of file logging operations to console\r\n    enableMetaLogging: boolean;\r\n\r\n    // If true, all file log messages also appear in the console\r\n    logToConsole: boolean;\r\n\r\n    // Date format used in log statements\r\n    logDateFormat: string;\r\n\r\n    // Date format used in log file names.\r\n    // NOTE: be careful with special characters like ':' as this can cause file system issues\r\n    fileDateFormat: string;\r\n\r\n    // Maximum number of log statements before file rollover\r\n    fileMaxLines: number;\r\n\r\n    // If the last log file exceeds this size on initialization, a new log file will be created\r\n    fileMaxSize: number;\r\n\r\n    // If the total size of all log files exceeds this size on initialisation, oldest files will be removed\r\n    totalLogSize: number;\r\n\r\n    // Name of directory to create for logs, within the baseDir\r\n    logDir: string;\r\n\r\n    // Name of directory in which to create log directory\r\n    baseDir: string;\r\n\r\n    // Prefix for log files\r\n    logPrefix: string;\r\n\r\n    // Developer-level logging will appear in log files if true\r\n    devMode: boolean;\r\n\r\n    constructor(fields: any) {\r\n      // Quick and dirty extend/assign fields to this model\r\n      for (const f in fields) {\r\n        // @ts-ignore\r\n        this[f] = fields[f];\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Overrides this object's uninitialized fields with the passed parameter's fields\r\n     * @param config\r\n     */\r\n    merge(config: any) {\r\n      for (const k in config) {\r\n        if (!(k in this)) {\r\n          this[k] = config[k];\r\n        }\r\n      }\r\n    }\r\n}","export enum LogLevel {\r\n  Error = 'error',\r\n  Warning = 'warning',\r\n  Log = 'log',\r\n  Info = 'info',\r\n  Debug = 'debug'\r\n}\r\n","import { LogLevel } from './log-level.model';\r\nimport { AppMode } from '@varsom-regobs-common/core';\r\nimport { LoggedInUser } from '../../../login/models/logged-in-user.model';\r\n\r\nexport abstract class LoggingService {\r\n  abstract configureLogging(appMode: AppMode);\r\n  abstract setUser(user: LoggedInUser);\r\n  abstract error(\r\n    error: Error,\r\n    tag?: string,\r\n    message?: string,\r\n    ...optionalParams: any[]\r\n  );\r\n  abstract debug(message: string, tag?: string, ...optionalParams: any[]);\r\n  abstract log(\r\n    message?: string,\r\n    error?: Error,\r\n    level?: LogLevel,\r\n    tag?: string,\r\n    ...optionalParams: any[]\r\n  );\r\n  abstract enable();\r\n  abstract disable();\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { AppMode } from '@varsom-regobs-common/core';\r\nimport * as Sentry from '@sentry/browser';\r\nimport { AppVersionService } from '../../../../core/services/app-version/app-version.service';\r\nimport { settings } from '../../../../../settings';\r\nimport { environment } from '../../../../../environments/environment';\r\nimport { LoggedInUser } from '../../../login/models/logged-in-user.model';\r\nimport { LoggingService } from './logging.service';\r\nimport { LogLevel } from './log-level.model';\r\nimport { FileLoggingService } from './file-logging.service';\r\nimport { AppVersion } from 'src/app/core/models/app-version.model';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SentryService implements LoggingService {\r\n\r\n  private versionInfo: AppVersion;\r\n\r\n  constructor(\r\n    appVersionService: AppVersionService,\r\n    private fileLoggingService: FileLoggingService\r\n  ) {\r\n    this.versionInfo = appVersionService.getAppVersion();\r\n    this.log(\r\n      `Version = ${this.versionInfo.version}, build = ${this.versionInfo.buildNumber}`,\r\n      null,\r\n      LogLevel.Info\r\n    );\r\n  }\r\n\r\n  error(\r\n    error: Error,\r\n    tag?: string,\r\n    message?: string,\r\n    ...optionalParams: any[]\r\n  ) {\r\n    this.log(message, error, LogLevel.Error, tag, ...optionalParams);\r\n  }\r\n\r\n  debug(message: string, tag?: string, ...optionalParams: any[]) {\r\n    this.log(message, null, LogLevel.Debug, tag, ...optionalParams);\r\n  }\r\n\r\n  configureLogging(appMode: AppMode) {\r\n    Sentry.init({\r\n      dsn: environment.production ? settings.sentryDsn : null,\r\n      transport: Sentry.Transports.FetchTransport,\r\n      environment:\r\n        appMode === AppMode.Prod\r\n          ? 'regObs'\r\n          : appMode === AppMode.Demo\r\n            ? 'demo regObs'\r\n            : 'test regObs',\r\n      enabled: environment.production,\r\n      release: this.versionInfo.version,\r\n      dist: this.versionInfo.revision\r\n    });\r\n  }\r\n\r\n  enable() {\r\n    Sentry.init({\r\n      dsn: environment.production ? settings.sentryDsn : null,\r\n      enabled: environment.production\r\n    });\r\n  }\r\n\r\n  disable() {\r\n    Sentry.init({\r\n      dsn: null,\r\n      enabled: false\r\n    });\r\n  }\r\n\r\n  setUser(user: LoggedInUser) {\r\n    if (user && user.email) {\r\n      Sentry.configureScope((scope) => {\r\n        scope.setUser({ email: user.email });\r\n      });\r\n    }\r\n  }\r\n\r\n  log(\r\n    message?: string,\r\n    error?: Error,\r\n    level?: LogLevel,\r\n    tag?: string,\r\n    ...optionalParams: any[]\r\n  ) {\r\n    this.fileLoggingService.log(message, error, level, tag, optionalParams, error);\r\n    if (\r\n      message &&\r\n      (level === LogLevel.Warning ||\r\n        level === LogLevel.Info ||\r\n        level === LogLevel.Error)\r\n    ) {\r\n      Sentry.addBreadcrumb({\r\n        category: tag,\r\n        data: optionalParams,\r\n        message,\r\n        level: (level as unknown) as Sentry.Severity\r\n      });\r\n    }\r\n    if (error && level === LogLevel.Error) {\r\n      if (error) {\r\n        Sentry.captureException(error);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { AUTH_CALLBACK_PATH } from 'src/app/modules/auth/factories/auth-factory';\r\n\r\n/**\r\n * Removes oauth tokens from given text\r\n * @param text looks for patterns that matches 'code=<token>' in the text\r\n * @returns the same text, but with 'TOKEN_REMOVED' instead of tokens\r\n */\r\nexport function removeOauthTokenFromUrl(text: string): string {\r\n  let result = text;\r\n  if (result?.indexOf(AUTH_CALLBACK_PATH) >= 0) {\r\n    result = updateQueryStringParameter(result, 'code', 'TOKEN_REMOVED');\r\n  }\r\n  return result;\r\n}\r\n\r\n\r\n/**\r\n * Replace specific parameter value(s) in provided url.\r\n * If the parameter doesn't exist in the url, the parameter will NOT be added.\r\n * Edited version of this SO answer: https://stackoverflow.com/a/6021027\r\n * created by \"amateur\" and edited by \"Matt Ball\", \"Joshua Stewardson\" and \"Niyaz\"\r\n * License: https://creativecommons.org/licenses/by-sa/3.0/.\r\n * @returns the new url\r\n */\r\nfunction updateQueryStringParameter(url: string, paramKey: string, paramValue: string): string {\r\n  const re = new RegExp('(?<=[?&])' + paramKey + '=.*?((?=[&\\'])|$)', 'g');\r\n  if (url.match(re)) {\r\n    return url.replace(re, paramKey + '=' + paramValue);\r\n  }\r\n  return url;\r\n}\r\n\r\n","import { TranslateModule } from '@ngx-translate/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { AngularSvgIconModule } from 'angular-svg-icon';\r\nimport { ObservationListCardComponent } from '../../components/observation/observation-list-card/observation-list-card.component';\r\nimport { ImgSwiperComponent } from '../../components/img-swiper/img-swiper.component';\r\nimport { RouterModule } from '@angular/router';\r\nimport { SummaryComponent } from '../../components/observation/summary/summary.component';\r\nimport { ObservationSkeletonComponent } from '../../components/observation/observation-skeleton/observation-skeleton.component';\r\nimport { SelectComponent } from './components/input/select/select.component';\r\nimport { GeoFabComponent } from './components/geo-fab/geo-fab.component';\r\nimport { GeoNameComponent } from './components/geo-name/geo-name.component';\r\nimport { GeoSelectComponent } from './components/geo-select/geo-select.component';\r\nimport { FormatDatePipe } from './pipes/format-date/format-date.pipe';\r\nimport { HeaderColorDirective } from './directives/header-color/header-color.directive';\r\nimport { ShadowCssDirective } from './directives/shadow-css/shadow-css.directive';\r\nimport { GeoIconComponent } from './components/geo-icon/geo-icon.component';\r\nimport { AddMenuComponent } from './components/add-menu/add-menu.component';\r\nimport { ExternalLinkComponent } from './components/external-link/external-link.component';\r\nimport { RefreshWithCancelComponent } from './components/refresh-with-cancel/refresh-with-cancel.component';\r\nimport { HeaderComponent } from './components/header/header.component';\r\nimport { OfflineImageComponent } from './components/offline-image/offline-image.component';\r\nimport { CompetenceComponent } from '../../components/competence/competence.component';\r\nimport { MapImageModule } from '../map-image/map-image.module';\r\nimport { AuthModule } from './../auth/auth.module';\r\nimport { VirtualScrollerModule } from 'ngx-virtual-scroller';\r\nimport { AbsPipe } from './pipes/abs.pipe';\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    IonicModule,\r\n    AngularSvgIconModule,\r\n    TranslateModule,\r\n    RouterModule,\r\n    MapImageModule,\r\n    AuthModule,\r\n    VirtualScrollerModule\r\n  ],\r\n  declarations: [\r\n    ShadowCssDirective,\r\n    AddMenuComponent,\r\n    OfflineImageComponent,\r\n    ExternalLinkComponent,\r\n    GeoIconComponent,\r\n    GeoSelectComponent,\r\n    FormatDatePipe,\r\n    ObservationListCardComponent,\r\n    ObservationSkeletonComponent,\r\n    ImgSwiperComponent,\r\n    HeaderComponent,\r\n    RefreshWithCancelComponent,\r\n    SummaryComponent,\r\n    HeaderColorDirective,\r\n    SelectComponent,\r\n    GeoFabComponent,\r\n    GeoNameComponent,\r\n    CompetenceComponent,\r\n    AbsPipe\r\n  ],\r\n  exports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    IonicModule,\r\n    TranslateModule,\r\n    RouterModule,\r\n    ShadowCssDirective,\r\n    AngularSvgIconModule,\r\n    MapImageModule,\r\n    AddMenuComponent,\r\n    OfflineImageComponent,\r\n    ExternalLinkComponent,\r\n    GeoIconComponent,\r\n    GeoSelectComponent,\r\n    FormatDatePipe,\r\n    ObservationListCardComponent,\r\n    ObservationSkeletonComponent,\r\n    ImgSwiperComponent,\r\n    HeaderComponent,\r\n    RefreshWithCancelComponent,\r\n    SummaryComponent,\r\n    HeaderColorDirective,\r\n    SelectComponent,\r\n    GeoFabComponent,\r\n    CompetenceComponent,\r\n    AuthModule,\r\n    VirtualScrollerModule,\r\n    AbsPipe\r\n  ]\r\n})\r\nexport class SharedModule {}\r\n","<ion-item class=\"no-border\">\r\n  <ion-label color=\"dark\" position=\"stacked\">{{'MENU.TIME_FRAME' | translate}}</ion-label>\r\n  <ion-select cancelText=\"{{'DIALOGS.CANCEL' | translate}}\" interface=\"action-sheet\" (ionChange)=\"save()\"\r\n    [(ngModel)]=\"selectedDaysBack\">\r\n    <ion-select-option *ngFor=\"let item of daysBackOptions\" [value]=\"item.val\">\r\n      <ng-container *ngIf=\"item.text\"> {{ item.text | translate }}</ng-container>\r\n      <ng-container *ngIf=\"!item.text && item.val < 28\">{{ item.val }} {{'MENU.DAYS_BACK' | translate | lowercase}}\r\n      </ng-container>\r\n      <ng-container *ngIf=\"!item.text && item.val >= 28\">{{ (item.val / 7) }} {{'MENU.WEEKS_BACK' | translate |\r\n        lowercase}}</ng-container>\r\n    </ion-select-option>\r\n  </ion-select>\r\n</ion-item>","import { Component, OnInit, OnDestroy, NgZone } from '@angular/core';\r\nimport { Subscription, combineLatest } from 'rxjs';\r\nimport { take } from 'rxjs/operators';\r\nimport { UserSettingService } from '../../../../core/services/user-setting/user-setting.service';\r\nimport { LoggingService } from '../../../shared/services/logging/logging.service';\r\nimport { GeoHazard } from '@varsom-regobs-common/core';\r\nimport { settings } from '../../../../../settings';\r\n\r\n@Component({\r\n  selector: 'app-observations-days-back',\r\n  templateUrl: './observations-days-back.component.html',\r\n  styleUrls: ['./observations-days-back.component.scss']\r\n})\r\nexport class ObservationsDaysBackComponent implements OnInit, OnDestroy {\r\n  selectedDaysBack: number;\r\n  daysBackOptions: { val: number; text: string }[];\r\n  subscription: Subscription;\r\n\r\n  constructor(\r\n    private userSettingService: UserSettingService,\r\n    private zone: NgZone,\r\n    private loggingService: LoggingService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.subscription = combineLatest([\r\n      this.userSettingService.daysBack$,\r\n      this.userSettingService.currentGeoHazard$\r\n    ]).subscribe(([daysBack, currentGeoHazard]) => {\r\n      const geoHazard = currentGeoHazard[0];\r\n      this.zone.run(() => {\r\n        this.daysBackOptions = this.getDaysBackArray(geoHazard);\r\n        const daysBackForCurrentGeoHazard = daysBack.find(\r\n          (x) => x.geoHazard === geoHazard\r\n        );\r\n        if (daysBackForCurrentGeoHazard) {\r\n          this.selectedDaysBack = daysBackForCurrentGeoHazard.daysBack;\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.subscription.unsubscribe();\r\n  }\r\n\r\n  getDaysBackArray(geoHazard: GeoHazard) {\r\n    return settings.observations.daysBack[GeoHazard[geoHazard]].map(\r\n      (val: number) => ({\r\n        val: val,\r\n        text: val === 0 ? 'MENU.TODAYS_OBSERVATIONS' : undefined\r\n      })\r\n    );\r\n  }\r\n\r\n  async save(): Promise<void> {\r\n    const userSetting = await this.userSettingService.userSetting$\r\n      .pipe(take(1))\r\n      .toPromise();\r\n    let changed = false;\r\n    for (const geoHazard of userSetting.currentGeoHazard) {\r\n      const existingValue = userSetting.observationDaysBack.find(\r\n        (x) => x.geoHazard === geoHazard\r\n      );\r\n      if (existingValue.daysBack !== this.selectedDaysBack) {\r\n        existingValue.daysBack = this.selectedDaysBack;\r\n        changed = true;\r\n      }\r\n    }\r\n    if (changed) {\r\n      this.userSettingService.saveUserSettings(userSetting);\r\n    }\r\n  }\r\n}\r\n","<ion-list lines=\"full\" class=\"ion-no-margin\" *ngIf=\"userSettings\">\r\n  <ion-list-header color=\"varsom-blue\" class=\"ion-no-margin\">\r\n    <ion-label class=\"list-header-label\">\r\n      {{'MENU.USER_SETTINGS' | translate}}\r\n    </ion-label>\r\n  </ion-list-header>\r\n  <ion-menu-toggle auto-hide=\"false\">\r\n    <app-user-login></app-user-login>\r\n    <ion-item routerLink=\"/user-settings\" routerDirection=\"forward\" detail=\"true\">\r\n      <ion-icon slot=\"start\" name=\"settings\" color=\"varsom-blue\"></ion-icon>\r\n      <ion-label class=\"menu-label\">\r\n        {{'SETTINGS.TITLE' | translate}}\r\n      </ion-label>\r\n    </ion-item>\r\n    <ion-item>\r\n      <ion-icon slot=\"start\" name=\"globe-sharp\" color=\"varsom-blue\"></ion-icon>\r\n      <ion-label position=\"stacked\" color=\"medium\" class=\"ion-text-uppercase\">\r\n        {{ \"SETTINGS.LANGUAGE\" | translate }}<span *ngIf=\"userSettings.language !== LangKey.en\"> / Language</span>\r\n      </ion-label>\r\n      <ion-select cancelText=\"{{'DIALOGS.CANCEL' | translate}}\" [(ngModel)]=\"userSettings.language\"\r\n        interface=\"action-sheet\" (ngModelChange)=\"changeLanguage()\">\r\n        <ion-select-option [value]=\"lang.langKey\" *ngFor=\"let lang of supportedLanguages\">\r\n          {{ lang.name }}\r\n        </ion-select-option>\r\n      </ion-select>\r\n    </ion-item>\r\n  </ion-menu-toggle>\r\n  <ion-list-header color=\"varsom-blue\" class=\"ion-no-margin\">\r\n    <ion-label class=\"list-header-label\">\r\n      {{'MENU.MAP_SETTINGS' | translate}}\r\n    </ion-label>\r\n  </ion-list-header>\r\n  <ion-item>\r\n    <svg-icon slot=\"start\" src=\"/assets/icon/map-center-menu.svg\"></svg-icon>\r\n    <ion-label class=\"menu-label\">\r\n      {{'MENU.SHOW_MAP_CENTER' | translate}}\r\n    </ion-label>\r\n    <ion-toggle [(ngModel)]=\"userSettings.showMapCenter\" (ionChange)=\"saveUserSettings()\"></ion-toggle>\r\n  </ion-item>\r\n  <ion-item>\r\n    <ion-icon slot=\"start\" name=\"eye\" color=\"varsom-blue\"></ion-icon>\r\n    <ion-label class=\"menu-label\">\r\n      {{'MENU.SHOW_OBSERVATIONS' | translate}}\r\n    </ion-label>\r\n    <ion-toggle [(ngModel)]=\"userSettings.showObservations\" (ionChange)=\"saveUserSettings()\"></ion-toggle>\r\n  </ion-item>\r\n  <div class=\"inner-list-panel\" *ngIf=\"userSettings.showObservations\">\r\n    <app-observations-days-back></app-observations-days-back>\r\n    <app-update-observations></app-update-observations>\r\n  </div>\r\n  <ion-item>\r\n    <ion-label position=\"stacked\" color=\"dark\" class=\"stacked-label\">{{ 'MENU.MAP' | translate }}</ion-label>\r\n    <ion-select cancelText=\"{{'DIALOGS.CANCEL' | translate}}\" [(ngModel)]=\"userSettings.topoMap\"\r\n      interface=\"action-sheet\" (ngModelChange)=\"saveUserSettings()\">\r\n      <ion-select-option [value]=\"TopoMap.default\">{{ 'MENU.TILES.ARC_GIS' | translate }} + {{\r\n        'MENU.TILES.KARTVERKET' | translate }}</ion-select-option>\r\n      <ion-select-option [value]=\"TopoMap.mixOpenTopo\">{{ 'MENU.TILES.OPEN_TOPO' | translate }} + {{\r\n        'MENU.TILES.KARTVERKET' | translate }}</ion-select-option>\r\n      <ion-select-option [value]=\"TopoMap.geoDataLandskap\">{{ 'MENU.TILES.GEODATA_LANDSKAP' | translate }}\r\n      </ion-select-option>\r\n    </ion-select>\r\n  </ion-item>\r\n  <ion-menu-toggle auto-hide=\"false\">\r\n    <ion-item routerLink=\"/offline-map\" routerDirection=\"forward\" detail=\"true\">\r\n      <ion-icon slot=\"start\" name=\"download-outline\" color=\"varsom-blue\"></ion-icon>\r\n      <ion-label class=\"menu-label\">\r\n        {{ 'OFFLINE_MAP.OFFLINE_MAP_PAGE_TITLE' | translate }}\r\n      </ion-label>\r\n    </ion-item>\r\n  </ion-menu-toggle>\r\n  <app-support-tiles-menu></app-support-tiles-menu>\r\n  <ion-list-header color=\"varsom-blue\" class=\"ion-no-margin\">\r\n    <ion-label class=\"list-header-label\">\r\n      {{'MENU.OTHER' | translate}}\r\n    </ion-label>\r\n  </ion-list-header>\r\n  <ion-menu-toggle auto-hide=\"false\">\r\n    <ion-item (click)=\"showLegalTerms()\" detail=\"true\">\r\n      <ion-icon slot=\"start\" name=\"information-circle-outline\" color=\"varsom-blue\"></ion-icon>\r\n      <ion-label class=\"menu-label\">{{'MENU.ABOUT_REGOBS' | translate}}</ion-label>\r\n    </ion-item>\r\n    <ion-item (click)=\"openStartWizard()\" detail=\"true\">\r\n      <svg-icon slot=\"start\" src=\"/assets/icon/start-wizard.svg\"></svg-icon>\r\n      <ion-label class=\"menu-label\">{{'MENU.START_WIZARD' | translate}}</ion-label>\r\n    </ion-item>\r\n    <ion-item (click)=\"contactError()\" detail=\"true\">\r\n      <svg-icon slot=\"start\" src=\"/assets/icon/error.svg\"></svg-icon>\r\n      <ion-label class=\"menu-label\">{{'MENU.CONTACT_REGOBS_ERROR' | translate}}</ion-label>\r\n    </ion-item>\r\n    <ion-item (click)=\"contactUs()\" detail=\"true\">\r\n      <ion-icon slot=\"start\" name=\"mail\" color=\"varsom-blue\"></ion-icon>\r\n      <ion-label class=\"menu-label\">{{'MENU.CONTACT_REGOBS' | translate}}</ion-label>\r\n    </ion-item>\r\n  </ion-menu-toggle>\r\n  <ion-item-divider>\r\n    <ion-label class=\"ion-text-wrap\">\r\n      {{'MENU.TOPO_MAP_CREDITS' | translate}} <app-external-link src=\"https://www.kartverket.no/\">Kartverket\r\n      </app-external-link>,\r\n      <app-external-link src=\"https://www.esri.com/\">Esri</app-external-link>, <app-external-link\r\n        src=\"https://www.geodata.no/\">Geodata</app-external-link>\r\n      {{'MENU.AND' | translate}}\r\n      <app-external-link src=\"https://opentopomap.org/\">OpenTopoMap</app-external-link>.\r\n      {{'MENU.SUPPORT_MAP_CREDITS' | translate}} <app-external-link src=\"https://www.nve.no/\">NVE</app-external-link>\r\n    </ion-label>\r\n  </ion-item-divider>\r\n</ion-list>","import { Component, OnInit, OnDestroy, NgZone } from '@angular/core';\r\nimport { ObservationService } from '../../../core/services/observation/observation.service';\r\nimport { UserSettingService } from '../../../core/services/user-setting/user-setting.service';\r\nimport { UserSetting } from '../../../core/models/user-settings.model';\r\nimport { settings } from '../../../../settings';\r\nimport { Subscription } from 'rxjs';\r\nimport { ModalController, Platform, NavController } from '@ionic/angular';\r\nimport { LegalTermsModalPage } from '../../../pages/modal-pages/legal-terms-modal/legal-terms-modal.page';\r\nimport { TopoMap } from '../../../core/models/topo-map.enum';\r\nimport {\r\n  EmailComposer,\r\n  EmailComposerOptions\r\n} from '@ionic-native/email-composer/ngx';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { AppVersionService } from '../../../core/services/app-version/app-version.service';\r\nimport { LangKey } from '@varsom-regobs-common/core';\r\nimport { isAndroidOrIos } from 'src/app/core/helpers/ionic/platform-helper';\r\nimport { DataMarshallService } from 'src/app/core/services/data-marshall/data-marshall.service';\r\n\r\n@Component({\r\n  selector: 'app-side-menu',\r\n  templateUrl: './side-menu.component.html',\r\n  styleUrls: ['./side-menu.component.scss']\r\n})\r\nexport class SideMenuComponent implements OnInit, OnDestroy {\r\n  userSettings: UserSetting;\r\n  lastUpdated: Date;\r\n  settings = settings;\r\n  TopoMap = TopoMap;\r\n  LangKey = LangKey;\r\n  offlineMapsAvailable = false;\r\n\r\n  supportedLanguages: {\r\n    lang: string;\r\n    name: string;\r\n    langKey: LangKey;\r\n  }[] = settings.language.supportedLanguages.map((lang) => ({\r\n    ...lang,\r\n    langKey: LangKey[lang.lang]\r\n  }));\r\n\r\n  private lastUpdateSubscription: Subscription;\r\n  private userSettingSubscription: Subscription;\r\n\r\n  constructor(\r\n    private observationService: ObservationService,\r\n    private userSettingService: UserSettingService,\r\n    private modalController: ModalController,\r\n    private emailComposer: EmailComposer,\r\n    private translateService: TranslateService,\r\n    private appVersionService: AppVersionService,\r\n    private platform: Platform,\r\n    private navController: NavController,\r\n    private ngZone: NgZone,\r\n    private dataMarshallService: DataMarshallService\r\n  ) {}\r\n\r\n  async ngOnInit() {\r\n    this.lastUpdateSubscription = this.observationService\r\n      .getLastUpdatedForCurrentGeoHazardAsObservable()\r\n      .subscribe((val) => {\r\n        this.ngZone.run(() => {\r\n          this.lastUpdated = val;\r\n        });\r\n      });\r\n    this.userSettingSubscription = this.userSettingService.userSetting$.subscribe(\r\n      (val) => {\r\n        this.ngZone.run(() => {\r\n          this.userSettings = val;\r\n        });\r\n      }\r\n    );\r\n    this.offlineMapsAvailable = isAndroidOrIos(this.platform);\r\n  }\r\n\r\n  saveUserSettings() {\r\n    this.userSettingService.saveUserSettings(this.userSettings);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.lastUpdateSubscription) {\r\n      this.lastUpdateSubscription.unsubscribe();\r\n    }\r\n    if (this.userSettingSubscription) {\r\n      this.userSettingSubscription.unsubscribe();\r\n    }\r\n  }\r\n\r\n  updateObservations() {\r\n    this.observationService.forceUpdateObservationsForCurrentGeoHazard();\r\n  }\r\n\r\n  async showLegalTerms() {\r\n    const modal = await this.modalController.create({\r\n      component: LegalTermsModalPage\r\n    });\r\n    modal.present();\r\n  }\r\n\r\n  openStartWizard() {\r\n    this.userSettings.showGeoSelectInfo = true;\r\n    this.saveUserSettings();\r\n    this.navController.navigateRoot('start-wizard');\r\n  }\r\n\r\n  async contactUs() {\r\n    const translations = await this.translateService\r\n      .get('MENU.CONTACT_SUBJECT')\r\n      .toPromise();\r\n    const email: EmailComposerOptions = {\r\n      to: settings.errorEmailAddress,\r\n      subject: translations,\r\n      isHtml: true\r\n    };\r\n    this.emailComposer.open(email);\r\n  }\r\n\r\n  async contactError() {\r\n    const translations = await this.translateService\r\n      .get(['MENU.ERROR_REPORT_DESCRIPTION', 'MENU.CONTACT_REGOBS_ERROR'])\r\n      .toPromise();\r\n    const appVersion = await this.appVersionService.getAppVersion();\r\n    const email: EmailComposerOptions = {\r\n      to: settings.errorEmailAddress,\r\n      subject:\r\n        `${translations['MENU.CONTACT_REGOBS_ERROR']}: ${\r\n          this.platform.is('ios') ? 'ios' : ''\r\n        }` +\r\n        `${this.platform.is('android') ? 'android' : ''}` +\r\n        ` ${appVersion.version} ${appVersion.buildNumber} ${appVersion.revision}`,\r\n      body: translations['MENU.ERROR_REPORT_DESCRIPTION'],\r\n      isHtml: true\r\n    };\r\n    this.emailComposer.open(email);\r\n  }\r\n\r\n  changeLanguage() {\r\n    //save language setting\r\n    this.userSettingService.saveUserSettings(this.userSettings);\r\n\r\n    //load observations from API in new language\r\n    this.observationService.forceUpdateObservationsForCurrentGeoHazard(\r\n      this.dataMarshallService.cancelObservationsPromise\r\n    );\r\n  }\r\n}\r\n","import { Component, ChangeDetectionStrategy } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-clayzones-legend',\r\n  templateUrl: './clayzones-legend.component.html',\r\n  styleUrls: ['./clayzones-legend.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ClayzonesLegendComponent {}\r\n","<p [innerHTML]=\"'SUPPORT_MAP.CLAY_MAP_DISCLAMER' | translate\"></p>\r\n<br />\r\n<ion-grid>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAPJJREFUOI1jYaAyYBk1cOgZyNkitCZa+quS7l+G398vMRzdP+ln0U6yDDRnCBPOYahdrPROxxMmpspgmCvPrtlf/NOzhmQDkxkK65UYEIZBFLNymfx0Lq1imHuqjSF5E0kGCrGLuzD8xKaBlU2NwciTgYGBNAOZfjLz4ZJjEWLhY3iHQw6Xph/s324x/GSQxib38eu7mzgtwyXx4ueTHiEGcQteBkFOZPHHDLev3/x5rI9kA4sYXLdNZjgQKcYuVcf+k0vnP8O/b5/Z3x988PNe3iSGyi8kG8jAwMCQy+CwkeEnw0a4AJZIIslAcsCogZQDADtZRA3CbXJoAAAAAElFTkSuQmCC\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.CLAY_LEGEND_TEXT_1'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAIdJREFUOI211NENgCAMBFCaMAhDMgZDskn5kiBci7TIn+b6rMlpDJdP/BPkCx69NqyZQypEKFkz9wcKGZ437INoIBWiB5UyEPSi8XRgl1k29KLwlY2oDFpQdUMPuv1SvqJB6qEVhRtqYXOxvSgstgcVi21F1WIfohAcf1HLPYCOlzSDYhVOTgM80cZWbNLXegAAAABJRU5ErkJggg==\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.CLAY_LEGEND_TEXT_2'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAFlJREFUOI3tlMEKACAIQyf4/79spyAUSbOgg962w2NOkHF5+BlQAKnCCCDWxilsBjIrCyArOKsNUKfMavco2WRbYDaZC+wOw9oFdodh7QL/7rDyEyeYtVGdASmgOIUrOvuWAAAAAElFTkSuQmCC\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.CLAY_LEGEND_TEXT_3'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADJJREFUOI1jYaAyYBk1cNTAwWXg//+4lTEyovKxqYWooaUL0V2BD+BWO6QiZdTAYWsgAIFsBFXO3k8bAAAAAElFTkSuQmCC\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.CLAY_LEGEND_TEXT_4'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n</ion-grid>\r\n<p>{{'SUPPORT_MAP.CLAY_DANGER_ZONE'|translate}}:</p>\r\n<ion-grid>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAHhJREFUOI210ksOwCAIBFBIuP+V6cYaItPKR2enwZcxQehw5CaoBzxeG7LRdVwwfURNiXcIfrmAMY2zA4vYjKDBKgYbdjAHdjHYsIOFwAy2BaOYEunvHmaxbcMsFlrsJIYbdjHYsINBsIM5kOc7HKOgGV7B7dJG8gD5VDVWrqAQVAAAAABJRU5ErkJggg==\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.HIGH'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAIFJREFUOI211EEOwCAIBEBI/GPf6CvpoWgTwAJiOTab6RqJDQ5P+xOkAx7Khjj1/vwAr/ebnJHhnGqoggkMgU+owE1sTrOCu5jZsIIpsIqZDStYCMxgLhjFqAN97mEWcxtmsdBiJzG7YRUzG1YwE6xgCuSrX76LYzUWGZSgu7SRuQHuVU8J5MIeKgAAAABJRU5ErkJggg==\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.MIDDLE'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAIBJREFUOI211MENwCAMA0BbYmTG6M7pB3iQUBJC87ZOrmpRcPnKn6Bc8Dg35NClCgCQD7G4nmk51VAFAxjRvlCBh9i4YgVPMbNhBlNgFjMbZjAXGMG2oBcTqfK5wyi2bRjFXMMOYnbDLGY2zGAmmMEU2H798l3s01hkOIPb0XruBcqZaBfEUN04AAAAAElFTkSuQmCC\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.LOW'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n</ion-grid>\r\n<p>{{'SUPPORT_MAP.CAUTION_AREA'|translate}}:</p>\r\n<ion-grid>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADpJREFUOI1jYaAyYKGlgf+pYB4jigtLVMg3qecOhKapl0cNHDVw1MBRA7EbCCuCyASM6AYyUmQcFAAA2r4Eu4YBFUkAAAAASUVORK5CYII=\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.CLAY_LEGEND_TEXT_8'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAGBJREFUOI1jYaAyYKGZgSUqDP8pNaznDgMjC7oAuYbBHETQyzCFuCxD9xntwhAXIBQMMHmivUwqwDCQ2DDDJU97FxIbZkQbSCkYTYeUgyGWDpFjjFD5iC4PczELugClAAC0+S663TRkhAAAAABJRU5ErkJggg==\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.CLAY_LEGEND_TEXT_9'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n</ion-grid>\r\n<p>{{'SUPPORT_MAP.MARITINE_BORDER'|translate}}:</p>\r\n<ion-grid>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABtJREFUOI1jYaAyYBk1cNTAUQNHDRw1cKQaCAAQKwBR5g8A3AAAAABJRU5ErkJggg==\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.CLAY_LEGEND_TEXT_5'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAGNJREFUOI3dkjEKACAMAxX8le/3XbpKMEXTomCmLh7p1ZKCU+4AW++p5hwHFGEciJkbs/kIOD9iMwU6/K2BxjoaEMEI/9ihG4jNdryZDrHZjrf3DoW17W8jrM2PIoYfxQ0MygBTsERSNt9GdAAAAABJRU5ErkJggg==\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.CLAY_LEGEND_TEXT_6'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAFRJREFUOI1jYaAyYBk1kGHfi///GRgYGJwkGBmxaSAkT3sX4rKZWHn6RwqhMCPZQFIBQQNJje3Bk7AHLh2SGqsEDaQUEJ1TcLkcXXzgYhmXy2meDgFJ/R7VSV9q1AAAAABJRU5ErkJggg==\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.CLAY_LEGEND_TEXT_7'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n</ion-grid>","import { Component, OnInit, ChangeDetectionStrategy } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-floodzones-legend',\r\n  templateUrl: './floodzones-legend.component.html',\r\n  styleUrls: ['./floodzones-legend.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FloodzonesLegendComponent {}\r\n","<p [innerHTML]=\"'SUPPORT_MAP.FLOOD_MAP_DISCLAMER' | translate\"></p>\r\n<br />\r\n<ion-grid>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAExJREFUOI1jYaAyYIExnjEw/KfEICkGBka4gZQaBjNDioGBkQVZEGYLOYbB2Cz4FJIDRg0cNXDUwGFoIDWKMRYGBkixRdUCFlmAUgAAtX8MUWjJcMsAAAAASUVORK5CYII=\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.FLOOD_LEGEND_TEXT_1'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAExJREFUOI1jYaAyYIExns1k+E+JQVLpDIxwAyk1DGaGVDoDIwuyIMwWcgyDsVnwKSQHjBo4auCogcPQQGoUYywMDJBii6oFLLIApQAA9CQSUSl++5QAAAAASUVORK5CYII=\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.FLOOD_LEGEND_TEXT_2'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAExJREFUOI1jYaAyYIExVjAw/KfEoAgGBka4gZQaBjMjgoGBkQVZEGYLOYbB2Cz4FJIDRg0cNXDUwGFoIDWKMRYGBkixRdUCFlmAUgAAQuQMUQvlxYsAAAAASUVORK5CYII=\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.FLOOD_LEGEND_TEXT_3'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAFpJREFUOI1jYaAyYIExnjEw/MelSIqBgZGQPIaBlACYZVIMDIws6ALEuAKXgVRzITIYNXCQGIiRDvElCWIAWemQWDA4w3DUQASgRpmIkg7xaSDLhYTSITHpFAAHhBS9fDWHWwAAAABJRU5ErkJggg==\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.FLOOD_LEGEND_TEXT_4'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAEJJREFUOI1jYaAyYKGdgb4r/lNs2uYIRhQXTu/3ItuszMJtDAwMNPXyqIGjBo4aOGogLgNhRRBZYHMEI6qBUAFKAQDn3Qn5K8ZpUQAAAABJRU5ErkJggg==\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.FLOOD_LEGEND_TEXT_6'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n</ion-grid>\r\n<p>\r\n  {{'SUPPORT_MAP.FLOOD_LEGEND_TEXT_YEAR'|translate}}:\r\n</p>\r\n<ion-grid>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADFJREFUOI1jYaAyYKGZgfte/P9PiUFOEoyMKAZSC4waOGrgqIGjBtLZQFh5RjUDqQUAz1QEreCHgOkAAAAASUVORK5CYII=\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.FLOOD_LEGEND_TEXT_5'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADFJREFUOI1jYaAyYKGZgSXn//+nxKAeQ0ZGFAOpBUYNHDVw1MBRA+lsIKw8o5qB1AIA8aYFEC0jhBwAAAAASUVORK5CYII=\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.FLOOD_LEGEND_TEXT_7'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAC9JREFUOI1jYaAyYKGdgdP+/6fIpCxGRlQDqQRGDRw1cNTAUQPpbSC0PKOegVQCACtHA722vKj4AAAAAElFTkSuQmCC\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.FLOOD_LEGEND_TEXT_8'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAC9JREFUOI1jYaAyYKGdgdHP/lNk0lIpRlQDqQRGDRw1cNTAUQPpbSC0PKOegVQCAEgOBBHrbs3dAAAAAElFTkSuQmCC\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.FLOOD_LEGEND_TEXT_9'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAC9JREFUOI1jYaAyYKGdgSol/yky6U4PI6qBVAKjBo4aOGrgqIH0NhBanlHPQCoBAIG0BLocdyqFAAAAAElFTkSuQmCC\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.FLOOD_LEGEND_TEXT_10'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADFJREFUOI1jYaAyYKGZga0MK/5TYlA1QwQjioHUAqMGjho4auCogXQ2EFaeUc1AagEAUCsEJep8d6kAAAAASUVORK5CYII=\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.FLOOD_LEGEND_TEXT_11'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADFJREFUOI1jYaAyYKGZgUcZ/v+nxCBrBkZGFAOpBUYNHDVw1MBRA+lsIKw8o5qB1AIAHFoDju+MrFoAAAAASUVORK5CYII=\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.FLOOD_LEGEND_TEXT_12'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADFJREFUOI1jYaAyYKGZgf/r6/9TYhBjYyMjioHUAqMGjho4auCogXQ2EFaeUc1AagEACGIFVcABtIoAAAAASUVORK5CYII=\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.FLOOD_LEGEND_TEXT_13'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n</ion-grid>","import { SteepnessLegendComponent } from './steepness-legend/steepness-legend.component';\r\nimport { FloodzonesLegendComponent } from './floodzones-legend/floodzones-legend.component';\r\nimport { ClayzonesLegendComponent } from './clayzones-legend/clayzones-legend.component';\r\nimport { WeakenediceLegendComponent } from './weakenedice-legend/weakenedice-legend.component';\r\n\r\nexport const legendsConfig = {\r\n  steepness: SteepnessLegendComponent,\r\n  floodzoones: FloodzonesLegendComponent,\r\n  clayzones: ClayzonesLegendComponent,\r\n  weakenedice: WeakenediceLegendComponent,\r\n};\r\n","import { Component, OnInit, ChangeDetectionStrategy } from '@angular/core';\r\nimport { ModalController } from '@ionic/angular';\r\nimport { SupportMapInfoPage } from '../../../../../map/pages/support-map-info/support-map-info.page';\r\n\r\n@Component({\r\n  selector: 'app-steepness-common-legend',\r\n  templateUrl: './steepness-common-legend.component.html',\r\n  styleUrls: ['./steepness-common-legend.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SteepnessCommonLegendComponent {\r\n  constructor(private modalController: ModalController) {}\r\n\r\n  async openAboutMapsModal() {\r\n    const modalInfoPage = await this.modalController.create({\r\n      component: SupportMapInfoPage\r\n    });\r\n    modalInfoPage.present();\r\n  }\r\n}\r\n","<p>{{'SUPPORT_MAP.STEEPNESS_COLOR_INFO'|translate}}</p>\r\n<ion-grid>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADpJREFUOI1jYaAyYKGlgf+pYB4jigtVSsg36U4PhKapl0cNHDVw1MBRA7EbCCuCyASM6AYyUmQcFAAA2w4Eu02XbecAAAAASUVORK5CYII=\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      27-30\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADhJREFUOI1jYaAyYKGlgf+pYB4jigv/U2AkIyOEpqmXRw0cNXDUwFEDsRsIK4LIBIzoBlJmHBQAAF8jA1XJU6ZXAAAAAElFTkSuQmCC\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      30-35\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADlJREFUOI1jYaAyYKGlgf+pYB4jigv/r6TApHAITVMvjxo4auCogaMGYjcQVgSRCRjRDWSkyDgoAAB8swOrTPh0KQAAAABJRU5ErkJggg==\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      35-40\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADlJREFUOI1jYaAyYKGlgf+pYB4jigv/h1Jg0moITVMvjxo4auCogaMGYjcQVgSRCRjRDWSkyDgoAACZkwP/r1UNTQAAAABJRU5ErkJggg==\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      40-45\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADhJREFUOI1jYaAyYKGlgf+pYB4jigufUWCSFJSmqZdHDRw1cNTAUQOxGyiFSxVxgBHdQEbKzIMAABQxAm3yqYmFAAAAAElFTkSuQmCC\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      45-50\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADhJREFUOI1jYaAyYKGlgf+pYB4jigtLKDCpB0rT1MujBo4aOGrgqIHYDezBpYo4wIhuICNl5kEAADvTAt94zGSEAAAAAElFTkSuQmCC\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      > 50\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col class=\"ion-no-padding\">\r\n      <ion-button fill=\"clear\" (click)=\"openAboutMapsModal()\">{{'SUPPORT_MAP.READ_MORE' | translate}}</ion-button>\r\n    </ion-col>\r\n  </ion-row>\r\n</ion-grid>","<p [innerHTML]=\"'SUPPORT_MAP.STEEPNESS_MAP_DISCLAMER' | translate\"></p><br>\r\n<ng-container *ngIf=\"supportTilesWithSubTiles$ | async as supportTiles\">\r\n  <ng-container *ngIf=\"isOutletsActive(supportTiles)\">\r\n    <p [innerHTML]=\"'SUPPORT_MAP.STEEPNESS_OUTLET_LEGEND_TITLE' | translate\"></p>\r\n    <div class=\"tile-legend-row\">\r\n      <img class=\"tile-legend-image\"\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADtJREFUOI1jYaAyYKGlgf+pYB4jqgt9V5Bv1OYIBgYGGnt51MBRA0cNHDUQh4HQIohMwIhuICMlpsEAALfiBF7FLHyOAAAAAElFTkSuQmCC\" />\r\n      {{'SUPPORT_MAP.STEEPNESS_OUTLET_LEGEND_TEXT_1' | translate}}\r\n    </div>\r\n    <div class=\"tile-legend-row\">\r\n      <img class=\"tile-legend-image\"\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADlJREFUOI1jYaAyYKGlgf+pYB4jqgvzKTBzIiMDAwONvTxq4KiBowaOGojDQGgRRCZgRDeQItNgAACOoQPlkCSSYAAAAABJRU5ErkJggg==\" />\r\n      {{'SUPPORT_MAP.STEEPNESS_OUTLET_LEGEND_TEXT_2' | translate}}\r\n    </div>\r\n    <div class=\"tile-legend-row\">\r\n      <img class=\"tile-legend-image\"\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADtJREFUOI1jYaAyYKGlgf+pYB4jigv3XSLfTCc9RgYGBhp7edTAUQNHDRw1ELuBsCKITMCIbiBFpsEAANfWBMRO4MAYAAAAAElFTkSuQmCC\" />\r\n      {{'SUPPORT_MAP.STEEPNESS_OUTLET_LEGEND_TEXT_3' | translate}}\r\n    </div><br>\r\n  </ng-container>\r\n  <ng-container *ngIf=\"!isOutletsActive(supportTiles)\">\r\n    <p [innerHTML]=\"'SUPPORT_MAP.STEEPNESS_OFFLINE_DISCLAMER' | translate\"></p><br>\r\n  </ng-container>\r\n</ng-container>\r\n<app-steepness-common-legend></app-steepness-common-legend>","import { Component, ChangeDetectionStrategy } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { SupportTile } from 'src/app/core/models/support-tile.model';\r\nimport { UserSettingService } from 'src/app/core/services/user-setting/user-setting.service';import { SupportMapInfoPage } from 'src/app/modules/map/pages/support-map-info/support-map-info.page';\r\nimport {\r\n  setObservableTimeout\r\n} from '../../../../../../core/helpers/observable-helper';\r\n\r\n@Component({\r\n  selector: 'app-steepness-legend',\r\n  templateUrl: './steepness-legend.component.html',\r\n  styleUrls: ['./steepness-legend.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SteepnessLegendComponent {\r\n  readonly supportTilesWithSubTiles$: Observable<SupportTile[]>;\r\n\r\n  constructor(\r\n    private userSettingService: UserSettingService,\r\n  ) {\r\n    this.supportTilesWithSubTiles$ = this.userSettingService.supportTilesWithSubTiles$.pipe(\r\n      setObservableTimeout()\r\n    );\r\n  }\r\n\r\n  isOutletsActive(supportTiles: SupportTile[]): boolean {\r\n    const steepness = supportTiles.find((t) => t.name == 'steepness');\r\n    if (steepness && steepness.subTile && steepness.subTile.name == 'steepness-outlet') {\r\n      return steepness.subTile.enabled;\r\n    }\r\n    return false;\r\n  }\r\n}","import {\r\n  Component,\r\n  OnInit,\r\n  ChangeDetectionStrategy,\r\n  Input,\r\n  ComponentFactoryResolver,\r\n  ViewChild,\r\n  ViewContainerRef\r\n} from '@angular/core';\r\nimport { legendsConfig } from '../legends.config';\r\n\r\n@Component({\r\n  selector: 'app-support-tile-legend-loader',\r\n  templateUrl: './support-tile-legend-loader.component.html',\r\n  styleUrls: ['./support-tile-legend-loader.component.css'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SupportTileLegendLoaderComponent implements OnInit {\r\n  @Input() name: string;\r\n  @ViewChild('legend', { static: true, read: ViewContainerRef })\r\n  viewContainerRef: ViewContainerRef;\r\n\r\n  constructor(private componentFactoryResolver: ComponentFactoryResolver) {}\r\n\r\n  ngOnInit(): void {\r\n    this.loadComponent();\r\n  }\r\n\r\n  loadComponent(): void {\r\n    if (this.name && legendsConfig[this.name]) {\r\n      const componentFactory = this.componentFactoryResolver.resolveComponentFactory(\r\n        legendsConfig[this.name]\r\n      );\r\n      this.viewContainerRef.createComponent(componentFactory);\r\n    }\r\n  }\r\n}\r\n","<ng-template #legend></ng-template>","import { Component, ChangeDetectionStrategy } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-weakenedice-legend',\r\n  templateUrl: './weakenedice-legend.component.html',\r\n  styleUrls: ['./weakenedice-legend.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class WeakenediceLegendComponent {}\r\n","<p>{{'SUPPORT_MAP.ICE_MAP_DESCRIPTION'|translate}}</p>\r\n<br />\r\n<ion-grid>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADpJREFUOI1jYaAyYIFQ//9TxzhGRhbqGIQAaAYyMpJnDMKHtHbhqIGjBo4aODwMpLxcpJULyS0HMQEAAT8GUWkdMN8AAAAASUVORK5CYII=\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.ICE_LEGEND_TEXT_1'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADFJREFUOI1jYaAyYKGZgf8ZGP5TYhAjAwMjioHUAqMGjho4auCogXQ2EFaeUc1AagEAYH8CU17tvfIAAAAASUVORK5CYII=\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.ICE_LEGEND_TEXT_2'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAGlJREFUOI3t1MsJACEMBNBZSBXbf222oaeAJAqjo4eFzc0hPD8EDYfLroEFqCr2Ao/FoF8XoMYslvf4gaZXXsH6bAjuYkNQwRKoYglUsQSqGA2yGAWy70qB/2BTPR8bbOZPnPX4RhYDtRqLLD5RMLVW9QAAAABJRU5ErkJggg==\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.ICE_LEGEND_TEXT_3'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADNJREFUOI1jYaAyYBk1cNTAwWTgL2P2/5QYxHb2JyOKgdQCcANhNlDNQGqBUQNHDSQDAABtxwYe2RyxLgAAAABJRU5ErkJggg==\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.ICE_LEGEND_TEXT_4'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAD1JREFUOI1jYaAyYBk1cNRAygz8T6FZjCgGLnn/kSLTYgT5GVAMpBaAGwizgWoGMkDDgJoGUgWMGjgSDAQAY9kEzvceSB8AAAAASUVORK5CYII=\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.ICE_LEGEND_TEXT_5'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADtJREFUOI3t0MEJADAMQlGF7L+yvbSBnPXW/AGeYCFcLbigB8q0OEDJ80higKkafAsxEPeDJBhpwR/AAy3mBFXDMuqtAAAAAElFTkSuQmCC\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.ICE_LEGEND_TEXT_6'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n  <ion-row>\r\n    <ion-col size=\"1.5\" class=\"ion-no-padding\">\r\n      <img\r\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAENJREFUOI3t0LENADAIA0EisZ83omAjT5hUiUSNu/ADXPFu4nzAARsggN2BSK4CRkTHM5JWQFUPzEwteB/IQFUD/gAeu+ULeISIW6QAAAAASUVORK5CYII=\" />\r\n    </ion-col>\r\n    <ion-col size=\"auto\" class=\"ion-no-padding\">\r\n      {{'SUPPORT_MAP.ICE_LEGEND_TEXT_7'|translate}}\r\n    </ion-col>\r\n  </ion-row>\r\n</ion-grid>","<ng-container *ngIf=\"supportTilesWithSubTiles$ | async as supportTiles\">\r\n  <ng-container *ngFor=\"let supportTile of supportTiles; trackBy: trackByMethod\">\r\n    <ion-item>\r\n      <svg-icon slot=\"start\" src=\"/assets/icon/map.svg\"></svg-icon>\r\n      <ion-label class=\"menu-label ion-text-wrap\">\r\n        {{'SUPPORT_MAP.' +supportTile.description | translate }}\r\n      </ion-label>\r\n      <ion-toggle [(ngModel)]=\"supportTile.checked\" (ionChange)=\"onTileChanged(supportTile)\">\r\n      </ion-toggle>\r\n    </ion-item>\r\n    <div class=\"inner-list-panel\" *ngIf=\"isTileActive(supportTile)\">\r\n      <ion-item *ngIf=\"supportTile.subTile\">\r\n        <ion-label class=\"menu-label ion-text-wrap\">\r\n          {{'SUPPORT_MAP.' +supportTile.subTile.description | translate }}\r\n        </ion-label>\r\n        <ion-toggle [(ngModel)]=\"supportTile.subTile.checked\" (ionChange)=\"onSubTileChanged(supportTile)\"></ion-toggle>\r\n      </ion-item>\r\n      <ion-item>\r\n        <ion-label position=\"stacked\" color=\"dark\" class=\"stacked-label\">{{'MENU.OPACITY' | translate}}</ion-label>\r\n        <ion-select interface=\"action-sheet\" cancelText=\"{{'DIALOGS.CANCEL' | translate}}\"\r\n          [(ngModel)]=\"supportTile.opacity\" (ionChange)=\"onTileChanged(supportTile)\">\r\n          <ion-select-option *ngFor=\"let option of opacityValues\" [value]=\"option.value\">{{ option.name | translate }}\r\n          </ion-select-option>\r\n        </ion-select>\r\n      </ion-item>\r\n      <ion-item>\r\n        <ion-label class=\"ion-text-wrap\">\r\n          <app-support-tile-legend-loader [name]=\"supportTile.name\"></app-support-tile-legend-loader>\r\n        </ion-label>\r\n      </ion-item>\r\n    </div>\r\n  </ng-container>\r\n</ng-container>","import { Component, ChangeDetectionStrategy } from '@angular/core';\r\nimport { SubTile, SupportTile, SupportTileStore } from '../../../../core/models/support-tile.model';\r\nimport { UserSettingService } from '../../../../core/services/user-setting/user-setting.service';\r\nimport {\r\n  setObservableTimeout,\r\n  NgDestoryBase\r\n} from '../../../../core/helpers/observable-helper';\r\nimport { Observable, Subscription } from 'rxjs';\r\nimport { PopupInfoService } from '../../../../core/services/popup-info/popup-info.service';\r\nimport { takeUntil, take } from 'rxjs/operators';\r\n\r\ninterface PopupSubscription {\r\n  subscription: Subscription,\r\n  checker: (name: string) => Observable<void>,\r\n  condition: (tile: SubTile) => boolean,\r\n}\r\n\r\n@Component({\r\n  selector: 'app-support-tiles-menu',\r\n  templateUrl: './support-tiles-menu.component.html',\r\n  styleUrls: ['./support-tiles-menu.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SupportTilesMenuComponent extends NgDestoryBase {\r\n  private checkSupportMap: PopupSubscription;\r\n  private checkOfflineSupportMaps: {[mapName: string]: PopupSubscription} = {};\r\n  private subTileInstantiation: Subscription;\r\n\r\n  opacityValues = [\r\n    { name: 'SUPPORT_MAP.NO_OPACITY', value: 1.0 },\r\n    { name: '25%', value: 0.75 },\r\n    { name: '50%', value: 0.5 },\r\n    { name: '75%', value: 0.25 }\r\n  ];\r\n\r\n  readonly supportTilesWithSubTiles$: Observable<SupportTile[]>;\r\n\r\n  constructor(\r\n    private userSettingService: UserSettingService,\r\n    private popupInfoService: PopupInfoService\r\n  ) {\r\n    super();\r\n    this.supportTilesWithSubTiles$ = this.userSettingService.supportTilesWithSubTiles$.pipe(\r\n      setObservableTimeout()\r\n    );\r\n\r\n    this.subTileInstantiation = this.supportTilesWithSubTiles$.subscribe((supportTiles) => {\r\n      supportTiles.forEach(\r\n        (supportTile) => this.onTileChanged(supportTile)\r\n      );\r\n      this.subTileInstantiation.unsubscribe();\r\n    });\r\n\r\n    this.checkSupportMap = {\r\n      subscription: undefined,\r\n      checker: popupInfoService.checkSupportMapInfoPopup,\r\n      condition: (_) => true,\r\n    };\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    for (const checkMap of Object.values(this.checkOfflineSupportMaps).concat([this.checkSupportMap])) {\r\n      if (checkMap.subscription && !checkMap.subscription.closed) {\r\n        checkMap.subscription.unsubscribe();\r\n      }\r\n    }\r\n  }\r\n\r\n  trackByMethod(index: number, el: SupportTile) {\r\n    return el.name;\r\n  }\r\n\r\n  async onTileChanged(supportTile: SupportTile) {\r\n    if (supportTile.checked) {\r\n      this.onSubTileChanged(supportTile);\r\n    } else {\r\n      if (supportTile.subTile) {\r\n        supportTile.subTile.enabled = false;\r\n      }\r\n      supportTile.enabled = false;\r\n      this.saveSettings(supportTile);\r\n    }\r\n  }\r\n\r\n  async onSubTileChanged(supportTile: SupportTile) {\r\n    if (supportTile.subTile?.enabled != supportTile.subTile?.checked) {\r\n      supportTile.subTile.enabled = supportTile.subTile.checked;\r\n      this.checkForInfoPopup(supportTile.subTile);\r\n    }\r\n    if (supportTile.enabled == this.isChildActive(supportTile)) {\r\n      supportTile.enabled = !this.isChildActive(supportTile);\r\n      this.checkForInfoPopup(supportTile);\r\n    }\r\n    this.saveSettings(supportTile);\r\n  }\r\n\r\n  async saveSettings(supportTile: SupportTile) {\r\n    const currentSettings = await this.userSettingService.userSetting$\r\n      .pipe(take(1))\r\n      .toPromise();\r\n    this.userSettingService.saveUserSettings({\r\n      ...currentSettings,\r\n      supportTiles: this.addOrUpdateSupportTileSettings(\r\n        supportTile,\r\n        currentSettings.supportTiles\r\n      )\r\n    });\r\n  }\r\n\r\n  isChildActive(supportTile: SupportTile): boolean {\r\n    return !!supportTile.subTile?.enabled;\r\n  }\r\n\r\n  isTileActive(supportTile: SupportTile): boolean {\r\n    return supportTile.enabled || this.isChildActive(supportTile);\r\n  }\r\n\r\n  checkForInfoPopup(tile: SubTile = null) {\r\n    if (!(tile.name in this.checkOfflineSupportMaps)) {\r\n      this.checkOfflineSupportMaps[tile.name] = {\r\n        subscription: undefined,\r\n        checker: this.popupInfoService.checkOfflineSupportMapInfoPopup,\r\n        condition: (tile) => !tile.availableOffline,\r\n      };\r\n    }\r\n    [this.checkSupportMap, this.checkOfflineSupportMaps[tile.name]].forEach((checkMap) => {\r\n      if (checkMap.subscription && !checkMap.subscription.closed) {\r\n        checkMap.subscription.unsubscribe();\r\n      }\r\n      if (tile.enabled && checkMap.condition(tile)) {\r\n        checkMap.subscription = checkMap\r\n          .checker.bind(this.popupInfoService)(tile.name)\r\n          .pipe(takeUntil(this.ngDestroy$))\r\n          .subscribe();\r\n      }\r\n    });\r\n  }\r\n\r\n  addOrUpdateSupportTileSettings(\r\n    supportTile: SupportTile,\r\n    currentSupportTileSettings: {\r\n      name: string;\r\n      enabled: boolean;\r\n      opacity: number;\r\n    }[]\r\n  ): SupportTileStore[] {\r\n    const storeTile = {\r\n      opacity: supportTile.opacity,\r\n      name: supportTile.name,\r\n      enabled: supportTile.enabled,\r\n      checked: supportTile.checked,\r\n    };\r\n    if (supportTile.subTile) {\r\n      storeTile['subTile'] = {\r\n        name: supportTile.subTile.name,\r\n        enabled: supportTile.subTile.enabled,\r\n        checked: supportTile.subTile.checked,\r\n      };\r\n    }\r\n    return [\r\n      ...currentSupportTileSettings.filter((m) => m.name !== supportTile.name) as SupportTile[],\r\n      storeTile,\r\n    ];\r\n  }\r\n}\r\n","<ion-item (click)=\"updateOrCancelObservations()\">\r\n  <ion-label color=\"dark\" position=\"stacked\">{{'MENU.UPDATE_OBSERVATIONS' | translate}}</ion-label>\r\n  <ng-container *ngIf=\"!isLoading else isLoadingTemplate\">\r\n    <ion-text class=\"ion-align-self-start\">\r\n      <ng-container *ngIf=\"lastUpdated\">\r\n        {{ lastUpdated | date:settings.dateFormats.angular.dateAndTime }}\r\n      </ng-container>\r\n    </ion-text>\r\n    <ion-button size=\"small\" fill=\"clear\" slot=\"end\">\r\n      <svg-icon src=\"/assets/icon/refresh.svg\"></svg-icon>\r\n    </ion-button>\r\n  </ng-container>\r\n</ion-item>\r\n<ng-template #isLoadingTemplate>\r\n  <ion-text class=\"ion-align-self-start\">\r\n    <ion-spinner name=\"dots\"></ion-spinner>\r\n  </ion-text>\r\n  <ion-button size=\"small\" fill=\"clear\" slot=\"end\">\r\n    {{'DIALOGS.CANCEL' | translate}}\r\n  </ion-button>\r\n</ng-template>","import { Component, OnInit, OnDestroy, NgZone } from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\nimport { switchMap, map, distinctUntilChanged, tap } from 'rxjs/operators';\r\nimport { settings } from '../../../../../settings';\r\nimport { ObservationService } from '../../../../core/services/observation/observation.service';\r\nimport { DataMarshallService } from '../../../../core/services/data-marshall/data-marshall.service';\r\nimport { DataLoadService } from '../../../data-load/services/data-load.service';\r\n\r\n@Component({\r\n  selector: 'app-update-observations',\r\n  templateUrl: './update-observations.component.html',\r\n  styleUrls: ['./update-observations.component.scss']\r\n})\r\nexport class UpdateObservationsComponent implements OnInit, OnDestroy {\r\n  lastUpdated: Date;\r\n  settings = settings;\r\n  isLoading: boolean;\r\n  subscriptions: Subscription[] = [];\r\n\r\n  constructor(\r\n    private observationService: ObservationService,\r\n    private dataMarshallService: DataMarshallService,\r\n    private ngZone: NgZone,\r\n    private dataLoadService: DataLoadService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.subscriptions.push(\r\n      this.observationService\r\n        .getLastUpdatedForCurrentGeoHazardAsObservable()\r\n        .subscribe((val) => {\r\n          this.ngZone.run(() => {\r\n            this.lastUpdated = val;\r\n          });\r\n        })\r\n    );\r\n    this.subscriptions.push(\r\n      this.observationService.dataLoad$\r\n        .pipe(\r\n          switchMap((id) => this.dataLoadService.getStateAsObservable(id)),\r\n          map((state) => state.isLoading),\r\n          distinctUntilChanged()\r\n        )\r\n        .subscribe((val) => {\r\n          this.ngZone.run(() => {\r\n            this.isLoading = val;\r\n          });\r\n        })\r\n    );\r\n  }\r\n  ngOnDestroy(): void {\r\n    for (const subscription of this.subscriptions) {\r\n      subscription.unsubscribe();\r\n    }\r\n  }\r\n\r\n  async updateOrCancelObservations() {\r\n    if (this.isLoading) {\r\n      this.dataMarshallService.cancelUpdateObservations();\r\n    } else {\r\n      this.isLoading = true;\r\n      await this.observationService.forceUpdateObservationsForCurrentGeoHazard(\r\n        this.dataMarshallService.cancelObservationsPromise\r\n      );\r\n      setTimeout(() => {\r\n        this.isLoading = false;\r\n      }, 500);\r\n    }\r\n  }\r\n}\r\n","<ng-container *ngIf=\"!isLoggingIn else spinner\">\r\n  <ion-item *ngIf=\"!loggedInUser.isLoggedIn\" (click)=\"login()\" detail=\"true\">\r\n    <ion-icon slot=\"start\" name=\"person-circle\" color=\"varsom-blue\"></ion-icon>\r\n    <ion-label class=\"menu-label\">\r\n      {{'LOGIN.TITLE' | translate}}\r\n    </ion-label>\r\n  </ion-item>\r\n  <ng-container *ngIf=\"loggedInUser.isLoggedIn\">\r\n    <ion-item routerLink=\"/login\" routerDirection=\"forward\" detail=\"true\">\r\n      <ion-icon slot=\"start\" name=\"person-circle\" color=\"varsom-blue\"></ion-icon>\r\n      <ion-label class=\"menu-label\">\r\n        {{ loggedInUser.email }}\r\n      </ion-label>\r\n    </ion-item>\r\n    <ion-item routerLink=\"/my-observations\" routerDirection=\"forward\" detail=\"true\">\r\n      <ion-icon slot=\"start\" name=\"eye\" color=\"varsom-blue\"></ion-icon>\r\n      <ion-label class=\"menu-label\">\r\n        {{'MY_OBSERVATIONS.TITLE' | translate}}\r\n      </ion-label>\r\n    </ion-item>\r\n  </ng-container>\r\n</ng-container>\r\n<ng-template #spinner>\r\n  <ion-item>\r\n    <ion-text>\r\n      <ion-spinner name=\"dots\"></ion-spinner>\r\n    </ion-text>\r\n  </ion-item>\r\n</ng-template>","import { Component, NgZone, OnInit, OnDestroy } from '@angular/core';\r\nimport { Subject } from 'rxjs';\r\nimport { takeUntil } from 'rxjs/operators';\r\nimport { RegobsAuthService } from '../../../auth/services/regobs-auth.service';\r\nimport { LoggedInUser } from '../../../login/models/logged-in-user.model';\r\n\r\n@Component({\r\n  selector: 'app-user-login',\r\n  templateUrl: './user-login.component.html',\r\n  styleUrls: ['./user-login.component.scss']\r\n})\r\nexport class UserLoginComponent implements OnInit, OnDestroy {\r\n  loggedInUser: LoggedInUser = { isLoggedIn: false };\r\n  private ngDestroy$ = new Subject<void>();\r\n  isLoggingIn = false;\r\n\r\n  constructor(\r\n    private regobsauthService: RegobsAuthService,\r\n    private ngZone: NgZone\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.regobsauthService.loggedInUser$\r\n      .pipe(takeUntil(this.ngDestroy$))\r\n      .subscribe((val) => {\r\n        this.ngZone.run(() => {\r\n          this.loggedInUser = val;\r\n        });\r\n      });\r\n    this.regobsauthService.isLoggingIn$\r\n      .pipe(takeUntil(this.ngDestroy$))\r\n      .subscribe((val) => {\r\n        this.ngZone.run(() => {\r\n          this.isLoggingIn = val;\r\n        });\r\n      });\r\n  }\r\n\r\n  login(): void {\r\n    this.regobsauthService.signIn();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.ngDestroy$.next();\r\n    this.ngDestroy$.complete();\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { SideMenuComponent } from './components/side-menu.component';\r\nimport { SupportTilesMenuComponent } from './components/support-tiles-menu/support-tiles-menu.component';\r\nimport { UserLoginComponent } from './components/user-login/user-login.component';\r\nimport { ObservationsDaysBackComponent } from './components/observations-days-back/observations-days-back.component';\r\nimport { UpdateObservationsComponent } from './components/update-observations/update-observations.component';\r\nimport { SharedModule } from '../shared/shared.module';\r\nimport { SupportTileLegendLoaderComponent } from './components/support-tiles-menu/legends/support-tile-legend-loader/support-tile-legend-loader.component';\r\nimport { SteepnessLegendComponent } from './components/support-tiles-menu/legends/steepness-legend/steepness-legend.component';\r\nimport { FloodzonesLegendComponent } from './components/support-tiles-menu/legends/floodzones-legend/floodzones-legend.component';\r\nimport { ClayzonesLegendComponent } from './components/support-tiles-menu/legends/clayzones-legend/clayzones-legend.component';\r\nimport { WeakenediceLegendComponent } from './components/support-tiles-menu/legends/weakenedice-legend/weakenedice-legend.component';\r\nimport { SteepnessCommonLegendComponent } from './components/support-tiles-menu/legends/steepness-common-legend/steepness-common-legend.component';\r\n\r\n@NgModule({\r\n  imports: [SharedModule],\r\n  declarations: [\r\n    SideMenuComponent,\r\n    SupportTilesMenuComponent,\r\n    UserLoginComponent,\r\n    ObservationsDaysBackComponent,\r\n    UpdateObservationsComponent,\r\n    SupportTileLegendLoaderComponent,\r\n    SteepnessLegendComponent,\r\n    FloodzonesLegendComponent,\r\n    ClayzonesLegendComponent,\r\n    WeakenediceLegendComponent,\r\n    SteepnessCommonLegendComponent\r\n  ],\r\n  entryComponents: [\r\n    SteepnessLegendComponent,\r\n    FloodzonesLegendComponent,\r\n    ClayzonesLegendComponent,\r\n    WeakenediceLegendComponent\r\n  ],\r\n  exports: [SideMenuComponent]\r\n})\r\nexport class SideMenuModule {}\r\n","import { Component, OnInit, Input, OnDestroy } from '@angular/core';\r\nimport { ModalController, Platform } from '@ionic/angular';\r\nimport { ScreenOrientation } from '@ionic-native/screen-orientation/ngx';\r\nimport { isAndroidOrIos } from '../../../core/helpers/ionic/platform-helper';\r\n\r\n@Component({\r\n  selector: 'app-fullscreen-image-modal',\r\n  templateUrl: './fullscreen-image-modal.page.html',\r\n  styleUrls: ['./fullscreen-image-modal.page.scss']\r\n})\r\nexport class FullscreenImageModalPage implements OnInit, OnDestroy {\r\n  @Input() imgSrc: string;\r\n  @Input() header: string;\r\n  @Input() description: string;\r\n\r\n  constructor(\r\n    private modalController: ModalController,\r\n    private screenOrientation: ScreenOrientation,\r\n    private platform: Platform\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    if (isAndroidOrIos(this.platform)) {\r\n      this.screenOrientation.unlock();\r\n    }\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (isAndroidOrIos(this.platform)) {\r\n      this.screenOrientation.lock(this.screenOrientation.ORIENTATIONS.PORTRAIT);\r\n    }\r\n  }\r\n\r\n  closeModal(): void {\r\n    this.modalController.dismiss();\r\n  }\r\n}\r\n","<ion-content (click)=\"closeModal()\">\r\n  <ion-slides>\r\n    <ion-slide>\r\n      <div class=\"swiper-zoom-container\">\r\n        <img [src]=\"imgSrc\" onerror=\"this.style.display='none'\" />\r\n      </div>\r\n    </ion-slide>\r\n  </ion-slides>\r\n</ion-content>","import { NgModule } from '@angular/core';\r\nimport { LegalTermsModalPage } from './legal-terms-modal.page';\r\nimport { SharedModule } from '../../../modules/shared/shared.module';\r\nimport { LegalTermsComponent } from '../../../components/legal-terms/legal-terms.component';\r\n\r\n@NgModule({\r\n  imports: [SharedModule],\r\n  declarations: [LegalTermsModalPage, LegalTermsComponent],\r\n  entryComponents: [LegalTermsModalPage],\r\n  exports: [LegalTermsModalPage]\r\n})\r\nexport class LegalTermsModalPageModule {}\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { ModalController } from '@ionic/angular';\r\n\r\n@Component({\r\n  selector: 'app-legal-terms-modal',\r\n  templateUrl: './legal-terms-modal.page.html',\r\n  styleUrls: ['./legal-terms-modal.page.scss']\r\n})\r\nexport class LegalTermsModalPage implements OnInit {\r\n  constructor(private modalController: ModalController) {}\r\n\r\n  ngOnInit() {}\r\n\r\n  close() {\r\n    this.modalController.dismiss();\r\n  }\r\n}\r\n","<ion-header>\r\n  <ion-toolbar appHeaderColor mode=\"ios\">\r\n    <ion-buttons slot=\"end\">\r\n      <ion-button (click)=\"close()\">{{ 'DIALOGS.OK' | translate }}</ion-button>\r\n    </ion-buttons>\r\n    <ion-title>\r\n      {{ 'LEGAL_TERMS.HEADER' | translate }}\r\n    </ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n<ion-content>\r\n  <ion-grid>\r\n    <ion-row>\r\n      <ion-col class=\"ion-text-center\">\r\n        <app-legal-terms></app-legal-terms>\r\n      </ion-col>\r\n    </ion-row>\r\n  </ion-grid>\r\n</ion-content>","// The file contents for the current environment will overwrite these during build.\r\n// The build system defaults to the dev environment which uses `environment.ts`, but if you do\r\n// `ng build --env=prod` then `environment.prod.ts` will be used instead.\r\n// The list of which env maps to which file can be found in `.angular-cli.json`.\r\nexport const environment = {\r\n  production: false\r\n};\r\n\r\n/*\r\n * In development mode, to ignore zone related error stack frames such as\r\n * `zone.run`, `zoneDelegate.invokeTask` for easier debugging, you can\r\n * import the following file, but please comment it out in production mode\r\n * because it will have performance impact when throw error\r\n */\r\n// import 'zone.js/plugins/zone-error';  // Included with Angular CLI.\r\n","/* eslint-disable no-console */\r\nimport { enableProdMode } from '@angular/core';\r\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\r\n\r\nimport { AppModule } from './app/app.module';\r\nimport { environment } from './environments/environment';\r\nimport { NanoSql } from './nanosql';\r\nimport '@angular/compiler';\r\n\r\nif (environment.production) {\r\n  enableProdMode();\r\n}\r\n\r\nfunction startApp() {\r\n  console.log('starting app');\r\n  platformBrowserDynamic()\r\n    .bootstrapModule(AppModule)\r\n    .catch((err) => console.log(err));\r\n}\r\n\r\ndocument.addEventListener(\r\n  typeof cordova !== 'undefined' ? 'deviceready' : 'DOMContentLoaded',\r\n  async () => {\r\n    console.log('Init NanoSql database');\r\n    try {\r\n      await NanoSql.init();\r\n      startApp();\r\n    } catch (err) {\r\n      console.error('Error init NanoSql database', err);\r\n      startApp(); // Try to start app anyway\r\n    }\r\n  }\r\n);\r\n","import { settings } from './settings';\r\nimport { AppMode } from '@varsom-regobs-common/core';\r\nimport { nSQL } from '@nano-sql/core';\r\nimport { getMode } from '@nano-sql/adapter-sqlite-cordova';\r\nimport {\r\n  InanoSQLTableConfig,\r\n  InanoSQLTable,\r\n  InanoSQLQuery,\r\n  InanoSQLDataModel,\r\n  InanoSQLTableIndexConfig,\r\n  InanoSQLInstance\r\n} from '@nano-sql/core/lib/interfaces';\r\n\r\nexport class NanoSql {\r\n  public static readonly TABLES = {\r\n    OBSERVATION: {\r\n      name: 'observationV2',\r\n      instancePerAppMode: true,\r\n      model: {\r\n        'RegId:int': { pk: true },\r\n        'GeoHazardTID:int': {},\r\n        'LangKey:int': {},\r\n        '*:any': {}\r\n      },\r\n      indexes: {}\r\n      // indexes: {\r\n      //     'GeoHazardTID:int': {},\r\n      //     'LangKey:int': {},\r\n      // },\r\n    },\r\n    TRIP_LOG: {\r\n      name: 'triplog',\r\n      model: {\r\n        'id:uuid': { pk: true },\r\n        'latitude:number': {},\r\n        'longitude:number': {},\r\n        'timestamp:number': {},\r\n        'altitude:number': {},\r\n        'speed:number': {},\r\n        'accuracy:number': {},\r\n        'heading:number': {}\r\n      },\r\n      indexes: {}\r\n    },\r\n    TRIP_LOG_ACTIVITY: {\r\n      name: 'triplogactivity',\r\n      model: {\r\n        'id:uuid': { pk: true },\r\n        'state:string': {},\r\n        'timestamp:number': {}\r\n      },\r\n      indexes: {}\r\n    },\r\n    LEGACY_TRIP_LOG: {\r\n      name: 'legacytrip',\r\n      instancePerAppMode: true,\r\n      model: {\r\n        'id:string': { pk: true },\r\n        '*:any': {}\r\n      },\r\n      indexes: {}\r\n    },\r\n    WARNING: {\r\n      name: 'warning',\r\n      model: {\r\n        'id:string': { pk: true },\r\n        '*:any': {}\r\n      },\r\n      indexes: {}\r\n    },\r\n    WARNING_FAVOURITE: {\r\n      name: 'warning_favourite',\r\n      model: {\r\n        'id:string': { pk: true },\r\n        '*:any': {}\r\n      },\r\n      indexes: {}\r\n    },\r\n    OFFLINE_MAP: {\r\n      name: 'offlinemap',\r\n      model: {\r\n        'name:string': { pk: true },\r\n        '*:any': {}\r\n      },\r\n      indexes: {}\r\n    },\r\n    OFFLINE_MAP_TILES: {\r\n      name: 'offlinemaptiles',\r\n      model: {\r\n        'id:string': { pk: true },\r\n        'mapName:string': {},\r\n        'lastAccess:number': {},\r\n        'size:number': {},\r\n        'dataUrl:string': {},\r\n        'mimeType:string': {}\r\n      },\r\n      indexes: {\r\n        'mapName:string': {},\r\n        'lastAccess:number': {},\r\n        'size:number': {}\r\n      }\r\n    },\r\n    OFFLINE_MAP_CACHE_SIZE: {\r\n      name: 'offlinemapcachessize',\r\n      model: {\r\n        'id:string': { pk: true },\r\n        'count:number': {},\r\n        'size:number': {}\r\n      }\r\n    },\r\n    OFFLINE_ASSET: {\r\n      name: 'offlineasset',\r\n      model: {\r\n        'url:string': { pk: true },\r\n        'type:string': {},\r\n        'lastAccess:number': {},\r\n        'size:number': {},\r\n        'dataUrl:string': {}\r\n      },\r\n      indexes: {\r\n        'lastAccess:number': {}\r\n      }\r\n    },\r\n    MAP_SEARCH_HISTORY: {\r\n      name: 'mapsearchhistory',\r\n      model: {\r\n        'id:string': { pk: true },\r\n        '*:any': {}\r\n      },\r\n      indexes: {}\r\n    },\r\n    USER_SETTINGS: {\r\n      name: 'usersettings',\r\n      model: {\r\n        'id:string': { pk: true },\r\n        '*:any': {}\r\n      },\r\n      indexes: {}\r\n    },\r\n    USER: {\r\n      name: 'user',\r\n      instancePerAppMode: true,\r\n      model: {\r\n        'id:string': { pk: true },\r\n        '*:any': {}\r\n      },\r\n      indexes: {}\r\n    },\r\n    DATA_LOAD: {\r\n      name: 'dataload',\r\n      model: {\r\n        'id:string': { pk: true },\r\n        '*:any': {}\r\n      },\r\n      indexes: {}\r\n    },\r\n    REGISTRATION: {\r\n      name: 'registration',\r\n      instancePerAppMode: true,\r\n      model: {\r\n        'id:uuid': { pk: true },\r\n        '*:any': {}\r\n      },\r\n      indexes: {}\r\n    },\r\n    KDV_ELEMENTS: {\r\n      name: 'kdvelements',\r\n      instancePerAppMode: true,\r\n      model: {\r\n        'langKey:int': { pk: true },\r\n        '*:any': {}\r\n      },\r\n      indexes: {}\r\n    },\r\n    OBSERVER_GROUPS: {\r\n      name: 'groups',\r\n      instancePerAppMode: true,\r\n      model: {\r\n        'key:string': { pk: true },\r\n        'userId:string': {},\r\n        '*:any': {}\r\n      },\r\n      indexes: {\r\n        'userId:string': {}\r\n      }\r\n    },\r\n    HELP_TEXTS: {\r\n      name: 'helptexts',\r\n      instancePerAppMode: true,\r\n      model: {\r\n        'langKey:int': { pk: true },\r\n        '*:any': {}\r\n      },\r\n      indexes: {}\r\n    }\r\n  };\r\n\r\n  static getTables() {\r\n    const result: {\r\n      name: string;\r\n      instancePerAppMode: boolean;\r\n      model: InanoSQLDataModel;\r\n      indexes: InanoSQLTableIndexConfig;\r\n    }[] = [];\r\n    // tslint:disable-next-line:forin\r\n    for (const tableDef in NanoSql.TABLES) {\r\n      result.push(NanoSql.TABLES[tableDef]);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  static getInstanceName(name: string, appMode: AppMode): string {\r\n    return `${name}_${appMode}`;\r\n  }\r\n\r\n  static getTableModels(): InanoSQLTableConfig[] {\r\n    const tables: InanoSQLTableConfig[] = [];\r\n    for (const table of NanoSql.getTables()) {\r\n      if (table.instancePerAppMode) {\r\n        tables.push({\r\n          name: NanoSql.getInstanceName(table.name, AppMode.Prod),\r\n          model: table.model,\r\n          indexes: table.indexes\r\n        });\r\n        tables.push({\r\n          name: NanoSql.getInstanceName(table.name, AppMode.Demo),\r\n          model: table.model,\r\n          indexes: table.indexes\r\n        });\r\n        tables.push({\r\n          name: NanoSql.getInstanceName(table.name, AppMode.Test),\r\n          model: table.model,\r\n          indexes: table.indexes\r\n        });\r\n      } else {\r\n        tables.push({\r\n          name: table.name,\r\n          model: table.model,\r\n          indexes: table.indexes\r\n        });\r\n      }\r\n    }\r\n    return tables;\r\n  }\r\n\r\n  static async init(\r\n    dbName: string = settings.db.nanoSql.dbName,\r\n    dbMode?: string\r\n  ): Promise<void> {\r\n    await nSQL().createDatabase({\r\n      id: dbName,\r\n      mode: dbMode || getMode(),\r\n      version: 1.0,\r\n      tables: this.getTableModels(),\r\n      // cache: false,\r\n      // historyMode: {\r\n      //     table: 'row',\r\n      // }\r\n      plugins: [\r\n        {\r\n          name: 'Table Name Plugin', // Plugin to avoid random id on table name\r\n          version: 1.0,\r\n          dependencies: {},\r\n          filters: [\r\n            {\r\n              name: 'configTableSystem',\r\n              priority: 1000,\r\n              call: (\r\n                inputArgs: { res: InanoSQLTable; query: InanoSQLQuery },\r\n                complete\r\n              ) => {\r\n                inputArgs.res.id = inputArgs.res.name;\r\n                complete(inputArgs);\r\n              }\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    });\r\n    // NOTE: It is also possible to implement migrations on version updates.\r\n    // See: https://github.com/ClickSimply/Nano-SQL/issues/70\r\n  }\r\n\r\n  static getInstance(name: string, appMode: AppMode): InanoSQLInstance {\r\n    return nSQL(`${name}_${appMode}`);\r\n  }\r\n\r\n  static async resetDb(\r\n    onError?: (tableName: string, ex: Error) => void\r\n  ): Promise<void[]> {\r\n    // try {\r\n    //     await nSQL().dropDatabase(settings.db.nanoSql.dbName);\r\n    //     await this.init();\r\n    // } catch (err) {\r\n    //     console.log(err);\r\n    // }\r\n    return Promise.all(\r\n      NanoSql.getTableModels().map((tableConfig) =>\r\n        this.resetTable(tableConfig, onError)\r\n      )\r\n    );\r\n  }\r\n\r\n  static async resetTable(\r\n    tableConfig: InanoSQLTableConfig,\r\n    onError?: (tableName: string, ex: Error) => void\r\n  ): Promise<void> {\r\n    if (tableConfig.name === 'offlinemaptiles') {\r\n      await this.dropAndRecreateTable(tableConfig, onError);\r\n    } else {\r\n      await this.deleteAllRowsInTable(tableConfig, onError);\r\n    }\r\n  }\r\n\r\n  private static async deleteAllRowsInTable(\r\n    tableConfig: InanoSQLTableConfig,\r\n    onError?: (tableName: string, ex: Error) => void\r\n  ) {\r\n    try {\r\n      await nSQL(tableConfig.name).query('delete').exec();\r\n    } catch (ex) {\r\n      if (onError) {\r\n        onError(tableConfig.name, ex);\r\n      }\r\n    }\r\n  }\r\n\r\n  private static async dropAndRecreateTable(\r\n    tableConfig: InanoSQLTableConfig,\r\n    onError?: (tableName: string, ex: Error) => void\r\n  ) {\r\n    try {\r\n      await nSQL(tableConfig.name).query('drop').exec();\r\n    } catch (ex) {\r\n      if (onError) {\r\n        onError(tableConfig.name, ex);\r\n      }\r\n    }\r\n    try {\r\n      await nSQL().query('create table', tableConfig).exec();\r\n    } catch (ex) {\r\n      if (onError) {\r\n        onError(tableConfig.name, ex);\r\n      }\r\n    }\r\n  }\r\n}\r\n","/* eslint-disable max-len */\r\nexport const settings = {\r\n  authConfig: {\r\n    TEST: {\r\n      client_id: '13270815-7def-4800-8fc9-178dd517f574',\r\n      server_host: 'https://nveb2c01test.b2clogin.com/nveb2c01test.onmicrosoft.com/B2C_1A_sign_up_sign_in_nve/v2.0',\r\n      redirect_url: 'regobs://callback',\r\n      end_session_redirect_url: undefined,\r\n      scopes: 'openid offline_access',\r\n      pkce: true,\r\n      getObserverUrl: 'https://test-api.regobs.no/v5/Account/GetObserver',\r\n      myPageUrl: 'https://test-konto.nve.no/User',\r\n      updateObserverUrl: 'https://test-api.regobs.no/v5/Account/UpdateObserver'\r\n    },\r\n    DEMO: {\r\n      client_id: '7149f248-5e18-4feb-8a0c-e988dc021977',\r\n      server_host: 'https://nveb2c01staging.b2clogin.com/nveb2c01staging.onmicrosoft.com/B2C_1A_sign_up_sign_in_nve/v2.0',\r\n      redirect_url: 'regobs://callback',\r\n      end_session_redirect_url: undefined,\r\n      scopes: 'openid offline_access',\r\n      pkce: true,\r\n      getObserverUrl: 'https://demo-api.regobs.no/v5/Account/GetObserver',\r\n      myPageUrl: 'https://demo-konto.nve.no/User',\r\n      updateObserverUrl: 'https://demo-api.regobs.no/v5/Account/UpdateObserver'\r\n    },\r\n    PROD: {\r\n      client_id: 'a0b10e50-f942-4619-a9ab-cf5c900a98d5',\r\n      server_host: 'https://nveb2c01prod.b2clogin.com/nveb2c01prod.onmicrosoft.com/B2C_1A_sign_up_sign_in_nve/v2.0',\r\n      redirect_url: 'regobs://callback',\r\n      end_session_redirect_url: undefined,\r\n      scopes: 'openid offline_access',\r\n      pkce: true,\r\n      getObserverUrl: 'https://api.regobs.no/v5/Account/GetObserver',\r\n      myPageUrl: 'https://konto.nve.no/User',\r\n      updateObserverUrl: 'https://api.regobs.no/v5/Account/UpdateObserver'\r\n    }\r\n  },\r\n  observations: {\r\n    maxObservationsToFetch: 5000,\r\n    daysBack: {\r\n      Snow: [0, 1, 2, 3, 7, 7 * 2],\r\n      Ice: [0, 1, 2, 7, 7 * 4, 7 * 12],\r\n      Water: [0, 1, 2, 3, 7, 7 * 2],\r\n      Dirt: [0, 1, 2, 3, 7, 7 * 2]\r\n    },\r\n    timeZone: 'Europe/Oslo'\r\n  },\r\n  services: {\r\n    regObs: {\r\n      apiUrl: {\r\n        PROD: 'https://api.regobs.no/v5',\r\n        DEMO: 'https://demo-api.regobs.no/v5',\r\n        TEST: 'https://test-api.regobs.no/v5'\r\n        // 'TEST': 'http://localhost:40001'\r\n      },\r\n      serviceUrl: {\r\n        PROD: 'https://api.nve.no/hydrology/regobs/v3.5.0',\r\n        DEMO: 'http://stg-h-web03.nve.no/RegObsServices',\r\n        TEST: 'http://tst-h-web03.nve.no/regobsservices_test'\r\n      },\r\n      webUrl: {\r\n        PROD: 'https://www.regobs.no',\r\n        DEMO: 'https://demo.regobs.no',\r\n        TEST: 'https://test.regobs.no'\r\n      },\r\n      createUserUrl: '/Account/Register?c=Home',\r\n      passwordRecoveryUrl: '/Account/PasswordRecovery?c=Home',\r\n      changePasswordUrl: '/Account/ChangePassword?email={email}&c=Home',\r\n      viewProfileUrl: '/Account/MyPage',\r\n      apiJsonVersion: '4.0.0'\r\n    },\r\n    warning: {\r\n      defaultWarningDaysAhead: 2,\r\n      summerMonths: [5, 6, 7, 8, 9, 10],\r\n      timezone: 'Europe/Oslo',\r\n      dateFormat: 'YYYY-MM-DD',\r\n      Snow: {\r\n        apiUrl: 'https://api01.nve.no/hydrology/forecast/avalanche/v4.0.2/api',\r\n        webUrl: {\r\n          nb: 'http://www.varsom.no/snoskredvarsling/varsel/{regionName}/{day}?utm_source=regobs&utm_medium=app&utm_campaign=avalanche',\r\n          en: 'http://www.varsom.no/en/avalanche-bulletins/forecast/{regionName}/{day}?utm_source=regobs&utm_medium=app&utm_campaign=avalanche'\r\n        },\r\n        featureName: 'omradeID'\r\n      },\r\n      Dirt: {\r\n        apiUrl: 'https://api01.nve.no/hydrology/forecast/landslide/v1.0.6/api',\r\n        webUrl: {\r\n          nb: 'http://www.varsom.no/flom-og-jordskredvarsling/varsel/{regionName}/?date={day}&utm_source=regobs&utm_medium=app&utm_campaign=landslide',\r\n          en: 'http://www.varsom.no/en/flood-and-landslide-warning-service/forecast/{regionName}/?date={day}&utm_source=regobs&utm_medium=app&utm_campaign=landslide'\r\n        },\r\n        featureName: 'fylkesnummer'\r\n      },\r\n      Water: {\r\n        apiUrl: 'https://api01.nve.no/hydrology/forecast/flood/v1.0.6/api',\r\n        webUrl: {\r\n          nb: 'http://www.varsom.no/flom-og-jordskredvarsling/varsel/{regionName}/?date={day}&utm_source=regobs&utm_medium=app&utm_campaign=flood',\r\n          en: 'http://www.varsom.no/en/flood-and-landslide-warning-service/forecast/{regionName}/?date={day}&utm_source=regobs&utm_medium=app&utm_campaign=flood'\r\n        },\r\n        featureName: 'fylkesnummer'\r\n      },\r\n      Ice: {\r\n        apiUrl: 'https://www.iskart.no/json/ice_forecast_regions.json',\r\n        featureName: 'fylkesnummer'\r\n      }\r\n    }\r\n  },\r\n  db: {\r\n    simpleStorage: {\r\n      dbName: 'regobsSimpleStorage',\r\n      location: 'default'\r\n    },\r\n    nanoSql: {\r\n      dbName: 'regobs'\r\n    }\r\n  },\r\n  map: {\r\n    tiles: {\r\n      cacheFolder: 'tilescache',\r\n      cacheSize: 0,\r\n      cacheSaveBufferThrottleTimeMs: 50,\r\n      cacheSaveBufferIdleInterval: 2000,\r\n      tileImageFormat: 'image/png',\r\n      embeddedUrl: '/assets/map/{z}/tile_{x}_{y}.png',\r\n      defaultZoom: 5,\r\n      embeddedUrlMaxZoomWorld: 0,\r\n      embeddedUrlMaxZoomNorway: 0,\r\n      minZoom: 2,\r\n      minZoomSupportMaps: 5,\r\n      maxZoom: 18,\r\n      zoomInPosition: 15,\r\n      zoomLevelObservationList: 12,\r\n      edgeBufferTiles: 0,\r\n      detectRetina: false,\r\n      updateWhenIdle: false,\r\n      statensKartverkMapUrl: 'https://opencache.statkart.no/gatekeeper/gk/gk.open_gmaps?layers=norgeskart_bakgrunn&zoom={z}&x={x}&y={y}',\r\n      geoDataLandskapMapUrl: 'https://services.geodataonline.no/arcgis/rest/services/Geocache_WMAS_WGS84/GeocacheLandskap/MapServer/tile/{z}/{y}/{x}?blankTile=false',\r\n      openTopoMapUrl: 'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',\r\n      arcGisOnlineTopoMapUrl: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}',\r\n      supportTiles: [\r\n        {\r\n          name: 'steepness',\r\n          description: 'STEEPNESS_MAP_DESCRIPTION',\r\n          url: 'https://gis3.nve.no/arcgis/rest/services/wmts/Bratthet/MapServer/tile/{z}/{y}/{x}',\r\n          enabled: false,\r\n          checked: true,\r\n          opacity: 0.5,\r\n          geoHazardId: 10,\r\n          availableOffline: false,\r\n          subTile: {\r\n            name: 'steepness-outlet',\r\n            description: 'STEEPNESS_OUTLET_MAP_DESCRIPTION',\r\n            url: 'https://gis3.nve.no/arcgis/rest/services/wmts/KastWMTS/MapServer/tile/{z}/{y}/{x}',\r\n            enabled: true,\r\n            checked: true,\r\n            availableOffline: true\r\n          }\r\n        },\r\n        {\r\n          name: 'clayzones',\r\n          description: 'CLAY_ZONES_MAP_DESCRIPTION',\r\n          url: 'https://gis2.nve.no/arcgis/rest/services/wmts/Kvikkleire_Jordskred/MapServer/tile/{z}/{y}/{x}',\r\n          enabled: true,\r\n          checked: true,\r\n          opacity: 0.5,\r\n          geoHazardId: 20,\r\n          availableOffline: false\r\n        },\r\n        {\r\n          name: 'floodzoones',\r\n          description: 'FLOOD_ZONES_MAP_DESCRIPTION',\r\n          url: 'https://gis3.nve.no/arcgis/rest/services/wmts/Flomsoner1/MapServer/tile/{z}/{y}/{x}',\r\n          enabled: true,\r\n          checked: true,\r\n          opacity: 0.5,\r\n          geoHazardId: 60,\r\n          availableOffline: false\r\n        },\r\n        {\r\n          name: 'weakenedice',\r\n          description: 'WEAKENED_ICE_MAP_DESCRIPTION',\r\n          url: 'https://gis3.nve.no/arcgis/rest/services/wmts/SvekketIs/MapServer/tile/{z}/{y}/{x}',\r\n          enabled: true,\r\n          checked: true,\r\n          opacity: 0.5,\r\n          geoHazardId: 70,\r\n          availableOffline: true\r\n        }\r\n      ],\r\n      supportTilesBounds: [\r\n        [57.136239319177434, -0.17578125],\r\n        [57.136239319177434, 36.03515625],\r\n        [81.36128726057069, 36.03515625],\r\n        [81.36128726057069, -0.17578125],\r\n        [57.136239319177434, -0.17578125]\r\n      ]\r\n    },\r\n    search: {\r\n      no: {\r\n        url: 'https://ws.geonorge.no/stedsnavn/v1/navn',\r\n        maxResults: 20,\r\n        exactFirst: true,\r\n        coordinateSystem: 4326,\r\n        resultFields: 'metadata.totaltAntallTreff,navn.skrivemåte,navn.navneobjekttype,navn.stedsnummer,navn.representasjonspunkt.øst,navn.representasjonspunkt.nord,navn.fylker.fylkesnavn,navn.kommuner.kommunenavn'\r\n      },\r\n      geonames: {\r\n        url: 'https://secure.geonames.org',\r\n        maxResults: 20,\r\n        username: 'regobs'\r\n      },\r\n      searchHistorySize: 5\r\n    },\r\n    bounds: {\r\n      svalbard: {\r\n        bbox: [\r\n          [80.493155, 3.157765],\r\n          [80.309405, 21.685119],\r\n          [76.337433, 18.003936],\r\n          [76.465943, 4.879966]\r\n        ]\r\n      }\r\n    },\r\n    mapSearchZoomToLevel: 14,\r\n    unknownMapCenter: [59.911197, 10.741059],\r\n    flyToOnGpsZoom: 14,\r\n    maxClusterRadius: 60 // 30,\r\n  },\r\n  snowRegionsGeoJsonName: 'omradeNavn',\r\n  cordovaNotAvailable: 'cordova_not_available',\r\n  gps: {\r\n    highAccuracyPositionOptions: {\r\n      enableHighAccuracy: true,\r\n      timeout: 20 * 1000, // 20 sec\r\n      maximumAge: Infinity // Start with latest cached value\r\n    }\r\n  },\r\n  offlineAssetsFolder: 'assets',\r\n  dateFormats: {\r\n    angular: {\r\n      date: 'dd.MM.yyyy',\r\n      dateAndTime: 'dd.MM.yyyy HH:mm'\r\n    },\r\n    moment: {\r\n      date: 'DD.MM.YYYY',\r\n      dateAndTime: 'DD.MM.YYYY HH:mm'\r\n    }\r\n  },\r\n  kdvElements: {\r\n    daysBeforeUpdate: 1\r\n  },\r\n  helpTexts: {\r\n    daysBeforeUpdate: 1\r\n  },\r\n  images: {\r\n    size: 1800,\r\n    quality: 50\r\n  },\r\n  sentryDsn: 'https://2e07df8503a34dc9973eedd05e7a0f49@sentry.io/170000',\r\n  errorEmailAddress: 'regobs@nve.no',\r\n  foregroundUpdateIntervalMs: 2 * 60 * 1000, // 2 minutes\r\n  backgroundFetchTimeout: 20 * 1000, // 20 seconds\r\n  popupDisclamerRefreshTimeMs: 1000 * 60 * 60 * 24 * 30, // 30 days\r\n  googleAnalytics: {\r\n    trackerId: 'UA-32394009-4',\r\n    anonymizeIp: true\r\n  },\r\n  language: {\r\n    fallbackLang: 'en',\r\n    supportedLanguages: [\r\n      { lang: 'nb', name: 'Norsk bokmål' },\r\n      { lang: 'nn', name: 'Norsk nynorsk' },\r\n      { lang: 'en', name: 'English' },\r\n      { lang: 'sv', name: 'Svenska' },\r\n      { lang: 'de', name: 'Deutsch' },\r\n      { lang: 'sl', name: 'Slovenski' },\r\n      { lang: 'fr', name: 'Français' },\r\n    ]\r\n  }\r\n};\r\n","var map = {\n\t\"./ion-action-sheet.entry.js\": [\n\t\t90733,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-action-sheet_entry_js\"\n\t],\n\t\"./ion-alert.entry.js\": [\n\t\t20985,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-alert_entry_js\"\n\t],\n\t\"./ion-app_8.entry.js\": [\n\t\t93899,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-app_8_entry_js\"\n\t],\n\t\"./ion-avatar_3.entry.js\": [\n\t\t5121,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-avatar_3_entry_js\"\n\t],\n\t\"./ion-back-button.entry.js\": [\n\t\t52960,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-back-button_entry_js\"\n\t],\n\t\"./ion-backdrop.entry.js\": [\n\t\t45473,\n\t\t\"node_modules_ionic_core_dist_esm_ion-backdrop_entry_js\"\n\t],\n\t\"./ion-button_2.entry.js\": [\n\t\t19787,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-button_2_entry_js\"\n\t],\n\t\"./ion-card_5.entry.js\": [\n\t\t66165,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-card_5_entry_js\"\n\t],\n\t\"./ion-checkbox.entry.js\": [\n\t\t69569,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-checkbox_entry_js\"\n\t],\n\t\"./ion-chip.entry.js\": [\n\t\t35119,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-chip_entry_js\"\n\t],\n\t\"./ion-col_3.entry.js\": [\n\t\t90799,\n\t\t\"node_modules_ionic_core_dist_esm_ion-col_3_entry_js\"\n\t],\n\t\"./ion-datetime_3.entry.js\": [\n\t\t68918,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-datetime_3_entry_js\"\n\t],\n\t\"./ion-fab_3.entry.js\": [\n\t\t94028,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-fab_3_entry_js\"\n\t],\n\t\"./ion-img.entry.js\": [\n\t\t98107,\n\t\t\"node_modules_ionic_core_dist_esm_ion-img_entry_js\"\n\t],\n\t\"./ion-infinite-scroll_2.entry.js\": [\n\t\t72178,\n\t\t\"node_modules_ionic_core_dist_esm_ion-infinite-scroll_2_entry_js\"\n\t],\n\t\"./ion-input.entry.js\": [\n\t\t42868,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-input_entry_js\"\n\t],\n\t\"./ion-item-option_3.entry.js\": [\n\t\t18706,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-item-option_3_entry_js\"\n\t],\n\t\"./ion-item_8.entry.js\": [\n\t\t12099,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-item_8_entry_js\"\n\t],\n\t\"./ion-loading.entry.js\": [\n\t\t84868,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-loading_entry_js\"\n\t],\n\t\"./ion-menu_3.entry.js\": [\n\t\t54377,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-menu_3_entry_js\"\n\t],\n\t\"./ion-modal.entry.js\": [\n\t\t15678,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-modal_entry_js\"\n\t],\n\t\"./ion-nav_2.entry.js\": [\n\t\t16735,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-nav_2_entry_js\"\n\t],\n\t\"./ion-popover.entry.js\": [\n\t\t87686,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-popover_entry_js\"\n\t],\n\t\"./ion-progress-bar.entry.js\": [\n\t\t48555,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-progress-bar_entry_js\"\n\t],\n\t\"./ion-radio_2.entry.js\": [\n\t\t30568,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-radio_2_entry_js\"\n\t],\n\t\"./ion-range.entry.js\": [\n\t\t6231,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-range_entry_js\"\n\t],\n\t\"./ion-refresher_2.entry.js\": [\n\t\t45772,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-refresher_2_entry_js\"\n\t],\n\t\"./ion-reorder_2.entry.js\": [\n\t\t14977,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-reorder_2_entry_js\"\n\t],\n\t\"./ion-ripple-effect.entry.js\": [\n\t\t42886,\n\t\t\"node_modules_ionic_core_dist_esm_ion-ripple-effect_entry_js\"\n\t],\n\t\"./ion-route_4.entry.js\": [\n\t\t54990,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-route_4_entry_js\"\n\t],\n\t\"./ion-searchbar.entry.js\": [\n\t\t13810,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-searchbar_entry_js\"\n\t],\n\t\"./ion-segment_2.entry.js\": [\n\t\t2446,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-segment_2_entry_js\"\n\t],\n\t\"./ion-select_3.entry.js\": [\n\t\t47619,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-select_3_entry_js\"\n\t],\n\t\"./ion-slide_2.entry.js\": [\n\t\t28393,\n\t\t\"node_modules_ionic_core_dist_esm_ion-slide_2_entry_js\"\n\t],\n\t\"./ion-spinner.entry.js\": [\n\t\t56281,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-spinner_entry_js\"\n\t],\n\t\"./ion-split-pane.entry.js\": [\n\t\t35932,\n\t\t\"node_modules_ionic_core_dist_esm_ion-split-pane_entry_js\"\n\t],\n\t\"./ion-tab-bar_2.entry.js\": [\n\t\t57970,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-tab-bar_2_entry_js\"\n\t],\n\t\"./ion-tab_2.entry.js\": [\n\t\t80298,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-tab_2_entry_js\"\n\t],\n\t\"./ion-text.entry.js\": [\n\t\t71006,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-text_entry_js\"\n\t],\n\t\"./ion-textarea.entry.js\": [\n\t\t74783,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-textarea_entry_js\"\n\t],\n\t\"./ion-toast.entry.js\": [\n\t\t62749,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-toast_entry_js\"\n\t],\n\t\"./ion-toggle.entry.js\": [\n\t\t55404,\n\t\t\"common\",\n\t\t\"node_modules_ionic_core_dist_esm_ion-toggle_entry_js\"\n\t],\n\t\"./ion-virtual-scroll.entry.js\": [\n\t\t39043,\n\t\t\"node_modules_ionic_core_dist_esm_ion-virtual-scroll_entry_js\"\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn Promise.all(ids.slice(1).map(__webpack_require__.e)).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function() { return Object.keys(map); };\nwebpackAsyncContext.id = 50863;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./af\": 62275,\n\t\"./af.js\": 62275,\n\t\"./ar\": 90857,\n\t\"./ar-dz\": 11218,\n\t\"./ar-dz.js\": 11218,\n\t\"./ar-kw\": 14754,\n\t\"./ar-kw.js\": 14754,\n\t\"./ar-ly\": 66680,\n\t\"./ar-ly.js\": 66680,\n\t\"./ar-ma\": 92178,\n\t\"./ar-ma.js\": 92178,\n\t\"./ar-sa\": 56522,\n\t\"./ar-sa.js\": 56522,\n\t\"./ar-tn\": 95682,\n\t\"./ar-tn.js\": 95682,\n\t\"./ar.js\": 90857,\n\t\"./az\": 70164,\n\t\"./az.js\": 70164,\n\t\"./be\": 79774,\n\t\"./be.js\": 79774,\n\t\"./bg\": 60947,\n\t\"./bg.js\": 60947,\n\t\"./bm\": 21832,\n\t\"./bm.js\": 21832,\n\t\"./bn\": 89650,\n\t\"./bn-bd\": 74477,\n\t\"./bn-bd.js\": 74477,\n\t\"./bn.js\": 89650,\n\t\"./bo\": 66005,\n\t\"./bo.js\": 66005,\n\t\"./br\": 98492,\n\t\"./br.js\": 98492,\n\t\"./bs\": 70534,\n\t\"./bs.js\": 70534,\n\t\"./ca\": 52061,\n\t\"./ca.js\": 52061,\n\t\"./cs\": 84737,\n\t\"./cs.js\": 84737,\n\t\"./cv\": 61167,\n\t\"./cv.js\": 61167,\n\t\"./cy\": 77996,\n\t\"./cy.js\": 77996,\n\t\"./da\": 9528,\n\t\"./da.js\": 9528,\n\t\"./de\": 14540,\n\t\"./de-at\": 49430,\n\t\"./de-at.js\": 49430,\n\t\"./de-ch\": 67978,\n\t\"./de-ch.js\": 67978,\n\t\"./de.js\": 14540,\n\t\"./dv\": 83426,\n\t\"./dv.js\": 83426,\n\t\"./el\": 6616,\n\t\"./el.js\": 6616,\n\t\"./en-au\": 63816,\n\t\"./en-au.js\": 63816,\n\t\"./en-ca\": 32162,\n\t\"./en-ca.js\": 32162,\n\t\"./en-gb\": 83305,\n\t\"./en-gb.js\": 83305,\n\t\"./en-ie\": 61954,\n\t\"./en-ie.js\": 61954,\n\t\"./en-il\": 43060,\n\t\"./en-il.js\": 43060,\n\t\"./en-in\": 59923,\n\t\"./en-in.js\": 59923,\n\t\"./en-nz\": 13540,\n\t\"./en-nz.js\": 13540,\n\t\"./en-sg\": 16505,\n\t\"./en-sg.js\": 16505,\n\t\"./eo\": 41907,\n\t\"./eo.js\": 41907,\n\t\"./es\": 86640,\n\t\"./es-do\": 41246,\n\t\"./es-do.js\": 41246,\n\t\"./es-mx\": 56131,\n\t\"./es-mx.js\": 56131,\n\t\"./es-us\": 36430,\n\t\"./es-us.js\": 36430,\n\t\"./es.js\": 86640,\n\t\"./et\": 62551,\n\t\"./et.js\": 62551,\n\t\"./eu\": 32711,\n\t\"./eu.js\": 32711,\n\t\"./fa\": 54572,\n\t\"./fa.js\": 54572,\n\t\"./fi\": 33390,\n\t\"./fi.js\": 33390,\n\t\"./fil\": 87860,\n\t\"./fil.js\": 87860,\n\t\"./fo\": 48216,\n\t\"./fo.js\": 48216,\n\t\"./fr\": 99291,\n\t\"./fr-ca\": 98527,\n\t\"./fr-ca.js\": 98527,\n\t\"./fr-ch\": 58407,\n\t\"./fr-ch.js\": 58407,\n\t\"./fr.js\": 99291,\n\t\"./fy\": 47054,\n\t\"./fy.js\": 47054,\n\t\"./ga\": 49540,\n\t\"./ga.js\": 49540,\n\t\"./gd\": 73917,\n\t\"./gd.js\": 73917,\n\t\"./gl\": 51486,\n\t\"./gl.js\": 51486,\n\t\"./gom-deva\": 56245,\n\t\"./gom-deva.js\": 56245,\n\t\"./gom-latn\": 48868,\n\t\"./gom-latn.js\": 48868,\n\t\"./gu\": 59652,\n\t\"./gu.js\": 59652,\n\t\"./he\": 89019,\n\t\"./he.js\": 89019,\n\t\"./hi\": 42040,\n\t\"./hi.js\": 42040,\n\t\"./hr\": 63402,\n\t\"./hr.js\": 63402,\n\t\"./hu\": 79322,\n\t\"./hu.js\": 79322,\n\t\"./hy-am\": 27609,\n\t\"./hy-am.js\": 27609,\n\t\"./id\": 57942,\n\t\"./id.js\": 57942,\n\t\"./is\": 98275,\n\t\"./is.js\": 98275,\n\t\"./it\": 73053,\n\t\"./it-ch\": 4378,\n\t\"./it-ch.js\": 4378,\n\t\"./it.js\": 73053,\n\t\"./ja\": 46176,\n\t\"./ja.js\": 46176,\n\t\"./jv\": 679,\n\t\"./jv.js\": 679,\n\t\"./ka\": 92726,\n\t\"./ka.js\": 92726,\n\t\"./kk\": 72953,\n\t\"./kk.js\": 72953,\n\t\"./km\": 86957,\n\t\"./km.js\": 86957,\n\t\"./kn\": 59181,\n\t\"./kn.js\": 59181,\n\t\"./ko\": 47148,\n\t\"./ko.js\": 47148,\n\t\"./ku\": 27752,\n\t\"./ku.js\": 27752,\n\t\"./ky\": 65675,\n\t\"./ky.js\": 65675,\n\t\"./lb\": 41263,\n\t\"./lb.js\": 41263,\n\t\"./lo\": 65746,\n\t\"./lo.js\": 65746,\n\t\"./lt\": 11143,\n\t\"./lt.js\": 11143,\n\t\"./lv\": 38753,\n\t\"./lv.js\": 38753,\n\t\"./me\": 44054,\n\t\"./me.js\": 44054,\n\t\"./mi\": 31573,\n\t\"./mi.js\": 31573,\n\t\"./mk\": 30202,\n\t\"./mk.js\": 30202,\n\t\"./ml\": 68523,\n\t\"./ml.js\": 68523,\n\t\"./mn\": 79794,\n\t\"./mn.js\": 79794,\n\t\"./mr\": 56681,\n\t\"./mr.js\": 56681,\n\t\"./ms\": 56975,\n\t\"./ms-my\": 39859,\n\t\"./ms-my.js\": 39859,\n\t\"./ms.js\": 56975,\n\t\"./mt\": 3691,\n\t\"./mt.js\": 3691,\n\t\"./my\": 5152,\n\t\"./my.js\": 5152,\n\t\"./nb\": 7607,\n\t\"./nb.js\": 7607,\n\t\"./ne\": 21526,\n\t\"./ne.js\": 21526,\n\t\"./nl\": 86368,\n\t\"./nl-be\": 40076,\n\t\"./nl-be.js\": 40076,\n\t\"./nl.js\": 86368,\n\t\"./nn\": 68420,\n\t\"./nn.js\": 68420,\n\t\"./oc-lnc\": 51906,\n\t\"./oc-lnc.js\": 51906,\n\t\"./pa-in\": 94504,\n\t\"./pa-in.js\": 94504,\n\t\"./pl\": 54721,\n\t\"./pl.js\": 54721,\n\t\"./pt\": 74645,\n\t\"./pt-br\": 54548,\n\t\"./pt-br.js\": 54548,\n\t\"./pt.js\": 74645,\n\t\"./ro\": 71977,\n\t\"./ro.js\": 71977,\n\t\"./ru\": 26042,\n\t\"./ru.js\": 26042,\n\t\"./sd\": 78849,\n\t\"./sd.js\": 78849,\n\t\"./se\": 27739,\n\t\"./se.js\": 27739,\n\t\"./si\": 50084,\n\t\"./si.js\": 50084,\n\t\"./sk\": 92449,\n\t\"./sk.js\": 92449,\n\t\"./sl\": 23086,\n\t\"./sl.js\": 23086,\n\t\"./sq\": 33139,\n\t\"./sq.js\": 33139,\n\t\"./sr\": 30607,\n\t\"./sr-cyrl\": 30063,\n\t\"./sr-cyrl.js\": 30063,\n\t\"./sr.js\": 30607,\n\t\"./ss\": 40131,\n\t\"./ss.js\": 40131,\n\t\"./sv\": 21665,\n\t\"./sv.js\": 21665,\n\t\"./sw\": 5642,\n\t\"./sw.js\": 5642,\n\t\"./ta\": 33622,\n\t\"./ta.js\": 33622,\n\t\"./te\": 74825,\n\t\"./te.js\": 74825,\n\t\"./tet\": 48336,\n\t\"./tet.js\": 48336,\n\t\"./tg\": 39238,\n\t\"./tg.js\": 39238,\n\t\"./th\": 99463,\n\t\"./th.js\": 99463,\n\t\"./tk\": 39986,\n\t\"./tk.js\": 39986,\n\t\"./tl-ph\": 29672,\n\t\"./tl-ph.js\": 29672,\n\t\"./tlh\": 40043,\n\t\"./tlh.js\": 40043,\n\t\"./tr\": 51212,\n\t\"./tr.js\": 51212,\n\t\"./tzl\": 50110,\n\t\"./tzl.js\": 50110,\n\t\"./tzm\": 80482,\n\t\"./tzm-latn\": 38309,\n\t\"./tzm-latn.js\": 38309,\n\t\"./tzm.js\": 80482,\n\t\"./ug-cn\": 42495,\n\t\"./ug-cn.js\": 42495,\n\t\"./uk\": 54157,\n\t\"./uk.js\": 54157,\n\t\"./ur\": 80984,\n\t\"./ur.js\": 80984,\n\t\"./uz\": 64141,\n\t\"./uz-latn\": 43662,\n\t\"./uz-latn.js\": 43662,\n\t\"./uz.js\": 64141,\n\t\"./vi\": 12607,\n\t\"./vi.js\": 12607,\n\t\"./x-pseudo\": 66460,\n\t\"./x-pseudo.js\": 66460,\n\t\"./yo\": 92948,\n\t\"./yo.js\": 92948,\n\t\"./zh-cn\": 62658,\n\t\"./zh-cn.js\": 62658,\n\t\"./zh-hk\": 39352,\n\t\"./zh-hk.js\": 39352,\n\t\"./zh-mo\": 38274,\n\t\"./zh-mo.js\": 38274,\n\t\"./zh-tw\": 98451,\n\t\"./zh-tw.js\": 98451\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 46700;","var map = {\n\t\"./helptexts.de.json\": 42292,\n\t\"./helptexts.en.json\": 83410,\n\t\"./helptexts.nb.json\": 66783,\n\t\"./helptexts.nn.json\": 61317,\n\t\"./helptexts.sl.json\": 86026,\n\t\"./helptexts.sv.json\": 20026\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 67680;","var map = {\n\t\"./kdvelements.de.json\": 27522,\n\t\"./kdvelements.en.json\": 67287,\n\t\"./kdvelements.nb.json\": 85980,\n\t\"./kdvelements.nn.json\": 65324,\n\t\"./kdvelements.sl.json\": 43544,\n\t\"./kdvelements.sv.json\": 87285\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 20366;","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */"]}