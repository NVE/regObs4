{"version":3,"mappings":"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","names":["resolve","path","posix","split","filter","item","newPosix","forEach","length","pop","push","join","isPathParent","parent","children","pathsA","pathsB","every","value","index","FilesystemWeb","constructor","arguments","DB_VERSION","DB_NAME","_writeCmds","initDb","_this","_db","undefined","window","unavailable","Promise","reject","request","indexedDB","open","onupgradeneeded","doUpgrade","onsuccess","result","onerror","error","onblocked","console","warn","dbRequest","cmd","args","readFlag","_this2","indexOf","then","conn","tx","transaction","store","objectStore","req","dbIndexRequest","indexName","_this3","getPath","directory","uriPath","cleanedUriPath","replace","fsPath","clear","_this4","readFile","options","_this5","entry","Error","data","content","writeFile","_this6","doRecursive","recursive","occupiedEntry","type","encoding","parentPath","substr","lastIndexOf","parentEntry","subDirIndex","parentArgPath","mkdir","now","Date","pathObj","folder","size","ctime","mtime","uri","appendFile","_this7","deleteFile","_this8","IDBKeyRange","only","entries","_this9","depth","match","rmdir","fullPath","_this10","readdir","readDirResult","files","entryPath","stat","entryObj","_this11","names","map","e","substring","getUri","_this12","_this13","rename","_this14","_copy","copy","_this15","requestPermissions","publicStorage","checkPermissions","doRename","toDirectory","to","from","fromDirectory","fromPath","_this16","toPath","toObj","toPathComponents","toParentDirectory","fromObj","updateTime","file","contents","filename","event","eventTarget","target","db","oldVersion","objectStoreNames","contains","deleteObjectStore","createObjectStore","keyPath","createIndex","WebPlugin","_debug"],"sources":["webpack:///node_modules/@capacitor/filesystem/dist/esm/web.js"],"sourcesContent":["import { WebPlugin } from '@capacitor/core';\nfunction resolve(path) {\n    const posix = path.split('/').filter(item => item !== '.');\n    const newPosix = [];\n    posix.forEach(item => {\n        if (item === '..' &&\n            newPosix.length > 0 &&\n            newPosix[newPosix.length - 1] !== '..') {\n            newPosix.pop();\n        }\n        else {\n            newPosix.push(item);\n        }\n    });\n    return newPosix.join('/');\n}\nfunction isPathParent(parent, children) {\n    parent = resolve(parent);\n    children = resolve(children);\n    const pathsA = parent.split('/');\n    const pathsB = children.split('/');\n    return (parent !== children &&\n        pathsA.every((value, index) => value === pathsB[index]));\n}\nexport class FilesystemWeb extends WebPlugin {\n    constructor() {\n        super(...arguments);\n        this.DB_VERSION = 1;\n        this.DB_NAME = 'Disc';\n        this._writeCmds = ['add', 'put', 'delete'];\n    }\n    async initDb() {\n        if (this._db !== undefined) {\n            return this._db;\n        }\n        if (!('indexedDB' in window)) {\n            throw this.unavailable(\"This browser doesn't support IndexedDB\");\n        }\n        return new Promise((resolve, reject) => {\n            const request = indexedDB.open(this.DB_NAME, this.DB_VERSION);\n            request.onupgradeneeded = FilesystemWeb.doUpgrade;\n            request.onsuccess = () => {\n                this._db = request.result;\n                resolve(request.result);\n            };\n            request.onerror = () => reject(request.error);\n            request.onblocked = () => {\n                console.warn('db blocked');\n            };\n        });\n    }\n    static doUpgrade(event) {\n        const eventTarget = event.target;\n        const db = eventTarget.result;\n        switch (event.oldVersion) {\n            case 0:\n            case 1:\n            default: {\n                if (db.objectStoreNames.contains('FileStorage')) {\n                    db.deleteObjectStore('FileStorage');\n                }\n                const store = db.createObjectStore('FileStorage', { keyPath: 'path' });\n                store.createIndex('by_folder', 'folder');\n            }\n        }\n    }\n    async dbRequest(cmd, args) {\n        const readFlag = this._writeCmds.indexOf(cmd) !== -1 ? 'readwrite' : 'readonly';\n        return this.initDb().then((conn) => {\n            return new Promise((resolve, reject) => {\n                const tx = conn.transaction(['FileStorage'], readFlag);\n                const store = tx.objectStore('FileStorage');\n                const req = store[cmd](...args);\n                req.onsuccess = () => resolve(req.result);\n                req.onerror = () => reject(req.error);\n            });\n        });\n    }\n    async dbIndexRequest(indexName, cmd, args) {\n        const readFlag = this._writeCmds.indexOf(cmd) !== -1 ? 'readwrite' : 'readonly';\n        return this.initDb().then((conn) => {\n            return new Promise((resolve, reject) => {\n                const tx = conn.transaction(['FileStorage'], readFlag);\n                const store = tx.objectStore('FileStorage');\n                const index = store.index(indexName);\n                const req = index[cmd](...args);\n                req.onsuccess = () => resolve(req.result);\n                req.onerror = () => reject(req.error);\n            });\n        });\n    }\n    getPath(directory, uriPath) {\n        const cleanedUriPath = uriPath !== undefined ? uriPath.replace(/^[/]+|[/]+$/g, '') : '';\n        let fsPath = '';\n        if (directory !== undefined)\n            fsPath += '/' + directory;\n        if (uriPath !== '')\n            fsPath += '/' + cleanedUriPath;\n        return fsPath;\n    }\n    async clear() {\n        const conn = await this.initDb();\n        const tx = conn.transaction(['FileStorage'], 'readwrite');\n        const store = tx.objectStore('FileStorage');\n        store.clear();\n    }\n    /**\n     * Read a file from disk\n     * @param options options for the file read\n     * @return a promise that resolves with the read file data result\n     */\n    async readFile(options) {\n        const path = this.getPath(options.directory, options.path);\n        // const encoding = options.encoding;\n        const entry = (await this.dbRequest('get', [path]));\n        if (entry === undefined)\n            throw Error('File does not exist.');\n        return { data: entry.content ? entry.content : '' };\n    }\n    /**\n     * Write a file to disk in the specified location on device\n     * @param options options for the file write\n     * @return a promise that resolves with the file write result\n     */\n    async writeFile(options) {\n        const path = this.getPath(options.directory, options.path);\n        const data = options.data;\n        const doRecursive = options.recursive;\n        const occupiedEntry = (await this.dbRequest('get', [path]));\n        if (occupiedEntry && occupiedEntry.type === 'directory')\n            throw 'The supplied path is a directory.';\n        const encoding = options.encoding;\n        const parentPath = path.substr(0, path.lastIndexOf('/'));\n        const parentEntry = (await this.dbRequest('get', [parentPath]));\n        if (parentEntry === undefined) {\n            const subDirIndex = parentPath.indexOf('/', 1);\n            if (subDirIndex !== -1) {\n                const parentArgPath = parentPath.substr(subDirIndex);\n                await this.mkdir({\n                    path: parentArgPath,\n                    directory: options.directory,\n                    recursive: doRecursive,\n                });\n            }\n        }\n        const now = Date.now();\n        const pathObj = {\n            path: path,\n            folder: parentPath,\n            type: 'file',\n            size: data.length,\n            ctime: now,\n            mtime: now,\n            content: !encoding && data.indexOf(',') >= 0 ? data.split(',')[1] : data,\n        };\n        await this.dbRequest('put', [pathObj]);\n        return {\n            uri: pathObj.path,\n        };\n    }\n    /**\n     * Append to a file on disk in the specified location on device\n     * @param options options for the file append\n     * @return a promise that resolves with the file write result\n     */\n    async appendFile(options) {\n        const path = this.getPath(options.directory, options.path);\n        let data = options.data;\n        // const encoding = options.encoding;\n        const parentPath = path.substr(0, path.lastIndexOf('/'));\n        const now = Date.now();\n        let ctime = now;\n        const occupiedEntry = (await this.dbRequest('get', [path]));\n        if (occupiedEntry && occupiedEntry.type === 'directory')\n            throw 'The supplied path is a directory.';\n        const parentEntry = (await this.dbRequest('get', [parentPath]));\n        if (parentEntry === undefined) {\n            const subDirIndex = parentPath.indexOf('/', 1);\n            if (subDirIndex !== -1) {\n                const parentArgPath = parentPath.substr(subDirIndex);\n                await this.mkdir({\n                    path: parentArgPath,\n                    directory: options.directory,\n                    recursive: true,\n                });\n            }\n        }\n        if (occupiedEntry !== undefined) {\n            data = occupiedEntry.content + data;\n            ctime = occupiedEntry.ctime;\n        }\n        const pathObj = {\n            path: path,\n            folder: parentPath,\n            type: 'file',\n            size: data.length,\n            ctime: ctime,\n            mtime: now,\n            content: data,\n        };\n        await this.dbRequest('put', [pathObj]);\n    }\n    /**\n     * Delete a file from disk\n     * @param options options for the file delete\n     * @return a promise that resolves with the deleted file data result\n     */\n    async deleteFile(options) {\n        const path = this.getPath(options.directory, options.path);\n        const entry = (await this.dbRequest('get', [path]));\n        if (entry === undefined)\n            throw Error('File does not exist.');\n        const entries = await this.dbIndexRequest('by_folder', 'getAllKeys', [\n            IDBKeyRange.only(path),\n        ]);\n        if (entries.length !== 0)\n            throw Error('Folder is not empty.');\n        await this.dbRequest('delete', [path]);\n    }\n    /**\n     * Create a directory.\n     * @param options options for the mkdir\n     * @return a promise that resolves with the mkdir result\n     */\n    async mkdir(options) {\n        const path = this.getPath(options.directory, options.path);\n        const doRecursive = options.recursive;\n        const parentPath = path.substr(0, path.lastIndexOf('/'));\n        const depth = (path.match(/\\//g) || []).length;\n        const parentEntry = (await this.dbRequest('get', [parentPath]));\n        const occupiedEntry = (await this.dbRequest('get', [path]));\n        if (depth === 1)\n            throw Error('Cannot create Root directory');\n        if (occupiedEntry !== undefined)\n            throw Error('Current directory does already exist.');\n        if (!doRecursive && depth !== 2 && parentEntry === undefined)\n            throw Error('Parent directory must exist');\n        if (doRecursive && depth !== 2 && parentEntry === undefined) {\n            const parentArgPath = parentPath.substr(parentPath.indexOf('/', 1));\n            await this.mkdir({\n                path: parentArgPath,\n                directory: options.directory,\n                recursive: doRecursive,\n            });\n        }\n        const now = Date.now();\n        const pathObj = {\n            path: path,\n            folder: parentPath,\n            type: 'directory',\n            size: 0,\n            ctime: now,\n            mtime: now,\n        };\n        await this.dbRequest('put', [pathObj]);\n    }\n    /**\n     * Remove a directory\n     * @param options the options for the directory remove\n     */\n    async rmdir(options) {\n        const { path, directory, recursive } = options;\n        const fullPath = this.getPath(directory, path);\n        const entry = (await this.dbRequest('get', [fullPath]));\n        if (entry === undefined)\n            throw Error('Folder does not exist.');\n        if (entry.type !== 'directory')\n            throw Error('Requested path is not a directory');\n        const readDirResult = await this.readdir({ path, directory });\n        if (readDirResult.files.length !== 0 && !recursive)\n            throw Error('Folder is not empty');\n        for (const entry of readDirResult.files) {\n            const entryPath = `${path}/${entry}`;\n            const entryObj = await this.stat({ path: entryPath, directory });\n            if (entryObj.type === 'file') {\n                await this.deleteFile({ path: entryPath, directory });\n            }\n            else {\n                await this.rmdir({ path: entryPath, directory, recursive });\n            }\n        }\n        await this.dbRequest('delete', [fullPath]);\n    }\n    /**\n     * Return a list of files from the directory (not recursive)\n     * @param options the options for the readdir operation\n     * @return a promise that resolves with the readdir directory listing result\n     */\n    async readdir(options) {\n        const path = this.getPath(options.directory, options.path);\n        const entry = (await this.dbRequest('get', [path]));\n        if (options.path !== '' && entry === undefined)\n            throw Error('Folder does not exist.');\n        const entries = await this.dbIndexRequest('by_folder', 'getAllKeys', [IDBKeyRange.only(path)]);\n        const names = entries.map(e => {\n            return e.substring(path.length + 1);\n        });\n        return { files: names };\n    }\n    /**\n     * Return full File URI for a path and directory\n     * @param options the options for the stat operation\n     * @return a promise that resolves with the file stat result\n     */\n    async getUri(options) {\n        const path = this.getPath(options.directory, options.path);\n        let entry = (await this.dbRequest('get', [path]));\n        if (entry === undefined) {\n            entry = (await this.dbRequest('get', [path + '/']));\n        }\n        return {\n            uri: (entry === null || entry === void 0 ? void 0 : entry.path) || path,\n        };\n    }\n    /**\n     * Return data about a file\n     * @param options the options for the stat operation\n     * @return a promise that resolves with the file stat result\n     */\n    async stat(options) {\n        const path = this.getPath(options.directory, options.path);\n        let entry = (await this.dbRequest('get', [path]));\n        if (entry === undefined) {\n            entry = (await this.dbRequest('get', [path + '/']));\n        }\n        if (entry === undefined)\n            throw Error('Entry does not exist.');\n        return {\n            type: entry.type,\n            size: entry.size,\n            ctime: entry.ctime,\n            mtime: entry.mtime,\n            uri: entry.path,\n        };\n    }\n    /**\n     * Rename a file or directory\n     * @param options the options for the rename operation\n     * @return a promise that resolves with the rename result\n     */\n    async rename(options) {\n        return this._copy(options, true);\n    }\n    /**\n     * Copy a file or directory\n     * @param options the options for the copy operation\n     * @return a promise that resolves with the copy result\n     */\n    async copy(options) {\n        return this._copy(options, false);\n    }\n    async requestPermissions() {\n        return { publicStorage: 'granted' };\n    }\n    async checkPermissions() {\n        return { publicStorage: 'granted' };\n    }\n    /**\n     * Function that can perform a copy or a rename\n     * @param options the options for the rename operation\n     * @param doRename whether to perform a rename or copy operation\n     * @return a promise that resolves with the result\n     */\n    async _copy(options, doRename = false) {\n        let { toDirectory } = options;\n        const { to, from, directory: fromDirectory } = options;\n        if (!to || !from) {\n            throw Error('Both to and from must be provided');\n        }\n        // If no \"to\" directory is provided, use the \"from\" directory\n        if (!toDirectory) {\n            toDirectory = fromDirectory;\n        }\n        const fromPath = this.getPath(fromDirectory, from);\n        const toPath = this.getPath(toDirectory, to);\n        // Test that the \"to\" and \"from\" locations are different\n        if (fromPath === toPath) {\n            return;\n        }\n        if (isPathParent(fromPath, toPath)) {\n            throw Error('To path cannot contain the from path');\n        }\n        // Check the state of the \"to\" location\n        let toObj;\n        try {\n            toObj = await this.stat({\n                path: to,\n                directory: toDirectory,\n            });\n        }\n        catch (e) {\n            // To location does not exist, ensure the directory containing \"to\" location exists and is a directory\n            const toPathComponents = to.split('/');\n            toPathComponents.pop();\n            const toPath = toPathComponents.join('/');\n            // Check the containing directory of the \"to\" location exists\n            if (toPathComponents.length > 0) {\n                const toParentDirectory = await this.stat({\n                    path: toPath,\n                    directory: toDirectory,\n                });\n                if (toParentDirectory.type !== 'directory') {\n                    throw new Error('Parent directory of the to path is a file');\n                }\n            }\n        }\n        // Cannot overwrite a directory\n        if (toObj && toObj.type === 'directory') {\n            throw new Error('Cannot overwrite a directory with a file');\n        }\n        // Ensure the \"from\" object exists\n        const fromObj = await this.stat({\n            path: from,\n            directory: fromDirectory,\n        });\n        // Set the mtime/ctime of the supplied path\n        const updateTime = async (path, ctime, mtime) => {\n            const fullPath = this.getPath(toDirectory, path);\n            const entry = (await this.dbRequest('get', [fullPath]));\n            entry.ctime = ctime;\n            entry.mtime = mtime;\n            await this.dbRequest('put', [entry]);\n        };\n        const ctime = fromObj.ctime ? fromObj.ctime : Date.now();\n        switch (fromObj.type) {\n            // The \"from\" object is a file\n            case 'file': {\n                // Read the file\n                const file = await this.readFile({\n                    path: from,\n                    directory: fromDirectory,\n                });\n                // Optionally remove the file\n                if (doRename) {\n                    await this.deleteFile({\n                        path: from,\n                        directory: fromDirectory,\n                    });\n                }\n                // Write the file to the new location\n                await this.writeFile({\n                    path: to,\n                    directory: toDirectory,\n                    data: file.data,\n                });\n                // Copy the mtime/ctime of a renamed file\n                if (doRename) {\n                    await updateTime(to, ctime, fromObj.mtime);\n                }\n                // Resolve promise\n                return;\n            }\n            case 'directory': {\n                if (toObj) {\n                    throw Error('Cannot move a directory over an existing object');\n                }\n                try {\n                    // Create the to directory\n                    await this.mkdir({\n                        path: to,\n                        directory: toDirectory,\n                        recursive: false,\n                    });\n                    // Copy the mtime/ctime of a renamed directory\n                    if (doRename) {\n                        await updateTime(to, ctime, fromObj.mtime);\n                    }\n                }\n                catch (e) {\n                    // ignore\n                }\n                // Iterate over the contents of the from location\n                const contents = (await this.readdir({\n                    path: from,\n                    directory: fromDirectory,\n                })).files;\n                for (const filename of contents) {\n                    // Move item from the from directory to the to directory\n                    await this._copy({\n                        from: `${from}/${filename}`,\n                        to: `${to}/${filename}`,\n                        directory: fromDirectory,\n                        toDirectory,\n                    }, doRename);\n                }\n                // Optionally remove the original from directory\n                if (doRename) {\n                    await this.rmdir({\n                        path: from,\n                        directory: fromDirectory,\n                    });\n                }\n            }\n        }\n    }\n}\nFilesystemWeb._debug = true;\n"]}