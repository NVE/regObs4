{"version":3,"mappings":"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","names":["DEBUG_TAG","BasePageService","registrationService","newAttachmentService","commonRegistrationService","ngZone","alertController","translateService","loggingService","registration","registrationTid","onReset","get","toPromise","leaveText","createResetDialog","message","translations","create","buttons","text","role","alert","present","onDidDismiss","result","reset","Zone","run","request","getDefaultValue","resetImages","saveRegistrationAsync","propName","getAttachments","id","pipe","attachments","map","a","removeAttachment","subscribe","debug","error","_angular_core__WEBPACK_IMPORTED_MODULE_7__","factory","providedIn","BasePage","basePageService","activatedRoute","snapshot","params","CommonRegistrationService","getRegistrationByIdShared$","reg","createDefaultProps","createInitObservable","ngDestroy$","Promise","resolve","isValid","valid","isEmpty","confirmLeave","onInit","onBeforeLeave","save","clean","syncStatus","src_app_modules_common_registration_registration_models__WEBPACK_IMPORTED_MODULE_1__","RegistrationService","hasAnyDataToShowInRegistrationTypes","confirmReset","pathFromRoot","v","url","segment","toString","join","filter","path","_core_helpers_observable_helper__WEBPACK_IMPORTED_MODULE_2__","_angular_core__WEBPACK_IMPORTED_MODULE_11__","features","AddOrEditDangerObsModalPageModule","_shared_components_module__WEBPACK_IMPORTED_MODULE_1__","declarations","_add_or_edit_danger_obs_modal_page__WEBPACK_IMPORTED_MODULE_0__","imports","_angular_core__WEBPACK_IMPORTED_MODULE_5__","ctx_r0","COMMENT_SEPARATOR","AddOrEditDangerObsModalPage","modalController","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_6__","geoHazard","showDangerSignCheckbox","getAreaArray","tranlations","commentTranslations","areaArr","item","dangerObs","Comment","option","find","x","indexOf","tmpArea","comment","substr","length","textToFind","additionalCommentIndex","DangerSignTID","getNoDangerSignTid","noDangerObs","dangerSignTid","updateDangerSignSelectVisibilty","loaded","showDangerSignSelect","getDangerSignTidOrFallback","val","dismiss","undefined","dangerObsToSave","GeoHazardTID","getComment","selectors","inputs","decls","vars","consts","template","ctx","routes","component","_danger_obs_page__WEBPACK_IMPORTED_MODULE_0__","DangerObsPageModule","_add_or_edit_danger_obs_modal_add_or_edit_danger_obs_modal_module__WEBPACK_IMPORTED_MODULE_2__","_angular_router__WEBPACK_IMPORTED_MODULE_4__","_angular_core__WEBPACK_IMPORTED_MODULE_8__","DangerObsPage","zone","kdvService","src_app_modules_common_registration_registration_models__WEBPACK_IMPORTED_MODULE_0__","dangerSignKdvSubscription","unsubscribe","kdvKey","_varsom_regobs_common_core__WEBPACK_IMPORTED_MODULE_9__","getKdvRepositoryByKeyObservable","dangerSignKdv","index","DangerObs","_add_or_edit_danger_obs_modal_add_or_edit_danger_obs_modal_page__WEBPACK_IMPORTED_MODULE_2__","componentProps","modal","data","removeAtIndex","setDangerObs","addDangerObs","push","splice","kdvElement","Id","Name","trim","_base_page__WEBPACK_IMPORTED_MODULE_1__"],"sources":["webpack:///src/app/modules/registration/pages/base-page-service.ts","webpack:///src/app/modules/registration/pages/base.page.ts","webpack:///src/app/modules/registration/pages/danger-obs/add-or-edit-danger-obs-modal/add-or-edit-danger-obs-modal.module.ts","webpack:///src/app/modules/registration/pages/danger-obs/add-or-edit-danger-obs-modal/add-or-edit-danger-obs-modal.page.html","webpack:///src/app/modules/registration/pages/danger-obs/add-or-edit-danger-obs-modal/add-or-edit-danger-obs-modal.page.ts","webpack:///src/app/modules/registration/pages/danger-obs/danger-obs.module.ts","webpack:///src/app/modules/registration/pages/danger-obs/danger-obs.page.html","webpack:///src/app/modules/registration/pages/danger-obs/danger-obs.page.ts"],"sourcesContent":["import { Injectable, NgZone } from '@angular/core';\r\nimport { IRegistration, RegistrationTid } from 'src/app/modules/common-registration/registration.models';\r\nimport { getPropertyName, isArrayType } from 'src/app/modules/common-registration/registration.helpers';\r\nimport { NewAttachmentService, RegistrationService as CommonRegistrationService } from 'src/app/modules/common-registration/registration.services';\r\nimport { RegistrationService } from '../services/registration.service';\r\nimport { AlertController } from '@ionic/angular';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { forkJoin } from 'rxjs';\r\nimport { LoggingService } from '../../shared/services/logging/logging.service';\r\n\r\nconst DEBUG_TAG = 'BasePageService';\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class BasePageService {\r\n  get Zone() {\r\n    return this.ngZone;\r\n  }\r\n\r\n  get RegistrationService() {\r\n    return this.registrationService;\r\n  }\r\n\r\n  get AlertController() {\r\n    return this.alertController;\r\n  }\r\n\r\n  get TranslateService() {\r\n    return this.translateService;\r\n  }\r\n\r\n  get CommonRegistrationService() {\r\n    return this.commonRegistrationService;\r\n  }\r\n\r\n  constructor(\r\n    private registrationService: RegistrationService,\r\n    private newAttachmentService: NewAttachmentService,\r\n    private commonRegistrationService: CommonRegistrationService,\r\n    private ngZone: NgZone,\r\n    private alertController: AlertController,\r\n    private translateService: TranslateService,\r\n    private loggingService: LoggingService\r\n  ) {}\r\n\r\n  async confirmLeave(registration: IRegistration, registrationTid: RegistrationTid, onReset?: () => void) {\r\n    const leaveText = await this.translateService.get('REGISTRATION.REQUIRED_FIELDS_MISSING').toPromise();\r\n    return this.createResetDialog(leaveText, registration, registrationTid, onReset);\r\n  }\r\n\r\n  async confirmReset(registration: IRegistration, registrationTid: RegistrationTid, onReset?: () => void) {\r\n    const leaveText = await this.translateService.get('REGISTRATION.CONFIRM_RESET').toPromise();\r\n    return this.createResetDialog(leaveText, registration, registrationTid, onReset);\r\n  }\r\n\r\n  private async createResetDialog(message: string, registration: IRegistration, registrationTid: RegistrationTid, onReset?: () => void) {\r\n    const translations = await this.translateService.get(['DIALOGS.CANCEL', 'DIALOGS.YES']).toPromise();\r\n    const alert = await this.alertController.create({\r\n      message,\r\n      buttons: [\r\n        {\r\n          text: translations['DIALOGS.CANCEL'],\r\n          role: 'cancel'\r\n        },\r\n        {\r\n          text: translations['DIALOGS.YES']\r\n        }\r\n      ]\r\n    });\r\n    await alert.present();\r\n    const result = await alert.onDidDismiss();\r\n    const reset: boolean = result.role !== 'cancel';\r\n    if (reset) {\r\n      await this.reset(registration, registrationTid, onReset);\r\n    }\r\n    return reset;\r\n  }\r\n\r\n  async reset(registration: IRegistration, registrationTid: RegistrationTid, onReset?: () => void) {\r\n    this.Zone.run(() => {\r\n      if (registrationTid) {\r\n        registration.request[getPropertyName(registrationTid)] = this.getDefaultValue(registrationTid);\r\n        this.resetImages(registration);\r\n      }\r\n      if (onReset) {\r\n        onReset();\r\n      }\r\n    });\r\n    await this.registrationService.saveRegistrationAsync(registration);\r\n  }\r\n\r\n  createDefaultProps(registration: IRegistration, registrationTid: RegistrationTid) {\r\n    const propName = getPropertyName(registrationTid);\r\n    if (!registration.request[propName]) {\r\n      // Init to new object if null\r\n      registration.request[propName] = this.getDefaultValue(registrationTid);\r\n    }\r\n  }\r\n\r\n  getDefaultValue(registrationTid: RegistrationTid) {\r\n    if (isArrayType(registrationTid)) {\r\n      return [];\r\n    } else {\r\n      return {};\r\n    }\r\n  }\r\n\r\n  resetImages(registration: IRegistration) {\r\n    this.newAttachmentService\r\n      .getAttachments(registration.id)\r\n      .pipe(switchMap((attachments) => forkJoin(attachments.map((a) => this.newAttachmentService.removeAttachment(registration.id, a.id)))))\r\n      .subscribe(\r\n        () => {\r\n          this.loggingService.debug('Reset images complete', DEBUG_TAG);\r\n        },\r\n        (error) => {\r\n          this.loggingService.error(error, DEBUG_TAG, 'Could not reset images');\r\n        }\r\n      );\r\n  }\r\n}\r\n","import { Directive, OnInit } from '@angular/core';\r\nimport { from, of } from 'rxjs';\r\nimport { BasePageService } from './base-page-service';\r\nimport { IRegistration, RegistrationTid, SyncStatus } from 'src/app/modules/common-registration/registration.models';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { take, takeUntil, map, switchMap, tap } from 'rxjs/operators';\r\nimport { NgDestoryBase } from '../../../core/helpers/observable-helper';\r\n\r\n@Directive()\r\nexport abstract class BasePage extends NgDestoryBase implements OnInit {\r\n  registration: IRegistration;\r\n  basePageService: BasePageService;\r\n  registrationTid: RegistrationTid;\r\n  activatedRoute: ActivatedRoute;\r\n\r\n  constructor(registrationTid: RegistrationTid, basePageService: BasePageService, activatedRoute: ActivatedRoute) {\r\n    super();\r\n    this.basePageService = basePageService;\r\n    this.activatedRoute = activatedRoute;\r\n    this.registrationTid = registrationTid;\r\n  }\r\n\r\n  ngOnInit() {}\r\n\r\n  ionViewDidEnter() {\r\n    const id = this.activatedRoute.snapshot.params['id'];\r\n    this.basePageService.CommonRegistrationService.getRegistrationByIdShared$(id)\r\n      .pipe(\r\n        take(1),\r\n        map((reg) => {\r\n          this.basePageService.createDefaultProps(reg, this.registrationTid);\r\n          return reg;\r\n        }),\r\n        tap((reg) => {\r\n          this.registration = reg;\r\n        }),\r\n        switchMap(() => this.createInitObservable()),\r\n        takeUntil(this.ngDestroy$)\r\n      )\r\n      .subscribe();\r\n  }\r\n\r\n  onInit?(): void | Promise<any>;\r\n\r\n  onBeforeLeave?(): void | Promise<any>;\r\n\r\n  onReset?(): void;\r\n\r\n  isValid?(): boolean | Promise<boolean>;\r\n\r\n  // NOTE: Remember to add canDeactivate: [CanDeactivateRouteGuard] in page module\r\n  async canLeave() {\r\n    // Check if implementation page has implemented custom isValid logic\r\n    const valid = await Promise.resolve(this.isValid ? this.isValid() : true);\r\n    // Only return alert if page is not empty and invalid\r\n    const isEmpty = await Promise.resolve(this.isEmpty());\r\n    if (!isEmpty && !valid) {\r\n      return this.basePageService.confirmLeave(this.registration, this.registrationTid, () => (this.onReset ? this.onReset() : null));\r\n    }\r\n    return true;\r\n  }\r\n\r\n  private createInitObservable() {\r\n    if (this.onInit) {\r\n      return from(Promise.resolve(this.onInit()));\r\n    }\r\n    return of({});\r\n  }\r\n\r\n  async ionViewWillLeave() {\r\n    if (this.onBeforeLeave) {\r\n      await Promise.resolve(this.onBeforeLeave());\r\n    }\r\n    await this.save(true);\r\n  }\r\n\r\n  save(clean = false) {\r\n    this.registration.syncStatus = SyncStatus.Draft;\r\n    return this.basePageService.RegistrationService.saveRegistrationAsync(this.registration, clean);\r\n  }\r\n\r\n  getSaveFunc() {\r\n    return () => this.save();\r\n  }\r\n\r\n  async isEmpty(): Promise<boolean> {\r\n    return !(await this.basePageService.CommonRegistrationService.hasAnyDataToShowInRegistrationTypes(\r\n      this.registration,\r\n      this.registrationTid\r\n    )\r\n      .pipe(take(1))\r\n      .toPromise());\r\n  }\r\n\r\n  reset() {\r\n    return this.basePageService.confirmReset(this.registration, this.registrationTid, () => (this.onReset ? this.onReset() : null));\r\n  }\r\n\r\n  getResolvedUrl(): string {\r\n    return (\r\n      '/' +\r\n      this.activatedRoute.snapshot.pathFromRoot\r\n        .map((v) => v.url.map((segment) => segment.toString()).join('/'))\r\n        .filter((path) => !!path)\r\n        .join('/')\r\n    );\r\n  }\r\n\r\n  // getConfiguredUrl(): string {\r\n  //     return '/' + this.activatedRoute.snapshot.pathFromRoot\r\n  //         .filter(v => v.routeConfig)\r\n  //         .map(v => v.routeConfig.path)\r\n  //         .join('/');\r\n  // }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { AddOrEditDangerObsModalPage } from './add-or-edit-danger-obs-modal.page';\r\nimport { SharedComponentsModule } from '../../../shared-components.module';\r\n\r\n@NgModule({\r\n  imports: [SharedComponentsModule],\r\n  declarations: [AddOrEditDangerObsModalPage],\r\n  entryComponents: [AddOrEditDangerObsModalPage]\r\n})\r\nexport class AddOrEditDangerObsModalPageModule {}\r\n","<ion-header>\r\n  <ion-toolbar appHeaderColor mode=\"ios\">\r\n    <ion-buttons slot=\"start\">\r\n      <ion-button (click)=\"cancel()\">{{ 'DIALOGS.CANCEL' | translate }}</ion-button>\r\n    </ion-buttons>\r\n    <ion-title>\r\n      {{ 'REGISTRATION.DANGER_OBS.TITLE' | translate }}\r\n    </ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content *ngIf=\"loaded\">\r\n  <ion-list lines=\"full\">\r\n    <ion-list-header class=\"ion-text-uppercase\">\r\n      <ion-label>\r\n        {{ 'REGISTRATION.DANGER_OBS.TITLE' | translate}}\r\n      </ion-label>\r\n    </ion-list-header>\r\n    <ion-item *ngIf=\"showDangerSignCheckbox\">\r\n      <ion-checkbox (ionChange)=\"checkBoxChanged()\" color=\"varsom-dark-blue\" mode=\"md\" slot=\"start\" [(ngModel)]=\"noDangerObs\"></ion-checkbox>\r\n      <ion-label>{{ 'REGISTRATION.DANGER_OBS.NO_DAMAGE_SIGN' | translate}}</ion-label>\r\n    </ion-item>\r\n    <app-kdv-select (valueChange)=\"dropdownChanged($event)\" title=\"REGISTRATION.DANGER_OBS.TITLE\" *ngIf=\"showDangerSignSelect\"\r\n      kdvKey=\"{{ GeoHazardName }}_DangerSignKDV\" [(value)]=\"dangerSignTid\">\r\n    </app-kdv-select>\r\n    <ion-item>\r\n      <ion-label color=\"medium\" position=\"stacked\" class=\"ion-text-uppercase\">{{'REGISTRATION.DANGER_OBS.AREA' | translate}}\r\n      </ion-label>\r\n      <app-select title=\"REGISTRATION.DANGER_OBS.AREA\" [(selectedValue)]=\"tmpArea\" [options]=\"areaArr\"></app-select>\r\n    </ion-item>\r\n    <app-text-comment [(value)]=\"comment\" title=\"REGISTRATION.DANGER_OBS.COMMENT\" rows=\"2\"\r\n      placeholder=\"REGISTRATION.DANGER_OBS.COMMENT_PLACEHOLDER\"></app-text-comment>\r\n  </ion-list>\r\n  <app-modal-save-or-delete-buttons (saveClicked)=\"ok()\" (deleteClicked)=\"delete()\" [showDelete]=\"dangerObs\">\r\n  </app-modal-save-or-delete-buttons>\r\n</ion-content>","import { Component, OnInit, Input, NgZone } from '@angular/core';\r\nimport { DangerObsEditModel } from '@varsom-regobs-common/regobs-api';\r\nimport { ModalController } from '@ionic/angular';\r\nimport { GeoHazard } from '@varsom-regobs-common/core';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { SelectOption } from '../../../../shared/components/input/select/select-option.model';\r\n\r\nconst COMMENT_SEPARATOR = ': ';\r\n@Component({\r\n  selector: 'app-add-or-edit-danger-obs-modal',\r\n  templateUrl: './add-or-edit-danger-obs-modal.page.html',\r\n  styleUrls: ['./add-or-edit-danger-obs-modal.page.scss']\r\n})\r\nexport class AddOrEditDangerObsModalPage implements OnInit {\r\n  @Input() dangerObs: DangerObsEditModel;\r\n  @Input() geoHazard: GeoHazard;\r\n  noDangerObs = false;\r\n  areaArr: SelectOption[];\r\n  tmpArea = '';\r\n  dangerSignTid: number;\r\n  comment: string;\r\n  loaded = false;\r\n  commentTranslations: string[];\r\n  showDangerSignSelect = true;\r\n  showDangerSignCheckbox = false;\r\n\r\n  interfaceOptions = {};\r\n\r\n  get GeoHazardName() {\r\n    return GeoHazard[this.geoHazard];\r\n  }\r\n\r\n  constructor(\r\n    private modalController: ModalController,\r\n    private translateService: TranslateService,\r\n    private ngZone: NgZone\r\n  ) {}\r\n\r\n  async ngOnInit() {\r\n    this.showDangerSignCheckbox = this.geoHazard != GeoHazard.Ice;\r\n\r\n    const tranlations = await this.translateService\r\n      .get(this.getAreaArray())\r\n      .toPromise();\r\n    this.commentTranslations = await this.translateService\r\n      .get([\r\n        'REGISTRATION.DANGER_OBS.AREA',\r\n        'REGISTRATION.DANGER_OBS.DESCRIPTION'\r\n      ])\r\n      .toPromise();\r\n    this.areaArr = this.getAreaArray()\r\n      .map((item) => tranlations[item] as string)\r\n      .map((item) => ({ id: item, text: item }));\r\n\r\n    if (this.dangerObs) {\r\n      if (this.dangerObs.Comment) {\r\n        const option = this.areaArr.find(\r\n          (x) => this.dangerObs.Comment.indexOf(x.id) >= 0\r\n        );\r\n        this.tmpArea = option ? option.id : '';\r\n        if (this.tmpArea) {\r\n          this.comment = this.dangerObs.Comment.substr(\r\n            this.dangerObs.Comment.indexOf(this.tmpArea) + this.tmpArea.length\r\n          );\r\n          const textToFind =\r\n            `${this.commentTranslations['REGISTRATION.DANGER_OBS.DESCRIPTION']}` +\r\n            `${COMMENT_SEPARATOR}`;\r\n          const additionalCommentIndex = this.dangerObs.Comment.indexOf(\r\n            textToFind\r\n          );\r\n          if (additionalCommentIndex >= 0) {\r\n            this.comment = this.dangerObs.Comment.substr(\r\n              additionalCommentIndex + textToFind.length\r\n            );\r\n          }\r\n        } else {\r\n          this.comment = this.dangerObs.Comment;\r\n        }\r\n      }\r\n      if (this.dangerObs.DangerSignTID === this.getNoDangerSignTid()) {\r\n        this.noDangerObs = true;\r\n      }\r\n      this.dangerSignTid = this.dangerObs.DangerSignTID;\r\n      this.updateDangerSignSelectVisibilty();\r\n    }\r\n    this.loaded = true;\r\n  }\r\n\r\n  updateDangerSignSelectVisibilty() {\r\n    if (this.geoHazard === GeoHazard.Ice) {\r\n      this.showDangerSignSelect = true;\r\n    } else {\r\n      this.showDangerSignSelect = !this.noDangerObs;\r\n    }\r\n  }\r\n\r\n  toggleDangerObs(): void {\r\n    this.noDangerObs = !this.noDangerObs;\r\n    if (this.noDangerObs) {\r\n      this.dangerSignTid = this.getDangerSignTidOrFallback();\r\n    }\r\n    this.updateDangerSignSelectVisibilty();\r\n  }\r\n\r\n  checkBoxChanged(): void {\r\n    this.updateDangerSignSelectVisibilty();\r\n  }\r\n\r\n  dropdownChanged(val: number) {\r\n    if (val === this.getNoDangerSignTid()) {\r\n      this.noDangerObs = true;\r\n      this.updateDangerSignSelectVisibilty();\r\n    } else {\r\n      this.noDangerObs = false;\r\n    }\r\n  }\r\n\r\n  cancel() {\r\n    this.modalController.dismiss();\r\n  }\r\n\r\n  getNoDangerSignTid() {\r\n    return (this.geoHazard !== GeoHazard.Snow ? this.geoHazard * 10 : 0) + 1;\r\n  }\r\n\r\n  getDangerSignTidOrFallback() {\r\n    return this.dangerSignTid !== undefined\r\n      ? this.dangerSignTid\r\n      : this.geoHazard !== GeoHazard.Snow\r\n        ? this.geoHazard * 10\r\n        : 0;\r\n  }\r\n\r\n  ok() {\r\n    const dangerObsToSave: DangerObsEditModel = {\r\n      GeoHazardTID: this.geoHazard,\r\n      DangerSignTID: this.noDangerObs\r\n        ? this.getNoDangerSignTid()\r\n        : this.getDangerSignTidOrFallback(),\r\n      Comment: this.getComment()\r\n    };\r\n    this.modalController.dismiss(dangerObsToSave);\r\n  }\r\n\r\n  private getComment() {\r\n    if (\r\n      this.tmpArea &&\r\n      this.tmpArea.length > 0 &&\r\n      this.comment &&\r\n      this.comment.length > 0\r\n    ) {\r\n      return (\r\n        `${this.commentTranslations['REGISTRATION.DANGER_OBS.AREA']}` +\r\n        `${COMMENT_SEPARATOR}${this.tmpArea}. ` +\r\n        `${this.commentTranslations['REGISTRATION.DANGER_OBS.DESCRIPTION']}` +\r\n        `${COMMENT_SEPARATOR}${this.comment || ''}`\r\n      );\r\n    }\r\n    if (this.tmpArea && this.tmpArea.length > 0) {\r\n      return (\r\n        `${this.commentTranslations['REGISTRATION.DANGER_OBS.AREA']}` +\r\n        `${COMMENT_SEPARATOR}${this.tmpArea}`\r\n      );\r\n    }\r\n\r\n    return this.comment;\r\n  }\r\n\r\n  delete() {\r\n    this.modalController.dismiss({ delete: true });\r\n  }\r\n\r\n  getAreaArray() {\r\n    switch (this.geoHazard) {\r\n    case GeoHazard.Ice: {\r\n      return [\r\n        'REGISTRATION.DANGER_OBS.RIGHT_HERE',\r\n        'REGISTRATION.DANGER_OBS.ON_THIS_SIDE_OF_THE_WATER',\r\n        'REGISTRATION.DANGER_OBS.ON_THIS_WATER',\r\n        'REGISTRATION.DANGER_OBS.MANY_WATER_NEARBY'\r\n      ];\r\n    }\r\n    default:\r\n      return [\r\n        'REGISTRATION.DANGER_OBS.ON_THIS_PLACE',\r\n        'REGISTRATION.DANGER_OBS.ON_THIS_MOUNTAIN_SIDE',\r\n        'REGISTRATION.DANGER_OBS.GENERAL_ON_MOUNTAIN',\r\n        'REGISTRATION.DANGER_OBS.IN_THE_VALLEY_OR_FJORD',\r\n        'REGISTRATION.DANGER_OBS.FOR_MUNICIPAL',\r\n        'REGISTRATION.DANGER_OBS.FOR_REGION'\r\n      ];\r\n    }\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\nimport { DangerObsPage } from './danger-obs.page';\r\nimport { SharedComponentsModule } from '../../shared-components.module';\r\nimport { AddOrEditDangerObsModalPageModule } from './add-or-edit-danger-obs-modal/add-or-edit-danger-obs-modal.module';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: DangerObsPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [\r\n    SharedComponentsModule,\r\n    AddOrEditDangerObsModalPageModule,\r\n    RouterModule.forChild(routes)\r\n  ],\r\n  declarations: [DangerObsPage]\r\n})\r\nexport class DangerObsPageModule {}\r\n","<ion-header>\r\n  <ion-toolbar appHeaderColor mode=\"ios\">\r\n    <ion-buttons slot=\"start\">\r\n      <ion-back-button defaultHref=\"/\" text=\"\"></ion-back-button>\r\n    </ion-buttons>\r\n    <ion-title>\r\n      {{'REGISTRATION.DANGER_OBS.TITLE' | translate}}\r\n    </ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n<ion-content>\r\n  <app-registration-content-wrapper *ngIf=\"registration\" [registration]=\"registration\"\r\n    [registrationTid]=\"registrationTid\" (reset)=\"reset()\">\r\n    <ion-list lines=\"full\">\r\n      <ion-list-header class=\"ion-text-uppercase\">\r\n        <ion-label>\r\n          {{ 'REGISTRATION.DANGER_OBS.TITLE' | translate}}\r\n        </ion-label>\r\n      </ion-list-header>\r\n      <ion-item (click)=\"addOrEdit(i)\" *ngFor=\"let dangerObs of registration.request.DangerObs; let i = index\">\r\n        <ion-label>{{ getSummaryText(dangerObs) }}</ion-label>\r\n      </ion-item>\r\n      <ion-item (click)=\"addOrEdit()\">\r\n        <ion-icon color=\"dark\" name=\"add-circle-outline\" slot=\"start\"></ion-icon>\r\n        <ion-label>{{ 'REGISTRATION.DANGER_OBS.NEW_DANGER_OBS' | translate }}</ion-label>\r\n      </ion-item>\r\n      <ion-list-header class=\"ion-text-uppercase\">\r\n        <ion-label>\r\n          {{ 'REGISTRATION.ADD_IMAGES' | translate}}\r\n        </ion-label>\r\n      </ion-list-header>\r\n      <app-add-picture-item\r\n        [registrationTid]=\"registrationTid\" [geoHazard]=\"registration.geoHazard\" [registrationId]=\"registration.id\"></app-add-picture-item>\r\n    </ion-list>\r\n  </app-registration-content-wrapper>\r\n</ion-content>","import { Component, NgZone } from '@angular/core';\r\nimport { RegistrationTid } from 'src/app/modules/common-registration/registration.models';\r\nimport { BasePage } from '../base.page';\r\nimport { ModalController } from '@ionic/angular';\r\nimport { AddOrEditDangerObsModalPage } from './add-or-edit-danger-obs-modal/add-or-edit-danger-obs-modal.page';\r\nimport { DangerObsEditModel, KdvElement } from '@varsom-regobs-common/regobs-api';\r\nimport { KdvService } from '../../../../core/services/kdv/kdv.service';\r\nimport { GeoHazard } from '@varsom-regobs-common/core';\r\nimport { BasePageService } from '../base-page-service';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { Subscription } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-danger-obs',\r\n  templateUrl: './danger-obs.page.html',\r\n  styleUrls: ['./danger-obs.page.scss']\r\n})\r\nexport class DangerObsPage extends BasePage {\r\n  private dangerSignKdv: KdvElement[];\r\n  private dangerSignKdvSubscription: Subscription;\r\n\r\n  constructor(\r\n    basePageService: BasePageService,\r\n    activatedRoute: ActivatedRoute,\r\n    private modalController: ModalController,\r\n    private zone: NgZone,\r\n    private kdvService: KdvService\r\n  ) {\r\n    super(RegistrationTid.DangerObs, basePageService, activatedRoute);\r\n  }\r\n\r\n  onBeforeLeave() {\r\n    if (this.dangerSignKdvSubscription) {\r\n      this.dangerSignKdvSubscription.unsubscribe();\r\n    }\r\n  }\r\n\r\n  onInit() {\r\n    const kdvKey = `${GeoHazard[this.registration.geoHazard]}_DangerSignKDV`;\r\n    this.dangerSignKdvSubscription = this.kdvService\r\n      .getKdvRepositoryByKeyObservable(kdvKey)\r\n      .subscribe((val) => {\r\n        this.zone.run(() => {\r\n          this.dangerSignKdv = val;\r\n        });\r\n      });\r\n  }\r\n\r\n  async addOrEdit(index?: number) {\r\n    const dangerObs =\r\n      index !== undefined\r\n        ? this.registration.request.DangerObs[index]\r\n        : undefined;\r\n    const modal = await this.modalController.create({\r\n      component: AddOrEditDangerObsModalPage,\r\n      componentProps: { dangerObs, geoHazard: this.registration.geoHazard }\r\n    });\r\n    modal.present();\r\n    const result = await modal.onDidDismiss();\r\n    if (result.data) {\r\n      if (result.data.delete) {\r\n        this.removeAtIndex(index);\r\n      } else {\r\n        if (index !== undefined) {\r\n          this.setDangerObs(index, result.data);\r\n        } else {\r\n          this.addDangerObs(result.data);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  setDangerObs(index: number, dangerObs: DangerObsEditModel) {\r\n    this.zone.run(() => {\r\n      if (!this.registration.request.DangerObs) {\r\n        this.registration.request.DangerObs = [];\r\n      }\r\n      this.registration.request.DangerObs[index] = dangerObs;\r\n    });\r\n  }\r\n\r\n  addDangerObs(dangerObs: DangerObsEditModel) {\r\n    this.zone.run(() => {\r\n      if (!this.registration.request.DangerObs) {\r\n        this.registration.request.DangerObs = [];\r\n      }\r\n      this.registration.request.DangerObs.push(dangerObs);\r\n    });\r\n  }\r\n\r\n  removeAtIndex(index: number) {\r\n    this.zone.run(() => {\r\n      if (!this.registration.request.DangerObs) {\r\n        this.registration.request.DangerObs = [];\r\n      }\r\n      if (this.registration.request.DangerObs.length > 0) {\r\n        this.registration.request.DangerObs.splice(index, 1);\r\n      }\r\n    });\r\n  }\r\n\r\n  getSummaryText(dangerObs: DangerObsEditModel) {\r\n    const text = [];\r\n    if (dangerObs.DangerSignTID % 100 !== 0 && this.dangerSignKdv) {\r\n      const kdvElement = this.dangerSignKdv.find(\r\n        (x) => x.Id === dangerObs.DangerSignTID\r\n      );\r\n      if (kdvElement) {\r\n        text.push(kdvElement.Name.trim());\r\n      }\r\n    }\r\n    if (dangerObs.Comment) {\r\n      text.push(dangerObs.Comment);\r\n    }\r\n    return text.join(', ');\r\n  }\r\n}\r\n"]}