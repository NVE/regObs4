{"version":3,"file":"src_app_pages_offline-map_offline-map_module_ts-es2015.js","mappings":"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","sources":["./src/app/pages/offline-map/metadata.model.ts","./src/app/pages/offline-map/offline-map.module.ts","./src/app/pages/offline-map/offline-map.page.ts","./src/app/pages/offline-map/offline-map.page.html","./src/app/pages/offline-map/offline-package-modal/offline-package-modal.component.ts","./src/app/pages/offline-map/offline-package-modal/offline-package-modal.component.html"],"sourcesContent":["import type { BBox, Feature, Polygon } from 'geojson';\r\nimport moment, { Moment } from 'moment';\r\n\r\ntype XYZ = [number, number, number];\r\n\r\nexport interface PackageMetadata {\r\n  name: string;\r\n  lastModified: string;  // in UTC\r\n  urls: string[];\r\n  sizeInMib: number;\r\n}\r\n\r\nexport interface CompoundPackageMetadata {\r\n  id: string;\r\n  xyz: XYZ;\r\n  bbox: BBox;\r\n  sizeInMib: number;\r\n  maps: PackageMetadata[]\r\n}\r\n\r\nexport interface Part {\r\n  name: string;\r\n  url: string;\r\n}\r\n\r\nexport type CompoundPackageFeature = Feature<Polygon, null>;\r\n\r\nexport class CompoundPackage {\r\n\r\n  static GetNameFromXYZ(x: number, y: number, z: number) {\r\n    return `${x}-${y}-${z}`;\r\n  }\r\n\r\n  static GetFeatureId(x: number, y: number, z: number) {\r\n    return CompoundPackage.GetNameFromXYZ(x, y, z);\r\n  }\r\n\r\n  private metadata: CompoundPackageMetadata;\r\n\r\n  constructor(metadata: CompoundPackageMetadata) {\r\n    this.metadata = metadata;\r\n  }\r\n\r\n  getFeature(): CompoundPackageFeature {\r\n    const [xMin, yMin, xMax, yMax] = this.metadata.bbox;\r\n    return {\r\n      type: 'Feature',\r\n      geometry: {\r\n        bbox: this.metadata.bbox,\r\n        type: 'Polygon',\r\n        coordinates: [[\r\n          [xMin, yMin],\r\n          [xMin, yMax],\r\n          [xMax, yMax],\r\n          [xMax, yMin],\r\n          [xMin, yMin]\r\n        ]]\r\n      },\r\n      properties: null,\r\n      id: CompoundPackage.GetFeatureId(...this.metadata.xyz)\r\n    };\r\n  }\r\n\r\n  getSizeInMiB(): number {\r\n    return this.metadata.sizeInMib;\r\n  }\r\n\r\n  getName(): string {\r\n    const [x, y, z] = this.metadata.xyz;\r\n    return CompoundPackage.GetNameFromXYZ(x, y, z);\r\n  }\r\n\r\n  getLastModified(): Date {\r\n    if (this.metadata.maps.length === 0) {\r\n      return null;\r\n    }\r\n    return moment.max(this.metadata.maps.map(p => moment(p.lastModified))).toDate();\r\n  }\r\n\r\n  getParts(): Part[] {\r\n    return this.metadata.maps\r\n      // Hent name / url for alle pakker\r\n      .map((p) => p.urls.map(url => ({name: p.name, url})))\r\n      // Flatten array\r\n      .reduce((a, b) => a.concat(b), []);\r\n  }\r\n\r\n  getXYZ(): XYZ {\r\n    return this.metadata.xyz;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { OfflineMapPage } from './offline-map.page';\r\nimport { MapModule } from 'src/app/modules/map/map.module';\r\nimport { HttpClientModule } from '@angular/common/http';\r\nimport { SharedModule } from 'src/app/modules/shared/shared.module';\r\nimport { OfflinePackageModalComponent } from './offline-package-modal/offline-package-modal.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: OfflineMapPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    RouterModule.forChild(routes),\r\n    MapModule,\r\n    HttpClientModule,\r\n    SharedModule\r\n  ],\r\n  declarations: [OfflineMapPage, OfflinePackageModalComponent]\r\n})\r\nexport class OfflineMapPageModule {}\r\n","import { Component, NgZone } from '@angular/core';\r\nimport { OfflineMapService } from '../../core/services/offline-map/offline-map.service';\r\nimport { OfflineMapPackage } from '../../core/services/offline-map/offline-map.model';\r\nimport { HelperService } from '../../core/services/helpers/helper.service';\r\nimport { AlertController, ModalController } from '@ionic/angular';\r\nimport { BehaviorSubject, combineLatest, firstValueFrom, from, Observable, Subject } from 'rxjs';\r\nimport { debounceTime, filter, map, shareReplay, switchMap, takeUntil, tap, withLatestFrom } from 'rxjs/operators';\r\nimport * as L from 'leaflet';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { OfflinePackageModalComponent } from './offline-package-modal/offline-package-modal.component';\r\nimport { CompoundPackage, CompoundPackageMetadata, CompoundPackageFeature } from './metadata.model';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { NgDestoryBase } from 'src/app/core/helpers/observable-helper';\r\n\r\nconst PACKAGE_INDEX_URL = 'https://offlinemap.blob.core.windows.net/packages/packageIndex_v2.json';\r\nconst filledTileOpacity = 0.8;\r\nconst notFilledTileOpacity = 0.1;\r\nconst documentStyle = getComputedStyle(document.body);\r\nconst defaultTileStyle = {\r\n  color: documentStyle.getPropertyValue('--ion-color-primary'),\r\n  opacity: 1,\r\n  fillOpacity: notFilledTileOpacity\r\n};\r\nconst downloadedTileStyle = {\r\n  ...defaultTileStyle,\r\n  fillOpacity: filledTileOpacity,\r\n};\r\nconst errorTileStyle = {\r\n  ...downloadedTileStyle,\r\n  color: documentStyle.getPropertyValue('--ion-color-danger'),\r\n};\r\n\r\ntype PackageIndex = CompoundPackageMetadata[];\r\n\r\ninterface PackageTotals {\r\n  numPackages: number,\r\n  spaceUsed: string\r\n}\r\n\r\n@Component({\r\n  selector: 'app-offline-map',\r\n  templateUrl: './offline-map.page.html',\r\n  styleUrls: ['./offline-map.page.scss']\r\n})\r\nexport class OfflineMapPage extends NgDestoryBase {\r\n  private readonly installedPackages$: Observable<Map<string, OfflineMapPackage>>;\r\n  private installedPackages: Map<string, OfflineMapPackage> = new Map();\r\n  private failedPackageIds: string[] = []; //remember failed packages until features are ready for styling\r\n  private downloadAndUnzipProgress$: Observable<OfflineMapPackage[]>;\r\n  packageTotals$: Observable<PackageTotals>;\r\n  readonly allPackages$: Observable<OfflineMapPackage[]>;\r\n  private packagesOnServer$: Observable<Map<string, CompoundPackage>>;\r\n  private packagesOnServer: Map<string, CompoundPackage> = new Map();\r\n  showTileCard = true;\r\n  tilesLayer: L.GeoJSON;\r\n  // Could not get the click handler to only emit once per click, so wrapped this in a subject\r\n  showModal = new Subject<CompoundPackageFeature>();\r\n  isZooming = new BehaviorSubject<boolean>(false);\r\n  featureMap = new Map<string, { feature: CompoundPackageFeature, layer: L.Layer }>();\r\n  expanded = false; //show list of downloads if this is true\r\n\r\n  constructor(\r\n    private helperService: HelperService,\r\n    private modalController: ModalController,\r\n    private offlineMapService: OfflineMapService,\r\n    private alertController: AlertController,\r\n    private translateService: TranslateService,\r\n    private zone: NgZone,\r\n    http: HttpClient,\r\n  ) {\r\n    super();\r\n    // Download package index from azure\r\n    this.packagesOnServer$ = http.get<PackageIndex>(PACKAGE_INDEX_URL).pipe(\r\n      // Map downloaded package index to a packageName => package map\r\n      map((packageIndex) => {\r\n        const nameAndPkg: [string, CompoundPackage][] = packageIndex.map(p => [\r\n          CompoundPackage.GetNameFromXYZ(...p.xyz),\r\n          new CompoundPackage(p)\r\n        ]);\r\n        return new Map(nameAndPkg);\r\n      }),\r\n      shareReplay()\r\n    );\r\n\r\n    this.downloadAndUnzipProgress$ = this.offlineMapService.downloadAndUnzipProgress$\r\n      .pipe(map((items) => items.sort(((a, b) => b.downloadStart - a.downloadStart))));\r\n    this.installedPackages$ = this.offlineMapService.packages$\r\n      .pipe(map((downloaded) => new Map(downloaded.map((item) => [this.getFeatureIdForPackage(item), item]))));\r\n    this.allPackages$ = combineLatest([\r\n      this.offlineMapService.downloadAndUnzipProgress$,\r\n      this.offlineMapService.packages$\r\n    ]).pipe((map(([inProgress, downloaded]) => [...inProgress, ...downloaded])));\r\n\r\n    this.packageTotals$ = this.allPackages$.pipe(\r\n      map((packages) => {\r\n        let count = 0;\r\n        let space = 0;\r\n        for (const mapPackage of packages) {\r\n          count += 1;\r\n          space += mapPackage.size;\r\n        }\r\n        let spaceWithUnit = '0 MB';\r\n        if (space > 0) {\r\n          spaceWithUnit = this.humanReadableByteSize(space);\r\n        }\r\n        return { numPackages: count, spaceUsed: spaceWithUnit };\r\n      })\r\n    );\r\n  }\r\n\r\n  onMapReady(map: L.Map) {\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    (window as any).LEAFLET_MAP = map;\r\n\r\n    map.setZoom(7);\r\n\r\n    this.tilesLayer = new L.GeoJSON(null, {\r\n      onEachFeature: (feature: CompoundPackageFeature, layer) => {\r\n        this.featureMap.set(feature.id as string, { feature, layer });\r\n        layer.on('click', () => {\r\n          if(this.packagesOnServer.has(feature.id as string) || this.installedPackages.has(feature.id as string)) {\r\n            this.showModal.next(feature);\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    map.addLayer(this.tilesLayer);\r\n\r\n    this.packagesOnServer$.subscribe(packageMap => {\r\n      packageMap.forEach((mapPackage) => {\r\n        this.tilesLayer.addData(mapPackage.getFeature());\r\n      });\r\n    });\r\n\r\n    combineLatest([\r\n      this.installedPackages$,\r\n      this.packagesOnServer$\r\n    ])\r\n      .pipe(takeUntil(this.ngDestroy$))\r\n      .subscribe(([installedPackages, packagesOnServer]) => {\r\n        this.installedPackages = installedPackages;\r\n        this.packagesOnServer = packagesOnServer;\r\n        this.setStyleForPackages();\r\n      });\r\n\r\n    this.downloadAndUnzipProgress$.pipe(takeUntil(this.ngDestroy$)).pipe(\r\n      tap((itemsWithProgress) => {\r\n        this.failedPackageIds = itemsWithProgress.filter(item => item.error).map(item => item.name);\r\n      })\r\n    ).subscribe((itemsWithProgress) => {\r\n      this.zone.runOutsideAngular(() => {\r\n        for(const item of itemsWithProgress) {\r\n          this.setStyleForProgressOrDownloadedPackage(item);\r\n        }\r\n      });\r\n    });\r\n\r\n    this.showModal.pipe(\r\n      debounceTime(200),\r\n      withLatestFrom(this.isZooming),\r\n      filter(([, isZooming]) => !isZooming),\r\n      switchMap(([feature, ]) => from(this.showPackageModal(feature))),\r\n      takeUntil(this.ngDestroy$)\r\n    ).subscribe();\r\n\r\n    // This is to avoid pinch-zooming on map triggers click event\r\n    map.on('dragend zoomend', () => {\r\n      this.isZooming.next(false);\r\n    });\r\n    map.on('dragstart zoomstart', () => {\r\n      this.isZooming.next(true);\r\n    });\r\n  }\r\n\r\n  private setStyleForPackages() {\r\n    for(const [, item] of this.installedPackages) {\r\n      this.setStyleForProgressOrDownloadedPackage(item);\r\n    }\r\n    for(const [key, ] of this.packagesOnServer) {\r\n      let style = defaultTileStyle;\r\n      if(!this.installedPackages.has(key)) {\r\n        if (this.failedPackageIds.includes(key)) {\r\n          style = errorTileStyle;\r\n        }\r\n        this.setStyleForFeature(key, style);\r\n      }\r\n    }\r\n  }\r\n\r\n  private setStyleForFeature(id: string, style: L.PathOptions) {\r\n    const feature = this.featureMap.get(id);\r\n    if(feature) {\r\n      const polyline = (feature.layer as L.Polyline);\r\n      polyline.setStyle(style);\r\n    }\r\n  }\r\n\r\n  private setStyleForProgressOrDownloadedPackage(item: OfflineMapPackage) {\r\n    const id = this.getFeatureIdForPackage(item);\r\n    if (item.error) {\r\n      this.setStyleForFeature(id, errorTileStyle);\r\n    } else {\r\n      const fillOpacity = item.downloadComplete ? 0 : this.getProgressOpacity(item);\r\n      this.setStyleForFeature(id, { ...defaultTileStyle, fillOpacity });\r\n    }\r\n  }\r\n\r\n  private getProgressOpacity(item: OfflineMapPackage) {\r\n    const progressValue = (item.progress ? (item.progress.percentage / 2.0) : 0) + 0.4;\r\n    return Math.min(progressValue, filledTileOpacity);\r\n  }\r\n\r\n  private getFeaturePropertyId(x: number, y: number, z: number) {\r\n    return CompoundPackage.GetNameFromXYZ(x, y, z);\r\n  }\r\n\r\n  private getFeatureIdForPackage(map: OfflineMapPackage): string {\r\n    if(map.compoundPackageMetadata) {\r\n      return this.getFeaturePropertyId(...map.compoundPackageMetadata.getXYZ());\r\n    }\r\n    const firstMap = Object.keys(map.maps)[0];\r\n    if(map.maps[firstMap]) {\r\n      const rootTile = map.maps[firstMap].rootTile;\r\n      return this.getFeaturePropertyId(rootTile.x, rootTile.y, rootTile.z);\r\n    }\r\n    return '';\r\n  }\r\n\r\n\r\n  async showPackageModal(feature: CompoundPackageFeature) {\r\n    const compoundPackage = this.packagesOnServer.get(feature.id as string);\r\n    const name = compoundPackage.getName();\r\n    const modal = await this.modalController.create({\r\n      component: OfflinePackageModalComponent,\r\n      componentProps: {\r\n        feature: feature,\r\n        packageOnServer: compoundPackage,\r\n        offlinePackageStatus$: this.allPackages$.pipe(\r\n          map(packages => packages.find(p => p.name === name))),\r\n      },\r\n      swipeToClose: true,\r\n      mode: 'ios'\r\n    });\r\n    await modal.present();\r\n  }\r\n\r\n  showPackageModalForPackage(map: OfflineMapPackage) {\r\n    const feature = this.featureMap.get(map.name);\r\n    if (feature) {\r\n      this.showPackageModal(feature.feature);\r\n    }\r\n  }\r\n\r\n  humanReadableByteSize(bytes: number, fractionDigits = 0): string {\r\n    if (isNaN(bytes)) {\r\n      return '';\r\n    }\r\n    return this.helperService.humanReadableByteSize(bytes, fractionDigits, true);\r\n  }\r\n\r\n  formatProgressIfDownloading(map: OfflineMapPackage): string {\r\n    if (map.downloadStart && !map.downloadComplete) {\r\n      const value = Math.round((map.progress ? map.progress.percentage : 0) * 100);\r\n      return `(${value}%)`;\r\n    }\r\n    return '';\r\n  }\r\n\r\n  async cancelOrDelete(map: OfflineMapPackage, event: Event) {\r\n    event.stopPropagation();\r\n    if (this.isDownloaded(map)) {\r\n      const toTranslate = ['OFFLINE_MAP.DELETE_PACKAGE_CONFIRM', 'DIALOGS.CANCEL', 'DIALOGS.DELETE'];\r\n      const translations = await firstValueFrom(this.translateService.get(toTranslate));\r\n      const alert = await this.alertController.create({\r\n        message: translations['OFFLINE_MAP.DELETE_PACKAGE_CONFIRM'],\r\n        buttons: [\r\n          {\r\n            text: translations['DIALOGS.CANCEL'],\r\n            role: 'cancel'\r\n          },\r\n          {\r\n            text: translations['DIALOGS.DELETE'],\r\n            handler: () => {\r\n              this.offlineMapService.removeMapPackageByName(map.name);\r\n            }\r\n          }\r\n        ]\r\n      });\r\n      alert.present();\r\n    } else {\r\n      this.offlineMapService.cancelDownloadPackage(map);\r\n    }\r\n  }\r\n\r\n  isDownloaded(map: OfflineMapPackage): boolean {\r\n    return !!map.downloadComplete;\r\n  }\r\n\r\n  getSpaceAvailable(): string {\r\n    return this.humanReadableByteSize(this.offlineMapService.availableDiskspace?.available, 0);\r\n  }\r\n}\r\n","<ion-header>\r\n  <ion-toolbar appHeaderColor mode=\"ios\">\r\n    <ion-buttons slot=\"start\">\r\n      <ion-back-button text=\"\" defaultHref=\"/\"></ion-back-button>\r\n    </ion-buttons>\r\n    <ion-title>{{ 'OFFLINE_MAP.OFFLINE_MAP_PAGE_TITLE' | translate }}</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content>\r\n  <div class=\"map-container\">\r\n    <app-map\r\n      (mapReady)=\"onMapReady($event)\"\r\n      [offlinePackageMode]=\"true\"\r\n      [showScale]=\"false\"\r\n      [showMapSearch]=false\r\n      [showFullscreenToggle]=false\r\n      [showGpsCenter]=true\r\n      [showUserLocation]=\"true\"\r\n      [showSupportMaps]=\"false\"\r\n      [autoActivate]=\"true\"\r\n      [geoTag]=\"'package-map'\"\r\n    ></app-map>\r\n  </div>\r\n</ion-content>\r\n<ion-footer>\r\n  <ion-list>\r\n    <ion-item *ngIf=\"packageTotals$ | async as packageTotals\" (click)=\"expanded = !expanded\" lines=\"full\">\r\n      <ion-label *ngIf=\"packageTotals.numPackages === 1\" class=\"package-count\">{{ 'OFFLINE_MAP.PACKAGE_COUNT_SINGLE' | translate:{packageCount: packageTotals.numPackages} }}</ion-label>\r\n      <ion-label *ngIf=\"packageTotals.numPackages !== 1\" class=\"package-count\">{{ 'OFFLINE_MAP.PACKAGE_COUNT_MULTIPLE' | translate:{packageCount: packageTotals.numPackages} }}</ion-label>\r\n      <ion-label class=\"packages-size\">{{ packageTotals.spaceUsed }}</ion-label>\r\n      <ion-label class=\"space-available\">({{ 'OFFLINE_MAP.SPACE_AVAILABLE' | translate:{spaceAvailable: getSpaceAvailable()} }})</ion-label>\r\n      <ion-icon *ngIf=\"packageTotals.numPackages > 0\" slot=\"end\" [name]=\"expanded ? 'chevron-down-circle' : 'chevron-up-circle'\" class=\"expand-icon\"></ion-icon>\r\n    </ion-item>\r\n    <div class=\"footer\">\r\n      <ng-container *ngIf=\"expanded && allPackages$ | async as items\">\r\n        <ion-item (click)=\"showPackageModalForPackage(item)\" *ngFor=\"let item of items\" lines=\"full\">\r\n          <ion-label>{{ item.name }}</ion-label>\r\n          <ion-label>{{ humanReadableByteSize(item.size) }}</ion-label>\r\n          <ion-label>{{ formatProgressIfDownloading(item) }}</ion-label>\r\n          <ion-icon slot=\"end\" *ngIf=\"item.error\" name=\"warning-outline\"></ion-icon>\r\n          <ion-icon slot=\"end\" *ngIf=\"!(item.error)\" (click)=\"cancelOrDelete(item, $event)\" name=\"trash-outline\"></ion-icon>\r\n        </ion-item>\r\n      </ng-container>\r\n    </div>\r\n  </ion-list>\r\n</ion-footer>\r\n","import { Component, OnInit, ChangeDetectionStrategy, Input, ChangeDetectorRef } from '@angular/core';\r\nimport { ModalController } from '@ionic/angular';\r\nimport * as L from 'leaflet';\r\nimport { CompoundPackageFeature, CompoundPackage } from '../metadata.model';\r\nimport { OfflineMapService } from 'src/app/core/services/offline-map/offline-map.service';\r\nimport { Observable } from 'rxjs';\r\nimport { OfflineMapPackage } from 'src/app/core/services/offline-map/offline-map.model';\r\nimport { takeUntil, tap } from 'rxjs/operators';\r\nimport { NgDestoryBase } from 'src/app/core/helpers/observable-helper';\r\n\r\n/**\r\n * Shows detail info about a specific offline map package. From here you may download or delete the package.\r\n */\r\n@Component({\r\n  templateUrl: './offline-package-modal.component.html',\r\n  styleUrls: ['./offline-package-modal.component.css'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class OfflinePackageModalComponent extends NgDestoryBase implements OnInit {\r\n  @Input() feature: CompoundPackageFeature;\r\n  @Input() packageOnServer: CompoundPackage;\r\n  @Input() offlinePackageStatus$: Observable<OfflineMapPackage>;\r\n\r\n  zoom: number;\r\n  center: number[];\r\n  tileLayer: L.GeoJSON;\r\n  isCheckingAvailableDiskspace:boolean;\r\n\r\n  offlinePackageStatusThatTriggersChangeDetection$: Observable<OfflineMapPackage>;\r\n\r\n  constructor(\r\n    private modalController: ModalController,\r\n    private offlineMapService: OfflineMapService,\r\n    private cdr: ChangeDetectorRef,\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.isCheckingAvailableDiskspace = false;\r\n    this.offlinePackageStatusThatTriggersChangeDetection$ = this.offlinePackageStatus$.pipe(\r\n      tap(() => this.cdr.detectChanges() ));\r\n    this.tileLayer = new L.GeoJSON(this.feature);\r\n\r\n    // Set center from package bounds\r\n    const { lat, lng } = this.tileLayer.getBounds().getCenter();\r\n    this.center = [lat, lng];\r\n\r\n    // Use offline map package root tile as zoom level\r\n    const [, , z] = this.packageOnServer.getXYZ();\r\n    this.zoom = z;\r\n\r\n    this.offlineMapService.finishedPackageIds$.pipe(\r\n      takeUntil(this.ngDestroy$)).subscribe((packageName) => {\r\n      if (this.packageOnServer.getName() === packageName) {\r\n        this.dismiss(); //close when package is unzipped and ready to use\r\n      }\r\n    });\r\n  }\r\n\r\n  showTileOnMap(map: L.Map) {\r\n    this.tileLayer.addTo(map);\r\n  }\r\n\r\n  async startDownload(): Promise<void> {\r\n    this.isCheckingAvailableDiskspace = true;\r\n    this.cdr.detectChanges();\r\n\r\n    if(await this.offlineMapService.checkAvailableDiskSpace(this.packageOnServer)) {\r\n      this.offlineMapService.downloadPackage(this.packageOnServer);\r\n    }\r\n    this.isCheckingAvailableDiskspace = false;\r\n    this.cdr.detectChanges();\r\n  }\r\n\r\n  getPercentage(map: OfflineMapPackage): number {\r\n    return Math.round((map.progress ? map.progress.percentage : 0) * 100);\r\n  }\r\n\r\n  cancel(map: OfflineMapPackage) {\r\n    this.offlineMapService.cancelDownloadPackage(map);\r\n  }\r\n\r\n  delete() {\r\n    this.offlineMapService.removeMapPackageByName(this.packageOnServer.getName());\r\n  }\r\n\r\n  dismiss() {\r\n    this.modalController.dismiss({\r\n      'dismissed': true\r\n    });\r\n  }\r\n}\r\n","<ion-header translucent>\r\n  <ion-toolbar>\r\n    <ion-title>{{ 'OFFLINE_MAP.MAP_PACKAGE_DETAILS_PAGE.HEADER' | translate:{name: packageOnServer.getName()} }}</ion-title>\r\n    <ion-buttons slot=\"end\">\r\n      <ion-button (click)=\"dismiss()\">{{ 'CLOSE' | translate }}</ion-button>\r\n    </ion-buttons>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content>\r\n  <div class=\"map-container\" *ngIf=\"center\">\r\n    <app-map\r\n      [offlinePackageMode]=\"true\"\r\n      [showMapSearch]=false\r\n      [showFullscreenToggle]=false\r\n      [showGpsCenter]=false\r\n      [showUserLocation]=\"false\"\r\n      [showSupportMaps]=\"false\"\r\n      [center]=\"center\"\r\n      [zoom]=\"zoom\"\r\n      (mapReady)=\"showTileOnMap($event)\"\r\n    ></app-map>\r\n  </div>\r\n  <ion-grid>\r\n\r\n    <ion-row>\r\n      <ion-col size=\"4\">{{ 'OFFLINE_MAP.MAP_PACKAGE_DETAILS_PAGE.PACKAGE_PRODUCED_DATE' | translate }}</ion-col>\r\n      <ion-col>{{ packageOnServer.getLastModified() | date:'short' }}</ion-col>\r\n    </ion-row>\r\n\r\n    <ion-row>\r\n      <ion-col size=\"4\">{{ 'OFFLINE_MAP.MAP_PACKAGE_DETAILS_PAGE.PACKAGE_SIZE' | translate }}</ion-col>\r\n      <ion-col>{{ 'OFFLINE_MAP.MAP_PACKAGE_DETAILS_PAGE.PACKAGE_SIZE_VALUE_WITH_UNIT' | translate:{size: packageOnServer.getSizeInMiB() | number: '1.0-1'} }}</ion-col>\r\n    </ion-row>\r\n\r\n    <div *ngIf=\"offlinePackageStatusThatTriggersChangeDetection$ | async as packageStatus else downloadPackage\">\r\n      <ion-row>\r\n        <ion-col size=\"4\">{{ 'OFFLINE_MAP.MAP_PACKAGE_DETAILS_PAGE.PACKAGE_DOWNLOAD_STATUS' | translate }}</ion-col>\r\n        <ion-col>\r\n          {{ packageStatus.progress?.description }}\r\n          <span *ngIf=\"!!packageStatus.downloadComplete\">{{ 'OFFLINE_MAP.MAP_PACKAGE_DETAILS_PAGE.PACKAGE_DOWNLOADED_DATE' | translate:{date: packageStatus.downloadComplete * 1000 | date:'short'} }} </span>\r\n          <span *ngIf=\"!packageStatus.downloadComplete\">({{getPercentage(packageStatus) +'%' }})</span>\r\n        </ion-col>\r\n        <ion-col size=\"1\">\r\n          <ion-icon *ngIf=\"!!packageStatus.downloadComplete\" name=\"checkmark\"></ion-icon>\r\n          <ion-icon *ngIf=\"!packageStatus.error && packageStatus.progress?.step === 0\" name=\"stopwatch-outline\">\r\n          </ion-icon>\r\n          <ion-icon *ngIf=\"!packageStatus.error && packageStatus.progress?.step === 1\" name=\"cloud-download-outline\">\r\n          </ion-icon>\r\n          <ion-icon *ngIf=\"!packageStatus.error && packageStatus.progress?.step === 2\" name=\"folder-open-outline\">\r\n          </ion-icon>\r\n          <ion-icon *ngIf=\"packageStatus.error\" name=\"warning-outline\"></ion-icon>\r\n        </ion-col>\r\n      </ion-row>\r\n      <ion-row *ngIf=\"!packageStatus.downloadComplete && !packageStatus.error\">\r\n        <ion-col>\r\n          <ion-button expand=\"block\" color=\"danger\" (click)=\"cancel(packageStatus)\">{{ 'OFFLINE_MAP.MAP_PACKAGE_DETAILS_PAGE.CANCEL_DOWNLOAD_BUTTON' | translate }}</ion-button>\r\n        </ion-col>\r\n      </ion-row>\r\n      <ion-row *ngIf=\"packageStatus.error\">\r\n        <ion-col>\r\n          <ion-button expand=\"block\" color=\"varsom-orange\" (click)=\"startDownload()\">{{ 'OFFLINE_MAP.MAP_PACKAGE_DETAILS_PAGE.TRY_AGAIN_BUTTON' | translate }}</ion-button>\r\n        </ion-col>\r\n      </ion-row>\r\n      <ion-row *ngIf=\"!!packageStatus.downloadComplete || packageStatus.error\">\r\n        <ion-col>\r\n          <ion-button (click)=\"delete()\" expand=\"block\" color=\"danger\">{{ 'OFFLINE_MAP.MAP_PACKAGE_DETAILS_PAGE.DELETE_BUTTON' | translate }}</ion-button>\r\n        </ion-col>\r\n      </ion-row>\r\n    </div>\r\n  </ion-grid>\r\n</ion-content>\r\n\r\n<ng-template #downloadPackage>\r\n  <ion-row>\r\n    <ion-col>\r\n      <ion-button [disabled]=\"isCheckingAvailableDiskspace\" (click)=\"startDownload()\" expand=\"block\"\r\n        color=\"varsom-orange\">{{ 'OFFLINE_MAP.MAP_PACKAGE_DETAILS_PAGE.DOWNLOAD_BUTTON' | translate }}</ion-button>\r\n    </ion-col>\r\n  </ion-row>\r\n</ng-template>"],"names":[],"sourceRoot":"webpack:///"}